typeof jq=="undefined"&&(jq=jQuery.noConflict());typeof ASC=="undefined"&&(ASC={});typeof ASC.Files=="undefined"&&(ASC.Files=function(){return{}}());typeof ASC.Files.Constants=="undefined"&&(ASC.Files.Constants={});ASC.Files.Constants.REQUEST_STATUS_DELAY=2e3;ASC.Files.Constants.REQUEST_CONVERT_DELAY=500;ASC.Files.Constants.COUNT_ON_PAGE=30;ASC.Files.Constants.entryIdRegExpStr="(\\d+|[a-z]+-\\d+(-.+)*)";ASC.Files.Constants.storageKeyRecent="TeamLabRecentDocuments";ASC.Files.Constants.storageKeyCompactView="TeamLabDocumentsCompactView";ASC.Files.Constants.storageKeyUploaderCompactView="TeamLabDocumentsUploaderCompactView";ASC.Files.Common=function(){var t=function(n){if(typeof n=="undefined"||n===null||n===0)return!1;var t=new RegExp("^"+ASC.Files.Constants.entryIdRegExpStr);return t.test(n)},i=function(n){return jq.browser.safari||jq.browser.mozilla?encodeURI(n):n},r=function(t,i){var r="",f,u;if(typeof t=="object")if(t===null)typeof i!="undefined"&&(r+="<"+i+"><\/"+i+">");else if(t.constructor.toString().indexOf("Array")!==-1)for(u=0,f=t.length;u<f;u++)r+=typeof i!="undefined"?"<"+i+">"+arguments.callee(t[u])+"<\/"+i+">":arguments.callee(t[u]);else{for(u in t)r+=arguments.callee(t[u],u);typeof i!="undefined"&&(r="<"+i+">"+r+"<\/"+i+">")}else typeof t=="string"?(r=n(t),typeof i!="undefined"&&(r="<"+i+">"+r+"<\/"+i+">")):typeof t!="undefined"&&typeof t.toString!="undefined"&&(r=n(t.toString()),typeof i!="undefined"&&(r="<"+i+">"+r+"<\/"+i+">"));return r},n=function(n){return n.replace(/&/gim,"&amp;").replace(/</gim,"&lt;").replace(/>/gim,"&gt;")},u=function(){var n=jq.url.attr("protocol");return n+="://",n+=jq.url.attr("host"),jq.url.attr("port")!=null&&(n+=":",n+=jq.url.attr("port")),n},f=function(n){n||(n=window.event);n.cancelBubble=!0;n.stopPropagation&&n.stopPropagation()},e=new RegExp('[\t*+:"<>?|\\\\/]',"gim"),o=function(n){return(n||"").trim().replace(ASC.Files.Common.characterRegExp,"_")};return{getSitePath:u,cancelBubble:f,keyCode:{enter:13,esc:27,spaceBar:32,pageUP:33,pageDown:34,end:35,home:36,left:37,up:38,right:39,down:40,insertKey:45,deleteKey:46,A:65,C:67,F:70,N:78,a:97,c:99,f:102,n:110},characterString:'*+:"<>?|/',characterRegExp:e,replaceSpecCharacter:o,isCorrectId:t,getCorrectHash:i,jsonToXml:r,storeOriginal:!1}}();window.ASC.Files.TemplateManager=function(){var n=null,u=function(){return n||jq.ajax({url:ASC.Files.Constants.URL_TEMPLATES_HANDLER,async:!1,success:function(t){n=t}}),n},f=function(n){var t=u();return r(n,t)},e=function(n){var t,f;return typeof n=="undefined"?"":(t=n,typeof n=="string"&&(t=i(n)),f=u(),r(t,f))},i,r;try{var o=new ActiveXObject("Microsoft.XMLDOM"),s=new ActiveXObject("Microsoft.XMLHTTP"),t=o&&s}catch(h){t=!1}return i=function(){return t?function(n){if(typeof n!="string"||n.length===0)return undefined;var t=new ActiveXObject("Microsoft.XMLDOM");if(t.async="false",t.loadXML(n),t.parseError.errorCode!=0)throw"Can't create xml document";return t}:function(n){if(typeof n!="string"||n.length===0)return undefined;var t=new DOMParser;try{t=t.parseFromString(n,"text/xml")}catch(i){throw"Can't create xml document : "+i;}return t}}(),r=function(){function n(n,t){var u=new ActiveXObject("Microsoft.XMLDOM"),f=new ActiveXObject("MSXML2.FreeThreadedDOMDocument"),r,i;return u.load(n),f.load(t),r=new ActiveXObject("Msxml2.XSLTemplate"),r.stylesheet=f,i=r.createProcessor(),i.input=u,i.transform(),i.output}return t?function(t,i){var r="";if(typeof t=="undefined"||t==null||typeof i=="undefined"||i==null)return r;try{i.resolveExternals=!0}catch(u){}try{try{r=t.transformNode(i)}catch(f){r=n(t,i)}}catch(u){throw"Can't translate xml : "+u;}return r}:function(n,t){var i="",u,r,f;if(typeof n=="undefined"||typeof t=="undefined")return i;try{r=new XSLTProcessor;r.importStylesheet(t);u=r.transformToFragment(n,document)}catch(e){throw"Can't translate xml : "+e;}try{f=new XMLSerializer;i=f.serializeToString(u)}catch(e){throw"Can't serialized xml : "+e;}return i}}(),{createXML:i,translate:f,translateFromString:e}}();window.ASC.Files.ServiceManager=function(){var f=!1,e,a="/",v=6e4,t={},i=!0,r=[],y=function(n){if(typeof n!="string"||n.length===0)throw"Incorrect service path";e=n[n.length-1]==="/"?n:n+"/";f=!0},u=[],p=5e3,w=function(){return[ASC.Files.ServiceManager.events.GetFolderItems,ASC.Files.ServiceManager.events.GetFileHistory,ASC.Files.ServiceManager.events.GetNews,ASC.Files.ServiceManager.events.GetSiblingsImage,ASC.Files.ServiceManager.events.GetThirdParty,ASC.Files.ServiceManager.events.GetHelpCenter,ASC.Files.ServiceManager.events.GetTreePath,]},b=function(n,t){for(var r,f,i=0;i<u.length;i++)if(r=u[i],r.eventType==n&&r.params==JSON.stringify(t)){if(f=new Date-r.timeStamp,0<f&&f<p)return c.apply(this,r.data),!0;u.splice(i,1);i--}return!1},o=function(n){return(typeof n!="undefined"?n+"-":"")+Math.floor(Math.random()*1e6)},k=function(n,t){for(var r=0,i=o();n.hasOwnProperty(i)&&r++<1e3;)i=o(t);return i},s=function(n,i,r){var u,f;if(n=n.toLowerCase(),i=i||window,r=r||[],t.hasOwnProperty(n)){u=t[n];for(f in u)u.hasOwnProperty(f)&&(u[f].handler.apply(i,r),u[f].type&1&&delete u[f])}},d=function(n,i,r){var e,u,f;return typeof n!="string"||typeof i!="function"?undefined:(n=n.toLowerCase(),typeof r!="object"&&(r={}),e=r.hasOwnProperty("once")?r.once:!1,u=0,u|=+e*1,t.hasOwnProperty(n)||(t[n]={}),f=k(t[n]),t[n][f]={handler:i,type:u},f)},g=function(n,i){return typeof n!="string"||typeof i=="undefined"?!1:(t(n)&&t[n].hasOwnProperty(i)&&delete userEventHandlers[n][i],!0)},nt=function(){var t,n,r,i;if(f||y(ASC.Files.Constants.URL_WCFSERVICE),t=e,arguments.length===0)return t;for(n=0,r=arguments.length-1;n<r;n++)t+=arguments[n]+a;return i=t+arguments[n],i+((i.search(/\?/)>0?"&":"?")+"_="+(new Date).getTime())},h=function(n){return!n||typeof n!="object"?"":n.text||n.textContent||function(n){var t="",u=n.childNodes,i,f,r;if(!u)return t;for(i=0,f=u.length;i<f;i++){r=u.item(i);switch(r.nodeType){case 1:case 5:t+=arguments.callee(r);break;case 3:case 2:case 4:t+=r.nodeValue}}return t}(n)},c=function(n,t,u,f,e){var y,c,w,k;if(i=!0,typeof LoadingBanner!="undefined"&&typeof LoadingBanner.hideLoading!="undefined"&&LoadingBanner.hideLoading(),e==="error"){var o="",b="",a=null,p,v=null;if(f.responseXML){if(a=f.responseXML.getElementsByTagName("message")[0],p=f.responseXML.getElementsByTagName("inner")[0],p&&(v=p.getElementsByTagName("message")[0]),o==="")try{o=eval("["+f.responseText+"]")[0].Detail}catch(d){y=document.createElement("div");o=jq("#content",jq(y).html(f.responseText)).text()}}else if(f.responseText&&(y=document.createElement("div"),o=jq("#content",jq(y).html(f.responseText)).text(),o===""))try{o=eval("["+f.responseText+"]")[0].Detail}catch(d){}a&&typeof a=="object"&&(o=h(a));v&&typeof v=="object"&&(b=h(v));s(n,window,[undefined,t,b||o]);return}if(w="<!DOCTYPE",f.responseText&&f.responseText.indexOf(w)!=0)try{switch(u){case"xml":c=ASC.Files.TemplateManager.createXML(f.responseText);break;case"json":c=jq.parseJSON(f.responseText);break;default:f.responseXML.xml.indexOf(w)!=0&&(c=ASC.Files.TemplateManager.createXML(f.responseXML.xml)||jq.parseJSON(f.responseText))}}catch(d){c=f.responseText}s(n,window,[c,t]);r.length!=0&&i==!0&&(k=r.shift(),i=!1,l(k))},tt=function(n,t,i){return function(){for(var r=[n,t,i],f=0,e=arguments.length;f<e;f++)r.push(arguments[f]);jq.inArray(n,w())>=0&&u.push({eventType:n,params:JSON.stringify(t),timeStamp:new Date,data:r});c.apply(this,r)}},n=function(n,t,u,f){var e,s,c;if(typeof n!="undefined"&&typeof t!="undefined"&&typeof u=="string"&&(typeof f=="undefined"&&(f={}),!b(u,f))){(typeof LoadingBanner=="undefined"||typeof LoadingBanner.displayLoading=="undefined")&&(f.showLoading=!1);var a={},h=[],o=f.ajaxcontentType||"application/xml";typeof f!="object"&&(f={});switch((n||"").toLowerCase()){case"delete":case"get":for(e=4,s=arguments.length;e<s;e++)h.push(arguments[e]);break;case"post":for(a=o=="text/xml"||o=="application/xml"?ASC.Files.Common.jsonToXml(arguments[4]):o=="application/json"?JSON.stringify(arguments[4]):arguments[4],e=5,s=arguments.length;e<s;e++)h.push(arguments[e]);break;default:return}c={async:f.ajaxsync!=!0,data:a,type:n,dataType:t,contentType:o,cache:!0,url:nt.apply(this,h),timeout:v,beforeSend:function(){if(f.showLoading)ASC.Files.Folders&&ASC.Files.Folders.isFirstLoad||(LoadingBanner.displayLoading(),jq(".advansed-filter").advansedFilter("resize"));else return null},complete:tt(u,f,t)};r.length==0&&i==!0?(i=!1,l(c)):r.push(c)}},l=function(n){jq.ajax({async:n.async,data:n.data,type:n.type,dataType:n.dataType,contentType:n.contentType,cache:n.cache,url:n.url,timeout:n.timeout,beforeSend:n.beforeSend,complete:n.complete})},it=function(t,i){i.ajaxsync=!0;n("get","xml",t,i,"folders-create?parentId="+encodeURIComponent(i.parentFolderID)+"&title="+encodeURIComponent(i.title))},rt=function(t,i){i.ajaxsync=!0;n("get","xml",t,i,"folders-files-createfile?parentId="+encodeURIComponent(i.folderID)+"&title="+encodeURIComponent(i.fileTitle))},ut=function(t,i,r){i.showLoading=i.append!=!0;n("post","xml",t,i,r,"folders?parentId="+encodeURIComponent(i.folderId)+"&from="+i.from+"&count="+i.count+"&filter="+i.filter+"&subjectID="+i.subject+"&search="+encodeURIComponent(i.text))},ft=function(t,i){n("get","xml",t,i,"folders-subfolders?parentId="+encodeURIComponent(i.folderId))},et=function(t,i){n("get","json",t,i,"folders-path?folderId="+encodeURIComponent(i.folderId))},ot=function(t,i){n("get","json",t,i,"folders-folder?folderId="+encodeURIComponent(i.folderId))},st=function(t,i,r){n("post","json",t,i,r,"folders-intries?filter="+i.filter+"&subjectID="+i.subject+"&search="+encodeURIComponent(i.text))},ht=function(t,i){i.ajaxsync=!0;n("get","xml",t,i,"folders-files-getversion?fileId="+encodeURIComponent(i.fileId)+"&version="+(i.version||-1))},ct=function(t,i){n("get","xml",t,i,"folders-files-history?fileId="+encodeURIComponent(i.fileId))},lt=function(t,i){n("get","json",t,i,"folders-files-updateToVersion?fileId="+encodeURIComponent(i.fileId)+"&version="+i.version)},at=function(t,i){n("get","json",t,i,"folders-files-updateComment?fileId="+encodeURIComponent(i.fileId)+"&version="+i.version+"&comment="+encodeURIComponent(i.comment))},vt=function(t,i){n("get","json",t,i,"folders-files-completeversion?fileId="+encodeURIComponent(i.fileId)+"&version="+i.version+"&continueVersion="+i.continueVersion)},yt=function(t,i,r){n("post","json",t,i,r,"folders-files-siblings?fileId="+encodeURIComponent(i.fileId)+"&filter="+i.filter+"&subjectID="+i.subjectId+"&search="+encodeURIComponent(i.search))},pt=function(t,i){n("get","xml",t,i,"folders-rename?folderId="+encodeURIComponent(i.folderId)+"&title="+encodeURIComponent(i.newname))},wt=function(t,i){n("get","xml",t,i,"folders-files-rename?fileId="+encodeURIComponent(i.fileId)+"&title="+encodeURIComponent(i.newname))},bt=function(t,i,r){n("post","json",t,i,r,"folders-files-moveOrCopyFilesCheck?destFolderId="+encodeURIComponent(i.folderToId))},kt=function(t,i,r){n("post","json",t,i,r,"moveorcopy?destFolderId="+encodeURIComponent(i.folderToId)+"&resolve="+i.resolve+"&ic="+(i.isCopyOperation==!0))},dt=function(t,i,r){n("post","json",t,i,r,"folders-files?action=delete")},gt=function(t,i){n("get","json",t,i,"emptytrash")},ni=function(t,i,r){i.showLoading=!0;i.ajaxcontentType="application/json";n("post","json",t,i,r,"bulkdownload")},ti=function(t,i){n("get","json",t,i,"tasks-statuses")},ii=function(t,i){n("get","json",t,i,"tasks")},ri=function(t,i){n("get","json",t,i,"trackeditfile?fileId="+encodeURIComponent(i.fileID)+"&tabId="+i.tabId+"&docKeyForTrack="+i.docKeyForTrack+"&isFinish="+(i.finish==!0)+i.shareLinkParam)},ui=function(t,i,r){n("post","json",t,i,r,"checkediting")},fi=function(t,i){n("get","json",t,i,"startEdit?fileId="+encodeURIComponent(i.fileID)+i.shareLinkParam)},ei=function(t,i){n("get","json",t,i,"setacelink?fileId="+encodeURIComponent(i.fileId)+"&share="+i.share)},oi=function(t,i,r){n("post","json",t,i,r,"sharedinfo")},si=function(t,i){n("get","json",t,i,"sharedinfoshort?objectId="+encodeURIComponent(i.objectID))},hi=function(t,i,r){n("post","json",t,i,r,"setaceobject?notify="+(i.notify===!0))},ci=function(t,i,r){n("post","json",t,i,r,"removeace")},li=function(t,i){n("get","json",t,i,"shorten?fileId="+encodeURIComponent(i.fileId))},ai=function(t,i,r){n("post","json",t,i,r,"checkconversion")},vi=function(t,i){n("get","json",t,i,"storeoriginal?set="+i.value)},yi=function(t,i){n("get","json",t,i,"updateifexist?set="+i.value)},pi=function(t,i){i.showLoading=!0;ASC.Files.Folders.isFirstLoad=!1;n("get","json",t,i,"thirdparty-list?folderType="+(i.folderType||0))},wi=function(t,i,r){n("post","json",t,i,r,"thirdparty-save")},bi=function(t,i){n("get","json",t,i,"thirdparty-delete?providerId="+i.providerId)},ki=function(t,i){n("get","json",t,i,"thirdparty?enable="+(i.enable===!0))},di=function(t,i,r){i.ajaxcontentType="application/json";n("post","json",t,i,r,"docusign-save")},gi=function(t,i){n("get","json",t,i,"docusign-delete")},nr=function(t,i,r){n("post","json",t,i,r,"docusign?fileId="+encodeURIComponent(i.fileId))},tr=function(t,i,r){n("post","json",t,i,r,"markasread")},ir=function(t,i){n("get","xml",t,i,"getnews?folderId="+encodeURIComponent(i.folderId))},rr=function(t,i){n("get","xml",t,i,"folders-files-lock?fileId="+encodeURIComponent(i.fileId)+"&lockfile="+(i.lock===!0))},ur=function(t,i){n("get","json",t,i,"edit-history?fileId="+encodeURIComponent(i.fileID)+i.shareLinkParam)},fr=function(t,i){n("get","json",t,i,"edit-diff-url?fileId="+encodeURIComponent(i.fileID)+"&version="+i.version+i.shareLinkParam)},er=function(t,i){n("get","json",t,i,"restore-version?fileId="+encodeURIComponent(i.fileID)+"&version="+i.version+"&url="+encodeURIComponent(i.url)+i.shareLinkParam)},or=function(t,i){n("get","json",t,i,"mailaccounts")},sr=function(t,i){n("get","json",t,i,"gethelpcenter")},hr=function(t,i,r){n("post","json",t,i,r,"changeowner?userId="+i.userId)};return{bind:d,unbind:g,events:{CreateNewFile:"createnewfile",CreateFolder:"createfolder",CheckEditing:"checkediting",GetTreeSubFolders:"gettreesubfolders",GetTreePath:"gettreepath",GetThirdPartyTree:"getthirdpartytree",GetFolderInfo:"getfolderinfo",GetFolderItems:"getfolderitems",GetItems:"getitems",GetFolderItemsTree:"getfolderitemstree",SetAceLink:"setacelink",GetSharedInfo:"getsharedinfo",GetSharedInfoShort:"getsharedinfoshort",SetAceObject:"setaceobject",UnSubscribeMe:"unsubscribeme",GetShortenLink:"getshortenlink",MarkAsRead:"markasread",GetNews:"getnews",ChangeOwner:"changeowner",FolderRename:"folderrename",FileRename:"filerename",DeleteItem:"deleteitem",EmptyTrash:"emptytrash",GetFileHistory:"getfilehistory",ReplaceVersion:"replaceversion",SetCurrentVersion:"setcurrentversion",UpdateComment:"updatecomment",CompleteVersion:"completeversion",Download:"download",GetTasksStatuses:"getTasksStatuses",TerminateTasks:"terminatetasks",MoveFilesCheck:"movefilescheck",MoveItems:"moveitems",GetSiblingsImage:"getsiblingsimage",GetThirdParty:"getthirdparty",SaveThirdParty:"savethirdparty",DeleteThirdParty:"deletethirdparty",ChangeAccessToThirdparty:"changeaccesstothirdparty",SaveDocuSign:"savedocusign",SendDocuSign:"senddocusign",UpdateIfExist:"updateifexist",GetHelpCenter:"gethelpcenter",StoreOriginalFiles:"storeoriginalfiles",ConvertCurrentFile:"convertcurrentfile",ChunkUploadCheckConversion:"chunkuploadcheckconversion",ChunkUploadGetFileFromServer:"chunkuploadgetfilefromserver",TrackEditFile:"trackeditfile",StartEdit:"startedit",LockFile:"lockfile",GetEditHistory:"getedithistory",GetDiffUrl:"getdiffurl",RestoreVersion:"restoreversion",GetMails:"getmails",StartMailMerge:"startmailmerge"},createFolder:it,createNewFile:rt,getFolderItems:ut,getTreeSubFolders:ft,getTreePath:et,getFolder:ot,getItems:st,getFile:ht,getFileHistory:ct,setCurrentVersion:lt,updateComment:at,completeVersion:vt,getSiblingsImage:yt,renameFolder:pt,renameFile:wt,changeOwner:hr,moveFilesCheck:bt,moveItems:kt,deleteItem:dt,emptyTrash:gt,download:ni,getTasksStatuses:ti,terminateTasks:ii,trackEditFile:ri,checkEditing:ui,startEdit:fi,setAceLink:ei,getSharedInfo:oi,getSharedInfoShort:si,setAceObject:hi,unSubscribeMe:ci,getShortenLink:li,checkConversion:ai,storeOriginalFiles:vi,updateIfExist:yi,getThirdParty:pi,saveThirdParty:wi,deleteThirdParty:bi,changeAccessToThirdparty:ki,saveDocuSign:di,deleteDocuSign:gi,sendDocuSign:nr,markAsRead:tr,getNews:ir,lockFile:rr,getEditHistory:ur,getDiffUrl:fr,restoreVersion:er,getMailAccounts:or,getHelpCenter:sr}}();window.ASC.Files.UI=function(){var n=!1,i=new PopupBox("pb_filesUserProfileInfo",320,140,"tintLight","borderBaseShadow","",{apiMethodName:"Teamlab.getProfile",tmplName:"userProfileCardTmpl"}),r=function(){n===!1&&(n=!0);jq(window).resize(function(){t();ASC.Files.UI.fixContentHeaderWidth()});jq(window).bind("resizeWinTimerWithMaxDelay",function(){t();ASC.Files.UI.fixContentHeaderWidth()})},u=function(){},f=function(n,t){return n&&t?ASC.Files.Common.isCorrectId(t)?jq("#filesMainContent .file-row"+ASC.Files.UI.getSelectorId(n+"_"+t)):null:null},e=function(n){return'[data-id="'+(n+"").replace(/\\/g,"\\\\").replace(/\"/g,'\\"')+'"]'},o=function(n){var i,r,u,t;if(n=jq(n),i='input:hidden[name="entry_data"]',n.is(".file-row")||(r=".file-row",n.is(".jstree *")&&(r=".tree-node",i='> a input:hidden[name="entry_data"]'),n=n.closest(r)),n.length==0)return null;u=n.find(i).val();t=null;try{t=jq.parseJSON(u||null)}catch(f){console&&console.log&&console.log("Error parseJSON: \n"+u)}return t?(t.id=t.entryId=n.find(i).attr("data-id"),!ASC.Files.Common.isCorrectId(t.id))?null:(t.entryType=t.entryType==="file"?"file":"folder",t.create_by=n.find('input:hidden[name="create_by"]').val(),t.modified_by=n.find('input:hidden[name="modified_by"]').val(),t.comment=n.find('input:hidden[name="comment"]').val(),t.entryObject=n,t.error=t.error!=""?t.error:!1,t.title=(t.title||"").trim(),t):null},s=function(n){if(typeof n=="undefined"||n==null)return null;var t=n.indexOf("file_")=="0"?"file":"folder",i=n.substring((t+"_").length);return ASC.Files.Common.isCorrectId(i)?{entryType:t,entryId:i}:null},h=function(n,t){return ASC.Files.Common.isCorrectId(t)?ASC.Files.UI.getObjectTitle(ASC.Files.UI.getEntryObject(n,t)):null},c=function(n){return(n=jq(n),n.is(".file-row")||(n=n.closest(".file-row")),n.length==0)?null:ASC.Files.UI.getObjectData(n).title.trim()},l=function(n,t,i){if(n=="file"){var r=ASC.Files.Utility.GetFileDownloadUrl(t);ASC.Files.Utility.CanWebEdit(i)&&!ASC.Files.Utility.MustConvert(i)?r=ASC.Files.Utility.GetFileWebEditorUrl(t):ASC.Files.Utility.CanWebView(i)?r=ASC.Files.Utility.GetFileWebViewerUrl(t):typeof ASC.Files.ImageViewer!="undefined"&&ASC.Files.Utility.CanImageView(i)&&(r="#"+ASC.Files.Common.getCorrectHash(ASC.Files.ImageViewer.getPreviewHash(t)))}else r=ASC.Files.Constants.URL_BASE+"#"+ASC.Files.Common.getCorrectHash(t);return r},a=function(){if(!ASC.Files.Common.isCorrectId(ASC.Files.Folders.currentFolder.id)){ASC.Files.Anchor.move("");return}ASC.Files.UI.hideAllContent(!0);ASC.Files.UI.stickContentHeader();ASC.Files.Folders.getFolderItems(!1)},v=function(n){var t=ASC.Files.Constants.storageKeyCompactView;typeof n=="undefined"&&(n=localStorageManager.getItem(t)===!0);localStorageManager.setItem(t,n);jq("#switchViewFolder").toggleClass("compact",n===!0);jq("#filesMainContent").toggleClass("compact",n===!0);ASC.Files.Folders.showMore&&n!==!0&&jq(document).height()-jq(window).height()<=jq(window).scrollTop()+350&&ASC.Files.Folders.showMore();ASC.Files.Mouse&&ASC.Files.Mouse.updateMainContentArea()},y=function(){return jq("#settingCommon, #settingThirdPartyPanel, #helpPanel").is(":visible")},p=function(){var n=jq("#mainContentHeader.stick-panel:visible");n.css("width",n.parent().innerWidth()-parseInt(n.css("margin-left"))-parseInt(n.css("margin-right")))},t=function(){var n=jq("#mainContentHeader.stick-panel:visible"),t=jq(window);n.length!=0&&n.css("left",n.parent().offset().left-t.scrollLeft())},w=function(){var n=jq("#mainContentHeader .down_arrow"),t,i;n.length&&(t=n.offset().top+n.outerHeight(),i=jq("#filesSelectorPanel:visible"),ASC.Files.UI.stickMovingPanel("mainContentHeader",i,t,!1),ASC.Files.UI.fixContentHeaderWidth())},b=function(n,t,i,r){var u=jq("#"+n),e,f,s,c,o,l;if(u.is(":visible"))if(e="Spacer",f=jq("#"+n+e),s=jq("#"+n+e+":visible").length==0?u.offset().top:f.offset().top,i=i||0,c=jq(window),o=c.scrollTop(),o>=s){var a=u.outerHeight(),h=u.parent(),v=h.innerHeight()-parseInt(h.css("padding-top"))-parseInt(h.css("padding-bottom"));(!u.hasClass("stick-panel")||jq.browser.mobile)&&(!r||o-s<v-a)&&(f.length==0&&(l=document.createElement("div"),l.id=n+e,document.body.appendChild(l),f=jq("#"+n+e),f.insertAfter(u),f.css({height:u.css("height"),"padding-top":u.css("padding-top"),"padding-bottom":u.css("padding-bottom")})),f.show(),u.addClass("stick-panel").css("left",h.offset().left-c.scrollLeft()),t&&t.css({position:"fixed",top:i-o}),jq.browser.mobile&&u.css({top:jq(document).scrollTop()+"px",position:"absolute"}));r&&u.hasClass("stick-panel")&&u.css("top",-Math.max(0,o-s-(v-a)))}else u.hasClass("stick-panel")&&(f.hide(),u.removeClass("stick-panel"),jq("#mainContentHeader").css("width","auto"),t&&t.css({position:"absolute",top:i}),jq.browser.mobile&&u.css({position:"static"}))},k=function(n,t,i,r,u){return ASC.Files.UI.blockObject(ASC.Files.UI.getEntryObject(n,t),i,r,u)},d=function(n,t,i,r){if(t=t===!0,n=jq(n),n.length&&n.hasClass("checkloading")!=t){jq(n).removeClass("row-hover");n.toggleClass("loading checkloading",t===!0);t===!0?(n.block({message:"",baseZ:99}),typeof i!="undefined"&&i&&n.children("div.blockUI.blockOverlay").attr("title",i)):(n.unblock(),n.css("position","static"));var u=n.hasClass("row-selected"),f=n.attr("data-selected")=="true";ASC.Files.UI.selectRow(n,!t&&f);t&&n.attr("data-selected",u);r||ASC.Files.UI.updateMainContentHeader()}},g=function(n){return!n.hasClass("folder-row")&&n.hasClass("on-edit")},nt=function(n){return n.hasClass("file-locked-by")},tt=function(n){var t=n.entryObject,i=n.entryType,r=n.title;return i=="file"&&ASC.Files.Folders.folderContainer!="trash"&&!t.hasClass("row-rename")&&ASC.Files.UI.accessEdit(n,t,!0)&&ASC.Files.Utility.CanWebEdit(r)},it=function(n,t){var i=ASC.Files.Utility.GetFileExtension(t),r=t.substring(0,t.length-i.length);n.html('{0}<span class="file-extension">{1}<\/span>'.format(r,i))},rt=function(n){var t=n||jq("#filesMainContent .file-row");t.each(function(){var t=ASC.Files.UI.getObjectData(this),o=t.entryId,i=t.entryType,n=t.entryObject,f=t.title,r,h,u,e,s,c;ASC.Files.Folders.folderContainer=="trash"?(n.find(".file-lock").remove(),n.find(".entry-descr .title-created").remove(),n.find(".entry-descr .title-removed").show(),i=="folder"&&(n.find(".create-date").remove(),n.find(".modified-date").show())):(n.find(".entry-descr .title-removed").remove(),i=="folder"&&n.find(".modified-date").remove());r=n.find(".entry-title .name a");h=i=="file"?ASC.Files.Utility.getCssClassByFileTitle(f):ASC.Files.Utility.getFolderCssClass();n.find(".thumb-"+i).addClass(h);n.hasClass("checkloading")||(i=="file"?(r.is(":not(:has(.file-extension))")&&ASC.Files.UI.highlightExtension(r,f),ASC.Files.Folders.folderContainer!="trash"&&(u=ASC.Files.UI.getEntryLink(i,o,f),r.attr("href",u).attr("target","_blank"),e=n.find(".file-lock"),ASC.Files.UI.accessEdit(t,n)?n.hasClass("file-locked")&&(s=ASC.Files.FilesJSResources.TitleLockedFile,ASC.Files.UI.lockedForMe(n)&&(c=e.attr("data-name"),s=ASC.Files.FilesJSResources.TitleLockedFileBy.format(c)),e.attr("title",s)):e.remove()),ASC.Files.Utility.MustConvert(f)?(n.find(".pencil:not(.convert-action)").remove(),Teamlab.profile.isVisitor&&!ASC.Files.UI.accessEdit()||ASC.Files.Folders.folderContainer=="trash"?n.find(".convert-action").remove():n.find(".convert-action").show()):ASC.Files.UI.editableFile(t)?(ASC.Files.UI.lockEditFile(n,ASC.Files.UI.editingFile(n)),n.find(".convert-action").remove(),ASC.Files.Utility.CanCoAuhtoring(f)&&!n.hasClass("on-edit-alone")&&n.addClass("can-coauthoring"),u=ASC.Files.Utility.GetFileWebEditorUrl(o),n.find(".file-edit").attr("href",u)):(n.addClass("cannot-edit"),n.find(".pencil").remove())):ASC.Files.Folders.folderContainer!="trash"&&(u=ASC.Files.UI.getEntryLink(i,o),r.attr("href",u)),(ASC.Files.Folders.folderContainer=="trash"||t.error)&&r.attr("href",ASC.Files.UI.getEntryLink("folder",ASC.Files.Folders.currentFolder.id)),jq("#filesMainContent").hasClass("without-share")||(ASC.Files.Folders.folderContainer!="forme"||ASC.Files.UI.accessEdit(t,n))&&(!ASC.Resources.Master.Personal||i!="folder")&&Teamlab.profile.isVisitor!==!0||n.addClass("without-share"),jq.browser.msie&&n.find("*").attr("unselectable","on"))});jq("#switchToNormal").length&&ASC.Files.UI.switchFolderView()},ut=function(n,t){var i=jq.fixEvent(n),r,u;if(!(i.button==0||jq.browser.msie&&i.button==1))return!0;t=t||jq(i.srcElement||i.target);try{if(t.is("a, .menu-small"))return!0}catch(i){return!0}if(r=t.is(".file-row")?t:t.closest(".file-row"),u=!jq(r).hasClass("row-selected")||jq(r).find(".checkbox input:visible").is("[type=radio]"),i.shiftKey&&ASC.Files.UI.lastSelectedEntry&&ASC.Files.UI.lastSelectedEntry.entryObj){u=!0;var f=jq(".file-row").index(r),e=jq(".file-row").index(ASC.Files.UI.lastSelectedEntry.entryObj),o=Math.min(f,e),s=Math.max(f,e);jq(".file-row:lt("+s+"):gt("+o+")").each(function(){ASC.Files.UI.selectRow(jq(this),u)})}else i.ctrlKey||t.is(".checkbox, .checkbox input")||(jq(".row-selected").length>1&&(u=!0),ASC.Files.UI.checkSelectAll(!1));return ASC.Files.UI.selectRow(r,u),ASC.Files.UI.updateMainContentHeader(),ASC.Files.UI.lastSelectedEntry={entryObj:r},!0},ft=function(){ASC.Files.UI.resetSelectAll(jq("#filesMainContent .file-row:has(.checkbox input:visible:not(:checked))").length==0);jq("#filesMainContent .file-row:has(.checkbox input:checked)").length==0?(jq("#mainContentHeader .menuAction.unlockAction").removeClass("unlockAction"),ASC.Files.Folders.folderContainer=="trash"&&jq("#mainEmptyTrash").addClass("unlockAction")):ASC.Files.Actions&&ASC.Files.Actions.showActionsViewPanel();typeof ASC.Files.UI.filesSelectedHandler=="function"&&ASC.Files.UI.filesSelectedHandler()},et=function(n,t){return n?(n.hasClass("file-row")||(n=n.closest(".file-row")),n.hasClass("row-selected")==t)?!1:n.hasClass("checkloading")&&t?!1:((n.hasClass("new-folder")||jq(n).hasClass("row-rename"))&&(t=!1),t===!0&&n.find(".checkbox input:visible").is("[type=radio]")&&(jq("#filesMainContent .checkbox input:checked").prop("checked",!1),jq("#filesMainContent .file-row.row-selected").removeClass("row-selected")),n.find(".checkbox input").prop("checked",t===!0),n.toggleClass("row-selected",t).removeAttr("data-selected"),jq("#filesMainContent .menu-small.active").removeClass("active"),!0):!1},ot=function(n){jq("#filesSelectAllCheck").prop("checked",n===!0);var t=n!==!0&&jq("#filesMainContent .file-row .checkbox input:checked").length!=0;jq("#filesSelectAllCheck").prop("indeterminate",t).toggleClass("indeterminate",t)},st=function(n){var t=!1,i=".row-selected";n&&(i=":not("+i+")");jq("#filesMainContent .file-row"+i+":not(.checkloading)").each(function(){t=ASC.Files.UI.selectRow(jq(this),n)||t});t&&ASC.Files.UI.updateMainContentHeader();ASC.Files.UI.lastSelectedEntry=null},ht=function(n){ASC.Files.Actions.hideAllActionPanels();jq("#filesMainContent .file-row:not(.checkloading)").each(function(){var t,i=ASC.Files.UI.getObjectTitle(this);switch(n){case"folder":t=jq(this).hasClass("folder-row");break;case"file":t=!jq(this).hasClass("folder-row");break;case"document":t=ASC.Files.Utility.FileIsDocument(i)&&!jq(this).hasClass("folder-row");break;case"presentation":t=ASC.Files.Utility.FileIsPresentation(i)&&!jq(this).hasClass("folder-row");break;case"spreadsheet":t=ASC.Files.Utility.FileIsSpreadsheet(i)&&!jq(this).hasClass("folder-row");break;case"image":t=ASC.Files.Utility.FileIsImage(i)&&!jq(this).hasClass("folder-row");break;case"archive":t=ASC.Files.Utility.FileIsArchive(i)&&!jq(this).hasClass("folder-row");break;default:return!1}return ASC.Files.UI.selectRow(jq(this),t),!0});ASC.Files.UI.updateMainContentHeader()},ct=function(n,t){n!==""&&typeof n!="undefined"&&(t===!0?toastr.error(n):toastr.success(n))},lt=function(n,t,i){var u,r,f,e;if(Teamlab.profile.isOutsider||(n=n||(t?ASC.Files.UI.getObjectData(t):ASC.Files.Folders.currentFolder),u=ASC.Files.Constants.ADMIN||!n||n.create_by_id==Teamlab.profile.id,n&&n.entryType=="folder"&&(n.entryId===ASC.Files.Constants.FOLDER_ID_SHARE||n.entryId===ASC.Files.Constants.FOLDER_ID_PROJECT||n.entryId===ASC.Files.Constants.FOLDER_ID_TRASH)&&(u=!1),r=n?n.entryId:null,f=n?n.entryType:null,f=="folder"&&(r==ASC.Files.Constants.FOLDER_ID_COMMON_FILES&&!ASC.Files.Constants.ADMIN||r==ASC.Files.Constants.FOLDER_ID_SHARE||r==ASC.Files.Constants.FOLDER_ID_TRASH||r==ASC.Files.Constants.FOLDER_ID_PROJECT)))return!1;e=parseInt(n?n.access:ASC.Files.Constants.AceStatusEnum.None);f=="folder"&&ASC.Files.Folders&&ASC.Files.Folders.currentFolder&&r==ASC.Files.Folders.currentFolder.id&&(e=parseInt(ASC.Files.Folders.currentFolder.access));switch(e){case ASC.Files.Constants.AceStatusEnum.None:case ASC.Files.Constants.AceStatusEnum.ReadWrite:return!0;case ASC.Files.Constants.AceStatusEnum.Read:case ASC.Files.Constants.AceStatusEnum.Restrict:return!1;case ASC.Files.Constants.AceStatusEnum.Review:return!!i;default:return u}},at=function(n){if(Teamlab.profile.isOutsider)return!1;var t=n?ASC.Files.UI.getObjectData(n):ASC.Files.Folders.currentFolder,i=parseInt(t?t.access:ASC.Files.Constants.AceStatusEnum.None),r=t?t.entryId:null,u=t?t.entryType:null;return(u=="folder"&&r==ASC.Files.Folders.currentFolder.id&&(i=ASC.Files.Folders.currentFolder.access),i==ASC.Files.Constants.AceStatusEnum.Restrict)?(n.remove(),ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.AceStatusEnum_Restrict,!0),!1):ASC.Files.Folders.currentFolder.id==ASC.Files.Constants.FOLDER_ID_PROJECT?!1:i==ASC.Files.Constants.AceStatusEnum.Read?!1:i==ASC.Files.Constants.AceStatusEnum.None||ASC.Files.Folders.folderContainer=="corporate"&&ASC.Files.Constants.ADMIN||ASC.Files.Folders.currentFolder.id!=ASC.Files.Constants.FOLDER_ID_PROJECT&&t.create_by_id==Teamlab.profile.id},vt=function(n,t,i){var r=ASC.Files.UI.getEntryObject("file",n);return ASC.Files.UI.lockEditFile(r,t,i)},yt=function(n,t,i){if(!n.hasClass("folder-row"))if(t){n.addClass("on-edit");var r=ASC.Files.FilesJSResources.TitleEditingFile;i&&(r=ASC.Files.FilesJSResources.TitleEditingFileBy.format(i));n.find(".pencil.file-editing").attr("title",r)}else n.removeClass("on-edit")},pt=function(){var n,t;(clearTimeout(ASC.Files.UI.timeCheckEditing),n=jq(".files-content-panel #filesMainContent .file-row.on-edit:not(.cannot-edit)"),n.length!=0)&&(t={entry:jq(n).map(function(n,t){return ASC.Files.UI.getObjectData(t).entryId}).toArray()},ASC.Files.ServiceManager.checkEditing(ASC.Files.ServiceManager.events.CheckEditing,{list:t.entry},{stringList:t}))},wt=function(n,t,i){var u;n=n||ASC.Files.UI.getEntryObject(t,i);var r=ASC.Files.UI.getObjectData(n),f={entryTooltip:{type:t,title:r.title,create_by:r.create_by,date_type:ASC.Files.Folders.folderContainer=="trash"?"remove":t=="folder"?"create":r.version>1?"update":"upload",modified_on:t=="file"?r.modified_on:ASC.Files.Folders.folderContainer=="trash"?r.modified_on:r.create_on,version:r.version,length:r.content_length,error:r.error,provider_key:r.provider_key,total_files:parseInt(n.find(".countFiles").html())||0,total_sub_folder:parseInt(n.find(".countFolders").html())||0,comment:r.comment}},e=ASC.Files.Common.jsonToXml(f),o=ASC.Files.TemplateManager.translateFromString(e);jq("#entryTooltip").html(o);u=jq("#filesMainContent .file-row").length>10&&n.is("#filesMainContent .file-row:gt(-4)");jq.dropdownToggle().toggle(n.find(".thumb-"+t),"entryTooltip",u?-12:0,0,!1,null,null,null,u)},bt=function(){clearTimeout(ASC.Files.UI.timeTooltip);jq("#entryTooltip").hide();var n=jq("#filesMainContent .file-row .entry-title .name a[data-title]").removeAttr("data-title");n.attr("title",n.text())},kt=function(){var n=ASC.Files.Constants.COUNT_ON_PAGE-jq("#filesMainContent .file-row").length;n>0&&(ASC.Files.UI.currentPage<ASC.Files.UI.amountPage?ASC.Files.Folders.getFolderItems(!0,n):ASC.Files.Folders.folderContainer&&n>=ASC.Files.Constants.COUNT_ON_PAGE&&ASC.Files.EmptyScreen.displayEmptyScreen())},dt=function(n,t){if(ASC.Files.Tree&&ASC.Files.Tree.pathParts.length>1){var i=ASC.Files.Tree.pathParts[ASC.Files.Tree.pathParts.length-2],r=ASC.Files.Tree.getFolderTitle(i);jq(n).attr("data-id",i).attr("href",ASC.Files.UI.getEntryLink("folder",i)).attr("title",r);jq(t||n).show()}else jq(t||n).hide()},gt=function(n){jq(n).unbind("keyup").bind("keyup",function(){var n=jq(this).val();n.search(ASC.Files.Common.characterRegExp)!=-1&&(jq(this).val(ASC.Files.Common.replaceSpecCharacter(n)),ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.ErrorMassage_SpecCharacter.format(ASC.Files.Common.characterString),!0))})},ni=function(n){if(ASC.Files.UI.canSetDocumentTitle){n=n||ASC.Files.Folders.currentFolder.title;n=n?n+" - ":"";var t=jq(".files-content-panel").attr("data-title")||"TeamLab";document.title=n+t}},ti=function(n){typeof ASC.Files.ImageViewer!="undefined"&&ASC.Files.ImageViewer.resetWorkspace();n=!!n;n||(jq("#treeViewContainer .selected").removeClass("selected"),jq("#treeViewContainer .parent-selected").removeClass("parent-selected"));jq("#treeSecondary .currentCategory").removeClass("currentCategory");jq("#treeSecondary .active").removeClass("active");jq("#settingCommon").hide();jq("#settingThirdPartyPanel").hide();jq("#helpPanel").hide();jq("#moreFeatures").hide();jq(".files-content-panel").toggle(n);jq(".mainPageContent").children(".loader-page").remove()},ii=function(n){if(!jq("#helpPanel").length){ASC.Files.Anchor.defaultFolderSet();return}ASC.Files.UI.hideAllContent();var t={helpId:n};if(jq("#helpPanel").text().trim().length)ASC.Files.EventHandler.onGetHelpCenter(null,t);else t.update=!0,ASC.Files.ServiceManager.getHelpCenter(ASC.Files.ServiceManager.events.GetHelpCenter,t)},ri=function(){ASC.Files.UI.hideAllContent();LoadingBanner.hideLoading();jq("#treeSetting").addClass("currentCategory open");jq(".settings-link-common").addClass("active");jq("#settingCommon").show();ASC.Files.UI.setDocumentTitle(ASC.Files.FilesJSResources.TitleSettingsCommon)},ui=function(){ASC.Files.UI.hideAllContent();LoadingBanner.hideLoading();ASC.Files.CreateMenu.disableMenu();jq("#moreFeatures").show();ASC.Files.UI.setDocumentTitle(ASC.Files.FilesJSResources.TitleMoreFeaturs)},fi=function(){return jq("#tariffLimitExceedStoragePanel").length?(ASC.Files.UI.blockUI("#tariffLimitExceedStoragePanel",500,300,0),!0):!1},ei=function(){return jq("#tariffLimitExceedFileSizePanel").length?(ASC.Files.UI.blockUI("#tariffLimitExceedFileSizePanel",500,300,0),!0):!1},oi=function(n,t,i,r){return ASC.Files.Mouse&&(ASC.Files.Mouse.finishMoveTo(),ASC.Files.Mouse.finishSelecting()),StudioBlockUIManager.blockUI(n,t,i,r,"absolute")},si=function(n,t){var f,i,r,e,o,u;t=t|0;n=jq(n);n.is("progress")||(n=n.find("progress"));f=50;i=n.data("timer");clearInterval(i);r=n.val();!t||r>t?n.val(t):(e=function(t,r){var u=Math.min(r,n.val()+t);n.val(u);u==r&&clearInterval(i)},o=Math.max(1,(t-r)/f),i=setInterval(function(){e(o,t)},1),n.data("timer",i));u=n.find(".asc-progress-value");t?u.animate({width:t+"%"}):u.css("width",t+"%")},hi=function(n){n.find(".userLink").each(function(){var n=jq(this).attr("id").trim();n!=null&&n!=""&&i.RegistryElement(n,'"'+jq(this).attr("data-uid")+'"')})};return{init:r,parseItemId:s,getEntryObject:f,getObjectData:o,getSelectorId:e,getEntryTitle:h,getObjectTitle:c,getEntryLink:l,currentPage:0,amountPage:0,countTotal:0,updateFolderView:a,switchFolderView:v,isSettingsPanel:y,blockObjectById:k,blockObject:d,highlightExtension:it,addRowHandlers:rt,updateMainContentHeader:ft,lastSelectedEntry:null,checkSelectAll:st,checkSelect:ht,selectRow:et,clickRow:ut,resetSelectAll:ot,displayInfoPanel:ct,editingFile:g,editableFile:tt,lockedForMe:nt,checkEditing:pt,timeCheckEditing:null,lockEditFileById:vt,lockEditFile:yt,accessEdit:lt,accessDelete:at,checkCharacter:gt,canSetDocumentTitle:!0,setDocumentTitle:ni,stickContentHeader:w,fixContentHeaderWidth:p,stickMovingPanel:b,displayEntryTooltip:wt,hideEntryTooltip:bt,timeTooltip:null,checkEmptyContent:kt,checkButtonBack:dt,hideAllContent:ti,displayHelp:ii,displayCommonSetting:ri,displayMoreFeaturs:ui,displayTariffLimitStorageExceed:fi,displayTariffFileSizeExceed:ei,blockUI:oi,setProgressValue:si,filesSelectedHandler:u,registerUserProfilePopup:hi}}(),function(n){ASC.Files.UI.init();n(function(){jq("#switchToNormal").click(function(){ASC.Files.UI.switchFolderView(!1)});jq("#switchToCompact").click(function(){ASC.Files.UI.switchFolderView(!0)});jq("#filesMainContent").on("click",".file-row",ASC.Files.UI.clickRow);jq("#filesMainContent").on("dblclick",".file-row:not(.checkloading)",function(n){jq(n.srcElement||n.target).is("input, .checkbox, .file-lock, .version, .pencil, .is-new, .btn-row, .menu-small, #contentVersions, #contentVersions *")||jq(this).closest(".file-row").find(".entry-title .name a").trigger("click")});jq("#filesMainContent").on("click",".checkbox input",function(n){ASC.Files.Actions&&ASC.Files.Actions.hideAllActionPanels();ASC.Files.UI.clickRow(n,jq(this));jq(this).blur();ASC.Files.Common.cancelBubble(n)});jq(".menu-action-on-top").click(function(){return jq(document).scrollTop(0),!1});jq(document).keydown(function(n){var t,r,i;if(jq(".blockUI:visible").length!=0||jq(".studio-action-panel:visible").length!=0||jq("#promptRename").length!=0||jq("#promptCreateFolder").length!=0||jq("#promptCreateFile").length!=0)return!0;t||(t=n);t=jq.fixEvent(t);r=t.target||t.srcElement;try{if(jq(r).is("input,textarea"))return!0}catch(t){return!0}return(i=t.keyCode||t.which,(i==ASC.Files.Common.keyCode.a||i==ASC.Files.Common.keyCode.A)&&t.ctrlKey)?(jq.browser.opera&&setTimeout(function(){jq("#filesSelectAllCheck").focus()},1),ASC.Files.UI.checkSelectAll(!0),!1):!0});jq(document).keyup(function(n){var t,r,i;if(jq(".blockUI:visible").length!=0||jq(".studio-action-panel:visible").length!=0||jq("#promptRename").length!=0||jq("#promptCreateFolder").length!=0||jq("#promptCreateFile").length!=0)return!0;t||(t=n);t=jq.fixEvent(t);r=t.target||t.srcElement;try{if(jq(r).is("input,textarea"))return!0}catch(t){return!0}if(i=t.keyCode||t.which,ASC.Files.Folders){if(i==ASC.Files.Common.keyCode.deleteKey&&!t.shiftKey)return ASC.Files.Folders.deleteItem(),!1;if((i==ASC.Files.Common.keyCode.f||i==ASC.Files.Common.keyCode.F)&&t.shiftKey)return ASC.Files.Folders.createFolder(),!1;if((i==ASC.Files.Common.keyCode.n||i==ASC.Files.Common.keyCode.N)&&t.shiftKey)return ASC.Files.Utility.CanWebEdit(ASC.Files.Utility.Resource.InternalFormats.Document)&&(ASC.Files.Folders.typeNewDoc="document",ASC.Files.Folders.createNewDoc()),!1}if(i==ASC.Files.Common.keyCode.esc){if(ASC.Files.Mouse){if(jq("#filesMovingTooltip").is(":visible"))return ASC.Files.Mouse.finishMoveTo(),!1;if(jq("#filesSelector").is(":visible"))return ASC.Files.Mouse.finishSelecting(),!1}return ASC.Files.Actions&&ASC.Files.Actions.hideAllActionPanels(),ASC.Files.ChunkUploads&&ASC.Files.ChunkUploads.hideDragHighlight(),!0}return!0});jq("#bottomLoaderPanel").draggable({axis:"x",handle:".progress-dialog-header",containment:"body"});jq("#bottomLoaderPanel").on("drag",".progress-dialog-header",function(){ASC.Files.Actions.hideAllActionPanels()});jq(".mobile-app-banner").trackEvent("mobileApp-banner","action-click","app-store")})}(jQuery);window.ASC.Files.EventHandler=function(){var r=!1,t=null,f=function(){r===!1&&(r=!0,ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.GetFolderItems,ASC.Files.EventHandler.onGetFolderItems),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.GetItems,ASC.Files.EventHandler.onGetItems),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.CheckEditing,ASC.Files.EventHandler.onCheckEditing),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.LockFile,ASC.Files.EventHandler.onLockFile),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.UpdateIfExist,ASC.Files.EventHandler.onUpdateIfExist),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.GetHelpCenter,ASC.Files.EventHandler.onGetHelpCenter),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.CreateFolder,ASC.Files.EventHandler.onCreateFolder),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.CreateNewFile,ASC.Files.EventHandler.onCreateNewFile),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.FolderRename,ASC.Files.EventHandler.onRenameFolder),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.FileRename,ASC.Files.EventHandler.onRenameFile),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.ChangeOwner,ASC.Files.EventHandler.onChangeOwner),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.GetFileHistory,ASC.Files.EventHandler.onGetFileHistory),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.SetCurrentVersion,ASC.Files.EventHandler.onUpdateHistory),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.CompleteVersion,ASC.Files.EventHandler.onUpdateHistory),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.ReplaceVersion,ASC.Files.EventHandler.onGetFile),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.UpdateComment,ASC.Files.EventHandler.onUpdateComment),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.MoveFilesCheck,ASC.Files.EventHandler.onMoveFilesCheck),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.MoveItems,ASC.Files.EventHandler.onGetTasksStatuses),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.DeleteItem,ASC.Files.EventHandler.onGetTasksStatuses),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.EmptyTrash,ASC.Files.EventHandler.onGetTasksStatuses),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.Download,ASC.Files.EventHandler.onGetTasksStatuses),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.TerminateTasks,ASC.Files.EventHandler.onGetTasksStatuses),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.GetTasksStatuses,ASC.Files.EventHandler.onGetTasksStatuses))},e=function(t,i,r){var u,f;if(typeof r!="undefined"||typeof t=="undefined"){ASC.Files.UI.displayInfoPanel(r,!0);ASC.Files.Tree&&ASC.Files.Tree.resetFolder(ASC.Files.Tree.getParentId(i.folderId));ASC.Files.Anchor.defaultFolderSet();return}if(!o(t.getElementsByTagName("folder_info")[0])){ASC.Files.Anchor.defaultFolderSet();return}if(!s(t.getElementsByTagName("path_parts")[0])){ASC.Files.Anchor.defaultFolderSet();return}ASC.Files.Marker&&ASC.Files.Marker.markRootAsNew(t.getElementsByTagName("root_folders_id_marked_as_new")[0]);u=t.getElementsByTagName("total")[0];ASC.Files.UI.countTotal=parseInt(u.text||u.textContent)||0;i.append||jq("#filesMainContent").empty();f=ASC.Files.TemplateManager.translate(t);n(f);jq(ASC.Files.UI.lastSelectedEntry).each(function(){var n=ASC.Files.UI.getEntryObject(this.entryType,this.entryId);ASC.Files.UI.selectRow(n,!0)});ASC.Files.UI.updateMainContentHeader();ASC.Files.UI.lastSelectedEntry=null;ASC.Files.Folders.eventAfter!=null&&typeof ASC.Files.Folders.eventAfter=="function"&&(ASC.Files.Folders.eventAfter(),ASC.Files.Folders.eventAfter=null);ASC.Files.CreateMenu&&ASC.Files.CreateMenu.disableMenu(ASC.Files.UI.accessEdit());ASC.Files.UI.stickContentHeader()},n=function(n,t){var f,i,r,u;return ASC.Files.UI.resetSelectAll(),ASC.Files.EmptyScreen.hideEmptyScreen(),n==""?t||ASC.Files.EmptyScreen.displayEmptyScreen():(t?t.length?(f=t.hasClass("row-selected")||t.attr("data-selected")=="true",t.after(n),i=t.next(),t.remove()):(jq("#filesMainContent").prepend(n),i=jq('#filesMainContent .file-row[name="addRow"]')):(jq("#filesMainContent").append(n),i=jq("#filesMainContent .file-row:gt(-"+(ASC.Files.Constants.COUNT_ON_PAGE+1)+")")),jq('#filesMainContent .file-row[name="addRow"]').each(function(){var n=ASC.Files.UI.getObjectData(this),t=ASC.Files.UI.getEntryObject(n.entryType,n.id);t.filter('[name!="addRow"]').remove()}),r=parseInt(ASC.Files.Constants.COUNT_ON_PAGE)||0,ASC.Files.UI.amountPage=parseInt((ASC.Files.UI.countTotal/r).toFixed(0)),ASC.Files.UI.amountPage-ASC.Files.UI.countTotal/r<0&&ASC.Files.UI.amountPage++,ASC.Files.UI.currentPage=parseInt((jq('#filesMainContent .file-row[name!="addRow"]').length-1)/r)+1,u=ASC.Files.UI.countTotal-jq("#filesMainContent .file-row").length,ASC.Files.UI.currentPage<ASC.Files.UI.amountPage&&u>0?(jq("#pageNavigatorHolder").show(),ASC.Files.FilesJSResources&&jq("#pageNavigatorHolder a").text(r<u?ASC.Files.FilesJSResources.ButtonShowMoreOf.format(r,u):ASC.Files.FilesJSResources.ButtonShowMore.format(u))):jq("#pageNavigatorHolder").hide(),ASC.Files.Mouse&&ASC.Files.Mouse.collectEntryItems(),ASC.Files.UI.addRowHandlers(i),f&&(ASC.Files.UI.selectRow(i,f),ASC.Files.UI.updateMainContentHeader()),setTimeout(ASC.Files.UI.checkEditing,5e3)),i&&i.attr("name",""),i},o=function(n){var t,i;if(typeof n=="undefined"||n==null)return!1;if(!ASC.Files.Folders)return!0;ASC.Files.Folders.currentFolder={};t=jq(n.childNodes);for(i in t)i&&typeof t[i]=="object"&&(ASC.Files.Folders.currentFolder[t[i].tagName]=t[i].textContent||t[i].text||"");if(ASC.Files.Common.isCorrectId(ASC.Files.Folders.currentFolder.id))ASC.Files.Folders.currentFolder.entryId=ASC.Files.Folders.currentFolder.id;else return!1;if(ASC.Files.Folders.currentFolder.entryType="folder",ASC.Files.Share){if(ASC.Files.Folders.currentFolder.access=parseInt(ASC.Files.Folders.currentFolder.access||ASC.Files.Constants.AceStatusEnum.None),ASC.Files.Folders.currentFolder.access==ASC.Files.Constants.AceStatusEnum.Restrict)return ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.AceStatusEnum_Restrict,!0),!1;ASC.Files.Folders.currentFolder.shareable=ASC.Files.Folders.currentFolder.shareable==="true"}return ASC.Files.Tree&&ASC.Files.Folders.currentFolder.id==ASC.Files.Tree.folderIdCurrentRoot&&(ASC.Files.Folders.currentFolder.title=ASC.Files.FilesJSResources.ProjectFiles),ASC.Files.UI.setDocumentTitle(ASC.Files.Folders.currentFolder.title),!0},s=function(n){var t,i;if(typeof n=="undefined"||n==null||(t=jq(n.childNodes).map(function(n,t){var i=t.childNodes[0];return i.textContent||i.text}),t.length==0))return!1;i=parseInt(t[0]);ASC.Files.Tree&&(ASC.Files.Tree.pathParts=t);jq("#mainContentHeader .menuAction").removeClass("unlockAction").hide();jq("#filesMainContent").removeClass("myFiles").removeClass("corporateFiles").removeClass("shareformeFiles").removeClass("trashFiles").removeClass("projectFiles");switch(i){case ASC.Files.Constants.FOLDER_ID_MY_FILES:ASC.Files.Folders.folderContainer="my";jq("#filesMainContent").addClass("myFiles");jq("#mainDownload, #mainMove, #mainCopy, #mainDelete, #mainConvert").show();break;case ASC.Files.Constants.FOLDER_ID_SHARE:ASC.Files.Folders.folderContainer="forme";jq("#filesMainContent").addClass("shareformeFiles");jq("#mainDownload, #mainCopy, #mainMarkRead, #mainUnsubscribe, #mainConvert").show();break;case ASC.Files.Constants.FOLDER_ID_COMMON_FILES:ASC.Files.Folders.folderContainer="corporate";jq("#filesMainContent").addClass("corporateFiles");jq("#mainDownload, #mainMove, #mainCopy, #mainMarkRead, #mainDelete, #mainConvert").show();break;case ASC.Files.Constants.FOLDER_ID_PROJECT:ASC.Files.Folders.folderContainer="project";jq("#filesMainContent").addClass("projectFiles");jq("#mainDownload, #mainMove, #mainCopy, #mainMarkRead, #mainDelete, #mainConvert").show();break;case ASC.Files.Constants.FOLDER_ID_TRASH:ASC.Files.Folders.folderContainer="trash";jq("#filesMainContent").addClass("trashFiles");jq("#mainDownload, #mainRestore, #mainDelete, #mainEmptyTrash, #mainConvert").show();jq("#mainEmptyTrash").addClass("unlockAction");break;case ASC.Files.Tree.folderIdCurrentRoot:ASC.Files.Folders.folderContainer="project";jq("#filesMainContent").addClass("projectFiles");jq("#mainDownload, #mainMove, #mainCopy, #mainDelete, #mainConvert").show();break;default:if(!ASC.Files.Common.isCorrectId(ASC.Files.Folders.currentFolder.id))return!1}return ASC.Files.Share&&ASC.Files.Folders.currentFolder.shareable&&!ASC.Resources.Master.Personal&&jq("#mainShare").show(),ASC.Files.Filter&&ASC.Files.Filter.disableFilter(),jq("#filesMainContent").toggleClass("without-share",!(ASC.Files.Share&&ASC.Files.Folders.currentFolder.shareable)),ASC.Files.Tree&&ASC.Files.Tree.updateTreePath(),ASC.Files.UI.checkButtonBack(".to-parent-folder",".folder-row-toparent"),!0},h=function(t,i,r){var e,u,o,f,s;if(typeof r!="undefined"){ASC.Files.UI.displayInfoPanel(r,!0);return}if(ASC.Files.Folders.currentFolder.id==i.parentFolderID){for(i.lonelyType&&(t.__type=i.lonelyType,t=[t]),e="",u=0;u<t.length;u++)o=ASC.Files.Common.jsonToXml(t[u].__type.toLowerCase().indexOf("folder")==-1?{file:t[u]}:{folder:t[u]}),e+=ASC.Files.TemplateManager.translateFromString(o);f=n(e,{});f&&(s=f.hasClass("new-folder"),f.removeClass("new-file new-folder").show().yellowFade(),ASC.Files.Tree&&s&&ASC.Files.Tree.resetFolder(i.parentFolderID))}},c=function(t,i,r){var u=ASC.Files.UI.getEntryObject("file","0"),f,o,e;if(ASC.Files.UI.blockObject(u),f=i.winEditor,typeof r!="undefined"){u.remove();f.close();jq("#filesMainContent .file-row").length==0&&ASC.Files.EmptyScreen.displayEmptyScreen();ASC.Files.UI.displayInfoPanel(r,!0);return}if(ASC.Files.Folders.currentFolder.id==i.folderID){o=ASC.Files.TemplateManager.translate(t);e=n(o,u);e.show().yellowFade().removeClass("new-file");var s=ASC.Files.UI.getObjectData(e),h=s.title,c=s.entryId;ASC.Files.Actions.checkEditFile(c,f)}else h=i.fileTitle;ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.InfoCrateFile.format(h))},l=function(t,i,r){var e=ASC.Files.UI.getEntryObject("folder","0"),o,u,f;if(typeof r!="undefined"){e.remove();jq("#filesMainContent .file-row").length==0&&ASC.Files.EmptyScreen.displayEmptyScreen();ASC.Files.UI.displayInfoPanel(r,!0);return}ASC.Files.Folders.currentFolder.id==i.parentFolderID?(o=ASC.Files.TemplateManager.translate(t),u=n(o,e),u.yellowFade().removeClass("new-folder"),f=ASC.Files.UI.getObjectData(u).title):f=i.title;ASC.Files.Tree&&ASC.Files.Tree.resetFolder(i.parentFolderID);ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.InfoCrateFolder.format(f));trackingGoogleAnalitics("documents","create","folder")},a=function(t,i,r){var f;if(typeof r!="undefined"){ASC.Files.UI.displayInfoPanel(r,!0);return}var e=ASC.Files.TemplateManager.translate(t),o=i.folderId,u=ASC.Files.UI.getEntryObject("folder",o);u=n(e,u);u.yellowFade().removeClass("new-folder");ASC.Files.UI.selectRow(u,!0);ASC.Files.UI.updateMainContentHeader();f=ASC.Files.UI.getObjectData(u).title;ASC.Files.Tree&&ASC.Files.Tree.resetFolder(i.parentFolderID);ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.InfoRenameFolder.format(i.name,f))},v=function(n,t,i){var r,u;if(typeof i!="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);return}r=ASC.Files.EventHandler.onGetFile(n,t,i);ASC.Files.UI.selectRow(r.entryObject,!0);ASC.Files.UI.updateMainContentHeader();u=r.title;ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.InfoRenameFile.format(t.name,u))},y=function(t,i,r){if(typeof r!="undefined"){ASC.Files.UI.displayInfoPanel(r,!0);return}var u,f;jq(i.list).each(function(e,o){var h=ASC.Files.UI.parseItemId(o),l,v,c;if(jq(t).each(function(n,t){return t.id==h.entryId?(l=t,!1):!0}),h.entryType=="folder"){var a=ASC.Files.Common.jsonToXml({folder:l}),y=ASC.Files.TemplateManager.translateFromString(a),p=h.entryId,s=ASC.Files.UI.getEntryObject("folder",p);s=n(y,s);s.yellowFade().removeClass("new-folder");ASC.Files.UI.selectRow(s,!0);ASC.Files.UI.updateMainContentHeader();ASC.Files.Tree&&ASC.Files.Tree.resetFolder(i.parentFolderID);v=ASC.Files.UI.getObjectData(s);u=v.create_by;f=v.title}else a=ASC.Files.Common.jsonToXml({file:l}),c=ASC.Files.EventHandler.onGetFile(a,{fileId:h.entryId,isStringXml:!0,show:!0},r),ASC.Files.UI.selectRow(c.entryObject,!0),ASC.Files.UI.updateMainContentHeader(),u=c.create_by,f=c.title});i.list.length>1?ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.InfoChangeOwnerArray.format(Encoder.htmlEncode(u),i.list.length)):ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.InfoChangeOwner.format(Encoder.htmlEncode(u),f))},p=function(n,t,i){var f=t.fileId,e=ASC.Files.UI.getEntryObject("file",f),r,u;if(typeof i!="undefined"){ASC.Files.UI.blockObject(e);jq(".version-operation").css("visibility","");ASC.Files.UI.displayInfoPanel(i,!0);return}jq.extend(t,{isStringXml:!0,show:!0});r=ASC.Files.Common.jsonToXml({file:n.key});ASC.Files.EventHandler.onGetFile(r,t);u=ASC.Files.Common.jsonToXml({fileList:{entry:n.value}});ASC.Files.EventHandler.onGetFileHistory(u,t)},w=function(n,t,i){var h=t.fileId,r=ASC.Files.UI.getEntryObject("file",h),s,e,f,o,u;if(ASC.Files.UI.blockObject(r),ASC.Files.UI.updateMainContentHeader(),typeof i!="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);return}s=t.isStringXml===!0?ASC.Files.TemplateManager.translateFromString(n):ASC.Files.TemplateManager.translate(n);jq("#contentVersions").remove();r.append(s).addClass("file-row-fix");e=ASC.Files.UI.getObjectData(r);f=!0;!ASC.Files.UI.accessEdit(e,r)||ASC.Files.UI.editingFile(r)||ASC.Files.UI.lockedForMe(r)?(jq(".version-comment-edit").remove(),f=!1):jq("#contentVersions").addClass("version-edit");f&&Teamlab.profile.isVisitor!==!0||(jq(".version-operation.version-restore").empty(),jq(".version-complete, .version-continue").remove(),jq(".version-num span").addClass("display-num"));ASC.Files.Utility.CanWebView(e.title)&&jq(".not-preview").removeClass("not-preview");o=jq("#contentVersions .version-row").length;u=jq("#contentVersions .version-row:first").attr("data-version-group");jq("#contentVersions .version-row[data-version='"+o+"'] .version-restore").empty();jq("#contentVersions .version-row[data-version='"+o+"'] .version-sublist span").text(ASC.Files.FilesJSResources.RevisionCurrent);jq("#contentVersions .version-row[data-version-group="+u+"]").show();jq("#contentVersions .version-row").each(function(){var n=jq(this),i=n.attr("data-version-group"),t;i!=u?(n.find(".version-complete").remove(),u=i,n.addClass("version-group-head"),t=jq("#contentVersions .version-row[data-version-group="+u+"]"),t.length>1&&n.find(".version-sublist span").addClass("version-sublist-toggle").text(jq.format(ASC.Files.FilesJSResources.RevisionCount,t.length))):f?n.find(".version-num span, .version-continue").remove():n.find(".version-num").empty()});ASC.Files.UI.registerUserProfilePopup(jq("#contentVersions"))},b=function(n,t,i){if(typeof i!="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);return}n=n||"";var r=ASC.Files.UI.getEntryObject("file",t.fileId);r.find(".version-row[data-version="+t.version+"]").removeClass("version-row-comment").find(".version-comment").attr("data-comment",n).attr("title",n.length?n:"").html('<div class="version-comment-fix">'+Encoder.htmlEncode(n)+"<\/div>")},k=function(t,i,r){var e,o,u,f;if(typeof r!="undefined"){ASC.Files.UI.displayInfoPanel(r,!0);return}if(e=i.fileId,ASC.Files.Common.isCorrectId(e))return o=i.isStringXml===!0?ASC.Files.TemplateManager.translateFromString(t):ASC.Files.TemplateManager.translate(t),ASC.Files.Marker.removeNewIcon("file",e),u=ASC.Files.UI.getEntryObject("file",e),u=n(o,u),f=ASC.Files.UI.getObjectData(u),!f||(u=f.entryObject,i.show&&(ASC.Files.EmptyScreen.hideEmptyScreen(),u.removeClass("new-file").show().yellowFade()),u.find(".is-new").is(":visible")&&ASC.Files.Marker.setNewCount(f.entryType,f.entryId,1)),ASC.Files.UI.updateMainContentHeader(),f},d=function(n,t,i){if(typeof i!="undefined"){jq(t.list.entry).each(function(){var n=ASC.Files.UI.parseItemId(this);ASC.Files.UI.blockObjectById(n.entryType,n.entryId,!1,null,!0)});ASC.Files.UI.updateMainContentHeader();ASC.Files.UI.displayInfoPanel(i,!0);return}n!=null&&n.length>0?ASC.Files.Folders.showOverwriteMessage(t.list,t.folderToId,t.folderToTitle,t.isCopyOperation,n):(ASC.Files.ServiceManager.moveItems(ASC.Files.ServiceManager.events.MoveItems,{folderToId:t.folderToId,resolve:0,isCopyOperation:t.isCopyOperation,doNow:!0},{stringList:t.list}),ASC.Files.Folders.isCopyTo=!1)},u=function(n,t,i){var e=ASC.Files.UI.parseItemId(n[0]).entryId,u,o,r,s,h,l,y,p,w;for(n=n.slice(1),u=[],o=[],r=0;r<n.length;r++)(s=ASC.Files.UI.parseItemId(n[r]),s!=null)&&(r%2?o.push(s):(u.push(s),ASC.Files.UI.blockObjectById(s.entryType,s.entryId,!1,null,!0)));ASC.Files.UI.updateMainContentHeader();h=ASC.Files.UI.getEntryObject("folder",e);h.removeClass("row-to");var a,v=0,c=0,f="";for(u.length==1&&(f=ASC.Files.UI.getEntryTitle(u[0].entryType,u[0].entryId),(typeof f==undefined||f==null)&&(f="")),r=0;r<u.length;r++)l=ASC.Files.UI.getEntryObject(u[r].entryType,u[r].entryId),u[r].entryType=="file"?c++:(v+=1+(parseInt(l.find(".countFolders").html())||0),c+=parseInt(l.find(".countFiles").html())||0,ASC.Files.Tree&&!a&&(a=ASC.Files.Tree.getParentId(u[r].entryId))),t||ASC.Files.Folders.currentFolder.id==e||(ASC.Files.Marker.removeNewIcon(u[r].entryType,u[r].entryId),l.remove());if(v>0&&(y=h.find(".countFolders"),y.html((parseInt(y.html())||0)+v),ASC.Files.Tree&&(ASC.Files.Tree.resetFolder(e),t||e==ASC.Files.Folders.currentFolder.id||(ASC.Files.Tree.resetFolder(a||ASC.Files.Folders.currentFolder.id),ASC.Files.Tree.updateTreePath()))),c>0&&(p=h.find(".countFiles"),p.html((parseInt(p.html())||0)+c)),u.length>0&&ASC.Files.Folders.currentFolder.id!=e&&ASC.Files.UI.checkEmptyContent(),t?u.length==1&&f!=""?ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.InfoCopyItem.format(f)):ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.InfoCopyGroup.format(i)):u.length==1&&f!=""?ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.InfoMoveItem.format(f)):ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.InfoMoveGroup.format(i)),ASC.Files.Folders.currentFolder.id==e){for(w=[],r=0;r<o.length;r++)ASC.Files.UI.getEntryObject(o[r].entryType,o[r].entryId).length||w.push(o[r].entryType+"_"+o[r].entryId);ASC.Files.Folders.getItems(w,e)}},g=function(n,t){var s=ASC.Files.UI.parseItemId(n[0]).entryId,i,r,f,c;for(n=n.slice(1),i=[],r=0;r<n.length;r++)(f=ASC.Files.UI.parseItemId(n[r]),f!=null)&&(i.push(f),ASC.Files.UI.blockObjectById(f.entryType,f.entryId,!1,null,!0));ASC.Files.UI.updateMainContentHeader();var o,e=!1,u="",h=ASC.Files.Tree&&ASC.Files.Tree.pathParts.length>0&&(ASC.Files.Tree.pathParts[0]!=ASC.Files.Constants.FOLDER_ID_TRASH||s==ASC.Files.Constants.FOLDER_ID_TRASH||ASC.Files.ThirdParty&&ASC.Files.ThirdParty.isThirdParty());for(i.length==1&&(u=ASC.Files.UI.getEntryTitle(i[0].entryType,i[0].entryId),(typeof u==undefined||u==null)&&(u="")),r=0;r<i.length;r++)c=ASC.Files.UI.getEntryObject(i[r].entryType,i[r].entryId),i[r].entryType=="folder"&&(e||(e=!0),ASC.Files.Tree&&!o&&(o=ASC.Files.Tree.getParentId(i[r].entryId))),h&&(ASC.Files.Marker.removeNewIcon(i[r].entryType,i[r].entryId),c.remove());e&&ASC.Files.Tree&&(ASC.Files.Tree.resetFolder(o||ASC.Files.Folders.currentFolder.id),ASC.Files.Tree.updateTreePath());i.length>0&&h&&ASC.Files.UI.checkEmptyContent();i.length==1&&u!=""?e>0?ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.InfoRemoveFolder.format(u)):ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.InfoRemoveFile.format(u)):ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.InfoRemoveGroup.format(i.length,t));s==ASC.Files.Constants.FOLDER_ID_TRASH&&ASC.Files.ChunkUploads.initTenantQuota()},nt=function(n,t,i){var s,u,e,o,r,c;if(clearTimeout(ASC.Files.UI.timeCheckEditing),typeof i!="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);return}for(n||(n=[]),s=jq(".files-content-panel #filesMainContent .file-row.on-edit:not(.cannot-edit)"),u=0;u<s.length;u++){var h=ASC.Files.UI.getObjectData(s[u]),l=h.entryObject,f=h.entryId;for(ASC.Files.UI.lockEditFile(l,!1),e=!0,o=0;o<n.length&&e;o++)f==n[o].Key&&(e=!1);e&&ASC.Files.Folders.replaceVersion(f,!0)}for(r=0;r<n.length;r++)f=n[r].Key,c=n[r].Value,ASC.Files.UI.lockEditFileById(f,!0,c);n.length>0&&(ASC.Files.UI.timeCheckEditing=setTimeout(ASC.Files.UI.checkEditing,5e3))},tt=function(n,t,i){if(typeof i!="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);return}jq(".update-if-exist").prop("checked",n===!0)},it=function(n,t,i){var u,r;if(typeof i!="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);return}if(u=t.lock,u)r=t.fileObj,r.addClass("file-locked"),ASC.Files.UI.addRowHandlers(r);else{t.show=!0;ASC.Files.EventHandler.onGetFile(n,t,i)}},rt=function(n,t,i){if(typeof i!="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);ASC.Files.Anchor.defaultFolderSet();return}t.update&&(jq("#helpPanel").html(n),StudioManager.initImageZoom());LoadingBanner.hideLoading();jq("#helpPanel").show();showHelpPage(t.helpId);ASC.Files.UI.setDocumentTitle(ASC.Files.FilesJSResources.TitleSettingsHelp);ASC.Files.CreateMenu.disableMenu()},ut=function(n,r,f){var h,s,e;if(typeof n!="object"&&typeof f!="undefined"||n==null){ASC.Files.Folders.cancelTasksStatuses();ASC.Files.UI.displayInfoPanel(f,!0);return}if(n.length==0){ASC.Files.Folders.cancelTasksStatuses();return}var o=0,c=!1,l,a=[ASC.Files.FilesJSResources.TasksOperationMove,ASC.Files.FilesJSResources.TasksOperationCopy,ASC.Files.FilesJSResources.TasksOperationDelete,ASC.Files.FilesJSResources.TasksOperationBulkdownload,ASC.Files.FilesJSResources.TasksOperationMarkAsRead],v=[ASC.Files.FilesJSResources.DescriptMove,ASC.Files.FilesJSResources.DescriptCopy,ASC.Files.FilesJSResources.DescriptRemove,ASC.Files.FilesJSResources.DescriptBulkdownload,ASC.Files.FilesJSResources.DescriptMarkAsRead];for(n.length!=0&&(jq("#tasksProgress:visible").length==0&&(clearTimeout(t),jq("#tasksProgress").length==0&&(jq("#progressTemplate").clone().attr("id","tasksProgress").prependTo("#bottomLoaderPanel"),jq("#tasksProgress .progress-dialog-header").append('<a title="{0}" class="actions-container close">&times;<\/a>'.format(ASC.Files.FilesJSResources.TitleCancel)),jq("#tasksProgress .progress-dialog-header").append("<span><\/span>")),ASC.Files.UI.setProgressValue("#tasksProgress",0),jq("#tasksProgress .asc-progress-percent").text("0%"),jq("#tasksProgress .progress-dialog-header span").text(""),jq("#tasksProgress").show(),jq.browser.mobile&&(jq("#bottomLoaderPanel").css("bottom","auto"),jq("#bottomLoaderPanel").css("top",jq(window).scrollTop()+jq(window).height()-jq("#bottomLoaderPanel").height()+"px"))),l=n.length>1?ASC.Files.FilesJSResources.TasksOperationMixed.format(n.length):a[n[0].operation],jq("#tasksProgress .progress-dialog-header span").text(l)),i=0;i<n.length;i++)if(h=":",s=n[i].source.trim().split(h),jq(s).each(function(){var t=ASC.Files.UI.parseItemId(this);if(t==null)return!0;ASC.Files.UI.blockObjectById(t.entryType,t.entryId,!0,v[n[i].operation],!0)}),ASC.Files.UI.updateMainContentHeader(),o+=n[i].progress,n[i].finished){if(n[i].result!=null){e=n[i].result.trim().split(h);switch(n[i].operation){case 0:u(e,!1,n[i].processed);break;case 1:u(e,!0,n[i].processed);break;case 2:g(e,s.length);break;case 3:e[0]&&(location.href=e[0]);ASC.Files.Folders.bulkStatuses=!1;break;case 4:ASC.Files.Marker.onMarkAsRead(e)}}jq(s).each(function(){var n=ASC.Files.UI.parseItemId(this);if(n==null)return!0;ASC.Files.UI.blockObjectById(n.entryType,n.entryId,!1,null,!0)});ASC.Files.UI.updateMainContentHeader();n[i].error!=null&&ASC.Files.UI.displayInfoPanel(n[i].error,!0)}else c=!0;o=n.length==0?100:o/n.length;ASC.Files.UI.setProgressValue("#tasksProgress",o);jq("#tasksProgress .asc-progress-percent").text(o+"%");c?ASC.Files.Folders.getTasksStatuses(r.doNow):(clearTimeout(t),t=setTimeout(ASC.Files.Folders.cancelTasksStatuses,500))};return{init:f,onGetFolderItems:e,onGetItems:h,onGetFile:k,onCreateNewFile:c,onCreateFolder:l,onRenameFolder:a,onRenameFile:v,onChangeOwner:y,onUpdateHistory:p,onGetFileHistory:w,onUpdateComment:b,onCheckEditing:nt,onLockFile:it,onUpdateIfExist:tt,onGetHelpCenter:rt,onMoveFilesCheck:d,onGetTasksStatuses:ut}}(),function(n){n(function(){ASC.Files.EventHandler.init();jq("#bottomLoaderPanel").on("click","#tasksProgress a.close",function(){return ASC.Files.Folders.terminateTasks(),!1})})}(jQuery);window.ASC.Files.Anchor=function(){var t=!1,n={error:new RegExp("^error(?:/(\\S+))?"),message:new RegExp("^message(?:/(\\S+))?"),preview:new RegExp("^preview(?:/|%2F)"+ASC.Files.Constants.entryIdRegExpStr),setting:new RegExp("^setting(?:=?(\\w+)?)?"),folder:new RegExp("^"+ASC.Files.Constants.entryIdRegExpStr),help:new RegExp("^help(?:=(\\d+))?"),more:new RegExp("^more"),anyanchor:new RegExp("^(\\S+)?")},r=function(){t===!1&&(t=!0,ASC.Files.Folders&&(ASC.Controls.AnchorController.bind(n.anyanchor,u),ASC.Controls.AnchorController.bind(n.error,f),ASC.Controls.AnchorController.bind(n.message,e),ASC.Controls.AnchorController.bind(n.folder,s),ASC.Controls.AnchorController.bind(n.preview,h),ASC.Controls.AnchorController.bind(n.setting,l),ASC.Controls.AnchorController.bind(n.help,c),ASC.Controls.AnchorController.bind(n.more,o)))},u=function(t){n.error.test(t)||n.message.test(t)||n.preview.test(t)||n.setting.test(t)||n.folder.test(t)||n.help.test(t)||n.more.test(t)||ASC.Files.Anchor.defaultFolderSet()},f=function(n){ASC.Files.UI.displayInfoPanel(decodeURIComponent(n||ASC.Files.FilesJSResources.UnknownErrorText).replace(/\+/g," "),!0);jq.browser.msie?setTimeout(ASC.Files.Anchor.defaultFolderSet,3e3):ASC.Files.Anchor.defaultFolderSet()},e=function(n){n.length&&ASC.Files.UI.displayInfoPanel(decodeURIComponent(n).replace(/\+/g," "));jq.browser.msie?setTimeout(ASC.Files.Anchor.defaultFolderSet,3e3):ASC.Files.Anchor.defaultFolderSet()},o=function(){ASC.Files.UI.displayMoreFeaturs()},s=function(n){(jq.browser.safari||jq.browser.mozilla)&&(n=decodeURIComponent(n));ASC.Files.Folders.currentFolder.id=ASC.Files.Common.isCorrectId(n)?n:"";ASC.Files.Actions.hideAllActionPanels();ASC.Files.UI.updateFolderView()},h=function(n){(jq.browser.safari||jq.browser.mozilla)&&(n=decodeURIComponent(n));typeof ASC.Files.ImageViewer!="undefined"?ASC.Files.ImageViewer.init(n):ASC.Files.Anchor.defaultFolderSet()},c=function(n){ASC.Files.UI.displayHelp(n)},l=function(n){switch(n){case"thirdparty":if(ASC.Files.ThirdParty)ASC.Files.ThirdParty.showSettingThirdParty();else{ASC.Files.Anchor.defaultFolderSet();return}break;default:ASC.Files.UI.displayCommonSetting()}ASC.Files.CreateMenu.disableMenu()},a=function(n,t){n=ASC.Files.Common.getCorrectHash(n);t?ASC.Controls.AnchorController.safemove(n):ASC.Controls.AnchorController.move(n)},i=function(n,t){ASC.Files.Common.isCorrectId(n)||(n=ASC.Files.Folders.currentFolder.id);ASC.Files.UI.lastSelectedEntry=jq("#filesMainContent .file-row:has(.checkbox input:checked)").map(function(){var n=ASC.Files.UI.getObjectData(this);return{entryType:n.entryType,entryId:n.entryId}});ASC.Files.Anchor.move(n,t===!0)},v=function(n,t){ASC.Files.UI.resetSelectAll();ASC.Files.UI.amountPage=0;t=t===!0;ASC.Files.Common.isCorrectId(n)?(t&&ASC.Files.Folders.currentFolder.id==n||(ASC.Files.Folders.currentFolder.id=n,ASC.Files.Folders.folderContainer=""),i(null,t)):(ASC.Files.Folders.currentFolder.id="",ASC.Files.Folders.folderContainer=n,i(n,t))},y=function(){if(!ASC.Resources.Master.IsAuthenticated){location.reload(!0);return}ASC.Files.Tree&&(ASC.Files.Tree.folderIdCurrentRoot?ASC.Files.Folders.currentFolder.id!=ASC.Files.Tree.folderIdCurrentRoot&&ASC.Files.Anchor.navigationSet(ASC.Files.Tree.folderIdCurrentRoot):ASC.Files.Constants.FOLDER_ID_MY_FILES?(ASC.Files.Folders.currentFolder.id!=ASC.Files.Constants.FOLDER_ID_MY_FILES||ASC.Files.UI.isSettingsPanel())&&ASC.Files.Anchor.navigationSet(ASC.Files.Constants.FOLDER_ID_MY_FILES):ASC.Files.Anchor.navigationSet(ASC.Files.Constants.FOLDER_ID_COMMON_FILES))};return{init:r,move:a,navigationSet:v,defaultFolderSet:y}}(),function(n){n(function(){window.parent==window&&ASC.Files.Anchor.init()})}(jQuery);window.ASC.Files.FileChoice=function(){var n=!1,t=function(t,i,r,u){if(n===!1){n=!0;jq("#fileSelectorTree").css("visibility","visible");var f=function(){ASC.Files.FileSelector.openDialog(t,i,r)};r&&(jq("#fileSelectorTree>ul>li:not(.third-party-entry)").toggle(!1),ASC.Files.FileSelector.createThirdPartyTree(f));i?(jq("body").addClass("only-folder"),ASC.Files.FileSelector.onSubmit=function(n){var u=ASC.Files.FileSelector.fileSelectorTree.getFolderTitle(n),f=ASC.Files.FileSelector.fileSelectorTree.getPath(n),t=jq(f).map(function(n,t){return ASC.Files.FileSelector.fileSelectorTree.getFolderTitle(t)}),i,r;t.push(u);i=t.toArray().join(" > ");r=JSON.stringify({folderId:n,pathTitle:i});window.parent.postMessage(r,"*")}):ASC.Files.FileSelector.onSubmit=function(n){var t=n[0],i=ASC.Files.Utility.GetFileExtension(t.title),r;i=i.substring(i.indexOf(".")+1);u?Teamlab.getPresignedUri(t.id,{success:function(n,t){var u={file:{fileType:i,url:t}};r=JSON.stringify(u);window.parent.postMessage(r,"*")},error:function(n,t){toastr.error(t)}}):(r=JSON.stringify({fileId:t.id,fileTitle:t.title}),window.parent.postMessage(r,"*"))};ASC.Files.FileSelector.onCancel=function(){var n=JSON.stringify({file:null});window.parent.postMessage(n,"*")};r||f()}};return{init:t}}();window.ASC.Files.EmptyScreen=function(){var n=!1,t=function(){n===!1&&(n=!0);jq.dropdownToggle({switcherSelector:"#emptyContainer .hintCreate",dropdownID:"hintCreatePanel",fixWinSize:!1});jq.dropdownToggle({switcherSelector:"#emptyContainer .hintUpload",dropdownID:"hintUploadPanel",fixWinSize:!1});jq.dropdownToggle({switcherSelector:"#emptyContainer .hintOpen",dropdownID:"hintOpenPanel",fixWinSize:!1});jq.dropdownToggle({switcherSelector:"#emptyContainer .hintEdit",dropdownID:"hintEditPanel",fixWinSize:!1})},i=function(){ASC.Files.UI.hideAllContent(!0);ASC.Files.Mouse&&(ASC.Files.Mouse.finishMoveTo(),ASC.Files.Mouse.finishSelecting());jq("#filesMainContent, #switchViewFolder, #mainContentHeader, #pageNavigatorHolder, .folder-row-toparent").hide();jq("#emptyContainer > div").hide();ASC.Files.Filter&&(ASC.Files.Filter.getFilterSettings().filter!=0||ASC.Files.Filter.getFilterSettings().text!="")?jq("#emptyContainer_filter").show():(jq(".files-filter").hide(),jq("#emptyContainer .empty-folder-create").toggle(ASC.Files.UI.accessEdit()),jq("#emptyContainer_"+ASC.Files.Folders.folderContainer).show(),ASC.Files.UI.checkButtonBack(".empty-folder-toparent"));jq("#emptyContainer").show();ASC.Files.UI.stickContentHeader()},r=function(){jq("#filesMainContent").is(":visible")||(ASC.Files.UI.hideAllContent(!0),ASC.Files.Mouse&&(ASC.Files.Mouse.finishMoveTo(),ASC.Files.Mouse.finishSelecting()),jq("#emptyContainer").hide(),ASC.Files.UI.checkButtonBack(".to-parent-folder",".folder-row-toparent"),jq(".files-filter").show(),ASC.Files.Filter&&ASC.Files.Filter.resize(),jq("#filesMainContent, #switchViewFolder, #mainContentHeader").show(),ASC.Files.UI.stickContentHeader())};return{init:t,hideEmptyScreen:r,displayEmptyScreen:i}}(),function(n){jq("#hintCreatePanel").length!=0&&(ASC.Files.EmptyScreen.init(),n(function(){}))}(jQuery);window.ASC.Files.FileSelector=function(){var i=!1,n=!1,r=ASC.Files.Constants.FilterType.None,u=function(){},f=function(){},e=function(){return PopupKeyUpActionProvider.CloseDialog(),!1},o=function(){},s=function(){if(!i){i=!0;ASC.Files.Folders||(ASC.Files.Folders={});ASC.Files.UI.canSetDocumentTitle=!1;ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.GetThirdPartyTree,p);ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.GetFolderItemsTree,w);ASC.Files.FileSelector.fileSelectorTree=new ASC.Files.TreePrototype("#fileSelectorTree");jq("#filesMainContent").addClass("compact");jq("#fileSelectorDialog").on("click","#submitFileSelector:not(.disable)",function(){var t,i;n?t=ASC.Files.FileSelector.onSubmit(ASC.Files.FileSelector.fileSelectorTree.selectedFolderId):(i=jq("#filesMainContent .file-row:not(.folder-row):has(.checkbox input:checked)").map(function(){return ASC.Files.UI.getObjectData(this)}),t=ASC.Files.FileSelector.onSubmit(i));t!==!1&&PopupKeyUpActionProvider.CloseDialog()});jq("#pageNavigatorHolder a").click(function(){t(ASC.Files.FileSelector.fileSelectorTree.selectedFolderId,!0)});jq("#mainContent").scroll(function(){return jq("#filesMainContent").height()-jq("#fileSelectorDialog").height()<=jq("#mainContent").scrollTop()&&t(ASC.Files.FileSelector.fileSelectorTree.selectedFolderId,!0),!0});jq("#filesMainContent").on("click",".folder-row:not(.error-entry) .entry-title .name a, .folder-row:not(.error-entry) .thumb-folder",function(){var n=ASC.Files.UI.getObjectData(this).id;return t(n,!1,!0),!1});jq("#filesMainContent").on("click",".file-row:not(.folder-row):not(.error-entry) .entry-title .name a, .file-row:not(.folder-row):not(.error-entry) .thumb-file",function(n){return ASC.Files.UI.clickRow(n,jq(this).closest(".file-row")),!1});jq("#closeFileSelector").click(function(){ASC.Files.FileSelector.onCancel()});window.location.href.indexOf("compact")!=-1&&jq("body").addClass("file-selector-compact")}ASC.Files.FileSelector.onInit()},h=function(n){jq("#submitFileSelector").addClass("disable");var t=ASC.Files.FileSelector.fileSelectorTree.getFolderData(n);return ASC.Files.UI.accessEdit(t)&&ASC.Files.Common.isCorrectId(n)?(jq("#submitFileSelector").removeClass("disable"),!0):(ASC.Files.FileSelector.fileSelectorTree.expandFolder(n),!1)},t=function(n,t,i){if((n||0)!=0&&(!t||jq("#pageNavigatorHolder:visible").length!=0&&jq("#pageNavigatorHolder a").text()!=ASC.Files.FilesJSResources.ButtonShowMoreLoad)){jq("#pageNavigatorHolder a").text(ASC.Files.FilesJSResources.ButtonShowMoreLoad);jq("#submitFileSelector").addClass("disable");var r={sorter:{is_asc:!1,property:"DateAndTime"},text:ASC.Files.FileSelector.filesFilterText,filter:ASC.Files.FileSelector.filesFilter,subject:""};ASC.Files.ServiceManager.getFolderItems(ASC.Files.ServiceManager.events.GetFolderItemsTree,{folderId:n,from:t?jq('#filesMainContent .file-row[name!="addRow"]').length:0,count:ASC.Files.Constants.COUNT_ON_PAGE,append:t===!0,filter:r.filter,subject:r.subject,text:r.text,orderBy:r.sorter,currentFolderId:ASC.Files.Folders&&ASC.Files.Folders.currentFolder?ASC.Files.Folders.currentFolder.id:null,expandTree:i},{orderBy:r.sorter})}},c=function(){jq("#submitFileSelector").toggleClass("disable",!jq("#filesMainContent .file-row:not(.folder-row):has(.checkbox input:checked)").length)},l=function(n){jq("#fileSelectorDialog").toggleClass("hide-thirdparty",n)},a=function(i,r,u){n=!jq("#mainContent").length||r;ASC.Files.FileSelector.fileSelectorTree.clickOnFolder=n?h:t;jq("#fileSelectorDialog").toggleClass("only-folder",n);jq("#fileSelectorDialog").hasClass("popup-modal")&&ASC.Files.UI.blockUI("#fileSelectorDialog",n?440:1030,650);PopupKeyUpActionProvider.EnterAction='jq("#submitFileSelector").click();';typeof u!="undefined"&&(jq("#fileSelectorTree>ul>li:not(.third-party-entry)").toggle(!u),ASC.Files.FileSelector.toggleThirdParty(!u));ASC.Files.FileSelector.fileSelectorTree.rollUp();i=i||ASC.Files.FileSelector.fileSelectorTree.getDefaultFolderId();ASC.Files.FileSelector.fileSelectorTree.setCurrent(i);n||(ASC.Files.UI.filesSelectedHandler=c,t(i));jq("#submitFileSelector").toggleClass("disable",!n||!ASC.Files.Common.isCorrectId(ASC.Files.FileSelector.fileSelectorTree.selectedFolderId))},v=function(n){jq("#fileSelectorTitle").text((n||"").trim())},y=function(n){ASC.Files.ServiceManager.getThirdParty(ASC.Files.ServiceManager.events.GetThirdPartyTree,{folderType:1,callback:n})},p=function(n,t,i){if(typeof i!="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);return}if(n.length>0){var r=ASC.Files.Common.jsonToXml({folderList:{entry:n}}),u=ASC.Files.TemplateManager.translateFromString(r);jq("#fileSelectorTree>ul").prepend(u);ASC.Files.FileSelector.onThirdPartyTreeCreated()}t.callback&&t.callback()},w=function(n,t,i){ASC.Files.EventHandler.onGetFolderItems(n,t,i);t.expandTree&&ASC.Files.FileSelector.fileSelectorTree.expandFolder(t.currentFolderId,!0,!0);ASC.Files.FileSelector.fileSelectorTree.setCurrent(ASC.Files.Folders.currentFolder.id)};return{init:s,setTitle:v,openDialog:a,toggleThirdParty:l,createThirdPartyTree:y,fileSelectorTree:{},filesFilter:r,filesFilterText:"",onInit:u,onSubmit:f,onCancel:e,onThirdPartyTreeCreated:o}}(),function(n){n(function(){jq("#fileSelectorDialog").length!=0&&ASC.Files.FileSelector.init()})}(jQuery);window.ASC.Files.TreePrototype=function(n,t){var r=function(n){return n==c?i:ASC.Files.UI?i.find(".tree-node"+ASC.Files.UI.getSelectorId(n)):i.find('.tree-node[data-id="'+(n+"").replace(/\\/g,"\\\\").replace(/\"/g,'\\"')+'"]')},u=function(n){return jq(n).attr("data-id")},o=function(n){var t=r(n);return t.parents(".jstree .tree-node")},l=function(n,t){(n.find("ul").html()||"").trim()!=""&&s(n);t!=""?(n.removeClass("jstree-empty").append("<ul>"+t+"<\/ul>"),n.find("ul a").each(function(){var n=u(this),t=ASC.Files.UI.getEntryLink("folder",n);jq(this).attr("href",t)})):n.addClass("jstree-empty");n.find(".jstree-load-node").removeClass("jstree-load-node");n.addClass("jstree-open").removeClass("jstree-closed")},s=function(n){n.is(".tree-node")||(n=n.find(".tree-node"));n.addClass("jstree-closed").removeClass("jstree-open jstree-empty").children("ul").remove()},e=function(n,t,i,f){if(ASC.Files.Common.isCorrectId(t))var e=r(t);else e=jq(this).parent(),t=u(e);e.length&&t!=ASC.Files.Constants.FOLDER_ID_TRASH&&(e.is(":has(ul)")?e.toggleClass("jstree-closed",i!=null?!i:null).toggleClass("jstree-open",i):v(t,f))},a=function(){var n=jq(this).parent(),t=u(n),i=f.clickOnFolder(t)!==!1;return h(n,i),!1},h=function(n,t){if(i.find("a.selected").removeClass("selected"),i.find(".parent-selected").removeClass("parent-selected"),n.children("a").addClass("selected"),n.parents(".jstree .jstree-closed").addClass("jstree-open").removeClass("jstree-closed"),n.parents(".jstree .tree-node").addClass("parent-selected"),n&&n.offset()){var r=n.offset().top;r-=i.offset().top;r+=i.scrollTop();r-=30;i.scrollTop(r)}f.selectedFolderId=t?u(n):null},v=function(n,t){ASC.Files.Common.isCorrectId(n)&&(r(n).find(".jstree-expander").addClass("jstree-load-node"),ASC.Files.ServiceManager.getTreeSubFolders(ASC.Files.ServiceManager.events.GetTreeSubFolders,{folderId:n,ajaxsync:t===!0}))},y=function(n){ASC.Files.Common.isCorrectId(n)&&ASC.Files.ServiceManager.getTreePath(ASC.Files.ServiceManager.events.GetTreePath,{folderId:n,ajaxsync:!0})},p=function(n,t,u){if(typeof u!="undefined"){f.errorMessage(u);return}var o=t.folderId,s=ASC.Files.TemplateManager.translate(n),e=r(o);if(!e.length){if(c!=null)return;e=i}l(e,s)},w=function(n,t,i){if(typeof i!="undefined"){f.errorMessage(i);return}n.pop();jq(n).each(function(n,t){e(null,t,!0,!0)})};this.getFolderTitle=function(n){return r(n).children("a:first").text().trim()};this.getPath=function(n){return o(n).map(function(n,t){return u(t)}).toArray().reverse()};this.getParentId=function(n){var t=o(n);return t.length?u(t[0]):0};this.setCurrent=function(n){var t=r(n);t.length||(y(n),t=r(n));h(t,!0)};this.resetFolder=function(n){s(r(n))};this.rollUp=function(){i.find("a.selected").removeClass("selected");i.find(".parent-selected").removeClass("parent-selected");i.find(".jstree-open").addClass("jstree-closed").removeClass("jstree-open");f.selectedFolderId=null};this.expandFolder=function(n,t,i){return e(null,n,t,i)};this.selectedFolderId=null;this.clickOnFolder=function(){};this.errorMessage=function(n){ASC.Files.UI&&ASC.Files.UI.displayInfoPanel(n,!0)};this.getFolderData=function(n){var t=r(n);return ASC.Files.UI?ASC.Files.UI.getObjectData(t):{entryId:n,entryType:"folder",entryObject:t,title:getFolderTitle(n)}};this.getDefaultFolderId=function(){return u(i.find(".tree-node:visible:first"))};var f=this,i=jq(n),c=t;i.on("click",".jstree-expander",e);i.on("dblclick","a",e);i.on("click","a",a);ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.GetTreeSubFolders,p);ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.GetTreePath,w)}