typeof jq=="undefined"&&(jq=jQuery.noConflict());typeof ASC=="undefined"&&(ASC={});typeof ASC.Files=="undefined"&&(ASC.Files=function(){return{}}());typeof ASC.Files.Constants=="undefined"&&(ASC.Files.Constants={});ASC.Files.Constants.REQUEST_STATUS_DELAY=2e3;ASC.Files.Constants.REQUEST_CONVERT_DELAY=500;ASC.Files.Constants.COUNT_ON_PAGE=30;ASC.Files.Constants.entryIdRegExpStr="(\\d+|[a-z]+-\\d+(-.+)*)";ASC.Files.Constants.storageKeyRecent="TeamLabRecentDocuments";ASC.Files.Constants.storageKeyCompactView="TeamLabDocumentsCompactView";ASC.Files.Constants.storageKeyUploaderCompactView="TeamLabDocumentsUploaderCompactView";ASC.Files.Common=function(){var t=function(n){if(typeof n=="undefined"||n===null||n===0)return!1;var t=new RegExp("^"+ASC.Files.Constants.entryIdRegExpStr);return t.test(n)},i=function(n){return jq.browser.safari||jq.browser.mozilla?encodeURI(n):n},r=function(t,i){var r="",f,u;if(typeof t=="object")if(t===null)typeof i!="undefined"&&(r+="<"+i+"><\/"+i+">");else if(t.constructor.toString().indexOf("Array")!==-1)for(u=0,f=t.length;u<f;u++)r+=typeof i!="undefined"?"<"+i+">"+arguments.callee(t[u])+"<\/"+i+">":arguments.callee(t[u]);else{for(u in t)r+=arguments.callee(t[u],u);typeof i!="undefined"&&(r="<"+i+">"+r+"<\/"+i+">")}else typeof t=="string"?(r=n(t),typeof i!="undefined"&&(r="<"+i+">"+r+"<\/"+i+">")):typeof t!="undefined"&&typeof t.toString!="undefined"&&(r=n(t.toString()),typeof i!="undefined"&&(r="<"+i+">"+r+"<\/"+i+">"));return r},n=function(n){return n.replace(/&/gim,"&amp;").replace(/</gim,"&lt;").replace(/>/gim,"&gt;")},u=function(){var n=jq.url.attr("protocol");return n+="://",n+=jq.url.attr("host"),jq.url.attr("port")!=null&&(n+=":",n+=jq.url.attr("port")),n},f=function(n){n||(n=window.event);n.cancelBubble=!0;n.stopPropagation&&n.stopPropagation()},e=new RegExp('[\t*+:"<>?|\\\\/]',"gim"),o=function(n){return(n||"").trim().replace(ASC.Files.Common.characterRegExp,"_")};return{getSitePath:u,cancelBubble:f,keyCode:{enter:13,esc:27,spaceBar:32,pageUP:33,pageDown:34,end:35,home:36,left:37,up:38,right:39,down:40,insertKey:45,deleteKey:46,A:65,C:67,F:70,N:78,a:97,c:99,f:102,n:110},characterString:'*+:"<>?|/',characterRegExp:e,replaceSpecCharacter:o,isCorrectId:t,getCorrectHash:i,jsonToXml:r,storeOriginal:!1}}();window.ASC.Files.TemplateManager=function(){var n=null,u=function(){return n||jq.ajax({url:ASC.Files.Constants.URL_TEMPLATES_HANDLER,async:!1,success:function(t){n=t}}),n},f=function(n){var t=u();return r(n,t)},e=function(n){var t,f;return typeof n=="undefined"?"":(t=n,typeof n=="string"&&(t=i(n)),f=u(),r(t,f))},i,r;try{var o=new ActiveXObject("Microsoft.XMLDOM"),s=new ActiveXObject("Microsoft.XMLHTTP"),t=o&&s}catch(h){t=!1}return i=function(){return t?function(n){if(typeof n!="string"||n.length===0)return undefined;var t=new ActiveXObject("Microsoft.XMLDOM");if(t.async="false",t.loadXML(n),t.parseError.errorCode!=0)throw"Can't create xml document";return t}:function(n){if(typeof n!="string"||n.length===0)return undefined;var t=new DOMParser;try{t=t.parseFromString(n,"text/xml")}catch(i){throw"Can't create xml document : "+i;}return t}}(),r=function(){function n(n,t){var u=new ActiveXObject("Microsoft.XMLDOM"),f=new ActiveXObject("MSXML2.FreeThreadedDOMDocument"),r,i;return u.load(n),f.load(t),r=new ActiveXObject("Msxml2.XSLTemplate"),r.stylesheet=f,i=r.createProcessor(),i.input=u,i.transform(),i.output}return t?function(t,i){var r="";if(typeof t=="undefined"||t==null||typeof i=="undefined"||i==null)return r;try{i.resolveExternals=!0}catch(u){}try{try{r=t.transformNode(i)}catch(f){r=n(t,i)}}catch(u){throw"Can't translate xml : "+u;}return r}:function(n,t){var i="",u,r,f;if(typeof n=="undefined"||typeof t=="undefined")return i;try{r=new XSLTProcessor;r.importStylesheet(t);u=r.transformToFragment(n,document)}catch(e){throw"Can't translate xml : "+e;}try{f=new XMLSerializer;i=f.serializeToString(u)}catch(e){throw"Can't serialized xml : "+e;}return i}}(),{createXML:i,translate:f,translateFromString:e}}();window.ASC.Files.ServiceManager=function(){var f=!1,e,a="/",v=6e4,t={},i=!0,r=[],y=function(n){if(typeof n!="string"||n.length===0)throw"Incorrect service path";e=n[n.length-1]==="/"?n:n+"/";f=!0},u=[],p=5e3,w=function(){return[ASC.Files.ServiceManager.events.GetFolderItems,ASC.Files.ServiceManager.events.GetFileHistory,ASC.Files.ServiceManager.events.GetNews,ASC.Files.ServiceManager.events.GetSiblingsImage,ASC.Files.ServiceManager.events.GetThirdParty,ASC.Files.ServiceManager.events.GetHelpCenter,ASC.Files.ServiceManager.events.GetTreePath,]},b=function(n,t){for(var r,f,i=0;i<u.length;i++)if(r=u[i],r.eventType==n&&r.params==JSON.stringify(t)){if(f=new Date-r.timeStamp,0<f&&f<p)return c.apply(this,r.data),!0;u.splice(i,1);i--}return!1},o=function(n){return(typeof n!="undefined"?n+"-":"")+Math.floor(Math.random()*1e6)},k=function(n,t){for(var r=0,i=o();n.hasOwnProperty(i)&&r++<1e3;)i=o(t);return i},s=function(n,i,r){var u,f;if(n=n.toLowerCase(),i=i||window,r=r||[],t.hasOwnProperty(n)){u=t[n];for(f in u)u.hasOwnProperty(f)&&(u[f].handler.apply(i,r),u[f].type&1&&delete u[f])}},d=function(n,i,r){var e,u,f;return typeof n!="string"||typeof i!="function"?undefined:(n=n.toLowerCase(),typeof r!="object"&&(r={}),e=r.hasOwnProperty("once")?r.once:!1,u=0,u|=+e*1,t.hasOwnProperty(n)||(t[n]={}),f=k(t[n]),t[n][f]={handler:i,type:u},f)},g=function(n,i){return typeof n!="string"||typeof i=="undefined"?!1:(t(n)&&t[n].hasOwnProperty(i)&&delete userEventHandlers[n][i],!0)},nt=function(){var t,n,r,i;if(f||y(ASC.Files.Constants.URL_WCFSERVICE),t=e,arguments.length===0)return t;for(n=0,r=arguments.length-1;n<r;n++)t+=arguments[n]+a;return i=t+arguments[n],i+((i.search(/\?/)>0?"&":"?")+"_="+(new Date).getTime())},h=function(n){return!n||typeof n!="object"?"":n.text||n.textContent||function(n){var t="",u=n.childNodes,i,f,r;if(!u)return t;for(i=0,f=u.length;i<f;i++){r=u.item(i);switch(r.nodeType){case 1:case 5:t+=arguments.callee(r);break;case 3:case 2:case 4:t+=r.nodeValue}}return t}(n)},c=function(n,t,u,f,e){var y,c,w,k;if(i=!0,typeof LoadingBanner!="undefined"&&typeof LoadingBanner.hideLoading!="undefined"&&LoadingBanner.hideLoading(),e==="error"){var o="",b="",a=null,p,v=null;if(f.responseXML){if(a=f.responseXML.getElementsByTagName("message")[0],p=f.responseXML.getElementsByTagName("inner")[0],p&&(v=p.getElementsByTagName("message")[0]),o==="")try{o=eval("["+f.responseText+"]")[0].Detail}catch(d){y=document.createElement("div");o=jq("#content",jq(y).html(f.responseText)).text()}}else if(f.responseText&&(y=document.createElement("div"),o=jq("#content",jq(y).html(f.responseText)).text(),o===""))try{o=eval("["+f.responseText+"]")[0].Detail}catch(d){}a&&typeof a=="object"&&(o=h(a));v&&typeof v=="object"&&(b=h(v));s(n,window,[undefined,t,b||o]);return}if(w="<!DOCTYPE",f.responseText&&f.responseText.indexOf(w)!=0)try{switch(u){case"xml":c=ASC.Files.TemplateManager.createXML(f.responseText);break;case"json":c=jq.parseJSON(f.responseText);break;default:f.responseXML.xml.indexOf(w)!=0&&(c=ASC.Files.TemplateManager.createXML(f.responseXML.xml)||jq.parseJSON(f.responseText))}}catch(d){c=f.responseText}s(n,window,[c,t]);r.length!=0&&i==!0&&(k=r.shift(),i=!1,l(k))},tt=function(n,t,i){return function(){for(var r=[n,t,i],f=0,e=arguments.length;f<e;f++)r.push(arguments[f]);jq.inArray(n,w())>=0&&u.push({eventType:n,params:JSON.stringify(t),timeStamp:new Date,data:r});c.apply(this,r)}},n=function(n,t,u,f){var e,s,c;if(typeof n!="undefined"&&typeof t!="undefined"&&typeof u=="string"&&(typeof f=="undefined"&&(f={}),!b(u,f))){(typeof LoadingBanner=="undefined"||typeof LoadingBanner.displayLoading=="undefined")&&(f.showLoading=!1);var a={},h=[],o=f.ajaxcontentType||"application/xml";typeof f!="object"&&(f={});switch((n||"").toLowerCase()){case"delete":case"get":for(e=4,s=arguments.length;e<s;e++)h.push(arguments[e]);break;case"post":for(a=o=="text/xml"||o=="application/xml"?ASC.Files.Common.jsonToXml(arguments[4]):o=="application/json"?JSON.stringify(arguments[4]):arguments[4],e=5,s=arguments.length;e<s;e++)h.push(arguments[e]);break;default:return}c={async:f.ajaxsync!=!0,data:a,type:n,dataType:t,contentType:o,cache:!0,url:nt.apply(this,h),timeout:v,beforeSend:function(){if(f.showLoading)ASC.Files.Folders&&ASC.Files.Folders.isFirstLoad||(LoadingBanner.displayLoading(),jq(".advansed-filter").advansedFilter("resize"));else return null},complete:tt(u,f,t)};r.length==0&&i==!0?(i=!1,l(c)):r.push(c)}},l=function(n){jq.ajax({async:n.async,data:n.data,type:n.type,dataType:n.dataType,contentType:n.contentType,cache:n.cache,url:n.url,timeout:n.timeout,beforeSend:n.beforeSend,complete:n.complete})},it=function(t,i){i.ajaxsync=!0;n("get","xml",t,i,"folders-create?parentId="+encodeURIComponent(i.parentFolderID)+"&title="+encodeURIComponent(i.title))},rt=function(t,i){i.ajaxsync=!0;n("get","xml",t,i,"folders-files-createfile?parentId="+encodeURIComponent(i.folderID)+"&title="+encodeURIComponent(i.fileTitle))},ut=function(t,i,r){i.showLoading=i.append!=!0;n("post","xml",t,i,r,"folders?parentId="+encodeURIComponent(i.folderId)+"&from="+i.from+"&count="+i.count+"&filter="+i.filter+"&subjectID="+i.subject+"&search="+encodeURIComponent(i.text))},ft=function(t,i){n("get","xml",t,i,"folders-subfolders?parentId="+encodeURIComponent(i.folderId))},et=function(t,i){n("get","json",t,i,"folders-path?folderId="+encodeURIComponent(i.folderId))},ot=function(t,i){n("get","json",t,i,"folders-folder?folderId="+encodeURIComponent(i.folderId))},st=function(t,i,r){n("post","json",t,i,r,"folders-intries?filter="+i.filter+"&subjectID="+i.subject+"&search="+encodeURIComponent(i.text))},ht=function(t,i){i.ajaxsync=!0;n("get","xml",t,i,"folders-files-getversion?fileId="+encodeURIComponent(i.fileId)+"&version="+(i.version||-1))},ct=function(t,i){n("get","xml",t,i,"folders-files-history?fileId="+encodeURIComponent(i.fileId))},lt=function(t,i){n("get","json",t,i,"folders-files-updateToVersion?fileId="+encodeURIComponent(i.fileId)+"&version="+i.version)},at=function(t,i){n("get","json",t,i,"folders-files-updateComment?fileId="+encodeURIComponent(i.fileId)+"&version="+i.version+"&comment="+encodeURIComponent(i.comment))},vt=function(t,i){n("get","json",t,i,"folders-files-completeversion?fileId="+encodeURIComponent(i.fileId)+"&version="+i.version+"&continueVersion="+i.continueVersion)},yt=function(t,i,r){n("post","json",t,i,r,"folders-files-siblings?fileId="+encodeURIComponent(i.fileId)+"&filter="+i.filter+"&subjectID="+i.subjectId+"&search="+encodeURIComponent(i.search))},pt=function(t,i){n("get","xml",t,i,"folders-rename?folderId="+encodeURIComponent(i.folderId)+"&title="+encodeURIComponent(i.newname))},wt=function(t,i){n("get","xml",t,i,"folders-files-rename?fileId="+encodeURIComponent(i.fileId)+"&title="+encodeURIComponent(i.newname))},bt=function(t,i,r){n("post","json",t,i,r,"folders-files-moveOrCopyFilesCheck?destFolderId="+encodeURIComponent(i.folderToId))},kt=function(t,i,r){n("post","json",t,i,r,"moveorcopy?destFolderId="+encodeURIComponent(i.folderToId)+"&resolve="+i.resolve+"&ic="+(i.isCopyOperation==!0))},dt=function(t,i,r){n("post","json",t,i,r,"folders-files?action=delete")},gt=function(t,i){n("get","json",t,i,"emptytrash")},ni=function(t,i,r){i.showLoading=!0;i.ajaxcontentType="application/json";n("post","json",t,i,r,"bulkdownload")},ti=function(t,i){n("get","json",t,i,"tasks-statuses")},ii=function(t,i){n("get","json",t,i,"tasks")},ri=function(t,i){n("get","json",t,i,"trackeditfile?fileId="+encodeURIComponent(i.fileID)+"&tabId="+i.tabId+"&docKeyForTrack="+i.docKeyForTrack+"&isFinish="+(i.finish==!0)+i.shareLinkParam)},ui=function(t,i,r){n("post","json",t,i,r,"checkediting")},fi=function(t,i){n("get","json",t,i,"startEdit?fileId="+encodeURIComponent(i.fileID)+i.shareLinkParam)},ei=function(t,i){n("get","json",t,i,"setacelink?fileId="+encodeURIComponent(i.fileId)+"&share="+i.share)},oi=function(t,i,r){n("post","json",t,i,r,"sharedinfo")},si=function(t,i){n("get","json",t,i,"sharedinfoshort?objectId="+encodeURIComponent(i.objectID))},hi=function(t,i,r){n("post","json",t,i,r,"setaceobject?notify="+(i.notify===!0))},ci=function(t,i,r){n("post","json",t,i,r,"removeace")},li=function(t,i){n("get","json",t,i,"shorten?fileId="+encodeURIComponent(i.fileId))},ai=function(t,i,r){n("post","json",t,i,r,"checkconversion")},vi=function(t,i){n("get","json",t,i,"storeoriginal?set="+i.value)},yi=function(t,i){n("get","json",t,i,"updateifexist?set="+i.value)},pi=function(t,i){i.showLoading=!0;ASC.Files.Folders.isFirstLoad=!1;n("get","json",t,i,"thirdparty-list?folderType="+(i.folderType||0))},wi=function(t,i,r){n("post","json",t,i,r,"thirdparty-save")},bi=function(t,i){n("get","json",t,i,"thirdparty-delete?providerId="+i.providerId)},ki=function(t,i){n("get","json",t,i,"thirdparty?enable="+(i.enable===!0))},di=function(t,i,r){i.ajaxcontentType="application/json";n("post","json",t,i,r,"docusign-save")},gi=function(t,i){n("get","json",t,i,"docusign-delete")},nr=function(t,i,r){n("post","json",t,i,r,"docusign?fileId="+encodeURIComponent(i.fileId))},tr=function(t,i,r){n("post","json",t,i,r,"markasread")},ir=function(t,i){n("get","xml",t,i,"getnews?folderId="+encodeURIComponent(i.folderId))},rr=function(t,i){n("get","xml",t,i,"folders-files-lock?fileId="+encodeURIComponent(i.fileId)+"&lockfile="+(i.lock===!0))},ur=function(t,i){n("get","json",t,i,"edit-history?fileId="+encodeURIComponent(i.fileID)+i.shareLinkParam)},fr=function(t,i){n("get","json",t,i,"edit-diff-url?fileId="+encodeURIComponent(i.fileID)+"&version="+i.version+i.shareLinkParam)},er=function(t,i){n("get","json",t,i,"restore-version?fileId="+encodeURIComponent(i.fileID)+"&version="+i.version+"&url="+encodeURIComponent(i.url)+i.shareLinkParam)},or=function(t,i){n("get","json",t,i,"mailaccounts")},sr=function(t,i){n("get","json",t,i,"gethelpcenter")},hr=function(t,i,r){n("post","json",t,i,r,"changeowner?userId="+i.userId)};return{bind:d,unbind:g,events:{CreateNewFile:"createnewfile",CreateFolder:"createfolder",CheckEditing:"checkediting",GetTreeSubFolders:"gettreesubfolders",GetTreePath:"gettreepath",GetThirdPartyTree:"getthirdpartytree",GetFolderInfo:"getfolderinfo",GetFolderItems:"getfolderitems",GetItems:"getitems",GetFolderItemsTree:"getfolderitemstree",SetAceLink:"setacelink",GetSharedInfo:"getsharedinfo",GetSharedInfoShort:"getsharedinfoshort",SetAceObject:"setaceobject",UnSubscribeMe:"unsubscribeme",GetShortenLink:"getshortenlink",MarkAsRead:"markasread",GetNews:"getnews",ChangeOwner:"changeowner",FolderRename:"folderrename",FileRename:"filerename",DeleteItem:"deleteitem",EmptyTrash:"emptytrash",GetFileHistory:"getfilehistory",ReplaceVersion:"replaceversion",SetCurrentVersion:"setcurrentversion",UpdateComment:"updatecomment",CompleteVersion:"completeversion",Download:"download",GetTasksStatuses:"getTasksStatuses",TerminateTasks:"terminatetasks",MoveFilesCheck:"movefilescheck",MoveItems:"moveitems",GetSiblingsImage:"getsiblingsimage",GetThirdParty:"getthirdparty",SaveThirdParty:"savethirdparty",DeleteThirdParty:"deletethirdparty",ChangeAccessToThirdparty:"changeaccesstothirdparty",SaveDocuSign:"savedocusign",SendDocuSign:"senddocusign",UpdateIfExist:"updateifexist",GetHelpCenter:"gethelpcenter",StoreOriginalFiles:"storeoriginalfiles",ConvertCurrentFile:"convertcurrentfile",ChunkUploadCheckConversion:"chunkuploadcheckconversion",ChunkUploadGetFileFromServer:"chunkuploadgetfilefromserver",TrackEditFile:"trackeditfile",StartEdit:"startedit",LockFile:"lockfile",GetEditHistory:"getedithistory",GetDiffUrl:"getdiffurl",RestoreVersion:"restoreversion",GetMails:"getmails",StartMailMerge:"startmailmerge"},createFolder:it,createNewFile:rt,getFolderItems:ut,getTreeSubFolders:ft,getTreePath:et,getFolder:ot,getItems:st,getFile:ht,getFileHistory:ct,setCurrentVersion:lt,updateComment:at,completeVersion:vt,getSiblingsImage:yt,renameFolder:pt,renameFile:wt,changeOwner:hr,moveFilesCheck:bt,moveItems:kt,deleteItem:dt,emptyTrash:gt,download:ni,getTasksStatuses:ti,terminateTasks:ii,trackEditFile:ri,checkEditing:ui,startEdit:fi,setAceLink:ei,getSharedInfo:oi,getSharedInfoShort:si,setAceObject:hi,unSubscribeMe:ci,getShortenLink:li,checkConversion:ai,storeOriginalFiles:vi,updateIfExist:yi,getThirdParty:pi,saveThirdParty:wi,deleteThirdParty:bi,changeAccessToThirdparty:ki,saveDocuSign:di,deleteDocuSign:gi,sendDocuSign:nr,markAsRead:tr,getNews:ir,lockFile:rr,getEditHistory:ur,getDiffUrl:fr,restoreVersion:er,getMailAccounts:or,getHelpCenter:sr}}();window.ASC.Files.UI=function(){var n=!1,i=new PopupBox("pb_filesUserProfileInfo",320,140,"tintLight","borderBaseShadow","",{apiMethodName:"Teamlab.getProfile",tmplName:"userProfileCardTmpl"}),r=function(){n===!1&&(n=!0);jq(window).resize(function(){t();ASC.Files.UI.fixContentHeaderWidth()});jq(window).bind("resizeWinTimerWithMaxDelay",function(){t();ASC.Files.UI.fixContentHeaderWidth()})},u=function(){},f=function(n,t){return n&&t?ASC.Files.Common.isCorrectId(t)?jq("#filesMainContent .file-row"+ASC.Files.UI.getSelectorId(n+"_"+t)):null:null},e=function(n){return'[data-id="'+(n+"").replace(/\\/g,"\\\\").replace(/\"/g,'\\"')+'"]'},o=function(n){var i,r,u,t;if(n=jq(n),i='input:hidden[name="entry_data"]',n.is(".file-row")||(r=".file-row",n.is(".jstree *")&&(r=".tree-node",i='> a input:hidden[name="entry_data"]'),n=n.closest(r)),n.length==0)return null;u=n.find(i).val();t=null;try{t=jq.parseJSON(u||null)}catch(f){console&&console.log&&console.log("Error parseJSON: \n"+u)}return t?(t.id=t.entryId=n.find(i).attr("data-id"),!ASC.Files.Common.isCorrectId(t.id))?null:(t.entryType=t.entryType==="file"?"file":"folder",t.create_by=n.find('input:hidden[name="create_by"]').val(),t.modified_by=n.find('input:hidden[name="modified_by"]').val(),t.comment=n.find('input:hidden[name="comment"]').val(),t.entryObject=n,t.error=t.error!=""?t.error:!1,t.title=(t.title||"").trim(),t):null},s=function(n){if(typeof n=="undefined"||n==null)return null;var t=n.indexOf("file_")=="0"?"file":"folder",i=n.substring((t+"_").length);return ASC.Files.Common.isCorrectId(i)?{entryType:t,entryId:i}:null},h=function(n,t){return ASC.Files.Common.isCorrectId(t)?ASC.Files.UI.getObjectTitle(ASC.Files.UI.getEntryObject(n,t)):null},c=function(n){return(n=jq(n),n.is(".file-row")||(n=n.closest(".file-row")),n.length==0)?null:ASC.Files.UI.getObjectData(n).title.trim()},l=function(n,t,i){if(n=="file"){var r=ASC.Files.Utility.GetFileDownloadUrl(t);ASC.Files.Utility.CanWebEdit(i)&&!ASC.Files.Utility.MustConvert(i)?r=ASC.Files.Utility.GetFileWebEditorUrl(t):ASC.Files.Utility.CanWebView(i)?r=ASC.Files.Utility.GetFileWebViewerUrl(t):typeof ASC.Files.ImageViewer!="undefined"&&ASC.Files.Utility.CanImageView(i)&&(r="#"+ASC.Files.Common.getCorrectHash(ASC.Files.ImageViewer.getPreviewHash(t)))}else r=ASC.Files.Constants.URL_BASE+"#"+ASC.Files.Common.getCorrectHash(t);return r},a=function(){if(!ASC.Files.Common.isCorrectId(ASC.Files.Folders.currentFolder.id)){ASC.Files.Anchor.move("");return}ASC.Files.UI.hideAllContent(!0);ASC.Files.UI.stickContentHeader();ASC.Files.Folders.getFolderItems(!1)},v=function(n){var t=ASC.Files.Constants.storageKeyCompactView;typeof n=="undefined"&&(n=localStorageManager.getItem(t)===!0);localStorageManager.setItem(t,n);jq("#switchViewFolder").toggleClass("compact",n===!0);jq("#filesMainContent").toggleClass("compact",n===!0);ASC.Files.Folders.showMore&&n!==!0&&jq(document).height()-jq(window).height()<=jq(window).scrollTop()+350&&ASC.Files.Folders.showMore();ASC.Files.Mouse&&ASC.Files.Mouse.updateMainContentArea()},y=function(){return jq("#settingCommon, #settingThirdPartyPanel, #helpPanel").is(":visible")},p=function(){var n=jq("#mainContentHeader.stick-panel:visible");n.css("width",n.parent().innerWidth()-parseInt(n.css("margin-left"))-parseInt(n.css("margin-right")))},t=function(){var n=jq("#mainContentHeader.stick-panel:visible"),t=jq(window);n.length!=0&&n.css("left",n.parent().offset().left-t.scrollLeft())},w=function(){var n=jq("#mainContentHeader .down_arrow"),t,i;n.length&&(t=n.offset().top+n.outerHeight(),i=jq("#filesSelectorPanel:visible"),ASC.Files.UI.stickMovingPanel("mainContentHeader",i,t,!1),ASC.Files.UI.fixContentHeaderWidth())},b=function(n,t,i,r){var u=jq("#"+n),e,f,s,c,o,l;if(u.is(":visible"))if(e="Spacer",f=jq("#"+n+e),s=jq("#"+n+e+":visible").length==0?u.offset().top:f.offset().top,i=i||0,c=jq(window),o=c.scrollTop(),o>=s){var a=u.outerHeight(),h=u.parent(),v=h.innerHeight()-parseInt(h.css("padding-top"))-parseInt(h.css("padding-bottom"));(!u.hasClass("stick-panel")||jq.browser.mobile)&&(!r||o-s<v-a)&&(f.length==0&&(l=document.createElement("div"),l.id=n+e,document.body.appendChild(l),f=jq("#"+n+e),f.insertAfter(u),f.css({height:u.css("height"),"padding-top":u.css("padding-top"),"padding-bottom":u.css("padding-bottom")})),f.show(),u.addClass("stick-panel").css("left",h.offset().left-c.scrollLeft()),t&&t.css({position:"fixed",top:i-o}),jq.browser.mobile&&u.css({top:jq(document).scrollTop()+"px",position:"absolute"}));r&&u.hasClass("stick-panel")&&u.css("top",-Math.max(0,o-s-(v-a)))}else u.hasClass("stick-panel")&&(f.hide(),u.removeClass("stick-panel"),jq("#mainContentHeader").css("width","auto"),t&&t.css({position:"absolute",top:i}),jq.browser.mobile&&u.css({position:"static"}))},k=function(n,t,i,r,u){return ASC.Files.UI.blockObject(ASC.Files.UI.getEntryObject(n,t),i,r,u)},d=function(n,t,i,r){if(t=t===!0,n=jq(n),n.length&&n.hasClass("checkloading")!=t){jq(n).removeClass("row-hover");n.toggleClass("loading checkloading",t===!0);t===!0?(n.block({message:"",baseZ:99}),typeof i!="undefined"&&i&&n.children("div.blockUI.blockOverlay").attr("title",i)):(n.unblock(),n.css("position","static"));var u=n.hasClass("row-selected"),f=n.attr("data-selected")=="true";ASC.Files.UI.selectRow(n,!t&&f);t&&n.attr("data-selected",u);r||ASC.Files.UI.updateMainContentHeader()}},g=function(n){return!n.hasClass("folder-row")&&n.hasClass("on-edit")},nt=function(n){return n.hasClass("file-locked-by")},tt=function(n){var t=n.entryObject,i=n.entryType,r=n.title;return i=="file"&&ASC.Files.Folders.folderContainer!="trash"&&!t.hasClass("row-rename")&&ASC.Files.UI.accessEdit(n,t,!0)&&ASC.Files.Utility.CanWebEdit(r)},it=function(n,t){var i=ASC.Files.Utility.GetFileExtension(t),r=t.substring(0,t.length-i.length);n.html('{0}<span class="file-extension">{1}<\/span>'.format(r,i))},rt=function(n){var t=n||jq("#filesMainContent .file-row");t.each(function(){var t=ASC.Files.UI.getObjectData(this),o=t.entryId,i=t.entryType,n=t.entryObject,f=t.title,r,h,u,e,s,c;ASC.Files.Folders.folderContainer=="trash"?(n.find(".file-lock").remove(),n.find(".entry-descr .title-created").remove(),n.find(".entry-descr .title-removed").show(),i=="folder"&&(n.find(".create-date").remove(),n.find(".modified-date").show())):(n.find(".entry-descr .title-removed").remove(),i=="folder"&&n.find(".modified-date").remove());r=n.find(".entry-title .name a");h=i=="file"?ASC.Files.Utility.getCssClassByFileTitle(f):ASC.Files.Utility.getFolderCssClass();n.find(".thumb-"+i).addClass(h);n.hasClass("checkloading")||(i=="file"?(r.is(":not(:has(.file-extension))")&&ASC.Files.UI.highlightExtension(r,f),ASC.Files.Folders.folderContainer!="trash"&&(u=ASC.Files.UI.getEntryLink(i,o,f),r.attr("href",u).attr("target","_blank"),e=n.find(".file-lock"),ASC.Files.UI.accessEdit(t,n)?n.hasClass("file-locked")&&(s=ASC.Files.FilesJSResources.TitleLockedFile,ASC.Files.UI.lockedForMe(n)&&(c=e.attr("data-name"),s=ASC.Files.FilesJSResources.TitleLockedFileBy.format(c)),e.attr("title",s)):e.remove()),ASC.Files.Utility.MustConvert(f)?(n.find(".pencil:not(.convert-action)").remove(),Teamlab.profile.isVisitor&&!ASC.Files.UI.accessEdit()||ASC.Files.Folders.folderContainer=="trash"?n.find(".convert-action").remove():n.find(".convert-action").show()):ASC.Files.UI.editableFile(t)?(ASC.Files.UI.lockEditFile(n,ASC.Files.UI.editingFile(n)),n.find(".convert-action").remove(),ASC.Files.Utility.CanCoAuhtoring(f)&&!n.hasClass("on-edit-alone")&&n.addClass("can-coauthoring"),u=ASC.Files.Utility.GetFileWebEditorUrl(o),n.find(".file-edit").attr("href",u)):(n.addClass("cannot-edit"),n.find(".pencil").remove())):ASC.Files.Folders.folderContainer!="trash"&&(u=ASC.Files.UI.getEntryLink(i,o),r.attr("href",u)),(ASC.Files.Folders.folderContainer=="trash"||t.error)&&r.attr("href",ASC.Files.UI.getEntryLink("folder",ASC.Files.Folders.currentFolder.id)),jq("#filesMainContent").hasClass("without-share")||(ASC.Files.Folders.folderContainer!="forme"||ASC.Files.UI.accessEdit(t,n))&&(!ASC.Resources.Master.Personal||i!="folder")&&Teamlab.profile.isVisitor!==!0||n.addClass("without-share"),jq.browser.msie&&n.find("*").attr("unselectable","on"))});jq("#switchToNormal").length&&ASC.Files.UI.switchFolderView()},ut=function(n,t){var i=jq.fixEvent(n),r,u;if(!(i.button==0||jq.browser.msie&&i.button==1))return!0;t=t||jq(i.srcElement||i.target);try{if(t.is("a, .menu-small"))return!0}catch(i){return!0}if(r=t.is(".file-row")?t:t.closest(".file-row"),u=!jq(r).hasClass("row-selected")||jq(r).find(".checkbox input:visible").is("[type=radio]"),i.shiftKey&&ASC.Files.UI.lastSelectedEntry&&ASC.Files.UI.lastSelectedEntry.entryObj){u=!0;var f=jq(".file-row").index(r),e=jq(".file-row").index(ASC.Files.UI.lastSelectedEntry.entryObj),o=Math.min(f,e),s=Math.max(f,e);jq(".file-row:lt("+s+"):gt("+o+")").each(function(){ASC.Files.UI.selectRow(jq(this),u)})}else i.ctrlKey||t.is(".checkbox, .checkbox input")||(jq(".row-selected").length>1&&(u=!0),ASC.Files.UI.checkSelectAll(!1));return ASC.Files.UI.selectRow(r,u),ASC.Files.UI.updateMainContentHeader(),ASC.Files.UI.lastSelectedEntry={entryObj:r},!0},ft=function(){ASC.Files.UI.resetSelectAll(jq("#filesMainContent .file-row:has(.checkbox input:visible:not(:checked))").length==0);jq("#filesMainContent .file-row:has(.checkbox input:checked)").length==0?(jq("#mainContentHeader .menuAction.unlockAction").removeClass("unlockAction"),ASC.Files.Folders.folderContainer=="trash"&&jq("#mainEmptyTrash").addClass("unlockAction")):ASC.Files.Actions&&ASC.Files.Actions.showActionsViewPanel();typeof ASC.Files.UI.filesSelectedHandler=="function"&&ASC.Files.UI.filesSelectedHandler()},et=function(n,t){return n?(n.hasClass("file-row")||(n=n.closest(".file-row")),n.hasClass("row-selected")==t)?!1:n.hasClass("checkloading")&&t?!1:((n.hasClass("new-folder")||jq(n).hasClass("row-rename"))&&(t=!1),t===!0&&n.find(".checkbox input:visible").is("[type=radio]")&&(jq("#filesMainContent .checkbox input:checked").prop("checked",!1),jq("#filesMainContent .file-row.row-selected").removeClass("row-selected")),n.find(".checkbox input").prop("checked",t===!0),n.toggleClass("row-selected",t).removeAttr("data-selected"),jq("#filesMainContent .menu-small.active").removeClass("active"),!0):!1},ot=function(n){jq("#filesSelectAllCheck").prop("checked",n===!0);var t=n!==!0&&jq("#filesMainContent .file-row .checkbox input:checked").length!=0;jq("#filesSelectAllCheck").prop("indeterminate",t).toggleClass("indeterminate",t)},st=function(n){var t=!1,i=".row-selected";n&&(i=":not("+i+")");jq("#filesMainContent .file-row"+i+":not(.checkloading)").each(function(){t=ASC.Files.UI.selectRow(jq(this),n)||t});t&&ASC.Files.UI.updateMainContentHeader();ASC.Files.UI.lastSelectedEntry=null},ht=function(n){ASC.Files.Actions.hideAllActionPanels();jq("#filesMainContent .file-row:not(.checkloading)").each(function(){var t,i=ASC.Files.UI.getObjectTitle(this);switch(n){case"folder":t=jq(this).hasClass("folder-row");break;case"file":t=!jq(this).hasClass("folder-row");break;case"document":t=ASC.Files.Utility.FileIsDocument(i)&&!jq(this).hasClass("folder-row");break;case"presentation":t=ASC.Files.Utility.FileIsPresentation(i)&&!jq(this).hasClass("folder-row");break;case"spreadsheet":t=ASC.Files.Utility.FileIsSpreadsheet(i)&&!jq(this).hasClass("folder-row");break;case"image":t=ASC.Files.Utility.FileIsImage(i)&&!jq(this).hasClass("folder-row");break;case"archive":t=ASC.Files.Utility.FileIsArchive(i)&&!jq(this).hasClass("folder-row");break;default:return!1}return ASC.Files.UI.selectRow(jq(this),t),!0});ASC.Files.UI.updateMainContentHeader()},ct=function(n,t){n!==""&&typeof n!="undefined"&&(t===!0?toastr.error(n):toastr.success(n))},lt=function(n,t,i){var u,r,f,e;if(Teamlab.profile.isOutsider||(n=n||(t?ASC.Files.UI.getObjectData(t):ASC.Files.Folders.currentFolder),u=ASC.Files.Constants.ADMIN||!n||n.create_by_id==Teamlab.profile.id,n&&n.entryType=="folder"&&(n.entryId===ASC.Files.Constants.FOLDER_ID_SHARE||n.entryId===ASC.Files.Constants.FOLDER_ID_PROJECT||n.entryId===ASC.Files.Constants.FOLDER_ID_TRASH)&&(u=!1),r=n?n.entryId:null,f=n?n.entryType:null,f=="folder"&&(r==ASC.Files.Constants.FOLDER_ID_COMMON_FILES&&!ASC.Files.Constants.ADMIN||r==ASC.Files.Constants.FOLDER_ID_SHARE||r==ASC.Files.Constants.FOLDER_ID_TRASH||r==ASC.Files.Constants.FOLDER_ID_PROJECT)))return!1;e=parseInt(n?n.access:ASC.Files.Constants.AceStatusEnum.None);f=="folder"&&ASC.Files.Folders&&ASC.Files.Folders.currentFolder&&r==ASC.Files.Folders.currentFolder.id&&(e=parseInt(ASC.Files.Folders.currentFolder.access));switch(e){case ASC.Files.Constants.AceStatusEnum.None:case ASC.Files.Constants.AceStatusEnum.ReadWrite:return!0;case ASC.Files.Constants.AceStatusEnum.Read:case ASC.Files.Constants.AceStatusEnum.Restrict:return!1;case ASC.Files.Constants.AceStatusEnum.Review:return!!i;default:return u}},at=function(n){if(Teamlab.profile.isOutsider)return!1;var t=n?ASC.Files.UI.getObjectData(n):ASC.Files.Folders.currentFolder,i=parseInt(t?t.access:ASC.Files.Constants.AceStatusEnum.None),r=t?t.entryId:null,u=t?t.entryType:null;return(u=="folder"&&r==ASC.Files.Folders.currentFolder.id&&(i=ASC.Files.Folders.currentFolder.access),i==ASC.Files.Constants.AceStatusEnum.Restrict)?(n.remove(),ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.AceStatusEnum_Restrict,!0),!1):ASC.Files.Folders.currentFolder.id==ASC.Files.Constants.FOLDER_ID_PROJECT?!1:i==ASC.Files.Constants.AceStatusEnum.Read?!1:i==ASC.Files.Constants.AceStatusEnum.None||ASC.Files.Folders.folderContainer=="corporate"&&ASC.Files.Constants.ADMIN||ASC.Files.Folders.currentFolder.id!=ASC.Files.Constants.FOLDER_ID_PROJECT&&t.create_by_id==Teamlab.profile.id},vt=function(n,t,i){var r=ASC.Files.UI.getEntryObject("file",n);return ASC.Files.UI.lockEditFile(r,t,i)},yt=function(n,t,i){if(!n.hasClass("folder-row"))if(t){n.addClass("on-edit");var r=ASC.Files.FilesJSResources.TitleEditingFile;i&&(r=ASC.Files.FilesJSResources.TitleEditingFileBy.format(i));n.find(".pencil.file-editing").attr("title",r)}else n.removeClass("on-edit")},pt=function(){var n,t;(clearTimeout(ASC.Files.UI.timeCheckEditing),n=jq(".files-content-panel #filesMainContent .file-row.on-edit:not(.cannot-edit)"),n.length!=0)&&(t={entry:jq(n).map(function(n,t){return ASC.Files.UI.getObjectData(t).entryId}).toArray()},ASC.Files.ServiceManager.checkEditing(ASC.Files.ServiceManager.events.CheckEditing,{list:t.entry},{stringList:t}))},wt=function(n,t,i){var u;n=n||ASC.Files.UI.getEntryObject(t,i);var r=ASC.Files.UI.getObjectData(n),f={entryTooltip:{type:t,title:r.title,create_by:r.create_by,date_type:ASC.Files.Folders.folderContainer=="trash"?"remove":t=="folder"?"create":r.version>1?"update":"upload",modified_on:t=="file"?r.modified_on:ASC.Files.Folders.folderContainer=="trash"?r.modified_on:r.create_on,version:r.version,length:r.content_length,error:r.error,provider_key:r.provider_key,total_files:parseInt(n.find(".countFiles").html())||0,total_sub_folder:parseInt(n.find(".countFolders").html())||0,comment:r.comment}},e=ASC.Files.Common.jsonToXml(f),o=ASC.Files.TemplateManager.translateFromString(e);jq("#entryTooltip").html(o);u=jq("#filesMainContent .file-row").length>10&&n.is("#filesMainContent .file-row:gt(-4)");jq.dropdownToggle().toggle(n.find(".thumb-"+t),"entryTooltip",u?-12:0,0,!1,null,null,null,u)},bt=function(){clearTimeout(ASC.Files.UI.timeTooltip);jq("#entryTooltip").hide();var n=jq("#filesMainContent .file-row .entry-title .name a[data-title]").removeAttr("data-title");n.attr("title",n.text())},kt=function(){var n=ASC.Files.Constants.COUNT_ON_PAGE-jq("#filesMainContent .file-row").length;n>0&&(ASC.Files.UI.currentPage<ASC.Files.UI.amountPage?ASC.Files.Folders.getFolderItems(!0,n):ASC.Files.Folders.folderContainer&&n>=ASC.Files.Constants.COUNT_ON_PAGE&&ASC.Files.EmptyScreen.displayEmptyScreen())},dt=function(n,t){if(ASC.Files.Tree&&ASC.Files.Tree.pathParts.length>1){var i=ASC.Files.Tree.pathParts[ASC.Files.Tree.pathParts.length-2],r=ASC.Files.Tree.getFolderTitle(i);jq(n).attr("data-id",i).attr("href",ASC.Files.UI.getEntryLink("folder",i)).attr("title",r);jq(t||n).show()}else jq(t||n).hide()},gt=function(n){jq(n).unbind("keyup").bind("keyup",function(){var n=jq(this).val();n.search(ASC.Files.Common.characterRegExp)!=-1&&(jq(this).val(ASC.Files.Common.replaceSpecCharacter(n)),ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResources.ErrorMassage_SpecCharacter.format(ASC.Files.Common.characterString),!0))})},ni=function(n){if(ASC.Files.UI.canSetDocumentTitle){n=n||ASC.Files.Folders.currentFolder.title;n=n?n+" - ":"";var t=jq(".files-content-panel").attr("data-title")||"TeamLab";document.title=n+t}},ti=function(n){typeof ASC.Files.ImageViewer!="undefined"&&ASC.Files.ImageViewer.resetWorkspace();n=!!n;n||(jq("#treeViewContainer .selected").removeClass("selected"),jq("#treeViewContainer .parent-selected").removeClass("parent-selected"));jq("#treeSecondary .currentCategory").removeClass("currentCategory");jq("#treeSecondary .active").removeClass("active");jq("#settingCommon").hide();jq("#settingThirdPartyPanel").hide();jq("#helpPanel").hide();jq("#moreFeatures").hide();jq(".files-content-panel").toggle(n);jq(".mainPageContent").children(".loader-page").remove()},ii=function(n){if(!jq("#helpPanel").length){ASC.Files.Anchor.defaultFolderSet();return}ASC.Files.UI.hideAllContent();var t={helpId:n};if(jq("#helpPanel").text().trim().length)ASC.Files.EventHandler.onGetHelpCenter(null,t);else t.update=!0,ASC.Files.ServiceManager.getHelpCenter(ASC.Files.ServiceManager.events.GetHelpCenter,t)},ri=function(){ASC.Files.UI.hideAllContent();LoadingBanner.hideLoading();jq("#treeSetting").addClass("currentCategory open");jq(".settings-link-common").addClass("active");jq("#settingCommon").show();ASC.Files.UI.setDocumentTitle(ASC.Files.FilesJSResources.TitleSettingsCommon)},ui=function(){ASC.Files.UI.hideAllContent();LoadingBanner.hideLoading();ASC.Files.CreateMenu.disableMenu();jq("#moreFeatures").show();ASC.Files.UI.setDocumentTitle(ASC.Files.FilesJSResources.TitleMoreFeaturs)},fi=function(){return jq("#tariffLimitExceedStoragePanel").length?(ASC.Files.UI.blockUI("#tariffLimitExceedStoragePanel",500,300,0),!0):!1},ei=function(){return jq("#tariffLimitExceedFileSizePanel").length?(ASC.Files.UI.blockUI("#tariffLimitExceedFileSizePanel",500,300,0),!0):!1},oi=function(n,t,i,r){return ASC.Files.Mouse&&(ASC.Files.Mouse.finishMoveTo(),ASC.Files.Mouse.finishSelecting()),StudioBlockUIManager.blockUI(n,t,i,r,"absolute")},si=function(n,t){var f,i,r,e,o,u;t=t|0;n=jq(n);n.is("progress")||(n=n.find("progress"));f=50;i=n.data("timer");clearInterval(i);r=n.val();!t||r>t?n.val(t):(e=function(t,r){var u=Math.min(r,n.val()+t);n.val(u);u==r&&clearInterval(i)},o=Math.max(1,(t-r)/f),i=setInterval(function(){e(o,t)},1),n.data("timer",i));u=n.find(".asc-progress-value");t?u.animate({width:t+"%"}):u.css("width",t+"%")},hi=function(n){n.find(".userLink").each(function(){var n=jq(this).attr("id").trim();n!=null&&n!=""&&i.RegistryElement(n,'"'+jq(this).attr("data-uid")+'"')})};return{init:r,parseItemId:s,getEntryObject:f,getObjectData:o,getSelectorId:e,getEntryTitle:h,getObjectTitle:c,getEntryLink:l,currentPage:0,amountPage:0,countTotal:0,updateFolderView:a,switchFolderView:v,isSettingsPanel:y,blockObjectById:k,blockObject:d,highlightExtension:it,addRowHandlers:rt,updateMainContentHeader:ft,lastSelectedEntry:null,checkSelectAll:st,checkSelect:ht,selectRow:et,clickRow:ut,resetSelectAll:ot,displayInfoPanel:ct,editingFile:g,editableFile:tt,lockedForMe:nt,checkEditing:pt,timeCheckEditing:null,lockEditFileById:vt,lockEditFile:yt,accessEdit:lt,accessDelete:at,checkCharacter:gt,canSetDocumentTitle:!0,setDocumentTitle:ni,stickContentHeader:w,fixContentHeaderWidth:p,stickMovingPanel:b,displayEntryTooltip:wt,hideEntryTooltip:bt,timeTooltip:null,checkEmptyContent:kt,checkButtonBack:dt,hideAllContent:ti,displayHelp:ii,displayCommonSetting:ri,displayMoreFeaturs:ui,displayTariffLimitStorageExceed:fi,displayTariffFileSizeExceed:ei,blockUI:oi,setProgressValue:si,filesSelectedHandler:u,registerUserProfilePopup:hi}}(),function(n){ASC.Files.UI.init();n(function(){jq("#switchToNormal").click(function(){ASC.Files.UI.switchFolderView(!1)});jq("#switchToCompact").click(function(){ASC.Files.UI.switchFolderView(!0)});jq("#filesMainContent").on("click",".file-row",ASC.Files.UI.clickRow);jq("#filesMainContent").on("dblclick",".file-row:not(.checkloading)",function(n){jq(n.srcElement||n.target).is("input, .checkbox, .file-lock, .version, .pencil, .is-new, .btn-row, .menu-small, #contentVersions, #contentVersions *")||jq(this).closest(".file-row").find(".entry-title .name a").trigger("click")});jq("#filesMainContent").on("click",".checkbox input",function(n){ASC.Files.Actions&&ASC.Files.Actions.hideAllActionPanels();ASC.Files.UI.clickRow(n,jq(this));jq(this).blur();ASC.Files.Common.cancelBubble(n)});jq(".menu-action-on-top").click(function(){return jq(document).scrollTop(0),!1});jq(document).keydown(function(n){var t,r,i;if(jq(".blockUI:visible").length!=0||jq(".studio-action-panel:visible").length!=0||jq("#promptRename").length!=0||jq("#promptCreateFolder").length!=0||jq("#promptCreateFile").length!=0)return!0;t||(t=n);t=jq.fixEvent(t);r=t.target||t.srcElement;try{if(jq(r).is("input,textarea"))return!0}catch(t){return!0}return(i=t.keyCode||t.which,(i==ASC.Files.Common.keyCode.a||i==ASC.Files.Common.keyCode.A)&&t.ctrlKey)?(jq.browser.opera&&setTimeout(function(){jq("#filesSelectAllCheck").focus()},1),ASC.Files.UI.checkSelectAll(!0),!1):!0});jq(document).keyup(function(n){var t,r,i;if(jq(".blockUI:visible").length!=0||jq(".studio-action-panel:visible").length!=0||jq("#promptRename").length!=0||jq("#promptCreateFolder").length!=0||jq("#promptCreateFile").length!=0)return!0;t||(t=n);t=jq.fixEvent(t);r=t.target||t.srcElement;try{if(jq(r).is("input,textarea"))return!0}catch(t){return!0}if(i=t.keyCode||t.which,ASC.Files.Folders){if(i==ASC.Files.Common.keyCode.deleteKey&&!t.shiftKey)return ASC.Files.Folders.deleteItem(),!1;if((i==ASC.Files.Common.keyCode.f||i==ASC.Files.Common.keyCode.F)&&t.shiftKey)return ASC.Files.Folders.createFolder(),!1;if((i==ASC.Files.Common.keyCode.n||i==ASC.Files.Common.keyCode.N)&&t.shiftKey)return ASC.Files.Utility.CanWebEdit(ASC.Files.Utility.Resource.InternalFormats.Document)&&(ASC.Files.Folders.typeNewDoc="document",ASC.Files.Folders.createNewDoc()),!1}if(i==ASC.Files.Common.keyCode.esc){if(ASC.Files.Mouse){if(jq("#filesMovingTooltip").is(":visible"))return ASC.Files.Mouse.finishMoveTo(),!1;if(jq("#filesSelector").is(":visible"))return ASC.Files.Mouse.finishSelecting(),!1}return ASC.Files.Actions&&ASC.Files.Actions.hideAllActionPanels(),ASC.Files.ChunkUploads&&ASC.Files.ChunkUploads.hideDragHighlight(),!0}return!0});jq("#bottomLoaderPanel").draggable({axis:"x",handle:".progress-dialog-header",containment:"body"});jq("#bottomLoaderPanel").on("drag",".progress-dialog-header",function(){ASC.Files.Actions.hideAllActionPanels()});jq(".mobile-app-banner").trackEvent("mobileApp-banner","action-click","app-store")})}(jQuery);
/*!
 * clipboard.js v1.6.1
 * https://zenorocha.github.io/clipboard.js
 *
 * Licensed MIT Â© Zeno Rocha
 */
!function(n){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=n();else if("function"==typeof define&&define.amd)define([],n);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this;t.Clipboard=n()}}(function(){var n;return function n(t,i,r){function u(f,o){var h,c,s;if(!i[f]){if(!t[f]){if(h="function"==typeof require&&require,!o&&h)return h(f,!0);if(e)return e(f,!0);c=new Error("Cannot find module '"+f+"'");throw c.code="MODULE_NOT_FOUND",c;}s=i[f]={exports:{}};t[f][0].call(s.exports,function(n){var i=t[f][1][n];return u(i?i:n)},s,s.exports,n,t,i,r)}return i[f].exports}for(var e="function"==typeof require&&require,f=0;f<r.length;f++)u(r[f]);return u}({1:[function(n,t){function r(n,t){for(;n&&n.nodeType!==u;){if(n.matches(t))return n;n=n.parentNode}}var u=9,i;"undefined"==typeof Element||Element.prototype.matches||(i=Element.prototype,i.matches=i.matchesSelector||i.mozMatchesSelector||i.msMatchesSelector||i.oMatchesSelector||i.webkitMatchesSelector);t.exports=r},{}],2:[function(n,t){function i(n,t,i,u,f){var e=r.apply(this,arguments);return n.addEventListener(i,e,f),{destroy:function(){n.removeEventListener(i,e,f)}}}function r(n,t,i,r){return function(i){i.delegateTarget=u(i.target,t);i.delegateTarget&&r.call(n,i)}}var u=n("./closest");t.exports=i},{"./closest":1}],3:[function(n,t,i){i.node=function(n){return void 0!==n&&n instanceof HTMLElement&&1===n.nodeType};i.nodeList=function(n){var t=Object.prototype.toString.call(n);return void 0!==n&&("[object NodeList]"===t||"[object HTMLCollection]"===t)&&"length"in n&&(0===n.length||i.node(n[0]))};i.string=function(n){return"string"==typeof n||n instanceof String};i.fn=function(n){var t=Object.prototype.toString.call(n);return"[object Function]"===t}},{}],4:[function(n,t){function r(n,t,r){if(!n&&!t&&!r)throw new Error("Missing required arguments");if(!i.string(t))throw new TypeError("Second argument must be a String");if(!i.fn(r))throw new TypeError("Third argument must be a Function");if(i.node(n))return u(n,t,r);if(i.nodeList(n))return f(n,t,r);if(i.string(n))return e(n,t,r);throw new TypeError("First argument must be a String, HTMLElement, HTMLCollection, or NodeList");}function u(n,t,i){return n.addEventListener(t,i),{destroy:function(){n.removeEventListener(t,i)}}}function f(n,t,i){return Array.prototype.forEach.call(n,function(n){n.addEventListener(t,i)}),{destroy:function(){Array.prototype.forEach.call(n,function(n){n.removeEventListener(t,i)})}}}function e(n,t,i){return o(document.body,n,t,i)}var i=n("./is"),o=n("delegate");t.exports=r},{"./is":3,delegate:2}],5:[function(n,t){function i(n){var t,r,i,u;return"SELECT"===n.nodeName?(n.focus(),t=n.value):"INPUT"===n.nodeName||"TEXTAREA"===n.nodeName?(r=n.hasAttribute("readonly"),r||n.setAttribute("readonly",""),n.select(),n.setSelectionRange(0,n.value.length),r||n.removeAttribute("readonly"),t=n.value):(n.hasAttribute("contenteditable")&&n.focus(),i=window.getSelection(),u=document.createRange(),u.selectNodeContents(n),i.removeAllRanges(),i.addRange(u),t=i.toString()),t}t.exports=i},{}],6:[function(n,t){function i(){}i.prototype={on:function(n,t,i){var r=this.e||(this.e={});return(r[n]||(r[n]=[])).push({fn:t,ctx:i}),this},once:function(n,t,i){function r(){u.off(n,r);t.apply(i,arguments)}var u=this;return r._=t,this.on(n,r,i)},emit:function(n){var r=[].slice.call(arguments,1),i=((this.e||(this.e={}))[n]||[]).slice(),t=0,u=i.length;for(t;t<u;t++)i[t].fn.apply(i[t].ctx,r);return this},off:function(n,t){var u=this.e||(this.e={}),r=u[n],f=[],i,e;if(r&&t)for(i=0,e=r.length;i<e;i++)r[i].fn!==t&&r[i].fn._!==t&&f.push(r[i]);return f.length?u[n]=f:delete u[n],this}};t.exports=i},{}],7:[function(t,i,r){!function(u,f){if("function"==typeof n&&n.amd)n(["module","select"],f);else if("undefined"!=typeof r)f(i,t("select"));else{var e={exports:{}};f(e,u.select);u.clipboardAction=e.exports}}(this,function(n,t){"use strict";function r(n){return n&&n.__esModule?n:{"default":n}}function u(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function");}var i=r(t),f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},e=function(){function n(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}return function(t,i,r){return i&&n(t.prototype,i),r&&n(t,r),t}}(),o=function(){function n(t){u(this,n);this.resolveOptions(t);this.initSelection()}return e(n,[{key:"resolveOptions",value:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.action=n.action;this.emitter=n.emitter;this.target=n.target;this.text=n.text;this.trigger=n.trigger;this.selectedText=""}},{key:"initSelection",value:function(){this.text?this.selectFake():this.target&&this.selectTarget()}},{key:"selectFake",value:function(){var t=this,r="rtl"==document.documentElement.getAttribute("dir"),n;this.removeFake();this.fakeHandlerCallback=function(){return t.removeFake()};this.fakeHandler=document.body.addEventListener("click",this.fakeHandlerCallback)||!0;this.fakeElem=document.createElement("textarea");this.fakeElem.style.fontSize="12pt";this.fakeElem.style.border="0";this.fakeElem.style.padding="0";this.fakeElem.style.margin="0";this.fakeElem.style.position="absolute";this.fakeElem.style[r?"right":"left"]="-9999px";n=window.pageYOffset||document.documentElement.scrollTop;this.fakeElem.style.top=n+"px";this.fakeElem.setAttribute("readonly","");this.fakeElem.value=this.text;document.body.appendChild(this.fakeElem);this.selectedText=i.default(this.fakeElem);this.copyText()}},{key:"removeFake",value:function(){this.fakeHandler&&(document.body.removeEventListener("click",this.fakeHandlerCallback),this.fakeHandler=null,this.fakeHandlerCallback=null);this.fakeElem&&(document.body.removeChild(this.fakeElem),this.fakeElem=null)}},{key:"selectTarget",value:function(){this.selectedText=i.default(this.target);this.copyText()}},{key:"copyText",value:function(){var n=void 0;try{n=document.execCommand(this.action)}catch(t){n=!1}this.handleResult(n)}},{key:"handleResult",value:function(n){this.emitter.emit(n?"success":"error",{action:this.action,text:this.selectedText,trigger:this.trigger,clearSelection:this.clearSelection.bind(this)})}},{key:"clearSelection",value:function(){this.target&&this.target.blur();window.getSelection().removeAllRanges()}},{key:"destroy",value:function(){this.removeFake()}},{key:"action",set:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"copy";if(this._action=n,"copy"!==this._action&&"cut"!==this._action)throw new Error('Invalid "action" value, use either "copy" or "cut"');},get:function(){return this._action}},{key:"target",set:function(n){if(void 0!==n){if(!n||"object"!==("undefined"==typeof n?"undefined":f(n))||1!==n.nodeType)throw new Error('Invalid "target" value, use a valid Element');if("copy"===this.action&&n.hasAttribute("disabled"))throw new Error('Invalid "target" attribute. Please use "readonly" instead of "disabled" attribute');if("cut"===this.action&&(n.hasAttribute("readonly")||n.hasAttribute("disabled")))throw new Error('Invalid "target" attribute. You can\'t cut text from elements with "readonly" or "disabled" attributes');this._target=n}},get:function(){return this._target}}]),n}();n.exports=o})},{select:5}],8:[function(t,i,r){!function(u,f){if("function"==typeof n&&n.amd)n(["module","./clipboard-action","tiny-emitter","good-listener"],f);else if("undefined"!=typeof r)f(i,t("./clipboard-action"),t("tiny-emitter"),t("good-listener"));else{var e={exports:{}};f(e,u.clipboardAction,u.tinyEmitter,u.goodListener);u.clipboard=e.exports}}(this,function(n,t,i,r){"use strict";function u(n){return n&&n.__esModule?n:{"default":n}}function e(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function");}function o(n,t){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?n:t}function s(n,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);n.prototype=Object.create(t&&t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}});t&&(Object.setPrototypeOf?Object.setPrototypeOf(n,t):n.__proto__=t)}function f(n,t){var i="data-clipboard-"+n;if(t.hasAttribute(i))return t.getAttribute(i)}var h=u(t),c=u(i),l=u(r),a=function(){function n(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}return function(t,i,r){return i&&n(t.prototype,i),r&&n(t,r),t}}(),v=function(n){function t(n,i){e(this,t);var r=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.resolveOptions(i),r.listenClick(n),r}return s(t,n),a(t,[{key:"resolveOptions",value:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.action="function"==typeof n.action?n.action:this.defaultAction;this.target="function"==typeof n.target?n.target:this.defaultTarget;this.text="function"==typeof n.text?n.text:this.defaultText}},{key:"listenClick",value:function(n){var t=this;this.listener=l.default(n,"click",function(n){return t.onClick(n)})}},{key:"onClick",value:function(n){var t=n.delegateTarget||n.currentTarget;this.clipboardAction&&(this.clipboardAction=null);this.clipboardAction=new h.default({action:this.action(t),target:this.target(t),text:this.text(t),trigger:t,emitter:this})}},{key:"defaultAction",value:function(n){return f("action",n)}},{key:"defaultTarget",value:function(n){var t=f("target",n);if(t)return document.querySelector(t)}},{key:"defaultText",value:function(n){return f("text",n)}},{key:"destroy",value:function(){this.listener.destroy();this.clipboardAction&&(this.clipboardAction.destroy(),this.clipboardAction=null)}}],[{key:"isSupported",value:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:["copy","cut"],i="string"==typeof n?[n]:n,t=!!document.queryCommandSupported;return i.forEach(function(n){t=t&&!!document.queryCommandSupported(n)}),t}}]),t}(c.default);n.exports=v})},{"./clipboard-action":7,"good-listener":4,"tiny-emitter":6}]},{},[8])(8)});window.ASC.Files.Share=function(){var a=!1,n,t,o=[],r,u=null,s,i,h=jq("#shareLink").attr("data-shorten")!="true",e=!1,b=function(){if(a===!1){a=!0;ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.GetSharedInfo,ht);ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.GetSharedInfoShort,w);ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.SetAceObject,ct);ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.SetAceLink,vt);ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.UnSubscribeMe,lt);ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.GetShortenLink,at);u=new SharingSettingsManager(undefined,null);u.OnSave=p;u.OnChange=ft;u.OnCopyLink=function(){ASC.Files.UI.displayInfoPanel(ASC.Resources.Master.Resource.LinkCopySuccess)};jq(".embedded-size-item").on("click",l);jq(".embedded-size-custom").on("change",l);jq.dropdownToggle({switcherSelector:"#toggleEmbeddPanel",dropdownID:"shareEmbeddedPanel",inPopup:!0,rightPos:!0,addTop:10,afterShowFunction:function(){jq("#shareEmbedded").focus().select()}});jq(".sharing-empty").html(jq.format(ASC.Files.FilesJSResources.SharingSettingsEmpty,"<br />"))}},f=function(n){if(n=="owner")return ASC.Files.FilesJSResources.AceStatusEnum_Owner;n=parseInt(n);switch(n){case ASC.Files.Constants.AceStatusEnum.Read:return ASC.Files.FilesJSResources.AceStatusEnum_Read;case ASC.Files.Constants.AceStatusEnum.ReadWrite:return ASC.Files.FilesJSResources.AceStatusEnum_ReadWrite;case ASC.Files.Constants.AceStatusEnum.Restrict:return ASC.Files.FilesJSResources.AceStatusEnum_Restrict;case ASC.Files.Constants.AceStatusEnum.Varies:return ASC.Files.FilesJSResources.AceStatusEnum_Varies;case ASC.Files.Constants.AceStatusEnum.Review:return ASC.Files.FilesJSResources.AceStatusEnum_Review;default:return""}},c=function(){if(!ASC.Clipboard.enable){jq("#shareLinkCopy, #shareEmbedCopy").remove();return}ASC.Files.Share.clip=ASC.Clipboard.destroy(ASC.Files.Share.clip);ASC.Files.Share.clip=ASC.Clipboard.create(jq("#shareLink").val(),"shareLinkCopy",{onComplete:function(){typeof toastr!="undefined"?toastr.success(ASC.Resources.Master.Resource.LinkCopySuccess):jq("#shareLink, #shareLinkCopy").yellowFade()},textareaId:"shareLink"});ASC.Files.Share.clipEmbed=ASC.Clipboard.destroy(ASC.Files.Share.clipEmbed);ASC.Files.Share.clipEmbed=ASC.Clipboard.create(jq("#shareEmbedded").val(),"shareEmbedCopy",{onComplete:function(){typeof toastr!="undefined"?toastr.success(ASC.Files.FilesJSResources.CodeCopySuccess):jq("#shareEmbedded, #shareEmbedCopy").yellowFade()},textareaId:"shareEmbedded"})},v=function(){var n=jq("#shareViaSocPanel"),r=encodeURIComponent(i);n.find(".google").attr("href",ASC.Resources.Master.UrlShareGooglePlus.format(r));n.find(".facebook").attr("href",ASC.Resources.Master.UrlShareFacebook.format(r,encodeURIComponent(t),"",""));n.find(".twitter").attr("href",ASC.Resources.Master.UrlShareTwitter.format(r));var u=ASC.Files.FilesJSResources.shareLinkMailSubject.format(t),f=ASC.Files.FilesJSResources.shareLinkMailBody.format(t,i);n.find(".mail").attr("href","mailto:?subject={1}&body={0}".format(encodeURIComponent(f),encodeURIComponent(u)))},y=function(){var n=jq("#shareLinkOpen").is(":checked")?ASC.Files.Constants.AceStatusEnum.Read:ASC.Files.Constants.AceStatusEnum.Restrict;n==ASC.Files.Constants.AceStatusEnum.Restrict||it()?jq("#sharingLinkAce select").val()!=n&&jq("#sharingLinkAce select").val(n).change():st()},k=function(){var t=parseInt(jq("#sharingLinkAce select").val()),n;r!=t&&(e=!0);r=t;n=r==ASC.Files.Constants.AceStatusEnum.Restrict;jq("#shareLinkOpen").is(":checked")==n&&jq("#shareLinkOpen").prop("checked",!n);jq("#shareLinkPanel, #sharingLinkAce").toggle(!n);jq("#shareLinkDescr").toggle(n);jq("#sharingSettingsItems").toggleClass("with-share-link",!n);jq("#shareLink").val(i);jq("#shareLink").is(":visible")&&jq("#shareLink").focus().select();v();c();e&&et()},d=function(){if(jq("#shareLinkBody").show(),jq("#studio_sharingSettingsDialog #shareLinkBody").length==0){jq("#sharingSettingsDialogBody").prepend(jq("#shareLinkBody"));jq("#shareViaSocPanel").on("click","a:not(.mail)",function(){return window.open(jq(this).attr("href"),"new","height=600,width=1020,fullscreen=0,resizable=0,status=0,toolbar=0,menubar=0,location=1"),!1});if(!ASC.Resources.Master.Personal)jq("#shareViaSocPanel").on("click","a.mail",function(){var f=jq(this).attr("href"),n=window.open(""),r;try{n&&(n.document.write(ASC.Resources.Master.Resource.LoadingPleaseWait),n.document.close())}catch(h){}r=new ASC.Mail.Message;r.subject=ASC.Files.FilesJSResources.shareLinkMailSubject.format(t);var u='<a href="{0}">{1}<\/a>',e=u.format(Encoder.htmlEncode(i),Encoder.htmlEncode(t)),o=u.format(Encoder.htmlEncode(i),Encoder.htmlEncode(i)),s=ASC.Files.FilesJSResources.shareLinkMailBody.format(e,o);return r.body=s,ASC.Mail.Utility.SaveMessageInDrafts(r).done(function(t,i){var r=i.messageUrl;n&&n.location?n.location.href=r:n=window.open(r,"_blank")}).fail(function(){n.close();window.location.href=f}),!1});jq("#shareLinkOpen").on("click",y);jq("#sharingLinkAce select").on("change",k)}ASC.Files.Utility.CanWebView(t)||typeof ASC.Files.ImageViewer!="undefined"&&ASC.Files.Utility.CanImageView(t)?(jq("#shareLinkPanel").removeClass("without-emb"),l()):jq("#shareLinkPanel").addClass("without-emb");jq("#sharingLinkAce select").val(r).change();jq("#sharingLinkAce select [value="+ASC.Files.Constants.AceStatusEnum.ReadWrite+"]").attr("disabled",!ASC.Files.Utility.CanWebEdit(t)||ASC.Files.Utility.MustConvert(t));jq("#sharingLinkAce select [value="+ASC.Files.Constants.AceStatusEnum.Review+"]").attr("disabled",!ASC.Files.Utility.CanWebReview(t));jq("#sharingLinkAce select").tlcombobox()},l=function(){var i=jq(this),n,t;i.is(".embedded-size-item")&&(i.hasClass("embedded-size-6x8")?(jq("#embeddSizeWidth").val("600px"),jq("#embeddSizeHeight").val("800px")):i.hasClass("embedded-size-4x6")?(jq("#embeddSizeWidth").val("400px"),jq("#embeddSizeHeight").val("600px")):(jq("#embeddSizeWidth").val("100%"),jq("#embeddSizeHeight").val("100%")));n=jq("#embeddSizeWidth").val();t=jq("#embeddSizeHeight").val();n=(/\d+(px|%)?/gim.exec(n.toLowerCase().trim())||["100%"])[0];n==Math.abs(n)&&(n+="px");t=(/\d+(px|%)?/gim.exec(t.toLowerCase().trim())||["100%"])[0];t==Math.abs(t)&&(t+="px");jq("#embeddSizeWidth").val(n);jq("#embeddSizeHeight").val(t);jq(".embedded-size-item").removeClass("selected");n=="600px"&&t=="800px"?jq(".embedded-size-6x8").addClass("selected"):n=="400px"&&t=="600px"?jq(".embedded-size-4x6").addClass("selected"):n=="100%"&&t=="100%"&&jq(".embedded-size-1x1").addClass("selected");g(n,t)},g=function(n,i){var u,r;if(n=n||"100%",i=i||"100%",u=s,ASC.Files.Utility.CanWebView(t))r='<iframe src="{0}" width="{1}" height="{2}" frameborder="0" scrolling="no" allowtransparency><\/iframe>',u=u+"&action=embedded";else if(typeof ASC.Files.ImageViewer!="undefined"&&ASC.Files.Utility.CanImageView(t))r='<img src="{0}" width="{1}" height="{2}" alt="" />';else return;r=r.format(u,n,i);jq("#shareEmbedded").val(r).attr("title",r)},nt=function(n,t){var i;if(ASC.Files.Folders.folderContainer=="forme"){var e=[],r="",u="",f='<label title="{0}"><input type="checkbox" class="checkbox" entryType="{1}" entryId="{2}" checked="checked">{0}<\/label>';(n&&t?(e.push({entryType:n,entryId:t}),i=ASC.Files.UI.getEntryTitle(n,t),n=="file"?u+=f.format(i,n,t):r+=f.format(i,n,t)):jq("#filesMainContent .file-row:not(.checkloading):not(.new-folder):not(.new-file):has(.checkbox input:checked)").each(function(){var t=ASC.Files.UI.getObjectData(this),n=t.entryType,o=t.entryId;e.push({entryType:n,entryId:o});i=t.title;n=="file"?u+=f.format(i,n,o):r+=f.format(i,n,o)}),e.length!=0)&&(jq("#confirmUnsubscribeList dd.confirm-remove-files").html(u),jq("#confirmUnsubscribeList dd.confirm-remove-folders").html(r),jq("#confirmUnsubscribeList .confirm-remove-folders, #confirmUnsubscribeList .confirm-remove-files").show(),r==""&&jq("#confirmUnsubscribeList .confirm-remove-folders").hide(),u==""&&jq("#confirmUnsubscribeList .confirm-remove-files").hide(),ASC.Files.UI.blockUI("#filesConfirmUnsubscribe",420,0,-150),PopupKeyUpActionProvider.EnterAction='jq("#unsubscribeConfirmBtn").click();')}},tt=function(){e?ASC.Files.Share.getSharedInfoShort():w(null)},it=function(){return h||!new RegExp("/products/files/").test(i)},rt=function(i,r,u,f){var o,e,s;n=i;typeof n=="object"&&n.length==1&&(n=n[0],r?typeof r=="object"&&r.length==1&&(r=r[0]):(o=ASC.Files.UI.parseItemId(n),r=ASC.Files.UI.getEntryTitle(o.entryType,o.entryId)));t=typeof n=="object"?ASC.Files.FilesJSResources.SharingSettingsCount.format(n.length):r;e=!1;typeof n!="object"?e=ASC.Files.Utility.CanWebReview(t):typeof r=="object"&&(e=!0,jq(r).each(function(n,t){return ASC.Files.UI.parseItemId(i[n]).entryType=="folder"||!ASC.Files.Utility.CanWebReview(t)?(e=!1,!1):!0}));s={entry:jq(typeof n=="object"?n:[n]).map(function(n,t){return t}).toArray()};ASC.Files.ServiceManager.getSharedInfo(ASC.Files.ServiceManager.events.GetSharedInfo,{showLoading:!0,asFlat:u===!0,rootFolderType:f,canWebReview:e},{stringList:s})},ut=function(){ASC.Files.ServiceManager.getSharedInfoShort(ASC.Files.ServiceManager.events.GetSharedInfoShort,{showLoading:!0,objectID:n})},ft=function(n){n&&(!ASC.Files.Folders||ASC.Files.Folders.folderContainer!="corporate")&&(jq("#studio_sharingSettingsDialog #shareMessagePanel").show(),jq("#sharingSettingsItems").addClass("with-message-panel"))},p=function(t){var s=t.items,r=[],i,u,f;if(jq(s).each(function(n,t){var i=!0;jq(o).each(function(n,r){return r.id===t.id?(i=r.selectedAction.id!=t.selectedAction.id,!1):!0});i&&r.push({id:t.id,is_group:t.isGroup,ace_status:t.selectedAction.id})}),jq(o).each(function(n,t){var i=!0;jq(s).each(function(n,r){return t.id===r.id?(i=!1,!1):!0});i&&r.push({id:t.id,is_group:t.isGroup,ace_status:ASC.Files.Constants.AceStatusEnum.None})}),i=jq("#shareOwnerSelector").attr("data-id"),i=i!=jq("#shareOwnerSelector").attr("data-id-old")?i:null,r.length)e=!0;else{i&&ASC.Files.Folders.changeOwner(typeof n=="object"?n:[n],i);return}u={entries:{entry:n},aces:{entry:r},message:""};f=jq("#shareMessageSend").prop("checked")==!0;f&&(u.message=(jq("#shareMessage:visible").val()||"").trim());ASC.Files.ServiceManager.setAceObject(ASC.Files.ServiceManager.events.SetAceObject,{owner:i,showLoading:!0,notify:f},{ace_collection:u})},et=function(){ASC.Files.ServiceManager.setAceLink(ASC.Files.ServiceManager.events.SetAceLink,{showLoading:!0,fileId:ASC.Files.UI.parseItemId(n).entryId,share:r})},ot=function(){var t,n,i;jq("#filesConfirmUnsubscribe:visible").length!=0&&(PopupKeyUpActionProvider.CloseDialog(),t=jq("#confirmUnsubscribeList input:checked"),t.length!=0)&&(n={},n.entry=[],i=t.map(function(t,i){var r=jq(i).attr("entryType"),u=jq(i).attr("entryId"),f=ASC.Files.UI.getEntryObject(r,u);return ASC.Files.UI.blockObject(f,!0,ASC.Files.FilesJSResources.DescriptRemove,!0),n.entry.push(r+"_"+u),{entryId:u,entryType:r}}).toArray(),ASC.Files.UI.updateMainContentHeader(),ASC.Files.ServiceManager.unSubscribeMe(ASC.Files.ServiceManager.events.UnSubscribeMe,{parentFolderID:ASC.Files.Folders.currentFolder.id,showLoading:!0,list:i},{stringList:n}))},st=function(){if(!h){var t=ASC.Files.UI.parseItemId(n).entryId;ASC.Files.ServiceManager.getShortenLink(ASC.Files.ServiceManager.events.GetShortenLink,{fileId:t})}},ht=function(h,l,a){var y,k,it,p,rt,b,nt,tt,g,v,w,ut;if(typeof a!="undefined"||typeof h=="undefined"){ASC.Files.UI.displayInfoPanel(a,!0);return}o=h;e=!1;k=[];r=ASC.Files.Constants.AceStatusEnum.None;jq(h).each(function(n){var t=h[n];t.id===ASC.Files.Constants.ShareLinkId?(s=t.link,i=t.link_short||s,r=t.ace_status,it=t.ace_status):k.push({id:t.id,name:t.title,isGroup:t.is_group,canEdit:!(t.locked||t.owner),hideRemove:t.disable_remove,selectedAction:{id:t.ace_status,name:f(t.owner?"owner":t.ace_status),defaultAction:!1}});t.owner&&(y=t)});p=[{id:ASC.Files.Constants.AceStatusEnum.ReadWrite,name:f(ASC.Files.Constants.AceStatusEnum.ReadWrite),defaultAction:!1,defaultStyle:"full"}];l.canWebReview&&(p=p.concat([{id:ASC.Files.Constants.AceStatusEnum.Review,name:f(ASC.Files.Constants.AceStatusEnum.Review),defaultAction:!1,defaultStyle:"review"}]));p=p.concat([{id:ASC.Files.Constants.AceStatusEnum.Read,name:f(ASC.Files.Constants.AceStatusEnum.Read),defaultAction:!0,defaultStyle:"read"},{id:ASC.Files.Constants.AceStatusEnum.Restrict,name:f(ASC.Files.Constants.AceStatusEnum.Restrict),defaultAction:!1,defaultStyle:"restrict"},{id:ASC.Files.Constants.AceStatusEnum.Varies,name:f(ASC.Files.Constants.AceStatusEnum.Varies),defaultAction:!1,disabled:!0}]);rt={actions:p,items:k};o=k;b=null;typeof n!="object"&&(nt=ASC.Files.UI.parseItemId(n),b=ASC.Files.UI.getEntryLink(nt.entryType,nt.entryId,t),tt=document.createElement("a"),tt.href=b,b=jq(tt).prop("href"));u.UpdateSharingData(rt,b);jq("#shareLinkBody").hide();g=460;it&&(d(),g=550,ASC.Resources.Master.Personal&&(g=260));u.ShowDialog(null,g,l.asFlat);l.asFlat&&(PopupKeyUpActionProvider.CloseDialogAction="ASC.Files.Share.updateForParent();",PopupKeyUpActionProvider.ForceBinding=!0);ASC.Files.Actions&&ASC.Files.Actions.hideAllActionPanels();c();v=jq(".share-container-head");v.is("span")&&(v.replaceWith('<div class="share-container-head"><\/div>'),v=jq(".share-container-head"),v.html(ASC.Files.FilesJSResources.SharingSettingsTitle.format("(<span><\/span>)")));w=jq(".share-container-head-corporate");l.rootFolderType?jq("#studio_sharingSettingsDialog #shareMessagePanel").remove():jq("#studio_sharingSettingsDialog #shareMessagePanel").hide();jq("#sharingSettingsItems").removeClass("with-message-panel");l.rootFolderType||ASC.Files.Folders&&ASC.Files.Folders.folderContainer=="corporate"?(w.length||(v.after('<div class="share-container-head-corporate"><\/div>'),w=jq(".share-container-head-corporate"),w.html(ASC.Files.FilesJSResources.AccessSettingsTitle.format("(<span><\/span>)"))),w.show().find("span").attr("title",t).text(t),v.hide()):(v.show().find("span").attr("title",t).text(t),w.hide());ASC.Files.Folders&&ASC.Files.Folders.folderContainer=="corporate"&&y&&(ut=jq("#sharingSettingsItems .userLink[data-uid='"+y.id+"']"),ut.replaceWith('<div id="shareOwnerSelector" class="advanced-selector-select" data-id=""><div class="change-owner-selector"><\/div><\/div>'),jq("#shareOwnerSelector").useradvancedSelector({inPopup:!0,itemsChoose:[],canadd:!1,showGroups:!0,onechosen:!0,withGuests:!1}).on("showList",function(n,t){jq(this).attr("data-id",t.id).find(".change-owner-selector").html(t.title);t.id!=y.id&&u.WhereChanges(!0)}).attr("data-id",y.id).attr("data-id-old",y.id).find(".change-owner-selector").text(y.title))},w=function(n,t,i){var r,u;if(typeof i!="undefined"||typeof n=="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);return}r=n?{needUpdate:!0,sharingSettings:n}:{needUpdate:!1};u=JSON.stringify(r);window.parent.postMessage(u,"*")},ct=function(t,i,r){if(typeof r!="undefined"){ASC.Files.UI.displayInfoPanel(r,!0);return}jq(typeof n=="object"?n:[n]).each(function(n,i){var r=ASC.Files.UI.parseItemId(i),u=ASC.Files.UI.getEntryObject(r.entryType,r.entryId);u.toggleClass("__active",jq.inArray(i,t)!=-1)});i.owner&&ASC.Files.Folders.changeOwner(typeof n=="object"?n:[n],i.owner)},lt=function(n,t,i){if(typeof i!="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);return}var u=t.list,r=!1;jq(u).each(function(n,t){r||t.entryType!="folder"||(r=!0);ASC.Files.Marker.removeNewIcon(t.entryType,t.entryId);ASC.Files.UI.getEntryObject(t.entryType,t.entryId).remove()});r&&ASC.Files.Tree&&ASC.Files.Tree.resetFolder(t.parentFolderID);ASC.Files.UI.checkEmptyContent()},at=function(n,t,r){typeof r!="undefined"?(ASC.Files.UI.displayInfoPanel(r,!0),h=!0):n==null||n==""?h=!0:(i=n||s,jq("#shareLink").val(i),v(),c());y()},vt=function(t,i,r){if(typeof r!="undefined"){ASC.Files.UI.displayInfoPanel(r,!0);return}var u=ASC.Files.UI.parseItemId(n),f=ASC.Files.UI.getEntryObject(u.entryType,u.entryId);f.toggleClass("__active",t)};return{init:b,updateForParent:tt,getSharedInfo:rt,getSharedInfoShort:ut,setAceObject:p,unSubscribeMe:nt,confirmUnSubscribe:ot,clip:null,clipEmbed:null}}();jq(document).ready(function(){(function(n){jq("#shareLinkBody").length!=0&&(ASC.Files.Share.init(),n(function(){jq("#studioPageContent").on("click","#buttonUnsubscribe, #mainUnsubscribe.unlockAction",function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Share.unSubscribeMe()});jq("#studioPageContent").on("click","#buttonShare, #mainShare.unlockAction",function(){ASC.Files.Actions.hideAllActionPanels();var n=[],t=[];jq("#filesMainContent .file-row:not(.without-share):not(.checkloading):not(.new-folder):not(.new-file):not(.error-entry):has(.checkbox input:checked)").each(function(){var i=ASC.Files.UI.getObjectData(this),r=i.entryType,u=i.entryId;n.push(r+"_"+u);t.push(i.title)});ASC.Files.Share.getSharedInfo(n,t)});jq("#unsubscribeConfirmBtn").click(function(){ASC.Files.Share.confirmUnSubscribe()});jq("#filesMainContent").on("click",".btn-row",function(){var n=ASC.Files.UI.getObjectData(this),t=n.entryId,i=n.entryType,r=n.title;return ASC.Files.Actions.hideAllActionPanels(),ASC.Files.UI.checkSelectAll(!1),ASC.Files.UI.selectRow(n.entryObject,!0),ASC.Files.Share.getSharedInfo(i+"_"+t,r),!1});if(jq("#studio_sharingSettingsDialog .containerBodyBlock").addClass("clearFix"),jq.browser.mobile)jq("#shareLink, #shareEmbedded").attr("readonly","false").attr("readonly","").removeAttr("readonly");else{jq("#shareLink, #shareEmbedded").on("mousedown",function(){return jq(this).select(),!1});jq("#shareLink, #shareEmbedded").on("keypress",function(n){return n.ctrlKey&&(n.charCode===ASC.Files.Common.keyCode.c||n.charCode===ASC.Files.Common.keyCode.C||n.keyCode===ASC.Files.Common.keyCode.insertKey)})}}))})(jQuery)})