function G(){return function(){}}function V(n){return function(t){this[n]=t}}function W(n){return function(){return this[n]}}function aa(n){return function(){return n}}jQuery.template("projects_projectTmpl",'<tr {{if status !== 0}} class="noActiveProj" {{/if}} id="${id}">{{if !isSimpleView}}<td class="status">{{tmpl({canEdit: $item.data.canEdit, status: ASC.Projects.StatusList.getById($item.data.status)}) \'projects_statusChangeContainer\'}}<\/td>{{/if}}<td class="nameProject stretch">{{if isPrivate}}<span title="${ASC.Projects.Resources.ProjectResource.HiddenProject}" class="private"><\/span>{{/if}}<a href="${projLink}" class="linkHeaderMedium {{if status !== 0}} gray-text{{/if}}">${title}<\/a><\/td><td class="taskCount">{{if taskCount != 0}}<a href="${linkTasks}" title="${ASC.Projects.Resources.ProjectResource.TitleProjectOpenTasks}">${taskCount}<\/a>{{/if}}<\/td><td class="responsible"><span class=\'userLink{{if responsible.id==\'4a515a15-d4d6-4b8e-828e-e0586f18f3a3\'}} not-action{{/if}}\' title="{{if !isSimpleView}}${ASC.Projects.Resources.ProjectResource.TitleProjectManager}{{/if}}">${responsible.displayName}<\/span>{{if participants != 0}}<a class="participants" title="${ASC.Projects.Resources.ProjectResource.TitleProjectTeam}" href="${linkParticip}">+${participants}<\/a>{{/if}}<\/td>{{if isSimpleView}}<td class="trash">{{if canEdit || canLinkContact}}<img src="${StudioManager.GetImage(\'unlink_16.png\')}"                    title="${ASC.Projects.Resources.CommonResource.UnlinkProjects}" class="trash_delete" /><div class="trash_progress loader-middle" title=""><\/div>{{/if}}<\/td>{{/if}}<\/tr>');jQuery.template("memberTemplate",'<table class="listContainer"><tbody>{{each team}}<tr class="with-entity-menu pm-projectTeam-participantContainer {{if isAdmin || isManager}} disable{{/if}}" data-partisipantId="${id}"><td style="" class="user-info"><div class="pm-projectTeam-userPhotoContainer"><img src="${avatarSmall}"/>{{if status == 2}}<span class="status-blocked"><\/span>{{/if}}                    {{if project.canEditTeam}}                    {{if isVisitor}}<span class="role collaborator"><\/span>{{/if}}                    {{if isAdmin && status!=2}}<span class="role admin"><\/span>{{/if}}                    {{/if}}<\/div><div class="user-info-container"><a class="user-name {{if typeof title === \'undefined\' }} without-title{{/if}}" href="${profileUrl}" title="${displayName}">${displayName}<\/a>{{if typeof title !== \'undefined\'}}<span title="${title}">${title}<\/span>{{/if}}<\/div><\/td>{{if project.canEditTeam && project.isPrivate}}<td class="right-settings">{{if status!=2}}<div>{{each security}}                    {{tmpl(security[$index], {showSplitter: $index !== security.length - 1}) \'projects_securityItem\'}}                    {{/each}}<\/div>{{/if}}<\/td>{{/if}}<td class="menupoint-container"><div class="entity-menu"><\/div><\/td><\/tr>{{/each}}<\/tbody><\/table>');jQuery.template("member_template_without_photo",'<table class="listContainer"><tbody>{{each team}}<tr class="with-entity-menu pm-projectTeam-participantContainer {{if isAdmin || isManager}} disable{{/if}}" data-partisipantId="${id}"><td style="" class="user-info"><div class="user-info-container"><a class="user-name {{if typeof title === \'undefined\' }} without-title{{/if}}" href="${profileUrl}" title="${displayName}">${displayName}<\/a><\/div><\/td>{{if project.canEditTeam && project.isPrivate}}<td class="right-settings">{{if status!=2}}<div>{{each security}}                    {{tmpl(security[$index], {showSplitter: $index !== security.length - 1}) \'projects_securityItem\'}}                    {{/each}}<\/div>{{/if}}<\/td>{{/if}}<td class="menupoint-container"><div class="reset-action"><\/div><\/td><\/tr>{{/each}}<\/tbody><\/table>');jQuery.template("projects_securityItem",'<span class="right-checker pm-projectTeam-modulePermission{{if check}}On{{else}}Off{{/if}}" data-flag="${flag}"><span>${title}<\/span><\/span>{{if $item.showSplitter}}<span class="splitter"><\/span>{{/if}}');jQuery.template("projectParticipant",'<li class="items-display-list_i" participantid="${id}"><span class="item-name"><a class="link" href="${profileUrl}" target="_blank">${title}<\/a><\/span><div class="reset-action" data-userid="${id}" title="$ASC.Projects.Resources.CommonResource.Delete"><\/div><\/li>');jQuery.template("projects_team",'<div class="header-base block-cnt-splitter">${ASC.Projects.Resources.ProjectResource.ProjectLeader}<\/div><div class="block-cnt-splitter clearFix"><div class="pm-projectTeam-projectLeaderCard" style="float: left;"><img class="managerAvatar" src="${manager.avatar}"/><div class="manager-info" data-manager-guid="${manager.id}"><div><a class="link header-base middle bold" href="${manager.profileUrl}">${manager.displayName}<\/a><\/div>{{if manager.groups && manager.groups.length}}<div>${manager.groups[0].name}<\/div>{{/if}}<div>${Encoder.htmlEncode(manager.title)}<\/div><\/div><\/div><div style="margin-left: 380px; padding: 0 20px;"><div>${ASC.Projects.Resources.ProjectResource.ClosedProjectTeamManagerPermission}:<\/div><div class="simple-marker-list">${ASC.Projects.Resources.ProjectResource.ClosedProjectTeamManagerPermissionArticleA}<\/div><!--<% if (!ProjectSecurity.IsPrivateDisabled) { %>--><div class="simple-marker-list">{{html jq.format(ASC.Projects.Resources.ProjectResource.ClosedProjectTeamManagerPermissionArticleB, "<span id=\'PrivateProjectHelp\' class=\'baseLinkAction\'>", "<\/span>")}}<\/div><div class="simple-marker-list">{{html jq.format(ASC.Projects.Resources.ProjectResource.ClosedProjectTeamManagerPermissionArticleC, "<span id=\'RestrictAccessHelp\' class=\'baseLinkAction\'>", "<\/span>", "<br/>")}}<\/div><div class="popup_helper" id="AnswerForPrivateProjectTeam"><p>{{html jq.format(Encoder.htmlEncode(ASC.Projects.Resources.CommonResource.HelpAnswerPrivateProjectTeam), "<br/>", "<b>", "<\/b>")}}                    {{if ASC.Resources.Master.HelpLink}}<a target="_blank" href="${ASC.Resources.Master.HelpLink + \'/gettingstarted/projects.aspx#ManagingYourTeam_block\'}">${ASC.Projects.Resources.CommonResource.LearnMoreLink}<\/a>{{/if}}<\/p><\/div><div class="popup_helper" id="AnswerForRestrictAccessTeam"><p>{{html ASC.Projects.Resources.CommonResource.HelpAnswerRestrictAccessTeam}}                    {{if ASC.Resources.Master.HelpLink}}<a target="_blank" href="${ASC.Resources.Master.HelpLink + \'/gettingstarted/projects.aspx#ManagingYourTeam_block\'}">${ASC.Projects.Resources.CommonResource.LearnMoreLink}<\/a>{{/if}}<\/p><\/div><!--<% } else { %><div class="simple-marker-list">${ASC.Projects.Resources.ProjectResource.ClosedProjectTeamManagerPermissionArticleForOpen}<\/div><% } %>--><\/div><\/div><div class="block-cnt-splitter">{{if project.canEditTeam}}<div id="pm-projectTeam-Selector" class="link dotline plus">${ASC.Projects.Resources.ProjectResource.ManagmentTeam}<\/div>{{/if}}<\/div><div id="team_container" class="block-cnt-splitter {{if !project.canEditTeam}} no-access{{/if}}">{{tmpl \'memberTemplate\'}}<\/div>');jQuery.template("projects_milestoneTemplate",'<tr id="${id}" class="with-entity-menu ${status} with-checkbox"><td class="checkbox"><input type="checkbox"/><\/td><td class="status">{{tmpl({canEdit: $item.data.canEdit, status: ASC.Projects.StatusList.getById($item.data.status)}) \'projects_statusChangeContainer\'}}<\/td><td class="title stretch">{{if isKey == true}}<span class="key" title="${ASC.Projects.Resources.MilestoneResource.RootMilestone}"><\/span>{{/if}}<a href="javascript:void(0)" class="linkHeaderMedium {{if $item.data.status === 1}} gray-text{{/if}}">${title}<\/a><\/td><td class="activeTasksCount">{{if activeTasksCount != 0 || closedTasksCount != 0}}            {{if status !== 1}}<a href="${activeTasksLink}" title="${ASC.Projects.Resources.ProjectResource.TitleMilestoneOpenTasks}">${activeTasksCount}<\/a>{{else}}                ${activeTasksCount}            {{/if}}        {{/if}}<\/td><td class="slash">{{if activeTasksCount != 0 || closedTasksCount != 0}}            /        {{/if}}<\/td><td class="closedTasksCount">{{if activeTasksCount != 0 || closedTasksCount != 0}}            {{if status !== 1}}<a href="${closedTasksLink}" title="${ASC.Projects.Resources.ProjectResource.TitleMilestoneClosedTasks}">${closedTasksCount}<\/a>{{else}}                ${closedTasksCount}            {{/if}}        {{/if}}<\/td><td class="deadline">{{if overdue }}<span class="overdue">${deadline}<\/span>{{else}}<span>${deadline}<\/span>{{/if}}<\/td><td class="responsible"><div><span {{if responsibleId==\'4a515a15-d4d6-4b8e-828e-e0586f18f3a3\'}} class="not-action"{{/if}} title="${ASC.Projects.Resources.ProjectResource.TitleMilestoneResponsibleUser}">${responsible}<\/span><\/div><\/td><td class="actions">{{if (canEdit && !Teamlab.profile.isVisitor) || canDelete}}<div class="entity-menu"><\/div>{{/if}}<\/td><\/tr>');jQuery.template("projects_timeTrackingTmpl",'<tr id="timeSpendRecord${id}" class="timeSpendRecord with-entity-menu with-checkbox" timeid="${id}"><td class="checkbox"><input type="checkbox"/><\/td><td class="pm-ts-statusColumn"><div class="check">{{tmpl({canEdit: $item.data.canEditPaymentStatus, status: ASC.Projects.StatusList.getById($item.data.paymentStatus)}) \'projects_statusChangeContainer\'}}<\/div><\/td><td class="pm-ts-dateColumn">${displayDateCreation}<\/td><td class="pm-ts-noteColumn stretch"><a href="tasks.aspx?prjID=${relatedProject}&id=${relatedTask}">${relatedTaskTitle}<\/a><span>${note}<\/span><\/td><td class="pm-ts-hoursColumn">${jq.timeFormat(hours).split(":")[0]}${ASC.Projects.Resources.TimeTrackingResource.ShortHours} ${jq.timeFormat(hours).split(":")[1]}${ASC.Projects.Resources.TimeTrackingResource.ShortMinutes}<\/td><td class="pm-ts-personColumn">{{if person != null}}<span {{if person.id==\'4a515a15-d4d6-4b8e-828e-e0586f18f3a3\'}} class="not-action"{{/if}} title="${person.displayName}">${person.displayName}<\/span>{{else}}<span {{if createdBy.id==\'4a515a15-d4d6-4b8e-828e-e0586f18f3a3\'}} class="not-action"{{/if}} title="${createdBy.displayName}">${createdBy.displayName}<\/span>{{/if}}<\/td><td class="pm-ts-actionsColumn">{{if canEdit == true}}<div class="entity-menu"><\/div>{{/if}}<\/td><\/tr>');jQuery.template("projects_templatesEditMilestoneTmpl",'<div class="milestone" id="m_${number}"><div class="mainInfo menuButtonContainer with-entity-menu"><span class="daysCount" value="${duration}"><span>${duration}<\/span><\/span><div class="titleContainerEdit"><span class="title">${title}<\/span><\/div><a class="addTask">+ ${ASC.Projects.Resources.ProjectTemplatesResource.Task}<\/a><span class="entity-menu"><\/span><\/div>{{if displayTasks}}<div class="milestoneTasksContainer" style="display: block;">{{else}}<div class="milestoneTasksContainer">{{/if}}<div class="listTasks" milestone="m_${number}">{{each(i, task) tasks}}<div id="${number}_${i+1}" class="task menuButtonContainer with-entity-menu"><div class="titleContainer"><span class="title">${task.title}<\/span><\/div><span class="entity-menu"><\/span><\/div>{{/each}}<\/div><\/div><\/div>');jQuery.template("projects_templatesEditTaskTmpl",'<div class="task menuButtonContainer with-entity-menu" id="t_${number}"><div class="titleContainer"><span class="title">${title}<\/span><\/div><span class="entity-menu"><\/span><\/div>');jQuery.template("projects_templatesCreateMilestoneTmpl",'<div class="milestone" id="m_${number}"><div class="mainInfo menuButtonContainer with-entity-menu"><span class="dueDate"><span>${date}<\/span><\/span><div class="titleContainer"><span class="title">${title}<\/span><\/div><a class="addTask">+ ${ASC.Projects.Resources.ProjectTemplatesResource.Task}<\/a><span class="entity-menu"><\/span>{{if chooseRep}}<span class="chooseResponsible"><span class="link dotline" guid="${chooseRep.id}">${chooseRep.name}<\/span><\/span>{{/if}}<\/div>{{if displayTasks}}<div class="milestoneTasksContainer" style="display: block;">{{else}}<div class="milestoneTasksContainer">{{/if}}<div class="listTasks" milestone="m_${number}">{{each(i, task) tasks}}<div id="${number}_${i+1}" class="task menuButtonContainer with-entity-menu"><div class="titleContainer"><span class="title">${task.title}<\/span><\/div><span class="entity-menu"><\/span>{{if chooseRep}}<span class="chooseResponsible nobody"><span class="link dotline">${ASC.Projects.Resources.ProjectsJSResource.ChooseResponsible}<\/span><\/span>{{/if}}<\/div>{{/each}}<\/div><\/div>');jQuery.template("projects_templatesCreateTaskTmpl",'<div class="task menuButtonContainer with-entity-menu" id="t_${number}"><div class="titleContainer"><span class="title">${title}<\/span><\/div><span class="entity-menu"><\/span>{{if chooseRep}}<span class="chooseResponsible"><span class="link dotline" guid="${chooseRep.id}">${chooseRep.name}<\/span><\/span>{{else}}                {{if selectResp}}<span class="chooseResponsible nobody"><span class="link dotline">${ASC.Projects.Resources.ProjectsJSResource.ChooseResponsible}<\/span><\/span>{{/if}}            {{/if}}<\/div>');jQuery.template("projects_templateTmpl",'<tr class="with-entity-menu template menuButtonContainer" id="${id}"><td class="stretch"><a href="projectTemplates.aspx?id=${id}&action=edit" class="title">${title}<\/a><span class="description">(${milestones} ${ASC.Projects.Resources.ProjectTemplatesResource.Milestones}, ${tasks} ${ASC.Projects.Resources.ProjectTemplatesResource.Tasks})<\/span><\/td><td><span class="entity-menu"><\/span><\/td><\/tr>');jQuery.template("projects_tabsNavigator","{{each tabs}}    {{tmpl($item.data.tabs[$index], {showSplitter: $index !== $item.data.tabs.length - 1}) 'projects_tabsNavigatorItem'}}    {{/each}}");jQuery.template("projects_tabsNavigatorItem",'{{if $item.data.href}}<a class="tabsNavigationLink {{if $item.data.selected}}selectedTab{{/if}}" id="${$item.data.divID}_tab" href="${$item.data.href}">${$item.data.title}{{if $item.data.count}}<span class="count">(${$item.data.count}){{/if}}<\/span><\/a>{{else}}<span class="tabsNavigationLink {{if $item.data.selected}}selectedTab{{/if}}" id="${$item.data.divID}_tab">${$item.data.title}{{if $item.data.count}}<span class="count">(${$item.data.count}){{/if}}<\/span><\/span>{{/if}}    {{if $item.showSplitter}}<span class="splitter"><\/span>{{/if}}');jQuery.template("projects_taskListItemTmpl",'<div class="task with-entity-menu clearFix{{if !$item.data.subtasks.length}} noSubtasks{{/if}}{{if $item.data.canEdit}} canedit{{/if}}{{if $item.data.status == 2}} closed{{/if}}" taskid="${id}"{{if $item.data.milestone !=null}} milestoneid="${milestone.id}"{{/if}}>{{if ($item.data.canEdit && !Teamlab.profile.isVisitor) || $item.data.canCreateTimeSpend || $item.data.canDelete}}<div class="entity-menu"><\/div>{{else}}<div class="nomenupoint"><\/div>{{/if}}<div class="checkbox"><input title="Select" type="checkbox"><\/div><div class="check">{{tmpl({canEdit: $item.data.canEdit, status: ASC.Projects.StatusList.getById($item.data.status)}) \'projects_statusChangeContainer\'}}<\/div><div class="taskPlace"><div class="taskName">{{if $item.data.priority == 1}}<span class="high_priority"><\/span>{{/if}}<a href="tasks.aspx?prjID=${projectOwner.id}&id=${id}" class="linkHeaderMedium{{if $item.data.status == 2}} gray-text{{/if}}">${title}<\/a><\/div><div class="subtasksCount">{{tmpl \'projects_numSubtasksTmpl\'}}<\/div><\/div>{{if $item.data.responsibles.length > 1}}<div class="user"><span class="other" title="${ASC.Projects.Resources.ProjectResource.TitleTaskResponsibleUsers}">${responsibles.length} ${ASC.Projects.Resources.TasksResource.Responsibles}<\/span><\/div>{{else}}<div class="user">{{if $item.data.responsible == null}}<span>${ASC.Projects.Resources.TasksResource.NoResponsible}<\/span>{{else}}<span {{if responsible.id==\'4a515a15-d4d6-4b8e-828e-e0586f18f3a3\'}}class="not-action"{{else}} title="${ASC.Projects.Resources.ProjectResource.TitleTaskResponsibleUser}"{{/if}}>${responsible.displayName}<\/span>{{/if}}<\/div>{{/if}}        {{if $item.data.displayDateDeadline.length}}<div class="deadline"><span class="timeLeft {{if ASC.Projects.TasksManager.compareDates($item.data.deadline)}}red{{/if}}">${displayDateDeadline}<\/span><\/div>{{else}}            {{if $item.data.milestone != null}}<div class=\'deadline\'><span class="timeLeft {{if ASC.Projects.TasksManager.compareDates($item.data.milestone.deadline)}}red{{/if}}">${milestone.displayDateDeadline}<\/span><\/div>{{/if}}         {{/if}}<\/div><div taskid="${id}" class="subtasks"{{if !$item.data.subtasks.length || $item.data.status == 2}} style="display:none;"{{/if}}>{{tmpl \'projects_subtasksTemplate\'}}        {{if $item.data.canEdit || $item.data.canCreateSubtask}}<div class="quickAddSubTaskLink icon-link plus" {{if ($item.data.status == 1 || $item.data.status == 4) && ($item.data.subtasks.length)}}visible="true"{{else}}visible="false" style="display:none;"{{/if}}><span class="link dotline" taskid="${id}">${ASC.Projects.Resources.TasksResource.AddNewSubtask}<\/span><\/div>{{/if}}<div class="st_separater"><\/div><\/div>');jQuery.template("projects_taskListResponsibles",'{{each responsibles}}    {{if $index >= 0}}<li userId="${id}" class="user dropdown-item{{if id==\'4a515a15-d4d6-4b8e-828e-e0586f18f3a3\'}} not-action{{/if}}" title="${displayName}">${displayName}<\/li>{{/if}}    {{/each}}');jQuery.template("projects_milestoneForMoveTaskPanelTmpl",'<div class="ms"><input id="ms_${id}" value="${id}" type="radio" name="milestones" {{if checked}} checked="checked" {{/if}}/><label for="ms_${id}">{{if displayDateDeadline}}[${displayDateDeadline}] {{/if}}${title}<\/label><\/div>');jQuery.template("projects_numSubtasksTmpl",'{{if ASC.Projects.TasksManager.openedCount($item.data.subtasks)}}<span class="collaps link dotline" title="${ASC.Projects.Resources.ProjectResource.TitleTaskOpenSubtasks}" taskid="${id}">+{{html ASC.Projects.TasksManager.openedCount($item.data.subtasks)}}<\/span>{{else}}    {{if $item.data.canCreateSubtask}}<span class="add">+ ${ASC.Projects.Resources.TasksResource.Subtask}<\/span>{{/if}}    {{/if}}');jQuery.template("projects_taskDescriptionSubtasksContainerTmpl",'{{tmpl "projects_subtasksTemplate"}}    {{if canEdit || canCreateSubtask}}<div class="quickAddSubTaskLink icon-link plus" {{if status == 1 || status == 4}} visible="true" {{else}}visible="false" style="display:none;"{{/if}}><span class="link dotline">${ASC.Projects.Resources.TasksResource.AddNewSubtask}<\/span><\/div>{{/if}}<div class="st_separater"><\/div>');jQuery.template("projects_taskLinks",'<tr data-taskid="${id}" class="linked-task with-entity-menu{{if relatedTaskObject.invalidLink}} invalid-link{{/if}} {{if status==2}} gray-text{{/if}}"><td class="title stretch">{{if relatedTaskObject.invalidLink}}<span class="attantion">&nbsp;<\/span>{{/if}}<a class="task-name {{if status==2}} gray-text{{/if}}" href="tasks.aspx?prjID=${projectId}&id=${id}" target="_blank">${title}<\/a><\/td><td class="start-date" title="${ASC.Projects.Resources.TasksResource.TaskStartDate}">{{if displayDateStart != ""}}${displayDateStart}{{/if}}<\/td><td class="end-date" title="${ASC.Projects.Resources.TasksResource.EndDate}">{{if displayDateDeadline != ""}}${displayDateDeadline}{{/if}}<\/td><td class="link-type" title="${ASC.Projects.Resources.ProjectResource.GanttLinkType}" data-type="${relatedTaskObject.linkType}">${relatedTaskObject.linkTypeText}<\/td><td class="duration{{if relatedTaskObject.invalidLink}} red-text{{/if}}" title="${ASC.Projects.Resources.TasksResource.RelatedTaskIntervalDesc}">{{if relatedTaskObject.invalidLink}}-{{/if}}{{if relatedTaskObject.delay!=0}}${relatedTaskObject.delay}{{/if}}<\/td><td class="actions">{{if canEdit}}<div class="entity-menu" data-taskid="${id}"><\/div>{{/if}}<\/td><\/tr>');jQuery.template("projects_taskLinksContainer",'<div class="popup_helper" id="hintInvalidLink"><p>${ASC.Projects.Resources.TasksResource.RelatedLinkInvalid}            {{if ASC.Resources.Master.HelpLink}}<a href="${ASC.Resources.Master.HelpLink.concat(\'/guides/link-tasks.aspx\')}" target="_blank">${ASC.Projects.Resources.CommonResource.LearnMoreLink}<\/a>{{/if}}<\/p><\/div><div id="linkedTasksContainer" class="display-none"><table id="relatedTasks" class="task-links">{{each tasks}}            {{tmpl($item.data.tasks[$index]) \'projects_taskLinks\'}}            {{/each}}<\/table><table id="editTable" class="task-links display-none"><tbody><tr class="linked-task edit-link-container"><td class="title stretch"><select id="taskSelector"><option value="-1" selected="selected">${ASC.Projects.Resources.TasksResource.ChooseTaskForLink}<\/option><\/select><\/td><td class="link-type" colspan="4"><span id="linkTypeSelector"><\/span><\/td><td class="actions"><a id="addLink" class="button gray small">${ASC.Projects.Resources.ProjectResource.OkButton}<\/a><\/td><\/tr><\/tbody><\/table><div class="linked-tasks-buttons{{if !canEdit}} display-none{{/if}}"><span class="icon-link plus"><a id="addNewLink" class="baseLinkAction">${ASC.Projects.Resources.TasksResource.CreateNewLink}<\/a><\/span><span class="splitter-buttons"><\/span><\/div><\/div>');jQuery.template("projects_subtasksTemplate","{{each subtasks}}        {{tmpl($item.data.subtasks[$index], {taskStatus: $item.data.status}) 'projects_subtaskTemplate'}}      {{/each}}");jQuery.template("projects_subtaskTemplate",'<div id="${id}" class="with-entity-menu subtask clearFix {{if $item.data.status == 2}} closed{{/if}}{{if $item.data.canEdit}} canedit{{/if}}">{{if $item.data.canEdit}}<div class="entity-menu"><\/div>{{else}}<div class="nomenupoint"><\/div>{{/if}}<div class="check"><input type="checkbox" {{if $item.data.status == 2}} checked="checked" {{/if}} {{if !$item.data.canEdit || $item.taskStatus == 2}} disabled="true" {{/if}} /><\/div><div class="taskName{{if $item.data.canEdit}} canedit{{/if}}"><span>{{html jq.linksParser(jq.htmlEncodeLight($item.data.title))}}<\/span><\/div>{{if $item.data.responsible == null}}<div class="not user"><span>${ASC.Projects.Resources.TasksResource.NoResponsible}<\/span><\/div>{{else}}<div class="user" title="${$item.data.responsible.displayName}">${$item.data.responsible.displayName}<\/div>{{/if}}<\/div>');jQuery.template("projects_fieldForAddSubtask",'<table id="quickAddSubTaskField" class="add-subtask-field-wrapper display-none"><tr><td class="subtask-name border-style"><input class="subtask-name-input" type="text" value="${title}" data-subtaskid="${subtaskid}" maxlength="255"/><\/td><td class="subtask-responsible border-style"><span class="subtask-responsible-selector link dotline">{{if responsible != null}}${responsible.displayName}{{else}}${ASC.Projects.Resources.TasksResource.NoResponsible}{{/if}}<\/span><\/td><td class="subtask-add-button"><a class="button gray">${ASC.Projects.Resources.ProjectResource.OkButton}<\/a><\/td><\/tr><\/table>');jQuery.template("projects_discussionTemplate",'<div class="container-list"><div class="header-list clearFix"><div class="avatar-list"><img src="${authorAvatar}" alt="${authorName}"/><\/div><div class="describe-list"><div class="title-list"><a href="${discussionUrl}">${title}<\/a>{{if status == 1}}<span class="status">${ASC.Projects.Resources.MessageResource.ArchiveDiscussionStatus}<\/span>{{/if}}<\/div><div class="info-list"><span class="caption-list">${ASC.Projects.Resources.MessageResource.AuthorTitle}:<\/span><span class="name-list author{{if authorId==\'4a515a15-d4d6-4b8e-828e-e0586f18f3a3\'}} not-action{{/if}}" data-authorId="${authorId}">${authorName}<\/span><\/div>{{if projectTitle}}<div class="info-list"><span class="caption-list">${ASC.Projects.Resources.ProjectResource.Project}:<\/span><span class="name-list project" data-projectId="${projectId}">${projectTitle}<\/span><\/div>{{/if}}<div class="date-list">${createdDate}<span class="time-list">${createdTime}<\/span><\/div><\/div><\/div><div class="content-list">{{html htmlUtility.getFull(text)}}                                {{if hasPreview}}<div><a class="read-more" target="_blank" href="${discussionUrl}"><font>${ASC.Projects.Resources.MessageResource.ReadMore}<\/font><\/a><\/div>{{/if}}<div class="comment-list"><a href="${commentsUrl}">${ASC.Projects.Resources.MessageResource.Comments}: ${commentsCount}<\/a>{{if canComment}}<a href="${writeCommentUrl}">${ASC.Projects.Resources.CommonResource.WriteComment}<\/a>{{/if}}<\/div><\/div><\/div>');jQuery.template("projects_discussionActionTemplate",'<div class="discussionContainer"><div class="discussionHeaderContainer"><span class="discussionHeader">${title}<\/span><\/div><div class="discussionAuthorAvatar"><img src="${authorAvatarUrl}" alt="${authorName}"/><\/div><div class="discussionDescriptionContainer"><div><a class="link bold" href="${authorPageUrl}">${authorName}<\/a><span class="discussionCreatedDate">${createOn}<\/span><\/div><div class="discussionAuthorTitle">${authorTitle}<\/div><div class="discussionText">{{html content}}<\/div><div style="clear: both;"><\/div><\/div><\/div>');jQuery.template("projects_discussionTab",'<div id="discussionParticipantsContainer" class="participantsContainer display-none"><div id="manageParticipantsSelector" class="link dotline plus">${ASC.Projects.Resources.CommonResource.AddParticipants}<\/div><ul id="discussionParticipantsTable" class="items-display-list">{{tmpl \'projects_subscribedUsers\'}}<\/ul><div style="clear: both;"><\/div><\/div><div class="popup_helper" id="hintSubscribersPrivateProject"><p>${ASC.Projects.Resources.CommonResource.hintSubscribersPrivateProject}<\/p><\/div>');jQuery.template("projects_subscribedUsers","{{each newListParticipants}}    {{tmpl($item.data.newListParticipants[$index]) 'projects_subscribedUser'}}    {{/each}}     {{each notSeePartisipant}}    {{tmpl($item.data.notSeePartisipant[$index]) 'projects_subscribedUser'}}    {{/each}}");jQuery.template("projects_subscribedUser",'<li class="items-display-list_i" guid=\'${id}\'><span class="item-name"><a class="link {{if hidden}}gray{{/if}}" href="${profileUrl}" target="_blank">${displayName}<\/a><\/span>{{if !descriptionFlag}}<div class="reset-action"><\/div>{{/if}}<\/li>');jQuery.template("projects_tabs",'<div class="tabs-section" id="${id}"><span class="header-base">${title}{{if count}} (${count}){{/if}}<\/span><span id="switcher${id}" class="toggle-button">{{if state}}            ${ASC.Projects.Resources.CommonResource.Hide}            {{else}}            ${ASC.Projects.Resources.CommonResource.Show}            {{/if}}<\/span><\/div>');jQuery.template("projects_statusChangePanel",'<div id="statusChangePanel" class="studio-action-panel"><ul id="statusList" class="dropdown-content">{{each statuses}}<li id="statusItem_${id}" class="${cssClass} dropdown-item">${text}<\/li>{{/each}}<\/ul><\/div>');jQuery.template("projects_statusChangeContainer",'<div class="changeStatusCombobox{{if canEdit}} canEdit{{else}} noEdit{{/if}}"><span title="${status.text}" class="${status.cssClass}"><\/span>{{if canEdit}}<span class="arrow"><\/span>{{/if}}<\/div>');jQuery.template("projects_panelFrame",'<div id="${panelId}" class="studio-action-panel"><div class="panel-content"><\/div><\/div>');jQuery.template("projects_actionMenuContent",'<ul class="dropdown-content">{{each menuItems}}<li id="${id}" class="dropdown-item"><span title="${text}">${text}<\/span><\/li>{{/each}}<\/ul>');jQuery.template("projects_linedListWithCheckbox",'<ul class="dropdown-content lined">{{each menuItems}}<li class="dropdown-item {{if classname}}${classname}{{/if}}"><input id="${id}" type="checkbox" /><label for="${id}" title="${title}">${title}<\/label><\/li>{{/each}}<\/ul>');jQuery.template("projects_descriptionPanelContent",'{{if creationDate}}<div class="date"><div class="param">${ASC.Projects.Resources.TasksResource.CreatingDate}:<\/div><div class="value">${creationDate}<\/div><\/div>{{/if}}    {{if createdBy}}<div class="createdby"><div class="param">${ASC.Projects.Resources.TasksResource.CreatedBy}:<\/div><div class="value">${createdBy}<\/div><\/div>{{/if}}    {{if typeof startDate == "string"}}<div class="startdate"><div class="param">${ASC.Projects.Resources.TasksResource.TaskStartDate}:<\/div><div class="value">${startDate}<\/div><\/div>{{/if}}    {{if closedDate}}<div class="closed"><div class="param">${ASC.Projects.Resources.TasksResource.Closed}:<\/div><div class="value">${closedDate}<\/div><\/div>{{/if}}    {{if closedBy}}<div class="closedby"><div class="param">${ASC.Projects.Resources.TasksResource.ClosedBy}:<\/div><div class="value">${closedBy}<\/div><\/div>{{/if}}    {{if project}}<div class="project"><div class="param">${ASC.Projects.Resources.TasksResource.Project}:<\/div><div class="value" projectid="${projectId}"><span class="link dotline">{{html project}}<\/span><\/div><\/div>{{/if}}    {{if milestone}}<div class="milestone"><div class="param">${ASC.Projects.Resources.TasksResource.Milestone}:<\/div><div class="value" projectid="${projectId}" milestone="${milestoneId}"><span class="link dotline">{{html milestone}}<\/span><\/div><\/div>{{/if}}    {{if description}}<div class="descr"><div class="param">${ASC.Projects.Resources.TasksResource.Description}:<\/div><div class="value"><div class="descrValue">{{html jq.linksParser(jq.htmlEncodeLight(description))}}<\/div>{{if readMore}}<a class="readMore" target="_blank" href="${readMore}">${ASC.Projects.Resources.CommonResource.ReadMore}<\/a>{{/if}}<\/div><\/div>{{/if}}');jQuery.template("projects_groupActionMenu",'<ul id="groupActionMenu" class="clearFix contentMenu contentMenuDisplayAll"><li class="menuAction menuActionSelectAll menuActionSelectLonely"><div class="menuActionSelect"><input id="selectAll" type="checkbox" title="${ASC.Projects.Resources.TimeTrackingResource.GroupMenuSelectAll}"/><\/div>{{if multiSelector}}<div class="down_arrow" title="Select"><\/div><div id="groupActionMenuSelector" class="studio-action-panel"><ul class="dropdown-content">{{each multiSelector}}<li id="${id}"><a class="dropdown-item">${title}<\/a><\/li>{{/each}}<\/ul><\/div>{{/if}}<\/li>{{each actions}}<li class="menuAction" id="${id}" title="${title}"><span>${title}<\/span><\/li>{{/each}}<li class="menu-action-checked-count"><span><\/span><a id="deselectAll" class="link dotline small">${ASC.Projects.Resources.TimeTrackingResource.GroupMenuDeselectAll}<\/a><\/li><li class="menu-action-simple-pagenav" style="display: list-item;"><\/li><li class="menu-action-on-top"><a class="on-top-link" onclick="javascript:window.scrollTo(0, 0);">${ASC.Projects.Resources.TimeTrackingResource.GroupMenuOnTop}<\/a><\/li><\/ul>');jQuery.template("projects_totalTimeText",'<div class=\'total-time-forFilter\' id=\'totalTimeText\'><span><\/span><span class="total-count">${ASC.Projects.Resources.TimeTrackingResource.TotalTimeCommon}<b><span class="hours"><\/span>${ASC.Projects.Resources.TimeTrackingResource.Hours}<span class="minutes"><\/span>${ASC.Projects.Resources.TimeTrackingResource.Minutes}<\/b><\/span><span class="billed-count">${ASC.Projects.Resources.TimeTrackingResource.TotalTimeBilled}<b><span class="hours"><\/span>${ASC.Projects.Resources.TimeTrackingResource.Hours}<span class="minutes"><\/span>${ASC.Projects.Resources.TimeTrackingResource.Minutes}<\/b><\/span><\/div>');jQuery.template("projects_navPanel",'<div class="project-info-container"><div class="project-total-info"><div class="project-title header-with-menu with-entity-menu">{{if typeof $item.data.uplink != "undefined"}}<a class="header-back-link" href="${$item.data.uplink}"><\/a>{{/if}}<span class="main-title-icon ${$item.data.icon}"><\/span>{{if $item.data.private}}<span class="private"><\/span>{{/if}}<span id="essenceTitle" class="text-overflow truncated-text" title="${$item.data.title}">${$item.data.title}<\/span>{{if typeof $item.data.subscribed != "undefined"}}<a id="subscribe" class="follow-status {{if $item.data.subscribed}}subscribed{{else}}unsubscribed{{/if}}" title="${$item.data.subscribedTitle}"><\/a>{{/if}}<span class="entity-menu"><\/span><\/div><\/div><div id="projectTabs" class="display-none tabsNavigationLinkBox"><\/div><\/div>');jQuery.template("projects_emptyScreen",'<table><tbody><tr><td><div class="emptyScrImage ${img}"><\/div><\/td><td><div class="emptyScrTd"><div class="header-base-big">${$item.data.header}<\/div><div class="emptyScrDscr">${$item.data.description}<\/div>{{if $item.data.button.canCreate()}}<div class="emptyScrBttnPnl"><span class="link dotline {{if $item.data.button.clear}}clearFilterButton{{else}}addFirstElement{{/if}}">${$item.data.button.title}<\/span><\/div>{{/if}}<\/div><\/td><\/tr><\/tbody><\/table>');jQuery.template("projects_description",'<div class="descriptionContainer">{{if status.items.length }}<div><span class="title">${ASC.Projects.Resources.CommonResource.Status}:<\/span><span class="value">{{if status.canChange }}<span class="link dotline status">${status.current.title}<\/span>{{else}}                    ${status.current.title}                {{/if}}<\/span><\/div>{{/if}}        {{each data}}        {{tmpl($item.data.data[$index]) \'projects_description_item\'}}        {{/each}}<\/div>');jQuery.template("projects_description_item",'{{if typeof value != "undefined" && value.length}}<div><span class="title">${title}:<\/span><span class="value">{{if typeof href != "undefined" && href.length}}<a href="${href}">${value}<\/a>{{else typeof wrapper != "undefined" && wrapper.length}}        {{html jq.format(wrapper, value)}}        {{else}}        {{html value}}        {{/if}}<\/span><\/div>{{/if}}');jQuery.template("projects_dashboard_empty_screen",'<div id="projects_dashboard_empty_screen_container"><div class="backdrop" blank-page=""><\/div><div id="content" blank-page="" class="dashboard-center-box projects"><div class="header"><span class="close">&times;<\/span>${ASC.Projects.Resources.CommonResource.DashboardTitle}<\/div><div class="content clearFix">{{each blocks}}<div class="module-block"><img src="/products/projects/app_themes/default/images/${image}"/><div class="title">${title}<\/div><ul>{{each ul}}<li>${$value}<\/li>{{/each}}<\/ul><\/div>{{/each}}<\/div><div class="dashboard-buttons"><a class="button huge create-button" href="/products/projects/projects.aspx?action=add">${ASC.Projects.Resources.CommonResource.CreateProjectButtonText}<\/a><\/div><\/div><\/div>');jQuery.template("projects_move_task_panel",'<div class="describe-text">${describe.title}<\/div><div class="taskTitls ms"><b>${describe.description}<\/b><\/div><div class="describe-text ms">${ASC.Projects.Resources.TasksResource.WillBeMovedToMilestone}:<\/div><div class="milestonesList">{{tmpl(milestones) \'projects_milestoneForMoveTaskPanelTmpl\'}}<\/div><div class="middle-button-container"><a href="javascript:void(0)" class="button blue middle">${describe.moveToMilestone}<\/a><span class="splitter-buttons"><\/span><a class="button gray middle" href="javascript:void(0)">${ASC.Projects.Resources.CommonResource.Cancel}<\/a><\/div>');jQuery.template("projects_common_popup_header",'<span class="commonPopupHeaderTitle">${title}<\/span>');jQuery.template("projects_task_action",'{{tmpl \'projects_common_action\'}}<div id="pm-milestoneBlock" class="display-none"><div class="pm-headerLeft">${ASC.Projects.Resources.MilestoneResource.Milestone}:<\/div><div class="pm-fieldRight"><div id="taskMilestone" data-id="" class="link dotline advansed-select-container">${ASC.Projects.Resources.CommonResource.Select}<\/div><\/div><div style="clear: both"><\/div><\/div><div id="pm-respBlock" class="display-none"><div class="pm-headerLeft userAddHeader">${ASC.Projects.Resources.TasksResource.TaskResponsible}:<\/div><div class="userAdd"><div id="responsibleSelectContainer"><\/div><span id="taskResponsible" class="link dotline advansed-select-container">${ASC.Projects.Resources.TasksResource.Add}<\/span><div class="float-right notify display-none"><input type="checkbox" id="notify" checked="checked"/><label for="notify">${ASC.Projects.Resources.MessageResource.SubscribeUsers}<\/label><\/div><div id="fullFormUserList"><\/div><\/div><\/div><div style="clear: both"><\/div><div class="pm-headerLeft notify"><\/div><div style="clear: both" class="notify"><\/div><div class="pm-headerLeft" style="line-height: 21px;">${ASC.Projects.Resources.TasksResource.TaskStartDate}:<\/div><div class="pm-fieldRight"><span class="requiredErrorText startDate-error" error="${ASC.Projects.Resources.CommonResource.TaskCompareDateError}" style="margin-right: 24px;"><\/span><input type="text" id="taskStartDate" class="textEditCalendar"/><\/div><div style="clear: both"><\/div><div class="pm-headerLeft" style="line-height: 21px;">${ASC.Projects.Resources.TasksResource.DeadLine}:<\/div><div class="pm-fieldRight"><input type="text" id="taskDeadline" class="textEditCalendar"/><span class="splitter"><\/span><span class="link dotline deadline_left" data-value="0">${ASC.Projects.Resources.CommonResource.Today}<\/span><span class="splitter"><\/span><span class="link dotline deadline_left" data-value="3">3            ${ASC.Projects.Resources.DayGenitiveSingular}<\/span><span class="splitter"><\/span><span class="link dotline deadline_left" data-value="7">${ASC.Projects.Resources.ReportResource.Week}<\/span><\/div><div style="clear: both"><\/div><div><div class="pm-headerLeft">${ASC.Projects.Resources.TasksResource.Priority}:<\/div><div class="pm-fieldRight"><input type="checkbox" name="priority" value="1" id="priority"/><label class="priority high" for="priority">${ASC.Projects.Resources.TasksResource.HighPriority}<\/label><\/div><div style="clear: both"><\/div><\/div><div style="clear: both"><\/div><div class="display-none" id="copySubtasksContainer"><div class="pm-headerLeft">${ASC.Projects.Resources.CommonResource.Copy}:<\/div><div class="pm-fieldRight"><div class="copy"><input type="checkbox" name="copySubtasks" value="1" id="copySubtasks"/><label class="copy" for="copySubtasks">${ASC.Projects.Resources.TasksResource.Subtasks}<\/label><\/div><div class="copy files"><input type="checkbox" name="copyFiles" value="1" id="copyFiles"/><label class="copy" for="copyFiles">${ASC.Projects.Resources.CommonResource.DocsModuleTitle}<\/label><\/div><\/div><\/div><div class="success-popup display-none">${ASC.Projects.Resources.CommonResource.TaskAddedMessage}<a id="taskLink" href="javascript:void(0)">${ASC.Projects.Resources.TasksResource.GoToTheTask}<\/a><\/div><div class="error-popup display-none"><\/div><div class="pm-action-block big-button-container"><a id="saveTaskAction" href="javascript:void(0)" class="button blue middle">${ASC.Projects.Resources.CommonResource.Save}<\/a><span class="splitter-buttons"><\/span><a id="createTaskAndCreateNew" href="javascript:void(0)" class="button gray middle">${ASC.Projects.Resources.CommonResource.SaveAndAddMore}<\/a><span class="splitter-buttons"><\/span><a id="closeTaskAction" class="button gray middle" href="javascript:void(0)">${ASC.Projects.Resources.CommonResource.Cancel}<\/a><\/div>');jQuery.template("projects_milestone_action",'{{tmpl \'projects_common_action\'}}<div id="milestoneResponsibleContainer" class="block-cnt-splitter requiredField"><span class="requiredErrorText">${ASC.Projects.Resources.MilestoneResource.ChooseResponsible}<\/span><div class="headerPanelSmall">${ASC.Projects.Resources.MilestoneResource.Responsible}:<\/div><div id="milestoneResponsible" data-id="" class="link dotline advansed-select-container">${ASC.Projects.Resources.CommonResource.Select}<\/div><div class="notifyResponsibleContainer"><input id="notifyResponsibleCheckbox" type="checkbox" checked="checked"/><label for="notifyResponsibleCheckbox">${ASC.Projects.Resources.MilestoneResource.NotifyResponsible}<\/label><\/div><div id="noActiveParticipantsMilNote" class="float-right gray-text display-none">${ASC.Projects.Resources.ProjectsJSResource.NoActiveParticipantsNote}<\/div><\/div><div style="clear: both"><\/div><div id="milestoneDeadlineContainer" class="block-cnt-splitter requiredField"><div class="headerPanelSmall">${ASC.Projects.Resources.MilestoneResource.MilestoneDeadline}:<\/div><div id="milestoneDeadlineSelectorContainer"><input type="text" id="milestoneDeadlineInputBox" class="textEditCalendar"/><span class="link dotline deadlineLeft" data-value="7">${ASC.Projects.Resources.MilestoneResource.DeadlineInWeek}<\/span><span class="link dotline deadlineLeft" data-value="1">${ASC.Projects.Resources.MilestoneResource.DeadlineInMonth}<\/span><span class="link dotline deadlineLeft" data-value="2">${ASC.Projects.Resources.MilestoneResource.DeadlineInTwoMonths}<\/span><\/div><\/div><div id="milestoneKeyContainer"><input id="milestoneKeyCheckBox" type="checkbox"/><label for="milestoneKeyCheckBox">${ASC.Projects.Resources.MilestoneResource.RootMilestone}<\/label><div class="HelpCenterSwitcher" onclick="jq(this).helper({ BlockHelperID: \'AnswerForProjectMilestone\', popup: true });" title="${ASC.Projects.Resources.CommonResource.HelpQuestionProjectMilestone}"><\/div><div class="popup_helper" id="AnswerForProjectMilestone"><p>{{html jq.format(ASC.Projects.Resources.CommonResource.HelpAnswerProjectMilestone, "<br/>", "<b>", "<\/b>")}}<\/p><\/div><\/div><div id="milestoneNotifyManagerContainer"><input id="milestoneNotifyManagerCheckBox" type="checkbox"/><label for="milestoneNotifyManagerCheckBox">${ASC.Projects.Resources.MilestoneResource.RemindMe}<\/label><\/div><div class="error-popup display-none"><\/div><div id="milestoneActionButtonsContainer" class="big-button-container"><a id="milestoneActionButton" href="javascript:void(0)" class="button blue middle"           add="${ASC.Projects.Resources.MilestoneResource.AddMilestoneButton}" update="${ASC.Projects.Resources.CommonResource.SaveChanges}"><\/a><span class="splitter-buttons"><\/span><a id="milestoneActionCancelButton" href="javascript:void(0)" class="button gray middle" onclick="javascript:jq.unblockUI();">${ASC.Projects.Resources.CommonResource.Cancel}<\/a><\/div>');jQuery.template("projects_common_action",'<div class="block-cnt-splitter titlePanel requiredField"><span class="requiredErrorText title">${title.error}<\/span><div class="headerPanelSmall">${title.header}:<\/div><input class="textEdit" maxlength="250"/><\/div><div class="block-cnt-splitter"><div class="headerPanelSmall">${description}:<\/div><textarea cols="22" rows="3"><\/textarea><\/div><div class="block-cnt-splitter requiredField projectContaner"><span class="requiredErrorText">${project.error}<\/span><div class="headerPanelSmall">${project.header}:<\/div><div data-id="" class="link dotline advansed-select-container">${ASC.Projects.Resources.CommonResource.Select}<\/div><\/div>');jQuery.template("projects_choose_responsible","<span class='chooseResponsible nobody'><span class='link dotline'>${ASC.Projects.Resources.ProjectsJSResource.ChooseResponsible}<\/span><\/span>");jQuery.template("projects_commonWarning",'{{each notes}}<p>${$value}<\/p>{{/each}}<div class="errorBox display-none"><\/div><div class="middle-button-container"><a class="button blue middle">${okButton}<\/a><span class="splitter-buttons"><\/span><a class="button gray middle cancel">${ASC.Projects.Resources.CommonResource.Cancel}<\/a><\/div>');jQuery.template("projects_editTimerPopup",'<div id="TimeLogTaskTitle" class="header-base block-cnt-splitter"><\/div><div class="addLogPanel-infoPanel"><div class="addLogPanel-infoPanelBody"><span class="header-base gray-text">${ASC.Projects.Resources.CommonResource.SpentTotally}<\/span><span class="splitter-buttons"><\/span><span id="TotalHoursCount" class="header-base"><\/span><span class="splitter-buttons"><\/span><\/div><\/div><div class="warnBox" style="display:none;" id="timeTrakingErrorPanel"><\/div><div class="block-cnt-splitter" style="float:right"><div class="headerPanelSmall"><b>${ASC.Projects.Resources.TasksResource.TaskResponsible}:<\/b><\/div><select style="width: 220px;" class="comboBox pm-report-select" id="teamList"><\/select><\/div><div><div class="block-cnt-splitter" style="float:left;margin-right:20px"><div class="headerPanelSmall"><b>${ASC.Projects.Resources.CommonResource.Time}:<\/b><\/div><input id="inputTimeHours" type="text" placeholder="${ASC.Projects.Resources.CommonResource.WatermarkHours}" class="textEdit" maxlength="2" /><span class="splitter">:<\/span><input id="inputTimeMinutes" type="text" placeholder="${ASC.Projects.Resources.CommonResource.WatermarkMinutes}" class="textEdit" maxlength="2" /><\/div><div class="block-cnt-splitter"><div class="headerPanelSmall"><b>${ASC.Projects.Resources.CommonResource.Date}:<\/b><\/div><input id="timeTrakingDate" class="textEditCalendar" style="margin-right: 3px"/><\/div><\/div><div style="clear:both"><\/div><div class="block-cnt-splitter"><div class="headerPanelSmall"><b>${ASC.Projects.Resources.ProjectResource.ProjectDescription}:<\/b><\/div><textarea id="timeDescription" rows="7" cols="20" maxlength="250"><\/textarea><\/div><div class="middle-button-container"><a href="javascript:void(0)" class="button blue middle">${ASC.Projects.Resources.CommonResource.SaveChanges}<\/a><span class="splitter-buttons"><\/span><a class="button gray middle" href="javascript:void(0)" onclick="javascript: jq.unblockUI();">${ASC.Projects.Resources.CommonResource.Cancel}<\/a><\/div>');jQuery.template("projects_reportFilterList","{{if radio.length}}<div class=\"filter-option-container\">{{each radio}}        {{tmpl($item.data.radio[$index]) 'projects_reportFilterRadio'}}        {{/each}}<\/div>{{/if}}    {{each combo}}    {{tmpl($item.data.combo[$index]) 'projects_reportFilterCombo'}}    {{/each}}    {{each check}}    {{tmpl($item.data.check[$index]) 'projects_reportFilterCheck'}}    {{/each}}");jQuery.template("projects_reportFilterCombo",'<div class="filter-item-container {{if hidden}} display-none {{/if}}"><span class="describe-text">${describe}:<\/span><span class="splitter"><\/span><span id="${id}" class="link dotline">${defaultText}<\/span><\/div>');jQuery.template("projects_reportFilterRadio",'<input id="${id}" name="${name}" {{if checked}} checked="checked" {{/if}} value="${value}" type="radio"><label for="${id}">${describe}<\/label><span class="splitter"><\/span>');jQuery.template("projects_reportFilterCheck",'<div class="filter-item-container"><input id="${id}" {{if checked}} checked="checked" {{/if}} type="checkbox"><label for="${id}">${describe}<\/label><\/div>');jQuery.template("projects_action_create",'<div id="pageHeader"><div class="pageTitle">${pageTitle}<\/div><div style="clear: both"><\/div><\/div>{{if showTemplates }}<div id="templateContainer" class="block-cnt-splitter"><div class="headerPanelSmall">${ASC.Projects.Resources.ProjectResource.SelectProjectTemplate}<\/div><span id="templateSelect" data-id="" class="link dotline advansed-select-container">${ASC.Projects.Resources.CommonResource.Select}<\/span><\/div>{{/if}}<div id="projectTitleContainer" class="block-cnt-splitter requiredField"><span class="requiredErrorText">${ASC.Projects.Resources.ProjectsJSResource.EmptyProjectTitle}<\/span><div class="headerPanelSmall">${ASC.Projects.Resources.ProjectResource.ProjectTitle}<\/div><div class="inputTitleContainer" style="width: 100%"><input ID="projectTitle" class="textEdit" type="text" value="${project.title}"/><\/div><div style="clear: both;"><\/div><\/div><div class="popup_helper" id="AnswerForFollowProject"><p>{{html jq.format(Encoder.htmlEncode(ASC.Projects.Resources.CommonResource.HelpAnswerFollowProject), "<br/>", "<b>", "<\/b>")}}<\/p><\/div><div id="projectDescriptionContainer" class="block-cnt-splitter"><div class="headerPanelSmall">${ASC.Projects.Resources.ProjectResource.ProjectDescription}<\/div><div class="dottedHeaderContent"><textarea ID="projectDescription" style="width: 100%" rows="6">${project.description}<\/textarea><\/div><\/div><div id="projectManagerContainer" class="block-cnt-splitter requiredField"><span class="requiredErrorText">${ASC.Projects.Resources.ProjectsJSResource.EmptyProjectManager}<\/span><div class="headerPanelSmall">${ASC.Projects.Resources.ProjectResource.ProjectLeader}<\/div><div><span id="projectManagerSelector" data-id="${project.manager.id}" class="link dotline">${project.manager.name}<\/span><\/div>{{if !hideChooseTeam}}<div class="notifyManagerContainer"><input id="notifyManagerCheckbox" type="checkbox"/><label for="notifyManagerCheckbox">${ASC.Projects.Resources.ProjectResource.NotifyProjectManager}<\/label><\/div>{{/if}}<div style="clear: both;"><\/div><\/div><div id="projectTeamContainer" class="block-cnt-splitter {{if hideChooseTeam}} display-none{{/if}}"><div class="headerPanelSmall clearFix"><div class="float-left">${ASC.Projects.Resources.ProjectResource.ProjectTeam}<\/div><div class="HelpCenterSwitcher" onclick="jq(this).helper({ BlockHelperID: \'AnswerForProjectTeam\' });" title="${ASC.Projects.Resources.CommonResource.HelpQuestionProjectTeam}"><\/div><div class="popup_helper" id="AnswerForProjectTeam"><p>{{html jq.format(Encoder.htmlEncode(ASC.Projects.Resources.CommonResource.HelpAnswerProjectTeam), "<br/>", "<b>", "<\/b>")}}<br/>{{if ASC.Resources.Master.HelpLink}}<a target="_blank" href="${ASC.Resources.Master.HelpLink + \'/gettingstarted/projects.aspx#ManagingYourTeam_block\'}">${ASC.Projects.Resources.CommonResource.LearnMoreLink}<\/a>{{/if}}<\/p><\/div><\/div><div><span id="projectTeamSelector" class="link dotline plus">${ASC.Projects.Resources.ProjectResource.ManagmentTeam}<\/span><\/div><div id="projectParticipantsContainer" class="items-display-list"><\/div><input type="hidden" id="projectParticipants"/><\/div>{{if showTemplates }}    {{tmpl \'projects_action_template\'}}    {{/if}}    {{if IsProjectCreatedFromCrm}}<div id="projectContactsContainer"><div class="headerPanelSmall">${ASC.Projects.Resources.CommonResource.ProjectLinkedWithContacts}<\/div><div class="no-linked-contacts">${ASC.Projects.Resources.CommonResource.NoCRMContactsForLink}<\/div><div id="contactListBox"><table id="contactTable" class="table-list padding4"><tbody><\/tbody><\/table><\/div><\/div>{{/if}}    {{if typeof project.status !== "undefined" }}<div id="projectStatusContainer"><div class="headerPanelSmall clearFix"><div class="float-left">${ASC.Projects.Resources.ProjectResource.ProjectStatus}<\/div><div class="HelpCenterSwitcher" onclick="jq(this).helper({ BlockHelperID: \'AnswerForProjectStatus\' });" title="${ASC.Projects.Resources.CommonResource.HelpQuestionProjectStatus}"><\/div><div class="popup_helper" id="AnswerForProjectStatus"><p>{{html jq.format(Encoder.htmlEncode(ASC.Projects.Resources.CommonResource.HelpAnswerProjectStatus), "<br/>", "<b>", "<\/b>")}}<\/p><\/div><\/div><span id="projectStatus" class="link dotline" data-id="${project.status.id}">${project.status.title}<\/span><\/div>{{/if}}<div id="projectTagsContainer" class="dottedHeader"><div class="headerPanelSmall">${ASC.Projects.Resources.ProjectResource.Tags}<\/div><div class="dottedHeaderContent"><input id="projectTags" class="textEdit" maxlength="8000" value="${project.tags}" placeholder="${ASC.Projects.Resources.ProjectResource.EnterTheTags}"/><div id="tagsAutocompleteContainer"><\/div><\/div><\/div>{{if !IsPrivateDisabled}}<div id="projectVisibilityContainer"><div class="headerPanelSmall clearFix"><div class="popup_helper" id="AnswerForPrivateProject"><p>{{html jq.format(Encoder.htmlEncode(ASC.Projects.Resources.CommonResource.HelpAnswerPrivateProject), "<br/>", "<b>", "<\/b>")}}<br/>{{if ASC.Resources.Master.HelpLink}}<a target="_blank" href="${ASC.Resources.Master.HelpLink + \'/gettingstarted/projects.aspx#ManagingYourTeam_block\'}">${ASC.Projects.Resources.CommonResource.LearnMoreLink}<\/a>{{/if}}<\/p><\/div><\/div><div class="checkboxPrivateProj"><input id="projectPrivacyCkeckbox" type="checkbox" {{if project.private}}checked{{/if}}/><label for="projectPrivacyCkeckbox">${ASC.Projects.Resources.ProjectResource.IUnerstandForEditHidden}<\/label><div class="HelpCenterSwitcher" onclick="jq(this).helper({ BlockHelperID: \'AnswerForPrivateProject\' });" title="${ASC.Projects.Resources.CommonResource.HelpQuestionPrivateProject}"><\/div><\/div><\/div>{{/if}}    {{if typeof project.status === "undefined" && !hideChooseTeam}}<div id="projectFollowContainer"><div class="followingCheckboxContainer"><input id="followingProjectCheckbox" type="checkbox"/><label for="followingProjectCheckbox">${ASC.Projects.Resources.ProjectResource.FollowingProjects}<\/label><div class="HelpCenterSwitcher" onclick="jq(this).helper({ BlockHelperID: \'AnswerForFollowProject\' });" title="${ASC.Projects.Resources.CommonResource.HelpQuestionFollowProject}"><\/div><\/div><\/div>{{/if}}<div id="projectActionsContainer" class="big-button-container"><a id="projectActionButton" class="button blue big">${actionButton}<\/a><span class="splitter-buttons"><\/span>{{if project.url}}<a id="cancelEditProject" href="${project.url}" class="button gray big">${ASC.Projects.Resources.CommonResource.Cancel}<\/a><span class="splitter-buttons"><\/span>{{if project.canDelete}}<a id="projectDeleteButton" class="button gray big">${ASC.Projects.Resources.ProjectResource.ProjectDeleted}<\/a>{{/if}}        {{else}}<a id="cancelEditProject" class="button gray big">${ASC.Projects.Resources.CommonResource.Cancel}<\/a>{{/if}}<\/div>');jQuery.template("projects_action_template",'<div class="display-none"><p id="milestoneError">${ASC.Projects.Resources.ProjectTemplatesResource.MilestoneError}<\/p><p id="taskError">${ASC.Projects.Resources.ProjectTemplatesResource.TaskError}<\/p><\/div><div class="block-cnt-splitter"><div class="headerPanelSmall">${ASC.Projects.Resources.ProjectTemplatesResource.EditProjStructure}<\/div><div id="listAddedMilestone"><\/div><div id="addMilestone"><a class="link dotline plus">${ASC.Projects.Resources.ProjectResource.AddMilestone}<\/a><\/div><p class="unlocatedTaskTitle">${ASC.Projects.Resources.ProjectTemplatesResource.TasksWithoutMilestone}<\/p><div id="noAssignTaskContainer"><div id="listNoAssignListTask"><\/div><div class="addTaskContainer"><a class="link dotline plus">${ASC.Projects.Resources.ProjectResource.AddTask}<\/a><\/div><\/div><div id="addMilestoneContainer" target=""><div>{{if edit}}<select><option selected="selected" duration="0.5" value=\'${ASC.Projects.Common.chooseMonthNumeralCase(0.5)}\'>${ASC.Projects.Common.chooseMonthNumeralCase(0.5)}<\/option>{{each month}}<option duration="${$value}" value=\'${ASC.Projects.Common.chooseMonthNumeralCase($value)}\'>${ASC.Projects.Common.chooseMonthNumeralCase($value)}<\/option>{{/each}}<\/select>{{else}}<input class="textEditCalendar" id="dueDate" type="text" />{{/if}}<input id="newMilestoneTitle" type="text" placeholder="${ASC.Projects.Resources.ProjectTemplatesResource.AddMilestoneTitle}" maxlength="250" /><\/div><div><a class="button gray">${ASC.Projects.Resources.ProjectResource.OkButton}<\/a><\/div><\/div><div id="addTaskContainer" target=""><div><input id="newTaskTitle" type="text" placeholder="${ASC.Projects.Resources.ProjectTemplatesResource.AddTaskTitle}" maxlength="250" /><\/div><div><a class="button gray">${ASC.Projects.Resources.ProjectResource.OkButton}<\/a><\/div><\/div><div id="taskActionPanel" class="studio-action-panel"><ul class="actionList dropdown-content"><li id="editTask" class="dropdown-item">${ASC.Projects.Resources.ProjectTemplatesResource.Edit}<\/li><li id="removeTask" class="dropdown-item">${ASC.Projects.Resources.ProjectTemplatesResource.Delete}<\/li><\/ul><\/div><div id="milestoneActions" class="studio-action-panel"><ul class="actionList dropdown-content"><li id="editMilestone" class="dropdown-item">${ASC.Projects.Resources.ProjectTemplatesResource.Edit}<\/li><li id="addTaskInMilestone" class="dropdown-item">${ASC.Projects.Resources.ProjectTemplatesResource.AddTask}<\/li><li id="removeMilestone" class="dropdown-item">${ASC.Projects.Resources.ProjectTemplatesResource.Delete}<\/li><\/ul><\/div><div id="projectMemberPanel" class="studio-action-panel"><ul class="dropdown-content actionList" nobodyitemtext="${ASC.Projects.Resources.ProjectTemplatesResource.NoResponsible}" chooseresptext="${ASC.Projects.Resources.ProjectTemplatesResource.ChooseResponsible}" class="actionList"><\/ul><\/div><\/div>');jQuery.template("projects_settings",'{{if ASC.Projects.Master.IsModuleAdmin}}<span class="header-base">${ASC.Projects.Resources.CommonResource.CommonSettings}<\/span><br /><br /><input id="cbxEnableSettings" class="on-off-checkbox" {{if everebodyCanCreate}}checked="checked"{{/if}}  type="checkbox"><label for="cbxEnableSettings">${ASC.Projects.Resources.CommonResource.SettingsWhoCanCreateProject}<\/label><br /><br /><input id="cbxHideSettings" class="on-off-checkbox" {{if hideEntitiesInPausedProjects}} checked="checked"{{/if}}  type="checkbox"><label for="cbxHideSettings">${ASC.Projects.Resources.CommonResource.HideEntitiesInPausedProjects}<\/label><br /><br />{{/if}}<span class="header-base">${ASC.Projects.Resources.CommonResource.PersonalSettings}<\/span><br /><br /><div class="header-base-small headerPanelSmall">${ASC.Projects.Resources.CommonResource.StartPage}<\/div><span id="startModule" class="top-align link dotline">${startModuleTitle}<\/span>');jQuery.template("simpleContactTmpl",'<tr id="contactItem_${id}" {{if typeof showActionMenu !== "undefined" && showActionMenu === true}}class="with-entity-menu"{{/if}}><td style="width:40px;"><div class="contactItemPhotoImgContainer{{if isShared === true}} sharedContact{{/if}}">{{if isCompany == true}}<img class="contactItemPhotoImg" src="${ASC.CRM.Data.SmallSizePhotoCompany}" alt="${displayName}" title="${displayName}" onload="ASC.CRM.Common.loadContactFoto(jq(this), jq(this).next(), \'${smallFotoUrl}\');" />{{else}}<img class="contactItemPhotoImg" src="${ASC.CRM.Data.SmallSizePhoto}" alt="${displayName}" title="${displayName}" onload="ASC.CRM.Common.loadContactFoto(jq(this), jq(this).next(), \'${smallFotoUrl}\');" />{{/if}}<img class="contactItemPhotoImg" style="display:none;" alt="${displayName}" title="${displayName}"/><\/div><\/td><td class="main-info-contact" style="width:50%;"><div class="contactTitle">{{if typeof(id)=="number"}}<a class="linkHeaderMedium" href="${contactLink}">${displayName}<\/a>{{else}}<span class="header-base-small">${displayName}<\/span>{{/if}}<\/div>{{if isCompany == false && typeof (company) != "undefined" && company != null && showCompanyLink}}<div class="contactTitle">${ASC.CRM.Resources.CRMContactResource.Company}:<a href="${company.contactLink}" data-id="${company.id}" id="contact_${id}_company_${company.id}" class="linkMedium crm-companyInfoCardLink">${company.displayName}<\/a><\/div>{{/if}}<\/td><td class="contact-info-contact"><div class="primaryDataContainer">{{each(i, item) commonData}}                    {{if item.infoType == 0 && item.isPrimary}}<span title="${item.data}">${item.data}<\/span>{{/if}}                {{/each}}<\/div><div class="primaryDataContainer">{{each(i, item) commonData}}                    {{if item.infoType == 1 && item.isPrimary}}<a title="${item.data}" href="mailto:${item.data}" class="linkMedium">${item.data}<\/a>{{/if}}                {{/each}}<\/div><\/td><td style="width:25px;">{{if typeof showActionMenu !== "undefined" && showActionMenu === true}}<div title="${ASC.CRM.Resources.CRMCommonResource.Actions}" class="entity-menu" id="simpleContactMenu_${id}"                    data-displayName="${displayName}"                     data-email="{{if primaryEmail !== null}}${primaryEmail.data}{{/if}}"                ><\/div>{{else typeof showUnlinkBtn !== "undefined" && showUnlinkBtn === true}}<img src="${StudioManager.GetImage(\'unlink_16.png\')}"               class="contact-info-link-img"               title="${ASC.CRM.Resources.CRMCommonResource.UnlinkContact}"               onclick=\'ASC.CRM.ListContactView.removeMember({{if typeof(id)=="number"}}${id}{{else}}"${id}"{{/if}});\'               id="trashImg_${id}" /><div id="loaderImg_${id}" class="loader-middle baseList_loaderImg"><\/div>{{/if}}<\/td><\/tr>');jQuery.template("simpleContactActionMenuTmpl",'<div id="simpleContactActionMenu" class="studio-action-panel"><ul class="dropdown-content"><li><a class="unlinkContact dropdown-item">${ASC.CRM.Resources.CRMCommonResource.UnlinkContact}<\/a><\/li><li><a class="writeEmail dropdown-item">${ASC.CRM.Resources.CRMContactResource.WriteEmail}<\/a><\/li><li><a class="viewMailingHistory dropdown-item">${ASC.CRM.Resources.CRMCommonResource.ViewMailingHistoryWithParticipant}<\/a><\/li><\/ul><\/div>');jQuery.template("contactSelectorContainerTmpl",'<div id="selector_${ObjName}"><div class="contactSelector-itemList"><\/div><\/div>');jQuery.template("contactSelectorRowTmpl",'<div id="item_${ObjID}" class="contactSelector-item">{{tmpl "contactSelectorContentTmpl"}}    {{if ShowOnlySelectorContent === false}}        {{tmpl "contactSelectorContactInfoContentTmpl"}}    {{/if}}    {{if ShowNewCompanyContent === true||ShowNewContactContent === true}}        {{tmpl "contactSelectorNewContactContentTmpl"}}    {{/if}}<\/div>');jQuery.template("contactSelectorContentTmpl",'<div id="selectorContent_${ObjID}" class="contactSelector-selectorContent" style="{{if ShowOnlySelectorContent===false&&selectedContact != null}}display:none;{{/if}}"><table cellspacing="0" cellpadding="1" class="contactSelector-inputContainer" width="100%" style="height: 18px;"><tbody><tr><td width="16px" class="borderBase" style="border-right: 0 none;"><label class="searchButton" id="searchImg_${ObjID}" onclick="window.${ObjName}.quickSearch(\'${ObjID}\');"><\/label><img align="absmiddle" id="loaderImg_${ObjID}" src="${StudioManager.GetImage(\'loader_16.gif\')}" style="display:none;"/><\/td><td class="borderBase" style="border-left: 0 none; border-right: 0 none;"><input type="text" id="contactTitle_${ObjID}" value="" class="textEdit" placeholder="${WatermarkText}" autocomplete="off"/><input type="hidden" id="contactID_${ObjID}" value="{{if selectedContact != null}}${selectedContact.id}{{/if}}"/><\/td><td width="16px" class="borderBase" style="border-left: 0 none;"><label class="crossButton" style="display:none;" onclick="window.${ObjName}.crossButtonEventClick(\'${ObjID}\');"                     title="${ASC.CRM.Resources.CRMCommonResource.Cancel}"><\/label><\/td>{{if ShowDeleteButton === true}}<td width="16px;"><a class="crm-deleteLink" title="${DeleteContactText}" onclick="window.${ObjName}.deleteContact(\'${ObjID}\');">&nbsp;<\/a><\/td>{{/if}}                {{if ShowAddButton === true}}<td width="16px;"><a title="${AddButtonText}" class="crm-addNewLink" onclick="window.${ObjName}.AddNewSelector(jq(this));">&nbsp;<\/a><\/td>{{/if}}<\/tr><\/tbody><\/table>{{tmpl "contactSelectorNoMatchesTmpl"}}<\/div>');jQuery.template("contactSelectorNoMatchesTmpl",'<div id="noMatches_${ObjID}" class="borderBase noMatches"><div style="padding: 5px;">${ASC.CRM.Resources.CRMCommonResource.NoMatches}<\/div>{{if ShowNewCompanyContent === true}}<div style="padding:0 5px"><a class="link blue dotline small plus" onclick="window.${ObjName}.showNewCompany(\'${ObjID}\');">${ASC.CRM.Resources.CRMContactResource.AddNewCompany}<\/a><\/div>{{/if}}        {{if ShowNewContactContent === true}}<div style="padding:5px;"><a class="link blue dotline small plus" onclick="window.${ObjName}.showNewContact(\'${ObjID}\');">${ASC.CRM.Resources.CRMContactResource.AddNewContact}<\/a><\/div>{{/if}}<\/div>');jQuery.template("contactSelectorContactInfoContentTmpl",'<div id="infoContent_${ObjID}" {{if selectedContact==null}}style="display: none;"{{/if}}><table width="100%" cellspacing="0" cellpadding="3"><tbody><tr>{{if ShowContactImg === true}}<td width="40px"><img src="{{if selectedContact != null}}${selectedContact.smallFotoUrl}{{/if}}" /><\/td>{{/if}}<td><span class="splitter"><b>{{if selectedContact != null}}${selectedContact.displayName}{{/if}}<\/b><\/span>{{if ShowChangeButton === true}}<a class="crm-removeLink" title="${ASC.CRM.Resources.CRMCommonResource.UnlinkContact}" onclick="window.${ObjName}.changeContact(\'${ObjID}\');">&nbsp;<\/a>{{/if}}                                        {{if ShowDeleteButton === true}}<a class="crm-deleteLink" title="${DeleteContactText}" onclick="window.${ObjName}.deleteContact(\'${ObjID}\');">&nbsp;<\/a>{{/if}}                    {{if ShowAddButton === true}}<a title="${AddButtonText}" class="crm-addNewLink" onclick="window.${ObjName}.AddNewSelector(jq(this));">&nbsp;<\/a>{{/if}}<\/td><\/tr><\/tbody><\/table><\/div>');jQuery.template("contactSelectorNewContactContentTmpl",'<div id="newContactContent_${ObjID}" style="display: none;"><table width="100%" cellspacing="0" cellpadding="3"><tbody><tr><td width="40px">{{if ShowNewCompanyContent === true}}<img id="newCompanyImg_${ObjID}" src="${ASC.CRM.Data.SmallSizePhotoCompany}" />{{/if}}                    {{if ShowNewContactContent === true}}<img id="newContactImg_${ObjID}" src="${ASC.CRM.Data.SmallSizePhoto}" style="display:none;"/>{{/if}}<input type="hidden" id="hiddenIsCompany_${ObjID}" /><\/td><td class="name-container-block"><span class="splitter">{{if ShowNewCompanyContent === true}}<input type="text" id="newCompanyTitle_${ObjID}" class="textEdit" placeholder="${ASC.CRM.Resources.CRMContactResource.CompanyName}" autocomplete="off"/>{{/if}}                    {{if ShowNewContactContent === true}}<input type="text" id="newContactFirstName_${ObjID}" class="textEdit" placeholder="${ASC.CRM.Resources.CRMContactResource.FirstName}" autocomplete="off" style="display:none;"/><input type="text" id="newContactLastName_${ObjID}" class="textEdit" placeholder="${ASC.CRM.Resources.CRMContactResource.LastName}" autocomplete="off" style="display:none;"/>{{/if}}<\/span><a class="crm-acceptLink" title="${ASC.CRM.Resources.CRMCommonResource.Add}" onclick="window.${ObjName}.acceptNewContact(\'${ObjID}\');">&nbsp;<\/a><a class="crm-rejectLink" title="${ASC.CRM.Resources.CRMCommonResource.Cancel}" onclick="window.${ObjName}.rejectNewContact(\'${ObjID}\');">&nbsp;<\/a>{{if ShowAddButton === true}}<a title="${AddButtonText}" class="crm-addNewLink" onclick="window.${ObjName}.AddNewSelector(jq(this));">&nbsp;<\/a>{{/if}}<\/td><\/tr><\/tbody><\/table><\/div>');jQuery.template("contactInfoCardResourcesTmpl",'<div id="contactInfoCardResources" class="display-none"        data-one="${ASC.CRM.Resources.CRMJSResource.OneContact}"        data-no="${ASC.CRM.Resources.CRMJSResource.NoContacts}"        data-many="${ASC.CRM.Resources.CRMJSResource.ManyContacts}"><\/div>');jQuery.template("contactInfoCardTmpl",'<div class="crm-contactInfoCard" id="contactInfoCard_${id}">{{if isPrivateForMe == false}}<a href="${contactLink}">{{if isCompany == true}}<img class="crm-contactInfoCardImg" border="0" style="margin: 0 auto;" src="${ASC.CRM.Data.MediumSizePhotoCompany}" alt="${displayName}" title="${displayName}" onload="ASC.CRM.Common.loadContactFoto(jq(this), jq(this).next(), \'${mediumFotoUrl}\');" />{{else}}<img class="crm-contactInfoCardImg" border="0" style="margin: 0 auto;" src="${ASC.CRM.Data.MediumSizePhoto}" alt="${displayName}" title="${displayName}" onload="ASC.CRM.Common.loadContactFoto(jq(this), jq(this).next(), \'${mediumFotoUrl}\');" />{{/if}}<img class="crm-contactInfoCardImg" border="0" style="margin: 0 auto;display:none;" alt="${displayName}" title="${displayName}"/><\/a>{{else}}        {{if isCompany == true}}<img class="crm-contactInfoCardImg" border="0" style="margin: 0 auto 10px; float: left;" src="${ASC.CRM.Data.MediumSizePhotoCompany}" alt="${displayName}" title="${displayName}" onload="ASC.CRM.Common.loadContactFoto(jq(this), jq(this).next(), \'${mediumFotoUrl}\');" />{{else}}<img class="crm-contactInfoCardImg" border="0" style="margin: 0 auto 10px; float: left;" src="${ASC.CRM.Data.MediumSizePhoto}" alt="${displayName}" title="${displayName}" onload="ASC.CRM.Common.loadContactFoto(jq(this), jq(this).next(), \'${mediumFotoUrl}\');" />{{/if}}<img class="crm-contactInfoCardImg" border="0" style="margin: 0 auto 10px; float: left;display:none;" alt="${displayName}" title="${displayName}"/>{{/if}}<div class="infoCardContent">{{if isPrivateForMe == true}}<label class="crm-private-lock"><\/label><span class="crm-task-title header-base-medium">${displayName}<\/span>{{else}}<a title="${displayName}" class="linkHeader" style="display: inline-block;                margin-bottom: 6px;text-decoration: underline;" href="${contactLink}">${displayName}<\/a>{{if isCompany == true && typeof(personsCount) != "undefined"}}<div class="personsCountString" style="margin-bottom: 6px;" data-one="${ASC.CRM.Resources.CRMJSResource.OneContact}" data-no="${ASC.CRM.Resources.CRMJSResource.NoContacts}" data-many="${ASC.CRM.Resources.CRMJSResource.ManyContacts}">{{if personsCount == 0}}                    ${jq("#contactInfoCardResources").attr("data-no")}                {{else personsCount == 1}}                    1 ${jq("#contactInfoCardResources").attr("data-one")}                {{else}}                    ${personsCount} ${jq("#contactInfoCardResources").attr("data-many")}                {{/if}}<\/div>{{else}}<div style="margin-bottom: 6px;">${title}<\/div>{{/if}}<ul>{{each(i, item) commonData}}                    {{if item.infoType == 1 && item.isPrimary}}<li><div class="crm-email"><a class="linkMedium" href="mailto:${item.data}">${item.data}<\/a>&nbsp;<span class="text-medium-describe">(${item.categoryName})<\/span><\/div><\/li>{{/if}}                    {{if item.infoType == 0 && item.isPrimary}}<li><div class="crm-phone">${item.data}&nbsp;<span class="text-medium-describe">(${item.categoryName})<\/span><\/div><\/li>{{/if}}                {{/each}}                {{if typeof (primaryAddress) != "undefined" && primaryAddress != null}}<li><div class="crm-address">{{html primaryAddress.Data}}&nbsp;<span class="text-medium-describe">(${primaryAddress.categoryName})<\/span><br/><a class="linkMedium" style="text-decoration: underline;" href="${primaryAddress.Href}" target="_blank">${ASC.CRM.Resources.CRMContactResource.ShowOnMap}<\/a><\/div><\/li>{{/if}}<\/ul>{{/if}}<\/div><\/div>'),function(n){var t=ASC.Resources.Master.Resource,i=Teamlab,r=function(t,i){this.$element=n(t);this.options=n.extend({},n.fn.projectadvancedSelector.defaults,i);this.init()};r.prototype=n.extend({},n.fn.advancedSelector.Constructor.prototype,{constructor:r,initCreationBlock:function(){var n=this,r={},u=[],f;r.newoptions=[{title:t.SelectorTitle,type:"input",tag:"title"},{title:t.SelectorManager,type:"select",tag:"manager"}];r.newbtn=t.CreateButton;n.displayAddItemBlock.call(n,r);f={employeeStatus:1,employeeType:1};i.getProfilesByFilter({},{before:function(){n.showLoaderSimpleSelector.call(n,"manager")},filter:f,success:function(r,f){for(var e=0,o=f.length;e<o;e++)f[e].id==i.profile.id?u.unshift({title:t.MeLabel,id:f[e].id}):u.push({title:f[e].displayName,id:f[e].id});n.initDataSimpleSelector.call(n,{tag:"manager",items:u});n.hideLoaderSimpleSelector.call(n,"manager")},error:function(n,t){toastr.error(t)}})},initAdvSelectorData:function(){},rewriteObjectItem:function(n){var t=this;t.items=n.map(function(n){return{id:n.id,title:n.title,description:n.description,isPrivate:n.isPrivate,responsible:n.responsible,deadline:n.deadline}});t.items=t.items.sort(t.options.sortMethod||SortData);t.showItemsListAdvSelector.call(t)},createNewItemFn:function(){var n=this,r=n.$advancedSelector.find(".advanced-selector-add-new-block"),e=r.find(".advanced-selector-btn-add"),u,f={title:r.find(".title input").val().trim(),responsibleid:r.find(".manager input").attr("data-id"),notify:!1,description:"",tags:"",private:!1};if(f.title||(n.showErrorField.call(n,{field:r.find(".title"),error:t.ProjectSelectorEmptyTitleError}),u=!0),f.responsibleid||(n.showErrorField.call(n,{field:r.find(".manager"),error:t.ProjectSelectorEmptyManagerError}),u=!0),!f.responsibleid&&r.find(".manager input").val()&&(n.showErrorField.call(n,{field:r.find(".manager"),error:t.ProjectSelectorNotPersonError}),u=!0),u){r.find(".error input").first().focus();return}i.addPrjProject({},f,{before:function(){n.displayLoadingBtn.call(n,{btn:e,text:t.LoadingProcessing})},error:function(t,i){n.showServerError.call(n,{field:e,error:i})},success:function(t,i){i=this.__responses[0];var r={id:i.id,title:i.title};n.actionsAfterCreateItem.call(n,{newitem:r,response:i})},after:function(){n.hideLoadingBtn.call(n,e)}})}});n.fn.projectadvancedSelector=function(t){var i=Array.prototype.slice.call(arguments,1);return this.each(function(){var f=n(this),u=f.data("projectadvancedSelector"),e=n.extend({},n.fn.projectadvancedSelector.defaults,f.data(),typeof t=="object"&&t);u||f.data("projectadvancedSelector",u=new r(this,e));typeof t=="string"&&u[t].apply(u,i)})};n.fn.projectadvancedSelector.defaults=n.extend({},n.fn.advancedSelector.defaults,{showme:!0,addtext:t.ProjectSelectorAddText,noresults:t.ProjectSelectorNoResult,noitems:t.ProjectSelectorNoItems,emptylist:t.ProjectSelectorEmptyList})}(jQuery);
/*!
	Autosize 3.0.17
	license: MIT
	http://www.jacklmoore.com/autosize
*/
!function(n,t){if("function"==typeof define&&define.amd)define(["exports","module"],t);else if("undefined"!=typeof exports&&"undefined"!=typeof module)t(exports,module);else{var i={exports:{}};t(i.exports,i);n.autosize=i.exports}}(this,function(n,t){"use strict";function f(n){function l(){var r=window.getComputedStyle(n,null);"vertical"===r.resize?n.style.resize="none":"both"===r.resize&&(n.style.resize="horizontal");i="content-box"===r.boxSizing?-(parseFloat(r.paddingTop)+parseFloat(r.paddingBottom)):parseFloat(r.borderTopWidth)+parseFloat(r.borderBottomWidth);isNaN(i)&&(i=0);t()}function f(t){var i=n.style.width;n.style.width="0px";n.offsetWidth;n.style.width=i;n.style.overflowY=t;e()}function a(n){for(var t=[];n&&n.parentNode&&n.parentNode instanceof Element;)n.parentNode.scrollTop&&t.push({node:n.parentNode,scrollTop:n.parentNode.scrollTop}),n=n.parentNode;return t}function e(){var u=n.style.height,f=a(n),t=document.documentElement&&document.documentElement.scrollTop,r;return n.style.height="auto",r=n.scrollHeight+i,0===n.scrollHeight?void(n.style.height=u):(n.style.height=r+"px",o=n.clientWidth,f.forEach(function(n){n.node.scrollTop=n.scrollTop}),void(t&&(document.documentElement.scrollTop=t)))}function t(){var u;e();var t=window.getComputedStyle(n,null),i=Math.round(parseFloat(t.height)),o=Math.round(parseFloat(n.style.height));(i!==o?"visible"!==t.overflowY&&f("visible"):"hidden"!==t.overflowY&&f("hidden"),s!==i)&&(s=i,u=r("autosize:resized"),n.dispatchEvent(u))}if(n&&n.nodeName&&"TEXTAREA"===n.nodeName&&!u.has(n)){var i=null,o=n.clientWidth,s=null,h=function(){n.clientWidth!==o&&t()},c=function(i){window.removeEventListener("resize",h,!1);n.removeEventListener("input",t,!1);n.removeEventListener("keyup",t,!1);n.removeEventListener("autosize:destroy",c,!1);n.removeEventListener("autosize:update",t,!1);u["delete"](n);Object.keys(i).forEach(function(t){n.style[t]=i[t]})}.bind(n,{height:n.style.height,resize:n.style.resize,overflowY:n.style.overflowY,overflowX:n.style.overflowX,wordWrap:n.style.wordWrap});n.addEventListener("autosize:destroy",c,!1);"onpropertychange"in n&&"oninput"in n&&n.addEventListener("keyup",t,!1);window.addEventListener("resize",h,!1);n.addEventListener("input",t,!1);n.addEventListener("autosize:update",t,!1);u.add(n);n.style.overflowX="hidden";n.style.wordWrap="break-word";l()}}function e(n){if(n&&n.nodeName&&"TEXTAREA"===n.nodeName){var t=r("autosize:destroy");n.dispatchEvent(t)}}function o(n){if(n&&n.nodeName&&"TEXTAREA"===n.nodeName){var t=r("autosize:update");n.dispatchEvent(t)}}var u="function"==typeof Set?new Set:function(){var n=[];return{has:function(t){return Boolean(n.indexOf(t)>-1)},add:function(t){n.push(t)},"delete":function(t){n.splice(n.indexOf(t),1)}}}(),r=function(n){return new Event(n)},i;try{new Event("test")}catch(s){r=function(n){var t=document.createEvent("Event");return t.initEvent(n,!0,!1),t}}i=null;"undefined"==typeof window||"function"!=typeof getComputedStyle?(i=function(n){return n},i.destroy=function(n){return n},i.update=function(n){return n}):(i=function(n,t){return n&&Array.prototype.forEach.call(n.length?n:[n],function(n){return f(n,t)}),n},i.destroy=function(n){return n&&Array.prototype.forEach.call(n.length?n:[n],e),n},i.update=function(n){return n&&Array.prototype.forEach.call(n.length?n:[n],o),n});t.exports=i}),function(){function h(t){return typeof t=="string"&&(t=n.getElementById(t)),t}function t(n,t,r){if(i.addEventListener)n&&n.addEventListener(t,r,!1);else if(i.attachEvent){var u=function(){r.call(n,i.event)};n&&n.attachEvent("on"+t,u)}}function c(n,t){return n.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))}function l(n,t){c(n,t)||(n.className+=" "+t)}function f(n,t){var i=new RegExp("(\\s|^)"+t+"(\\s|$)");n.className=n.className.replace(i," ")}function a(n){var t,u,i,f,e=r(n);return t=e.left,i=e.top,u=t+n.offsetWidth,f=i+n.offsetHeight,{left:t,right:u,top:i,bottom:f}}function v(t){var i,r,u;return!t.pageX&&t.clientX?(i=1,r=document.body,r.getBoundingClientRect&&(u=r.getBoundingClientRect(),i=(u.right-u.left)/r.clientWidth),{x:t.clientX/i+n.body.scrollLeft+n.documentElement.scrollLeft,y:t.clientY/i+n.body.scrollTop+n.documentElement.scrollTop}):{x:t.pageX,y:t.pageY}}function o(n){return n.replace(/.*(\/|\\)/,"")}function s(n){return/[.]/.exec(n)?/[^.]+$/.exec(n.toLowerCase()):""}var n=document,i=window,u=function(){var t=n.createElement("div");return function(n){t.innerHTML=n;var i=t.childNodes[0];return t.removeChild(i),i}}(),r,e;r=document.documentElement.getBoundingClientRect?function(n){var f=n.getBoundingClientRect(),e=n.ownerDocument,i=e.body,r=e.documentElement,o=r.clientTop||i.clientTop||0,s=r.clientLeft||i.clientLeft||0,t=1,u,h,c;return i.getBoundingClientRect&&(u=i.getBoundingClientRect(),t=(u.right-u.left)/i.clientWidth),t>1&&(o=0,s=0),h=f.top/t+(window.pageYOffset||r&&r.scrollTop/t||i.scrollTop/t)-o,c=f.left/t+(window.pageXOffset||r&&r.scrollLeft/t||i.scrollLeft/t)-s,{top:h,left:c}}:function(n){if(i.jQuery)return jQuery(n).offset();var t=0,r=0;do t+=n.offsetTop||0,r+=n.offsetLeft||0;while(n=n.offsetParent);return{left:r,top:t}};e=function(){var n=0;return function(){return"ValumsAjaxUpload"+n++}}();Ajax_upload=AjaxUpload=function(t,i){var r,u;t.jquery?t=t[0]:typeof t=="string"&&/^#.*/.test(t)&&(t=t.slice(1));t=h(t);this._input=null;this._button=t;this._disabled=!1;this._submitting=!1;this._justClicked=!1;this._parentDialog=n.body;this._isInPopup=!1;window.jQuery&&jQuery.ui&&jQuery.ui.dialog&&(r=jQuery(this._button).parents(".ui-dialog"),r.length&&(this._parentDialog=r[0]));this._settings={action:"upload.php",name:"userfile",id:null,title:"",data:{},autoSubmit:!0,responseType:!1,onChange:function(){},onSubmit:function(){},onComplete:function(){}};for(u in i)this._settings[u]=i[u];this._settings.parentDialog&&(this._parentDialog=this._settings.parentDialog);this._settings.isInPopup&&(this._isInPopup=this._settings.isInPopup);this._createInput();this._rerouteClicks()};AjaxUpload.prototype={setData:function(n){this._settings.data=n},disable:function(){this._disabled=!0},enable:function(){this._disabled=!1},destroy:function(){this._input&&(this._input.parentNode&&this._input.parentNode.removeChild(this._input),this._input=null)},_createInput:function(){var r=this,i=n.createElement("input"),u,f;i.setAttribute("type","file");i.setAttribute("name",this._settings.name);i.setAttribute("class","fileuploadinput"+(this._settings.name==="userfile"?"":this._settings.name));i.setAttribute("title",this._settings.title);u={position:"absolute",margin:"-5px 0 0 -175px",padding:0,width:"220px",height:"30px",fontSize:"14px",opacity:0,cursor:"pointer",display:"none",zIndex:2147483583};for(f in u)i.style[f]=u[f];i.style.opacity==="0"||(i.style.filter="alpha(opacity=0)");this._parentDialog.appendChild?this._parentDialog.appendChild(i):this._parentDialog.append(i);t(i,"change",function(){r.justClicked=!1;var n=o(this.value);r._settings.onChange.call(r,n,s(n))!=!1&&r._settings.autoSubmit&&r.submit()});/safari/i.test(navigator.userAgent)&&!window.chrome&&t(i,"click",function(){r.justClicked=!0;setTimeout(function(){r.justClicked=!1},3e3)});this._input=i},_rerouteClicks:function(){var i=this,u,e={top:0,left:0},o=!1;t(i._button,"mouseover",function(){i._input&&!o&&(o=!0,u=a(i._button),i._parentDialog!=n.body&&(i._isInPopup?(e.top=jq(i._button).offset().top-jq(i._button).position().top,e.left=jq(i._button).offset().left-jq(i._button).position().left):e=r(i._parentDialog)))});t(document,"mousemove",function(n){var t=i._input,r;if(!t||!o){!t||o||t.style.display=="none"||i.justClicked||(t.style.display="none");return}if(i._disabled){f(i._button,"hover");t.style.display="none";return}r=v(n);r.x>=u.left&&r.x<=u.right&&r.y>=u.top&&r.y<=u.bottom?(t.style.top=r.y-e.top+"px",t.style.left=r.x-e.left+"px",t.style.display="block",l(i._button,"hover")):(o=!1,i.justClicked||(t.style.display="none"),f(i._button,"hover"))})},_createIframe:function(){var i=e(),t=u('<iframe src="javascript:false;" name="'+i+'" />');return t.id=i,t.style.display="none",n.body.appendChild(t),t},submit:function(){var h=this,u=this._settings,f,i,r,e;this._input.value!==""&&(f=o(this._input.value),u.onSubmit.call(this,f,s(f))==!1?(n.body.removeChild(this._input),this._input=null,this._createInput()):(i=this._createIframe(),r=this._createForm(i),r.appendChild(this._input),r.submit(),n.body.removeChild(r),r=null,this._input=null,this._createInput(),e=!1,t(i,"load",function(){var t,r;if(i.src=="javascript:'%3Chtml%3E%3C/html%3E';"||i.src=="javascript:'<html><\/html>';"){e&&setTimeout(function(){n.body.removeChild(i)},0);return}(t=i.contentDocument?i.contentDocument:frames[i.id].document,t.readyState&&t.readyState!="complete")||t.body&&t.body.innerHTML=="false"||(t.XMLDocument?r=t.XMLDocument:t.body?(r=t.body.innerHTML,u.responseType&&u.responseType.toLowerCase()=="json"&&(t.body.firstChild&&t.body.firstChild.nodeName.toUpperCase()=="PRE"&&(r=t.body.firstChild.firstChild.nodeValue),r=r?window.eval("("+r+")"):{})):r=t,u.onComplete.call(h,f,r),e=!0,i.src="javascript:'<html><\/html>';")})))},_createForm:function(t){var f=this._settings,i=u('<form method="post" enctype="multipart/form-data"><\/form>'),e,r;i.style.display="none";i.action=f.action;i.target=t.name;n.body.appendChild(i);for(e in f.data)r=n.createElement("input"),r.type="hidden",r.name=e,r.value=f.data[e],i.appendChild(r);return i}}}();String.prototype.trim||(String.prototype.trim=function(){return jq.trim(arguments.length?arguments[0]:"")});jQuery.extend({getAnchorParam:function(n,t){var r=new RegExp("[#&]"+n+"=([^&]*)"),i=r.exec("#"+t);return i==null?"":i[1]},hasParam:function(n,t){var i=new RegExp("(\\#|&|^)"+n+"=","g");return i.test(t)},removeParam:function(n,t){var i=new RegExp("[#&]"+n+"=([^&]*)");return t.replace(i,"")},addParam:function(n,t,i){return n.length&&(n+="&"),n+t+"="+i},changeParamValue:function(n,t,i){if(jq.hasParam(t,n)){var r=new RegExp(t+"[=][0-9a-z-]*");return n.replace(r,t+"="+i)}return jq.addParam(n,t,i)},format:function(n){var i,t;if(arguments.length<=1)return n;for(i=arguments.length-2,t=0;t<=i;++t)n=n.replace(new RegExp("\\{"+t+"\\}","gi"),arguments[t+1]);return n},timeFormat:function(n){var i=Math.floor(parseFloat(n)),t=Math.round((parseFloat(n)-i)*60);return t<10?t="0"+t:t==60&&(t="00",i=i+1),i+":"+t}});jQuery.fn.swap=function(n){n=jQuery(n)[0];var t=this[0],i=t.cloneNode(!0),u=n.cloneNode(!0),r=this;return t.parentNode.replaceChild(u,t),n.parentNode.replaceChild(i,n),r[0]=i,this.pushStack(r)};Array.prototype.find||(Array.prototype.find=function(n){var t;if(this==null)throw new TypeError("Array.prototype.find called on null or undefined");if(typeof n!="function")throw new TypeError("predicate must be a function");var i=Object(this),u=i.length>>>0,f=arguments[1],r;for(t=0;t<u;t++)if(r=i[t],n.call(f,r,t,i))return r;return undefined});String.prototype.contains||(String.prototype.contains=function(){return String.prototype.indexOf.apply(this,arguments)!==-1});Array.prototype.findIndex||(Array.prototype.findIndex=function(n){var t;if(this==null)throw new TypeError("Array.prototype.findIndex called on null or undefined");if(typeof n!="function")throw new TypeError("predicate must be a function");var i=Object(this),u=i.length>>>0,f=arguments[1],r;for(t=0;t<u;t++)if(r=i[t],n.call(f,r,t,i))return t;return-1});ASC.Projects.Tab=function(n,t,i,r,u,f,e){this.title=n;this.count=t;this.divID=i;this.$container=r;this.selected=u?u.indexOf("#")===0?location.href.endsWith(u):location.href.indexOf(u)>0:!1;this.link=u;this.isVisibleSelector=f;this.emptyScreen=e};ASC.Projects.Tab.prototype.select=function(){var i,n,t,r;if(this.selected=!0,i=this,n=jq("#emptyScrCtrlPrj"),this.count()===0&&this.emptyScreen){this.$container.hide();n.html(jq.tmpl("projects_emptyScreen",this.emptyScreen)).show();t=n.find(".addFirstElement");t.off("click").on("click",function(){n.hide();i.$container.show();i.emptyScreen.button.onclick()});r=ASC.Controls.AnchorController.getAnchor();r==this.emptyScreen.button.hash&&t.length>0&&t.click()}else this.$container&&(n.hide(),this.$container.show());this.link.indexOf("#")===0&&(location.hash=this.link);this.rewrite()};ASC.Projects.Tab.prototype.unselect=function(){this.selected=!1;this.$container&&this.$container.hide();this.rewrite()};ASC.Projects.Tab.prototype.rewrite=function(){this.getDiv().replaceWith(jq.tmpl("projects_tabsNavigatorItem",this))};ASC.Projects.Tab.prototype.getDiv=function(){return jq("#"+this.divID+"_tab")};ASC.Projects.ProjectTab=function(n,t,i,r,u,f,e){this.href=r?r+"?prjID="+n.id:"";this.onclick=f;ASC.Projects.Tab.call(this,t,i,u,undefined,r,e)};ASC.Projects.ProjectTab.prototype=new ASC.Projects.Tab;ASC.Projects.DescriptionTab=function(){function u(){return t=this,n={data:[],status:{items:[],current:{},canChange:!1}},i=jq(".tab"),t}function f(){var u,f;if(i.html(jq.tmpl("projects_description",n)),r(),u=n.status.items,u.length){f=i.find(".status");f.advancedSelector({height:26*u.length,itemsChoose:u,itemsSelectedIds:[n.status.current.id],showSearch:!1,onechosen:!0,sortMethod:function(){return 0}});f.on("showList",function(n,t){var i=u.find(function(n){return n.id==t.id});i.handler()})}return t}function r(){i.show()}function e(){i.hide()}function o(i,r,u,f){return n.data.push({title:i,value:r,href:u,wrapper:f}),t}function s(i,r,u){return n.status.items.push({title:i,handler:u,id:r.toString()}),t}function h(i){return n.status.current=n.status.items.find(function(n){return n.id==i}),t}function c(n){var r=i.find(".status");return r.advancedSelector("select",[n.toString()]),t}function l(i){return n.status.canChange=i,t}var n,i,t;return{init:u,push:o,pushStatus:s,resetStatus:c,setStatusRight:l,setCurrentStatus:h,tmpl:f,show:r,hide:e}}();ASC.Projects.TabCollection=function(){function r(r){var u,f;i=r;u=i.filter(function(n){return typeof n.isVisibleSelector=="function"?n.isVisibleSelector():!0});t=jq("#projectTabs");t.html(jq.tmpl("projects_tabsNavigator",{tabs:u})).show();t.off("click").on("click",".tabsNavigationLink",function(t){var r=jq(this).attr("id"),i=u.find(function(n){return n.divID+"_tab"===r});if(i)return(n.unselect(),i.select(),n=i,typeof n.onclick=="function")?n.onclick.call(this,{id:n.getDiv(),href:n.getDiv().attr("href")},t):!0});f=u.some(function(n){return n.selected});f||(u[0].selected=!0);u.forEach(function(n){n.selected?n.select():n.unselect()});n=u.find(function(n){return n.selected})}var i,n,t;return{init:r}}();ASC.Projects.InfoContainer=function(){var t=".project-info-container",n,i=function(i,r,u){jq(t).replaceWith(jq.tmpl("projects_navPanel",i));n=jq(t);ASC.Projects.Base.initActionPanel(r&&r().menuItems.length>0?r:undefined,n);u&&ASC.Projects.TabCollection.init(u);n.show()},r=function(t){n.find("#essenceTitle").attr("title",t).text(t)};return{init:i,updateTitle:r}}();ASC.Projects.ActionMenuItem=function(n,t,i){this.id=n;this.text=t;this.handler=i};ASC.Projects.DescriptionPanel=function(){function e(n,t,i){if(i){o(n,t);n.on("mouseenter",i.selector,function(n){var r=jq(n.target),t=i.getItem(n.target);s(t,r,i.getLink?i.getLink(t):undefined)});n.on("mouseleave",i.selector,function(){u(!1)})}}function o(t,r){if(!n){t.append(jq.tmpl("projects_panelFrame",{panelId:"descrPanel"}));n=jq("#descrPanel");n.on("mouseenter",function(){i=!0});n.on("mouseleave",function(){i=!1;u()});n.on(f,".project .value",function(){u(!1);r.add("project",jq(this).attr("projectId"),["tag","milestone","myprojects"])});n.on(f,".milestone .value",function(){r.add("milestone",jq(this).attr("milestone"))})}}function s(u,f,e){if(typeof u!="undefined"&&!(r>0)){r=setTimeout(function(){var l=n.find(".panel-content"),r={},c=u.displayDateCrtdate||u.created,o=u.description,s="",a=jq.getURLParam("prjID")?undefined:u.projectId;typeof u.createdBy!="undefined"&&(s=typeof u.createdBy=="string"?u.createdBy:u.createdBy.displayName);t(c)&&(r.creationDate=c);t(o)&&(r.description=o,e&&(o.indexOf("\n")>2||o.length>80)&&(r.readMore=e));t(a)&&(r.project=jq.htmlEncodeLight(u.projectTitle),r.projectId=u.projectId);t(s)&&(r.createdBy=Encoder.htmlEncode(s));t(u.displayDateUptdate)&&(u.statusname==="closed"||u.status==="closed"||u.status===2)&&(r.closedDate=u.displayDateUptdate.substr(0,10),t(u.updatedBy)&&(r.closedBy=Encoder.htmlEncode(u.updatedBy.displayName)));t(u.displayDateStart)&&(r.startDate=u.displayDateStart);t(u.milestone)&&(r.milestone=Encoder.htmlEncode("["+u.milestone.displayDateDeadline+"] "+u.milestone.title),r.milestoneId=u.milestone.id);l.html(jq.tmpl("projects_descriptionPanelContent",r));h(f);i=!0},500,this);return}}function u(t){r<=0||typeof n=="undefined"||(i=t,setTimeout(function(){i||(n.hide(),clearTimeout(r),r=-1)},50))}function t(n){return typeof n!="undefined"&&jq.trim(n)!=""&&n!=null}function h(t){var i=t.offset();(i.top||i.left)&&(n.css({left:i.left,top:i.top+t.parent().height()/2}),n.show())}var n,i,r,f="click";return{init:e,hide:u}}();ASC.Projects.Event=function(n,t){return{event:n,handler:t}};ASC.Projects.EventBinder=function(){function i(i){i&&Array.isArray(i)&&(n=i.map(function(n){return t.bind(n.event,n.handler)}))}function r(){while(n.length){var i=n.shift();t.unbind(i)}}var t=Teamlab,n=[];return{bind:i,unbind:r}}();ASC.Projects.GroupActionPanel=function(){function it(y,w){var nt,ut,ft,it,rt,et;for(r=w,u=y.actions,n=0,b=y.getItemByCheckbox,i&&i.remove(),e=jq("#groupActionContainer"),e.append(jq.tmpl(tt,y)),i=jq("#groupActionMenu"),nt=u.length-1;nt>=0;nt--){ut=function(n){return function(){jq(this).hasClass(c)&&n.handler(g().map(function(n){return n.id}))}}(u[nt]);jq("#"+u[nt].id).on("click",ut)}if(o=i?i.find(".menu-action-checked-count"):[],i){ft={menuSelector:"#groupActionMenu",menuAnchorSelector:"#selectAll",menuSpacerSelector:"#CommonListContainer .header-menu-spacer",userFuncInTop:function(){i.find(v).hide()},userFuncNotInTop:function(){i.find(v).show()}};ScrolledGroupMenu.init(ft);t=jq("#selectAll");t.off(h).on(h,function(){jq("#groupActionMenuSelector").hide();var i=r.find(".checkbox input"),u=r.find("tr");return t.is(":"+f)&&n===0?(n=i.length,i.each(function(n,t){t.checked=!0}),u.addClass(s),d(),a()):l(),!1});jq("#deselectAll").off(p).on(p,function(){l()})}r.off(h+".ga").on(h+".ga",".checkbox input",k);if(it=y.multiSelector,it)for(jq.dropdownToggle({switcherSelector:"#groupActionContainer .menuActionSelectAll",dropdownID:"groupActionMenuSelector",anchorSelector:".menuActionSelectAll",position:"fixed",simpleToggle:!0}),rt=it.length-1;rt>=0;rt--){et=function(n){return function(){l();var t=y.getLineByCondition(n.condition);t.forEach(function(n){var t=n.find(".checkbox input[type='checkbox']");t.prop("checked","checked");k.call(t)})}}(it[rt]);jq("#"+it[rt].id).on("click",et)}}function k(){var i=jq(this),u=r.find(".checkbox input").length;i.is(":"+f)?(n++,i.parents(y).addClass(s),n===u&&t.prop(f,!0)):(n--,i.parents(y).removeClass(s),t.prop(f,!1));n>0?d():nt();t.prop(w,n>0&&!t.prop(f));a()}function l(){var i=r.find(".checkbox input"),u=r.find("tr");n=0;i.each(function(n,t){t.checked=!1});u.removeClass(s);nt();a();t.prop(w,!1);t.prop(f,!1)}function a(){n>0?(o.show(),o.find("span").text(n+" "+ASC.Projects.Resources.ProjectsJSResource.GroupMenuSelectedItems)):o.hide()}function d(){for(var n,i=g(),t=u.length;t--;)n=u[t],i.every(n.checker)?jq("#"+n.id).addClass(c):jq("#"+n.id).removeClass(c)}function g(){var n=r.find(".checkbox input:checked").toArray();return n.map(b)}function nt(){for(var t,n=u.length;n--;)t=u[n],jq("#"+t.id).removeClass(c)}function rt(){e&&e.hide()}var e,i,t,r,n=0,tt="projects_groupActionMenu",o,f="checked",s="checked-row",v=".menu-action-on-top",y=".with-checkbox",h="change",p="click",c="unlockAction",w="indeterminate",u,b;return{init:it,hide:rt,deselectAll:l}}();ASC.Projects.StatusList=function(){function s(f,s){var l,c,a;if(f){t=f;l="#statusChangePanel";i=s;jq(l).remove();i.append(jq.tmpl("projects_statusChangePanel",f));n=jq(l);i.on(o,u,h);for(c=0;c<f.statuses.length;c++){a=function(n){return function(){t.handler(r,n)}}(f.statuses[c].id);jq("#statusItem_"+f.statuses[c].id).on("click",a)}jq("body").off("click.body3").on("click.body3",function(){setTimeout(function(){e()},1)})}}function h(){var i=t.getItem(this),c=n.is(":visible"),u=jq(this),o=i.id,s=typeof i.status!="undefined"?i.status:i.paymentStatus,h=u.offset();if(e(),r!==o||!c)return r=o,u.addClass("selected"),n.css({left:h.left,top:h.top+28}),n.find("li").show().removeClass(f),n.find("#statusItem_"+s).addClass(f),s===1&&n.find(".paused").hide(),n.show(),!1}function e(){n&&n.hide();i.find(u).removeClass("selected")}function c(n){return t.statuses.find(function(t){return n===t.id})}var o="click",u=".changeStatusCombobox.canEdit",r,f="active",t,n,i;return{init:s,getById:c}}();typeof ASC=="undefined"&&(ASC={});typeof ASC.Projects=="undefined"&&(ASC.Projects={});ASC.Projects.Common=function(){function p(){!h&&jq(".mobileApp-banner").length&&(h=!0,jq(".mobileApp-banner_btn.app-store").trackEvent("mobileApp-banner","action-click","app-store"),jq(".mobileApp-banner_btn.google-play").trackEvent("mobileApp-banner","action-click","google-play"))}function w(){s||(s=!0,typeof t!="undefined"?(typeof t.Projects!="undefined"&&t.Projects!=null&&(t.Projects=r.create("prj-projects",null,t.Projects.response)),typeof t.Tags!="undefined"&&t.Tags!=null&&(t.Tags=t.Tags.response),typeof t.Team!="undefined"&&t.Team!=null&&(t.TeamWithBlockedUsers=r.create("prj-projectpersons",null,t.Team.response),t.Team=n.Common.removeBlockedUsersFromTeam(t.TeamWithBlockedUsers)),typeof t.Milestones!="undefined"&&t.Milestones!=null&&(t.Milestones=r.create("prj-milestones",null,t.Milestones.response),t.Milestones=t.Milestones.sort(v))):ASC.Projects.Master={})}function b(){var f=jq.getURLParam("action"),h=jq.getURLParam("id"),c=jq.getURLParam("prjID"),e=location.href,s=document.location.pathname.match(/[^\/]+$/),l=n.Resources.StartModules,v,a;Teamlab.profile.isVisitor&&(l=n.Resources.StartModules=l.filter(function(n){return n.StartModuleType!==3}));s===null?(v=l.find(function(n){return n.StartModuleType===t.StartModuleType})||l[0],s=t.Projects.length!==0?v.Page:"projects.aspx",e=document.location.pathname+s,history.pushState({href:e},{href:e},e)):s=s[0].toLowerCase();k();o(n.TaskAction);o(n.MilestoneAction);jq.getURLParam("prjId")&&e.indexOf("ganttchart.aspx")==-1&&e.indexOf("timer.aspx")==-1?n.projectNavPanel.init():n.projectNavPanel.hide();o(n.navSidePanel);switch(s){case"tasks.aspx":i=h?n.TaskDescriptionPage:n.TasksManager;break;case"messages.aspx":f&&(i=n.DiscussionAction,ckeditorConnector.load(function(){n.Common.ckEditor=jq("#ckEditor").ckeditor({toolbar:"PrjMessage",extraPlugins:"oembed,teamlabcut,codemirror",removePlugins:"div",filebrowserUploadUrl:"fckuploader.ashx?newEditor=true&esid=projects_comments"}).editor;n.Common.ckEditor.on("change",i.showHidePreview)}));h&&f==null&&(i=n.DiscussionDetails);h==null&&f==null&&(i=n.Discussions);break;case"milestones.aspx":i=n.AllMilestones;break;case"projects.aspx":f==null?i=c==null?n.AllProject:n.Description:(i=n.ProjectAction,jq(".mainPageContent").children(".loader-page").hide());jq("#projectTitleContainer .inputTitleContainer").css("width","100%");f=="edit"&&(jq(".dottedHeader").removeClass("dottedHeader"),jq("#projectDescriptionContainer").show(),jq("#notifyManagerCheckbox").attr("disabled","disabled"),jq("#projectTagsContainer").show());break;case"projectteam.aspx":i=n.ProjectTeam;break;case"timer.aspx":i=n.TimeTraking;break;case"timetracking.aspx":n.TimeTrakingEdit.init();i=n.TimeSpendActionPage;break;case"projecttemplates.aspx":i=n.Templates;break;case"generatedreport.aspx":i=n.GeneratedReportView;break;case"reports.aspx":i=n.ReportView;break;case"contacts.aspx":i=n.Contacts;break;case"import.aspx":i=n.Import;break;case"ganttchart.aspx":i=n.GantChartPage}i&&i.hasOwnProperty("init")&&i.init();h===null&&f===null&&c&&(a=u[Number(c)],typeof a!="undefined"?r.call(r.events.getPrjProject,this,[null,a]):(r.bind(r.events.getPrjProject,function(n,t){u[t.id]=t}),r.getPrjProject({},c)))}function k(){location.href.indexOf("ganttchart.aspx")>0||typeof i!="undefined"&&typeof i.unbindListEvents=="function"&&i.unbindListEvents()}function o(n){n&&n.hasOwnProperty("init")&&n.init()}function d(){e.length||(e.push(r.bind(r.events.getException,function(n,t){t&&t[0]=="unauthorized request"&&(window.location="/auth.aspx")})),e.push(r.bind(r.events.updatePrjProjectStatus,function(n,i){f=[];i.status===0?typeof y(i.id)=="undefined"&&t.Projects.push(i):t.Projects=t.Projects.filter(function(n){return n.id!==i.id});u[i.id]=i})))}function g(){function u(n,t,i){return{image:n,title:t,ul:i}}function f(t,i){var r,e,f;if(i.canCreateProject){r=n.Resources.CommonResource;e={blocks:[u("icon-tasks.png",r.TasksModuleTitle,[r.TasksModuleFirstLine,r.TasksModuleSecondLine,r.TasksModuleThirdLine]),u("icon-milestones.png",r.MilestonesModuleTitle,[r.MilestonesModuleFirstLine,r.MilestonesModuleSecondLine,r.MilestonesModuleThirdLine]),u("icon-document.png",r.DocsModuleTitle,[r.DocsModuleFirstLine,r.DocsModuleSecondLine,r.DocsModuleThirdLine]),u("icon-discussion.png",r.DiscussionModuleTitle,[r.DiscussionModuleFirstLine,r.DiscussionModuleSecondLine,r.DiscussionModuleThirdLine]),u("icon-report.png",r.ReportsModuleTitle,[r.ReportsModuleFirstLine,r.ReportsModuleSecondLine,r.ReportsModuleThirdLine])]};jq.tmpl("projects_dashboard_empty_screen",e).appendTo("body");f=jq("#projects_dashboard_empty_screen_container");f.on("click",".close",function(){f.remove()});c=!0}}t.ProjectsCount!==0||c||i===n.ProjectAction||i===n.Import||i===n.GantChartPage||i===n.ReportView||i===n.Templates||r.getPrjSecurityinfo({},{success:f})}function ht(n,t,i){n.append(jq.tmpl("projects_panelFrame",{panelId:t}));var r=jq("#"+t);return r.find(".panel-content").html(jq.tmpl("projects_actionMenuContent",i)),r}function y(n){for(var i=0,r=t.Projects.length;i<r;i++)if(t.Projects[i].id==n)return t.Projects[i]}function ct(n){return u[n]}function lt(t,i){var r=u[t.projectOwner.id];if(r){switch(i){case 0:r.taskCount++;r.taskCountTotal++;break;case 1:t.status===2?r.taskCount--:r.taskCount++;break;case 2:t.status===1&&(r.taskCount--,r.taskCountTotal--)}n.projectNavPanel.rewriteTaskTab()}}function at(t,i){var r=u[t.projectId];if(r){switch(i){case 0:r.milestoneCount++;break;case 1:t.status===1?r.milestoneCount--:r.milestoneCount++;break;case 2:t.status===0&&r.milestoneCount--}n.projectNavPanel.rewriteMilestoneTab()}}function vt(t){var i=n.Resources;return t==0?"":t+" "+yt(t,i.MonthNominative,i.MonthGenitiveSingular,i.MonthGenitivePlural)}function yt(n,t,i,r){return n==.5&&ASC.Resources.Master.TwoLetterISOLanguageName==="ru"?i:n==1?t:pt(n,t,i,r)}function pt(n,t,i,r){var u,f;if(ASC.Resources.Master.TwoLetterISOLanguageName==="ru"){u=[2,0,1,1,1,2,2,2,2,2];n=Math.abs(n);f=u[(n%100/10!=1?1:0)*(n%10)];switch(f){case 0:return t;case 1:return i;default:return r}}else return n===1?t:r}function wt(i){var f,u,e;return i&&i.originalEvent&&i.originalEvent.ctrlKey?!0:(f=jq(this),u=f.attr("href"),ASC.Projects.Common.UpLink=location.href,history.pushState({href:u},{href:u},u),ASC.Controls.AnchorController.historyCheck(),e=jq.getURLParam("prjID"),r.getPrjTeam({},e,function(i,r){t.Team=r;n.Base.clearTables();jq("#filterContainer").hide();l()}),!1)}var s=!1,h=!1,n=ASC.Projects,r=Teamlab,i,f=[],u=[],c=!1,e=[],t=n.Master,l=function(){p();w();d();b();g()},nt=function(n){return n.filter(function(n){return n.status==1})},tt=function(){i.onDeleteComment()},it=function(n,t,i){var s=288,u=638,o=jq.browser,e;o.safari?u=584:o.opera&&(u=620);o.msie&&(s=284,u=614);o.chrome&&(u=658);var h="width="+s+",height="+u+",resizable=yes",c="displayTimerWindow",r=null,f=!1;try{r=window.open("",c,h)}catch(l){}try{f=!r||typeof r.ASC=="undefined"?!1:!0}catch(l){f=!0}if(e="timer.aspx",n&&(e+="?prjID="+n,t&&(e+="&taskId="+t,i&&(e+="&userID="+i))),f||(r=window.open(e,c,h),f=!0),!f)return undefined;try{r&&r.focus()}catch(l){}},rt=function(n){return n.filter(function(n){return!n.isVisitor})},ut=function(n){return typeof t.Team=="undefined"?!1:t.Team.find(function(t){return t.id==n})},ft=function(){return r.profile.isAdmin||t.IsModuleAdmin},et=function(t,i,r,u,f){var o=n.Common,e=[-1,-1,-1,-1];return e[0]=o.linkTypeEnum.start_start,i&&u?(e[1]=o.linkTypeEnum.end_end,i<=r?e[3]=o.linkTypeEnum.end_start:u<=t?e[2]=o.linkTypeEnum.start_end:(f.invalidLink=!0,t<=r?e[3]=o.linkTypeEnum.end_start:e[2]=o.linkTypeEnum.start_end)):u?(e[2]=o.linkTypeEnum.start_end,u>t&&(f.invalidLink=!0)):i&&(e[3]=o.linkTypeEnum.end_start,i<r&&(f.invalidLink=!0)),e},ot=function(n,t){n!==""&&typeof n!="undefined"&&(t===!0?toastr.error(n):toastr.success(n))},st=function(){var o,n,u;if(f.length)return f;var r=[],e=[],i=t.Projects;if(!i)return[];for(o=i.length,n=0;n<o;n++)u={value:i[n].id,title:i[n].title,canCreateTask:i[n].canCreateTask,canCreateMilestone:i[n].canCreateMilestone},i[n].isInTeam?r.push(u):e.push(u);return r.length>0&&(r[r.length-1].classname="separator"),f=r.concat(e)},a=function(n,t,i){return i?n<t?-1:n>t?1:0:n<t?1:n>t?-1:0},v=function(n,t){var i=a(n.deadline,t.deadline);return i?i:a(n.title,t.title,!0)};return{chooseMonthNumeralCase:vt,createActionPanel:ht,currentUserIsModuleAdmin:ft,currentUserIsProjectManager:function(n){return t.Projects.some(function(t){return t.id==n&&t.responsibleId===r.profile.id})},displayInfoPanel:ot,emptyGuid:"00000000-0000-0000-0000-000000000000",events:{loadTags:"loadTags",loadProjects:"loadProjects",loadTeam:"loadTeam",loadMilestones:"loadMilestones"},excludeVisitors:rt,filterParamsForListProjects:{sortBy:"title",sortOrder:"ascending",status:"open",fields:"id,title,security,isPrivate,status,responsible"},filterParamsForListMilestones:{sortBy:"deadline",sortOrder:"descending",status:"open",fields:"id,title,deadline"},filterParamsForListTasks:{sortBy:"deadline",sortOrder:"ascending"},goToWithoutReload:wt,getPossibleTypeLink:et,getProjectsForFilter:st,getProjectById:y,getProjectByIdFromCache:ct,changeTaskCountInProjectsCache:lt,changeMilestoneCountInProjectsCache:at,baseInit:l,linkTypeEnum:{start_start:0,end_end:1,start_end:2,end_start:3},milestoneSort:v,removeBlockedUsersFromTeam:nt,removeComment:tt,showTimer:it,userInProjectTeam:ut}}();jq(document).ready(function(){ASC.Projects.Common.baseInit()});ASC.Projects.navSidePanel=function(){function hi(){if(t=jq.getURLParam("prjID"),h||(h=jq("#createNewDiscussion")),t!==null?h.attr("href","messages.aspx?action=add&prjID="+t):h.attr("href","messages.aspx?action=add"),!ii){Teamlab.bind(Teamlab.events.updatePrjProjectStatus,function(){ui()});i=Teamlab.profile.id;ii=!0;l=jq("#menuCreateNewButton");s=jq("#createNewButton");b=jq("#createNewTask");k=jq("#createNewMilestone");d=jq("#createNewTimer");c=jq("#menuTMDocs");a=jq("#menuMessages");v=jq("#menuTasks");g=jq("#menuMilestones");et=jq("#menuTimeTracking");ri=jq("#menuTemplates");nt=jq("#menuSettings");oi=jq("#menuImport");f=jq("#menuProjects");e=jq("#myProjectsConteiner");r=jq(".page-menu");tt=r.find("#menuMyProjects");ot=r.find("#menuFollowedProjects");st=r.find("#menuActiveProjects");ht=r.find("#menuMyMilestones");ct=r.find("#menuUpcomingMilestones");lt=r.find("#menuMyTasks");at=r.find("#menuUpcomingTasks");vt=r.find("#menuMyDiscussions");yt=r.find("#menuLatestDiscussion");dt();ci();ui();l.on("click",function(){return l.hasClass(pt)?!1:!0});b.click(function(){var n=ASC.Controls.AnchorController.getAnchor(),i=jq.getAnchorParam("responsible_for_milestone",n)||jq.getAnchorParam("tasks_responsible",n)||jq.getAnchorParam("project_manager",n)||jq.getAnchorParam("team_member",n)||jq.getAnchorParam("author",n),r={projectId:t||jq.getAnchorParam("project",n),milestoneId:jq.getAnchorParam("milestone",n)};return i&&(r.responsibles=[{id:i}]),ASC.Projects.TaskAction.showCreateNewTaskForm(r),s.hide(),!1});k.click(function(){return ASC.Projects.MilestoneAction.showNewMilestonePopup(),s.hide(),!1});d.click(function(){var i=jq(".menu-list").find(".menu-item."+rt).attr("id"),n=jq.getURLParam("ID");return t?(i==="menuTasks"||document.location.href.indexOf(ut)>0)&&n?w.showTimer(t,n):w.showTimer(t):w.showTimer(),s.hide(),!1});e.find(".expander").click(function(n){var t=jq(this).closest(".menu-sub-item");jq(t).hasClass(u)?jq(t).removeClass(u):jq(t).addClass(u);n.stopPropagation()})}}function dt(){var l,h;jq(".menu-list li.filter, li.menu-item, div.menu-item, li.menu-sub-item").removeClass(o);l=location.pathname.split("/");h=l[l.length-1].toLowerCase();t=jq.getURLParam("prjID");h==="tmdocs.aspx"&&(c.removeClass("none-sub-list"),c.addClass("sub-list open"),t?c.find("a").attr("href","tmdocs.aspx"):(c.find("a").attr("href","#"),c.addClass(o)));t&&(h=y);h===wt&&a.addClass(o);h===y&&(e.find("li[id="+t+"]").length?(f.addClass(u),e.addClass(si),e.find("li[id="+t+"]").addClass(o)):f.addClass(n),f.addClass(rt));h===kt&&g.addClass(o);h===bt&&v.addClass(o);h===ut&&et.addClass(o);h==="reports.aspx"&&jq("#menuReports").addClass(n);h==="projecttemplates.aspx"&&ri.addClass(n);h==="settings.aspx"&&(nt.hasClass("open")||nt.find(".expander").click(),nt.find(" .menu-sub-item:first").addClass(n));var p=jq(".menu-list").find(".menu-item."+n).attr("id"),s=document.location.hash,r=!1,w=location.href.indexOf(y),b=jq.getURLParam("action");!t&&!b&&w>0&&(s.indexOf("team_member="+i)>0?(e.length?tt.closest("div").addClass(n):tt.closest("li").addClass(n),r=!0):s.indexOf("followed=true")>0?(ot.parent("li").addClass(n),r=!0):s.indexOf("status=open")>0&&(st.parent("li").addClass(n),f.addClass(u),r=!0),r&&f.removeClass(n));p==="menuMilestones"&&(r=!1,s.indexOf("user_tasks="+i)>0&&s.indexOf("status=open")>0?(ht.parent("li").addClass(n),r=!0):s.indexOf("user_tasks="+i)>0&&s.indexOf("&deadlineStart=")>0&&(ct.parent("li").addClass(n),r=!0),r&&g.removeClass(n));p==="menuTasks"&&v.hasClass(u)&&(r=!1,s.indexOf("tasks_responsible="+i)>0&&s.indexOf("status=open")>0?(lt.parent("li").addClass(n),r=!0):s.indexOf("tasks_responsible="+i)>0&&s.indexOf("&deadlineStart=")>0&&(at.parent("li").addClass(n),r=!0),r&&v.removeClass(n));p=="menuMessages"&&a.hasClass(u)&&(r=!1,s.indexOf("author="+i)>0?(vt.parent("li").addClass(n),r=!0):s.indexOf("createdStart=")>0&&(yt.parent("li").addClass(n),r=!0),r&&a.removeClass(n))}function ci(){var t=new Date,n=new Date(t.getFullYear(),t.getMonth(),t.getDate()),h=n.getTime(),s,c,o,l,r,y;n.setDate(n.getDate()+7);s=n.getTime();n=new Date(t.getFullYear(),t.getMonth(),t.getDate());c=n.getTime();n.setDate(n.getDate()-7);var w=n.getTime(),u=".category-wrapper a",b=[ft(f.find(u)),ft(tt,"team_member="+i+"&status=open"),ft(ot,"status=open&followed=true"),ft(st,"status=open"),gt(g.find(u)),gt(ht,"user_tasks="+i+"&status=open"),gt(ct,"user_tasks="+i+"&deadlineStart="+h+"&deadlineStop="+s),ni(v.find(u)),ni(lt,"tasks_responsible="+i+"&status=open"),ni(at,"tasks_responsible="+i+"&deadlineStart="+h+"&deadlineStop="+s),ti(a.find(u)),ti(yt,"createdStart="+w+"&createdStop="+c),ti(vt,"author="+i),p(et.find("a"),ut)];if(jq.getURLParam("id")==null||location.href.contains("messages.aspx")&&!location.href.contains("action")||location.href.contains("tasks.aspx"))for(li(b),o=e.find("li a"),l=function(){return function(){return fi()?(ASC.Projects.Common.goToWithoutReload.call(this),dt(),!1):!0}},r=0,y=o.length;r<y;r++)jq(o[r]).on("click",l(o[r]))}function ft(n,t){return p(n,y,it.AllProject.basePath,t)}function gt(n,t){return p(n,kt,it.AllMilestones.basePath,t)}function ni(n,t){return p(n,bt,it.TasksManager.basePath,t)}function ti(n,t){return p(n,wt,it.Discussions.basePath,t)}function p(n,t,i,r){var u=t;return r&&(u+="#"+i+"&"+r),{id:n,href:u,onclick:dt}}function li(n){n.forEach(function(n){n.id.attr("href",n.href);n.id.on("click",function(t){return ei.call(this,n,t)})})}function ui(){for(var n,e=ASC.Projects.Master.Projects,c=jq("#createNewProject"),a=jq("#createProjectTempl"),t=!1,i=!1,r=!1,u=!1,o=ASC.Projects.Master.CanCreateProject,f=0,v=e.length;f<v;f++)(n=e[f],n.status===0)&&(n.canCreateMilestone&&(t=!0),n.canCreateTask&&(i=!0),n.canCreateMessage&&(r=!0),n.canCreateTimeSpend&&n.taskCountTotal>0&&(u=!0));t?k.show():k.hide();i?b.show():b.hide();r?h.show():h.hide();u?d.show():d.hide();t||i||r||u||o?l.removeClass(pt):s.find(".dropdown-item-seporator").length===0?l.addClass(pt):s.find(".dropdown-item-seporator:first").hide();o||(c.hide(),a.hide())}function fi(){var n=document.location.pathname.match(/[^\/]+$/)[0];return!!(window.history&&window.history.replaceState)&&!jq.getURLParam("action")&&(n===y||n===wt||n===bt||n===kt||n===ut||n==="projectteam.aspx")}function ei(n,t){return fi()?t.which===1&&t.ctrlKey||t.which===2?!0:location.href.endsWith(n.href)?!1:(t.stopPropagation(),history.pushState({href:n.href},{href:n.href},n.href),ASC.Controls.AnchorController.historyCheck(),jq(this).attr("href").contains("#")||(location.hash=""),w.baseInit(),n.hasOwnProperty("onclick")&&n.onclick(),!1):!0}var t,ii,w=ASC.Projects.Common,s,b,k,d,h,l,c,a,v,g,et,ri,nt,oi,f,e,r,tt,ot,st,ht,ct,lt,at,vt,yt,it=ASC.Projects,u="open",n="active",pt="disable",rt="currentCategory",si=u+" "+rt,o=n+" "+rt,y="projects.aspx",wt="messages.aspx",bt="tasks.aspx",kt="milestones.aspx",ut="timetracking.aspx",i;return{init:hi,onClick:ei}}(jQuery);ASC.Projects.TaskAction=function(){function nr(){ei=r.profile.id;a=jq.getURLParam("prjID");n=jq("#addTaskPanel");w=n.find("input.textEdit");f=n.find("textarea");d=n.find(".projectContaner");e=d.find(".advansed-select-container");c=jq("#taskMilestone");y=jq("#taskResponsible");o=jq("#taskStartDate");i=jq("#taskDeadline");i.val("");ct=jq("#notify");b=jq("#priority");it=jq("#copySubtasks");rt=jq("#copySubtasksContainer");k=jq("#copyFiles");bt=rt.find(".copy.files");s=jq("#fullFormUserList");jq(e,c,y).css("max-width",300);jq.browser.mobile&&jq("#ui-datepicker-div").addClass("blockMsg");var t=jq(i).add(o);t.datepicker({selectDefaultDate:!1});t.on("keydown",tr).off("change").on("change",si);i.on("change",function(){var t=ti(i),n=new Date;n.setHours(0);n.setMinutes(0);n.setSeconds(0);var u=r.serializeTimestamp(n),f=r.serializeTimestamp(new Date(n.getFullYear(),n.getMonth(),n.getDate()+3,0,0,0)),e=r.serializeTimestamp(new Date(n.getFullYear(),n.getMonth(),n.getDate()+7,0,0,0));t===u?tt(0):t===f?tt(3):t===e?tt(7):tt(-1)})}function tr(n){n.keyCode===13&&si(n)}function si(n){jq(n.target).unmask().blur().mask(ASC.Resources.Master.DatePatternJQ)}function tt(t){var i="dotline",r="bold";n.find(".deadline_left").removeClass(r).removeClass(i).addClass(i);n.find("[data-value="+t+"]").removeClass(i).addClass(r)}function ir(){n.on(at,"#fullFormUserList .user",function(){jq(this).remove();y.advancedSelector("unselect",[jq(this).attr("data-value")]);s.find(".user").length||s.hide();ni()});n.on(at,".deadline_left",function(){var t=parseInt(jq(this).attr("data-value"),10),n=new Date;n.setDate(n.getDate()+t);i.datepicker("setDate",n);tt(t)});jq("#saveTaskAction, #createTaskAndCreateNew").on(at,function(){var n,i,s,f,o;jq(this).hasClass("disable")||(hi(),n=rr(),ur(n))||(lr(),h===u.update?((t.milestoneId||0)!=parseInt(n.milestoneId,10)&&(i="taskLinksRemoveWarning"),t.links.length&&(s=t.links.some(function(n){return n.linkType==2&&n.parentTaskId==t.id})),!n.deadline&&s&&(i="taskLinksRemoveDeadlineWarning"),t.links.length&&i?ASC.Projects.Base.showCommonPopup(i,function(){for(var u,r=t.links,i=0;i<r.length;++i)u={dependenceTaskId:r[i].dependenceTaskId,parentTaskId:r[i].parentTaskId},Teamlab.removePrjTaskLink({},r[i].dependenceTaskId,u,{success:function(){}});ai({},t.id,n)},wr):ai({},t.id,n)):h===u.add?(f=e.attr("data-id"),o={saveAndView:jq(this).attr("id")=="saveTaskAction"},r.addPrjTask(o,f,n,{error:ri})):h===u.copy&&(f=e.attr("data-id"),n.copyFrom=t.id,n.copySubtasks=it.is(":checked"),n.copyFiles=k.is(":checked"),n.removeOld=jq(this).attr("id")=="createTaskAndCreateNew",o={saveAndView:!0,removeOld:n.removeOld},r.copyPrjTask(o,f,n,{error:ri})))});n.find("#closeTaskAction").on(at,bi);var f=r.events;r.bind(f.addPrjMilestone,nu);r.bind(f.removePrjMilestone,function(n,t){v==t.projectId&&pt(t.projectId)});r.bind(f.addPrjTask,ar);r.bind(f.copyPrjTask,function(n,i){r.call(f.addPrjTask,this,[n,i]);n.removeOld&&r.call(f.removePrjTask,this,[n,t])});r.bind(f.updatePrjProjectStatus,function(n,t){if(ut){var i=l.getProjectsForFilter().filter(ci).map(ii);e.projectadvancedSelector("rewriteItemList",i,[]);v===t.id&&t.status===1&&i.length&&(e.projectadvancedSelector("reset"),e.projectadvancedSelector("selectBeforeShow",i[0]))}})}function ni(){var t=n.find(".notify"),i=s.find(".user").length;if(!i||i==s.find(".user[data-value="+ei+"]").length){t.hide();return}t.show()}function hi(){n.find(".titlePanel").removeClass(vt);d.removeClass(vt);n.find(".startDate-error").hide();o.removeClass(st);i.removeClass(st)}function rr(){var n={title:jq.trim(w.val()),description:f.val(),notify:ct.is(":checked"),milestoneId:c.attr("data-id"),priority:b.is(":checked")?1:0,projectId:e.attr("data-id")},t=s.find(".user");t.length&&(n.responsibles=[],t.each(function(){n.responsibles.push(jq(this).attr("data-value"))}));try{i.val().length&&(n.deadline=ti(i));o.val().length&&(n.startDate=ti(o))}catch(r){}return n}function ti(n){var t=n.datepicker("getDate");return t?(t.setHours(0),t.setMinutes(0),t.setSeconds(0),r.serializeTimestamp(t)):""}function ur(t){var i=!1;return t.title.length||(n.find(".titlePanel").addClass(vt),i=!0),t.projectId||h===u.update||(d.addClass(vt),i=!0),fr()&&(i=!0),i}function fr(){var u=o.val().trim(),f=i.val().trim(),e,s,t=!1,r;return u==""&&f==""?!1:(u&&!jq.isDateFormat(u)?(o.addClass(st),t=!0):e=o.datepicker("getDate"),f&&!jq.isDateFormat(f)?(i.addClass(st),t=!0):s=i.datepicker("getDate"),e&&s&&e>s&&(r=n.find(".startDate-error"),r.text(r.attr("error")),r.show(),o.addClass(st),t=!0),t)}function er(){or();sr();hr();a&&ht({},et.Team)}function or(){kt=l.getProjectsForFilter().filter(ci).map(ii);e.projectadvancedSelector({itemsChoose:kt,onechosen:!0,inPopup:!0,sortMethod:function(){return 0}});e.on("showList",function(n,t){e.attr("data-id",t.id).text(t.title).attr("title",t.title);cr(t)})}function ci(n){return n.canCreateTask}function ii(n){return{id:n.value,title:n.title}}function sr(){var n={onechosen:!0,inPopup:!0,sortMethod:l.milestoneSort,noresults:ASC.Resources.Master.Resource.MilestoneSelectorNoResult,noitems:ASC.Resources.Master.Resource.MilestoneSelectorNoItems};c.projectadvancedSelector(n);c.on("showList",function(n,t){c.attr("data-id",t.id).text(t.title).attr("title",t.title)})}function hr(){y.advancedSelector({showSearch:!0,inPopup:!0,noresults:lt.NoActiveParticipantsNote}).on("showList",function(n,t){var i,u,r;for(s.empty(),i=0,u=t.length;i<u;i++)r=t[i],s.find("div[data-value='"+r.id+"']").length||s.show().append('<div data-value="'+r.id+'" class="user">'+r.title+"<\/div>");ni();n.stopPropagation()})}function cr(i){v=i.id;v>0&&(jq(".popupActionPanel").hide(),n.find(".requiredErrorText.project").hide(),jq("#pm-milestoneBlock, #pm-respBlock").removeClass(di),s.html("").hide(),pt(v),v==a?ht({},et.Team):vi({},v),h===u.copy&&t&&(k.prop("checked",!1),v!==t.projectId?bt.hide():bt.show()))}function lr(){li([w,f,o,i,ct,b,it,k],!0);jq(".success-popup, .error-popup").hide();ot.showLoaderBtn(n)}function yt(){li([w,f,o,i,ct,b,it,k]);ot.hideLoaderBtn(n)}function li(n,t){var i="disabled";n.forEach(function(n){t?n.attr(i,i):n.removeAttr(i)})}function ar(i,r){i.saveAndView?(bi(),l.displayInfoPanel(lt.TaskAdded)):(n.find("#taskLink").attr("href","tasks.aspx?prjID="+r.projectId+"&id="+r.id),yt(),t=r,wi(pi()),n.find(".success-popup").show(),w.focus());var u=l.getProjectById(r.projectOwner.id);u&&u.taskCountTotal++;l.changeTaskCountInProjectsCache(r,0)}function ri(t,i){var r=n.find(".error-popup");ot.hideLoaderBtn(n);r.text(i[0]);r.show();setTimeout(r.hide,3e3);yt()}function ai(n,t,i){r.updatePrjTask(n,t,i,{error:ri})}function pt(n){var i=et.Milestones.filter(function(t){return t.status===0&&t.projectId==n}),r;ki=i;p=i.map(vr);p.unshift(gt);c.projectadvancedSelector("reset");c.projectadvancedSelector("rewriteItemList",p,[]);t&&(r=p.find(function(n){return n.id==t.milestoneId}),c.projectadvancedSelector("reset"),c.projectadvancedSelector("selectBeforeShow",r||gt))}function vr(n){return{id:n.id,title:"["+n.displayDateDeadline+"] "+n.title,deadline:n.deadline}}function vi(n,t){r.getPrjTeam(n,t,{success:ht})}function ht(n,t){nt=l.excludeVisitors(t);nt=l.removeBlockedUsersFromTeam(nt);s.empty();y.advancedSelector("reset");y.advancedSelector("rewriteItemList",nt.map(function(n){return{id:n.id,title:n.displayName}}),[]);yi()}function yi(){t&&t.responsibles.length&&nt&&(s.empty(),jQuery.each(t.responsibles,function(){var t=this,n=nt.find(function(n){return n.id===t.id});typeof n!="undefined"&&s.show().append('<div data-value="'+n.id+'" class="user">'+n.displayName+"<\/div>")}),y.advancedSelector("select",t.responsibles.map(function(n){return n.id})));t&&!t.responsibles.length&&h!==u.add&&s.empty();ni()}function pi(){var n={title:"",description:"",responsibles:[],priority:null,startDate:null,deadline:null};return a=jq.getURLParam("prjID"),a&&(n.projectId=a),n}function yr(n){return n&&(wt||e.attr("data-id")!=n.toString())}function wi(t){var v,nt,s;hi();n.find(".success-popup, .error-popup").hide();n.find(".notify");w.val(t.title);f.val(t.description);yr(t.projectId)?(v=kt.find(function(n){return n.id==t.projectId})||t.projectOwner,v?e.projectadvancedSelector("selectBeforeShow",v):(jq("#pm-milestoneBlock").hide(),pt(t.projectId),vi({},t.projectId))):(a&&(pt(t.projectId),ht({},et.Team)),t.milestoneId&&(c.projectadvancedSelector("reset"),nt=p.find(function(n){return n.id==t.milestoneId}),c.projectadvancedSelector("selectBeforeShow",nt||gt)),yi());s="setDate";t.deadline?(i.datepicker(s,t.deadline),i.change()):h!==u.add&&(i.datepicker(s,null),tt(-1));t.startDate?o.datepicker(s,t.startDate):h!==u.add&&o.datepicker(s,null);t.priority?b.prop("checked",!0):b.prop("checked",!1);h===u.update?(br(),d.hide()):(f.height(60),d.show());var y=n.find("#saveTaskAction"),r=jq("#createTaskAndCreateNew"),l=g.CommonResource;h===u.update?(r.hide(),r.siblings(".splitter-buttons").first().hide(),rt.hide(),y.html(l.SaveChanges),n.find(".containerHeaderBlock table td:first").html(lt.EditThisTask)):h===u.add?(r.show(),r.siblings(".splitter-buttons").show(),rt.hide(),y.html(l.Save),n.find(".containerHeaderBlock table td:first").html(lt.CreateNewTask)):h===u.copy&&(r.html(l.Replace),r.show(),r.siblings(".splitter-buttons").show(),it.prop("checked",!1),k.prop("checked",!1),rt.show(),y.html(l.Copy),n.find(".containerHeaderBlock table td:first").html(g.TasksResource.CopyTaskHeader));wt&&(wt=!1);ot.hideLoading()}function pr(r){t=r;yt();wi(r);oi.blockUI(n,550,550,0,"absolute");var u=jq(i).add(o);u.mask(ASC.Resources.Master.DatePatternJQ)}function wr(){yt();oi.blockUI(n,550,550,0,"absolute")}function bi(){var n=jq(i).add(o);n.unmask();jq.unblockUI()}function br(){var i="overflowY",r,t;f.height(60);f.css(i,"auto");var u=parseInt(f.attr("cols"),10),e=f.val(),n=e.split("\n").length;if(n>4){if(n>26){f.height(400);f.css(i,"scroll");return}f.height(n*15)}r=e.length;r>u*6&&(t=Math.floor(r/(u*2.5)),t>27?(f.height(400),f.css(i,"scroll")):t>n&&f.height(t*15))}function ui(n,t){if(!ut){var i=g.TasksResource;jq("#addTaskPanel").html(jq.tmpl("common_containerTmpl",{options:{PopupContainerCssClass:"popupContainerClass",OnCancelButtonClick:"PopupKeyUpActionProvider.CloseDialog();",IsPopup:!0},header:{data:{title:i.AddTask},title:"projects_common_popup_header"},body:{title:"projects_task_action",data:{title:{error:i.EachTaskMustHaveTitle,header:i.TaskTitle},description:i.TaskDescription,project:{error:i.ChooseProject,header:g.ProjectResource.Project}}}}));nr();ir();er();ut=!0}ot.displayLoading();h=t;pr(n)}function nu(n,t){e.attr("data-id")==t.projectId&&(p.push({id:t.id,title:"["+t.displayDateDeadline+"] "+t.title,deadline:t.deadline}),c.projectadvancedSelector("rewriteItemList",p,[]))}var u={add:0,update:1,copy:2},fi,h=u.add,wt=!0,t=null,n=null,w=null,f=null,e=null,c=null,y=null,o=null,i=null,ct=null,b=null,it=null,k=null,rt=null,bt=null,s=null,d,ei,a,ki=[],ut,ft=[],kt=[],p=[],dt=ASC.Projects,et=dt.Master,g=dt.Resources,lt=g.ProjectsJSResource,gt={id:0,title:g.TasksResource.None,deadline:""},l=dt.Common,ot=LoadingBanner,oi=StudioBlockUIManager,nt,at="click",st="red-border",di="display-none",vt="requiredFieldError",r,v,gi=function(){fi||(fi=!0,r=Teamlab)},kr=function(n){ui(jq.extend(pi(),n),u.add)},dr=function(n){ui(n,u.update)},gr=function(n){ui(n,u.copy)},tu=function(){ut&&a==e.attr("data-id")&&ht({},et.Team)},iu=function(n){function f(n){return n.canCreateTask&&(!r||ft.some(function(t){return n.value==t}))}var i,t,r,u;if(ut){if(n.length===ft.length){for(i=!0,t=n.length-1;t>=0;--t)if(ft[t]!==n[t]){i=!1;break}if(i)return}ft=n;r=ft.length;u=l.getProjectsForFilter();e.projectadvancedSelector("rewriteItemList",u.filter(f).map(ii),[])}};return{init:gi,showUpdateTaskForm:dr,showCreateNewTaskForm:kr,showCopyTaskForm:gr,onUpdateProjectTeam:tu,filterProjectsByIdInCombobox:iu}}(jQuery);ASC.Projects.MilestoneAction=function(){function pt(){if(!ot){ot=!0;var f=nt.MilestoneResource;jq("#milestoneActionPanel").html(jq.tmpl("common_containerTmpl",{options:{PopupContainerCssClass:"popupContainerClass",OnCancelButtonClick:"PopupKeyUpActionProvider.CloseDialog();",IsPopup:!0},header:{data:{title:nt.ProjectResource.AddMilestone},title:"projects_common_popup_header"},body:{title:"projects_milestone_action",data:{title:{error:f.NoTitleMessage,header:f.Title},description:f.Description,project:{header:nt.ProjectResource.Project,error:f.ChooseProject}}}}));t=jq("#milestoneActionPanel");e=jq("#milestoneResponsibleContainer");a=e.find("#milestoneResponsible");w=e.find(".notifyResponsibleContainer");n=jq("#milestoneDeadlineInputBox");d=jq("#milestoneDeadlineContainer");h=t.find(".projectContaner");r=h.find(".advansed-select-container");g=t.find(".titlePanel");c=t.find(".textEdit");v=t.find("textarea");y=jq("#milestoneKeyCheckBox");p=jq("#milestoneNotifyManagerCheckBox");l=jq("#milestoneActionButton");at=t.find(".deadlineLeft");rt=jq("#notifyResponsibleCheckbox");lt=o.profile.id;u=jq.getURLParam("prjID");o.profile.isAdmin&&(ui=!0);n.on("change",function(){jq.trim(n.val())!=""&&d.removeClass(i);var r=wt(),t=new Date,u=o.serializeTimestamp(new Date(t.getFullYear(),t.getMonth(),t.getDate()+7,0,0,0)),f=o.serializeTimestamp(new Date(t.getFullYear(),t.getMonth()+1,t.getDate(),0,0,0)),e=o.serializeTimestamp(new Date(t.getFullYear(),t.getMonth()+2,t.getDate(),0,0,0));r===u?b(7):r===f?b(1):r===e?b(2):b(-1)});c.keyup(function(){jq.trim(c.val())!=""&&g.removeClass(i)});at.click(function(){var i=parseInt(jq(this).attr("data-value")),t;b(i);t=new Date;i==7?t.setDate(t.getDate()+i):t.setMonth(t.getMonth()+i);n.datepicker("setDate",t)});l.on("click",function(){var s,f,o;if(!l.hasClass(ft))return(h.removeClass(i),e.removeClass(i),d.removeClass(i),g.removeClass(i),u=jq.getURLParam("prjID"),s=t.attr("milestoneId"),f={projectId:r.attr("data-id")||u,responsible:a.attr("data-id"),notifyResponsible:rt.is(":checked"),title:jq.trim(c.val()),description:v.val(),isKey:y.is(":checked"),isNotify:p.is(":checked")},n.val().length&&jq.isDateFormat(n.val())&&(f.deadline=wt()),o=!1,f.projectId||(h.addClass(i),o=!0),f.responsible||(w.hide(),e.addClass(i),o=!0),f.deadline||(d.addClass(i),o=!0),f.title.length||(g.addClass(i),o=!0),f.projectId||(h.addClass(i),o=!0),o)?!1:(tt.showLoaderBtn(t),t.attr("type")=="update"?li(s,f):ci(f),!1)});jq("#milestoneActionCancelButton").click(function(){location.href.indexOf(vt)>0&&ASC.Projects.GantChartPage.enableChartEvents()});o.bind(o.events.updatePrjProjectStatus,function(n,t){if(et){var i=s.getProjectsForFilter().filter(bt).map(kt);r.projectadvancedSelector("rewriteItemList",i,[]);yt===t.id&&t.status===1&&i.length&&(r.projectadvancedSelector("reset"),r.projectadvancedSelector("selectBeforeShow",i[0]))}})}}function wt(){var t=n.datepicker("getDate");return t?(t.setHours(0),t.setMinutes(0),t.setSeconds(0),o.serializeTimestamp(t)):""}function bt(n){return n.canCreateMilestone}function kt(n){return{id:n.value,title:n.title}}function si(n,t){h.removeClass(i);e.show();w.hide();u=jq.getURLParam("prjID");u==n.id?ht({serverData:!0,responsible:t}):ii(n.id,{responsible:t})}function b(n){var i="dotline",r="bold";t.find(".deadlineLeft").removeClass(r).removeClass(i).addClass(i);t.find("[data-value="+n+"]").removeClass(i).addClass(r)}function ai(t,i){ni();u=jq.getURLParam("prjID");ASC.Projects.Master.Milestones.push(i);ASC.Projects.Master.Milestones=ASC.Projects.Master.Milestones.sort(s.milestoneSort);jq.unblockUI();s.displayInfoPanel(st.MilestoneAdded);n.unmask();s.changeMilestoneCountInProjectsCache(i,0)}function ii(n,t){o.getPrjProjectTeamPersons(t,n,{success:ht})}function ri(){StudioBlockUIManager.blockUI(t,550,550,0);c.focus()}var ct,et,ui,lt,u,ot,k=[],it=[],r,a,n,e,w,d,h,g,c,t,at,v,y,p,l,rt,i="requiredFieldError",f="disabled",ut="display-none",ft="disable",vt="ganttchart.aspx",nt=ASC.Projects.Resources,st=nt.ProjectsJSResource,s=ASC.Projects.Common,o,tt,yt,fi=function(){ct||(o=Teamlab,tt=LoadingBanner,ct=!0)},ei=function(){jq(r,a).css("max-width",300);it=s.getProjectsForFilter().filter(bt).map(kt);r.projectadvancedSelector({itemsChoose:it,onechosen:!0,inPopup:!0,sortMethod:function(){return 0}});r.on("showList",function(n,t,i){r.attr("data-id",t.id).text(t.title).attr("title",t.title);yt=t.id;si(t,i)})},oi=function(){var n={onechosen:!0,inPopup:!0,noresults:ASC.Resources.Master.Resource.UserSelectorNoResults};u=jq.getURLParam("prjID");u&&(n.itemsChoose=s.excludeVisitors(ASC.Projects.Master.Team).map(function(n){return{id:n.id,title:n.displayName}}));a.projectadvancedSelector(n);a.on("showList",function(n,t){a.attr("data-id",t.id).html(t.title).attr("title",t.title);hi(t)});e.show()},dt=function(n){et||(et=!0,ei(n),oi(n));u=jq.getURLParam("prjID");var t=ASC.Controls.AnchorController.getAnchor(),f=u||jq.getAnchorParam("project",t),i=it.find(function(n){return n.id==f}),e=jq.getAnchorParam("responsible_for_milestone",t)||jq.getAnchorParam("tasks_responsible",t)||jq.getAnchorParam("project_manager",t)||jq.getAnchorParam("team_member",t)||jq.getAnchorParam("author",t);i&&r.projectadvancedSelector("selectBeforeShow",i,n?n.resposible:e)},hi=function(n){e.removeClass(i);n.id&&n.id!=lt?(w.show(),rt.attr("checked",!0)):w.hide()},ci=function(n){gt();var t={projectId:n.projectId};o.addPrjMilestone(t,n.projectId,n,{success:ai,error:vi})},li=function(n,t){gt();o.updatePrjMilestone({},n,t,{success:function(n,t){for(var i=0;i<ASC.Projects.Master.Milestones.length;i++)if(ASC.Projects.Master.Milestones[i].id==t.id){ASC.Projects.Master.Milestones[i]=t;break}}})},gt=function(){n.attr(f,!0);c.attr(f,!0);v.attr(f,!0);y.attr(f,!0);p.attr(f,!0)},ni=function(){ot&&(n.removeAttr(f),c.removeAttr(f).val(""),v.removeAttr(f).val(""),y.removeAttr(f).removeAttr("checked"),p.removeAttr(f),tt.hideLoaderBtn(t))},ti=function(){t.removeAttr("type");rt.attr("checked",!0);r.attr("data-id")||(e.hide(),w.hide());h.removeClass(i);d.removeClass(i);n.val("");n.datepicker({popupContainer:"#milestoneActionPanel",selectDefaultDate:!0});n.on("keydown",function(t){t.keyCode==13&&n.unmask().blur().mask(ASC.Resources.Master.DatePatternJQ)});n.on("change",function(){n.unmask().blur().mask(ASC.Resources.Master.DatePatternJQ)});jq.browser.mobile&&jq("#ui-datepicker-div").addClass("blockMsg");var u=new Date;u.setDate(u.getDate()+7);n.datepicker("setDate",u);b(7);e.removeClass(i);a.projectadvancedSelector("reset");g.removeClass(i);c.val("");v.val("");y.removeAttr("checked");p.removeAttr("checked");tt.hideLoaderBtn(t)},vi=function(i,r){var o,s,e;for(location.href.indexOf(vt)>0&&ASC.Projects.GantChartPage.enableChartEvents(),o=t.find(".errorBox"),s=jq("#milestoneActionButtonsContainer"),o.text(r[0]),o.removeClass(ut),l.addClass(ft),tt.hideLoaderBtn(t),s.css("marginTop","8px"),s.show(),setTimeout(function(){o.addClass(ut);s.css("marginTop","43px");n.removeAttr(f);c.removeAttr(f);v.removeAttr(f);y.removeAttr(f);p.removeAttr(f)},3e3),u=jq.getURLParam("prjID"),location.href.indexOf("milestones.aspx")>0&&u==i.projectId&&ASC.Projects.AllMilestones.removeMilestonesActionsForManager(),e=0;e<ASC.Projects.Master.Projects.length;e++)if(i.projectId==ASC.Projects.Master.Projects[e].id){ASC.Projects.Master.Projects[e].canCreateMilestone=!1;break}},ht=function(n,t){var r,i,u;n.serverData&&!t&&(t=ASC.Projects.Master.Team);t=s.excludeVisitors(t);t=s.removeBlockedUsersFromTeam(t);t=t.filter(function(n){return!n.isVisitor}).map(function(n){return{id:n.id,title:n.id==o.profile.id?ASC.Resources.Master.Resource.MeLabel:n.displayName}});r=t.find(function(t){return t.id==n.responsible});r?i=r:(u=jq("#noActiveParticipantsMilNote"),t.length?(u.addClass(ut),l.removeClass(ft),i=t[0]):(u.removeClass(ut),l.addClass(ft),i=[{id:"",title:nt.CommonResource.Select}]));a.projectadvancedSelector("rewriteItemList",t,[i.id]);a.projectadvancedSelector("selectBeforeShow",i);h.is(":visible")&&e.show()},yi=function(i){var o,f;pt();dt(i);ti();t.attr("type","update");t.attr("milestoneId",i.id);l.html(l.attr("update"));o=t.find(".containerHeaderBlock table td:first");o.html(st.EditMilestone);i.deadline&&(n.datepicker("setDate",i.deadline),n.change());c.val(i.title);v.val(i.description);h.hide();s.currentUserIsModuleAdmin()||s.currentUserIsProjectManager(i.project)||e.hide();y.prop("checked",i.isKey);p.prop("checked",i.isNotify);u=jq.getURLParam("prjID");u==i.project&&r.attr("data-id")==u?ht({serverData:!0,responsible:i.responsible}):(f=it.find(function(n){return n.id==i.project}),f?r.trigger("showList",[f,i.responsible]):(r.attr("data-id",i.project),ii(i.project,{responsible:i.responsible})));ri()},pi=function(){pt();n.mask(ASC.Resources.Master.DatePatternJQ);dt();ti();l.html(l.attr("add"));var i=t.find(".containerHeaderBlock table td:first");return i.html(st.AddMilestone),h.show(),r.attr("data-id")&&e.show(),ri(),!1},wi=function(n){function e(n){return n.canCreateMilestone&&(!u||k.some(function(t){return n.value==t}))}function o(n){return{id:n.value,title:n.title}}var i,t,u,f;if(n.length===k.length){for(i=!0,t=n.length-1;t>=0;--t)if(k[t]!==n[t]){i=!1;break}if(i)return}k=n;u=k.length;f=s.getProjectsForFilter();r.projectadvancedSelector("rewriteItemList",f.filter(e).map(o),[])};return{init:fi,showNewMilestonePopup:pi,onGetMilestoneBeforeUpdate:yi,unlockMilestoneActionPage:ni,filterProjectsByIdInCombobox:wi}}(jQuery);jq(document).ready(function(){autosize(jq("textarea"))});ASC.Projects.projectNavPanel=function(){function tt(t,a){var rt,tt;if(Number(jq.getURLParam("id"))===0&&jq.getURLParam("action")==null){n=a;var d=h.ProjectsJSResource,k=ASC.Projects.ProjectTab.bind(null,n),nt=ASC.Projects.navSidePanel.onClick;y=new k(d.OverviewModule,function(){return 0},"projects.aspx","overViewModule",nt);c=new k(d.TasksModule,function(){return n.taskCount},"tasks.aspx","tasksModule",nt,function(){return!0});l=new k(d.MilestonesModule,function(){return n.milestoneCount},"milestones.aspx","milestonesModule",nt,function(){return!0});p=new k(d.DiscussionsModule,function(){return n.discussionCount},"messages.aspx","messagesModule",nt,function(){return n.security.canReadMessages});f=new k(d.TimeTrackingModule,function(){return n.timeTrackingTotal},"timetracking.aspx","timetrackingModule",nt,function(){return!i.profile.isVisitor});w=new k(d.DocumentsModule,function(){return n.documentsCount},"tmdocs.aspx","tmdocsModule",null,function(){return n.security.canReadFiles});e=new k(d.ContactsModule,function(){return n.contactsCount},"contacts.aspx","contactsModule",null,function(){return n.security.canReadContacts});s=new k(d.TeamModule,function(){return n.participantCount},"projectteam.aspx","projectteamModule",nt);b=new k(h.ProjectResource.GanttGart,function(){return 0},"ganttchart.aspx","ganttchartModule",null,function(){return!jq.browser.mobile&&n.status===0&&n.security.canReadTasks&&n.security.canReadMilestones});rt=ASC.Projects.Master.Team.some(function(n){return n.id===Teamlab.profile.id});tt={icon:"projects",title:n.title,private:n.isPrivate};Teamlab.profile.isOutsider||rt||(tt.subscribed=n.isFollow,tt.subscribedTitle=n.isFollow?r.Unfollow:r.Follow);ASC.Projects.InfoContainer.init(tt,it,[y,c,l,p,f,w,e,s,b]);v=jq(g);u=jq("#subscribe");u.click(function(){return i.subscribeProject({followed:!n.isFollow},o,{success:ot}),!1});jq("#projectTabs").removeClass("display-none");jq("#CommonListContainer").show()}}function it(){var t=[];return n.canEdit&&t.push(new ASC.Projects.ActionMenuItem("pa_edit",r.Edit,rt)),n.canDelete&&t.push(new ASC.Projects.ActionMenuItem("pa_delete",r.Delete,ut)),{menuItems:t}}function rt(){location.href="projects.aspx?prjID="+n.id+"&action=edit"}function ut(){ASC.Projects.Base.showCommonPopup("projectRemoveWarning",function(){i.removePrjProject({},n.id,{success:st,error:ht})})}function ft(){function u(n){var t=jq.trim(n);return typeof n=="number"&&(t=jq.timeFormat(t)),t=t.split(":"),{hours:parseInt(t[0],10),minutes:parseInt(t[1],10)}}function h(n){return(n.minutes>59&&(n.hours+=1,n.minutes-=60),n.minutes<0&&(n.hours-=1,n.minutes+=60),n.hours===0&&n.minutes===0)?"":jq.format("{0}:{1}{2}",n.hours,n.minutes<10?"0":"",n.minutes)}var r=i.events;et();t(r.getPrjProject,tt);t(r.removePrjTask,function(t,r){r.status!==2&&r.projectId==o&&jq.getURLParam("id")===null&&i.getPrjTimeById({},n.id,{success:function(t,i){n.timeTrackingTotal=i;f.rewrite()}})});t(r.updatePrjTeam,function(t,i){n.participantCount=i.length;s.rewrite()});t(r.removePrjTeam,function(){n.participantCount--;s.rewrite()});t(r.getCrmContactsForProject,function(t,i){n.contactsCount=i.length;e.rewrite()});t(r.addCrmContactForProject,function(){n.contactsCount++;e.rewrite()});t(r.removeCrmContactFromProject,function(){n.contactsCount--;e.rewrite()});t(r.removePrjTime,function(t,i){var r,e,o;if(n){for(r=u(n.timeTrackingTotal),e=i.length;e--;)o=u(i[e].hours),r.hours-=o.hours,r.minutes-=o.minutes;n.timeTrackingTotal=h(r);f.rewrite()}});t(r.updatePrjTime,function(t,i){var e=t.oldTime,o=u(i.hours),r=u(n.timeTrackingTotal);r.hours-=e.hours;r.hours+=o.hours;r.minutes-=e.minutes;r.minutes+=o.minutes;n.timeTrackingTotal=h(r);f.rewrite()})}function t(n,t){a.push(i.bind(n,t))}function et(){while(a.length){var n=a.shift();i.unbind(n)}}function ot(t){var i="unsubscribed",f="subscribed",e="title";t.followed?(u.attr(e,r.Unfollow),u.removeClass(i).addClass(f)):(u.attr(e,r.Follow),u.removeClass(f).addClass(i));n.isFollow=t.followed}function st(){document.location.replace("projects.aspx")}function ht(){jq.unblockUI()}function ct(){o=undefined;typeof v!="undefined"&&v.hide()}function lt(){c.rewrite()}function at(){l.rewrite()}var y,c,l,p,f,w,s,b,e,o,k,u,i,d,h,r,n,a=[],g=".project-info-container",v,nt=function(){o!==jq.getURLParam("PrjID")&&(i=Teamlab,d=LoadingBanner,h=ASC.Projects.Resources,r=h.CommonResource,o=jq.getURLParam("PrjID"),k||ft(),k=!0)};return{init:nt,hide:ct,rewriteTaskTab:lt,rewriteMilestoneTab:at}}(jQuery);ASC.Projects.ProjectsAdvansedFilter=function(){function de(){if(pt=!0,delete window.userSelector,typeof h!="undefined"){var n=jq("#ProjectsAdvansedFilter").is(":visible");n&&h.attr("style","visibility:visible");h.removeClass("is-init")}}function ge(n){hi=n.basePath;var t=/sortBy=(.+)\&sortOrder=(.+)/ig.exec(hi);t&&t.length==3&&(su=t[1]);ui=n}function ne(){var k=ASC.Controls.AnchorController.getAnchor(),f,v,e,p,n,r,t,o,u,w;if(k==""){location.hash=hi;return}for(f=y(bi),v=y(ki),f||(f=su),e=0,p=b.filters.length;e<p;e++)if(n=b.filters[e],n.visible)if(n.id==="text"?r=y(n.id):n.id.indexOf(ou)>-1&&(t=n.id.substring(ou.length),i&&t.endsWith("_p")&&(t=t.substring(0,t.length-2)),r=n.type===l?y(t+"Start"):y(t)),o=y(n.groupby),r||o)switch(n.type){case s:case di:n.params={id:r.toLowerCase()};break;case c:case"text":n.params={value:(r||o).toLowerCase()};break;case a:n.params={};break;case l:n.params={from:r,to:y(n.id.substring(2)+"Stop")}}else n.reset=!0,delete n.params;for(u=0,w=b.sorters.length;u<w;u++)b.sorters[u].selected=b.sorters[u].id===f,b.sorters[u].sortOrder=v;h.advansedFilter({filters:b.filters,sorters:b.sorters})}function rr(n){return n.id||n.value}function r(n,t,i){return jq.changeParamValue(n,t,i)}function uo(n,t){var i=ir(t,"anchor"),r=ASC.Controls.AnchorController.getAnchor();if(pt&&r.length&&!no(i)){pt=!1;ne();return}pt?pt=!1:ASC.Projects.PageNavigator.reset();ui.currentFilter=ir(t,"data");ui.getData();i!==r&&(location.hash=i)}function fo(n,t){ASC.Projects.PageNavigator.reset();var i=ir(t,"anchor");ASC.Controls.AnchorController.move(i);ui.currentFilter=ir(t,"data");ui.getData()}function ei(n,t,r,u,f){i=jq.getURLParam("prjID");eu=to();tr=io();k=ro();var e=lo(r);return ho(t,e),ao(f,e),so(u,e),co(n,e),b=e,e}function t(n,t,i,r,u,f,e,o,s,h,c,l){var a={type:i,id:r,title:u,filtertitle:f,group:e,hashmask:o,groupby:s,visible:n,enable:n};typeof h!="undefined"&&h!=null&&(a.options=h);typeof c!="undefined"&&c!=null&&(a.bydefault=c);typeof l!="undefined"&&l!=null&&(a.defaulttitle=l);t.push(a)}function d(r,u,e,o,h){t(r,u,i?c:s,e,n.Me,o+":",o,f,h,i?k:null,{id:v})}function ie(i,r,u,f){t(i,r,di,kt,n.Groups,n.Group+":",u,bf,f)}function oi(i,r,u){for(var e,f=0,o=u.length;f<o;f++)e=u.map(function(n){return jq.extend({},n)}),e[f].def=!0,t(i,r,c,e[f].value,e[f].title,n.ByStatus+":",n.ByStatus,wf,ae,e)}function ur(r,u){t(i==null&&r,u,a,ni,n.MyProjects,"",n.ByProject,ni,gi);t(i==null&&r,u,c,gt,n.OtherProjects,n.ByProject+":",n.ByProject,ve,gi,yt.getProjectsForFilter(),null,n.Select);t(i==null&&r,u,c,dt,n.ByTag,n.ByTag+":",n.ByProject,null,gi,tr,null,n.Select);t(i==null&&r,u,a,ht,n.WithoutTag,"",n.ByProject,ht,gi)}function fr(n,i){var u="hidden",r;for(i=i||1,r=0;r<i;r++)t(!1,n,a,u+r,u,"",u+r)}function e(n,t,i,r,u,f){for(var e,h=!1,o=0,s=t.length;o<s;o++)if(e=t[o],e.id===i){n&&!e.visible&&(e.visible=!0);e.def=f;h=!0;break}if(f)for(o=0;o<s;o++)(e=t[o],e.id!==i)&&e.def&&!e.visible&&(e.def=!1);h||t.push({id:i,title:r,sortOrder:u,def:f,visible:n})}function si(n,t,i){for(var r=t,u=n.length;r<u;r++)n[r].id=i+n[r].id,n[r].groupid=i+n[r].group}function o(n){return n+"_p"}function re(n,t,i){var u=jq.changeParamValue(hu.getAnchor(),n,t),r,f;if(i)for(r=0,f=i.length;r<f;r++)u=jq.removeParam(i[r],u);hu.move(u);ne()}function ko(n,t,i){t!="4a515a15-d4d6-4b8e-828e-e0586f18f3a3"&&re(n,t,i)}var pt=!0,hi="",su="",h,b,hu=ASC.Controls.AnchorController,cu="t_",lu="p_",au="m_",vu="d_",yu="r_",ci="team_member",er="me_team_member",wt="me_responsible_for_milestone",et="responsible_for_milestone",or="me_project_manager",li="project_manager",ai="me_author",ot="author",sr="user",it="me_tasks_responsible",g="tasks_responsible",hr="me_tasks_creator",vi="tasks_creator",bt="me_tasks",st="user_tasks",yi="noresponsible",kt="group",rt="followed",dt="tag",ht="notag",cr="text",gt="project",ni="myprojects",p="milestone",ct="mymilestones",lr="status",lt="open",ti="closed",ar="archived",vr="paused",yr="notChargeable",pr="notBilled",wr="billed",pu="period",wu="today2",br="created",bu="previousweek2",ku="previousmonth2",du="period2",ut="overdue",pi="today",wi="upcoming",kr="recent",ue="today3",fe="yesterday",ee="currentweek",oe="previousweek",se="currentmonth",he="previousmonth",ce="currentyear",le="previousyear",ii="deadline",gu="deadlineStart",nf="deadlineStop",tf="createdStart",rf="createdStop",uf="periodStart",ff="periodStop",dr="entity",ef="project_entity",of="milestone_entity",sf="discussion_entity",hf="team_entity",cf="task_entity",lf="subtask_entity",af="time_entity",vf="comment_entity",bi="sortBy",ki="sortOrder",s="person",c="combobox",a="flag",di="group",l="daterange",u="userid",yf="creatorid",gr="taskuserid",pf="managerid",gi="projectGroup",ae="status",nu="createdGroup",ft="deadlineGroup",tu="periodGroup",at="/{0}",iu=at+"/{1}",f=s+at,ru=br+iu,wf=c+at,vt=ii+iu,bf=kt+at,ve=gt+at,ye=p+at,uu=pu+iu,nt="ascending",w="descending",pe="comments",ri="create_on",nr="title",kf="deadline",fu=[ci,er,wt,et,or,li,ai,ot,sr,it,g,hr,vi,bt,st,yi,kt,rt,dt,cr,gt,ni,p,ct,lr,lt,ti,ar,vr,"payment_status",yr,pr,wr,ut,pi,wi,kr,gu,nf,tf,rf,uf,ff,dr,ef,of,sf,hf,cf,lf,af,vf,bi,ki],df,ui,tt=Teamlab,gf=ASC.Projects,we=gf.Resources,n=we.ProjectsFilterResource,yt=gf.Common,i=jq.getURLParam("prjID"),v=tt.profile.id,eu,tr,k,be=jq("body"),ke="click.filter",ou,fi=function(n,t,r){if(df=this,i=jq.getURLParam("prjID"),ou=n,de(),ge(t),typeof h=="undefined")be.on(ke,".clearFilterButton",function(){return h.advansedFilter(null),!1});h=jq("#ProjectsAdvansedFilter").advansedFilter({store:!0,anykey:!0,hintDefaultDisable:!0,colcount:3,anykeytimeout:1e3,filters:r.filters,sorters:r.sorters}).unbind("setfilter").unbind("resetfilter").bind("setfilter",uo).bind("resetfilter",fo)},y=function(n,t){var u="[#&]"+n+"=([^&]*)",f=new RegExp(u),r="#",i;return r+=t?t:ASC.Controls.AnchorController.getAnchor(),i=f.exec(r),i==null?"":i[1]},no=function(n){var t=ASC.Controls.AnchorController.getAnchor(),f=y(ki,t),e=y(bi,t),i,r,u;for(e==""&&f==""&&(t=hi+"&"+t),i=fu.length;i--;)if(r=y(fu[i],n),u=y(fu[i],t),r!=u)return!1;return!0},ir=function(n,t){var f={},u="",w=n.advansedFilter(),s,h,c="true",b,v;for(i&&(f.projectId=i),b=w.length,df.baseFilter=b===1&&w[0].id=="sorter",v=0;v<b;v++){var e=w[v].params,l=e.id,a=e.value,y=w[v].id;y!=="sorter"&&y!=="text"&&(y=y.substring(2));switch(y){case er:case ci:f.participant=l;u=r(u,ci,f.participant);break;case or:case li:f.manager=l;u=r(u,li,f.manager);break;case wt:case o(wt):case et:case o(et):f.milestoneResponsible=rr(e);u=r(u,et,f.milestoneResponsible);break;case it:case o(it):case g:case o(g):f.participant=rr(e);u=r(u,g,f.participant);break;case hr:case vi:f.creator=l;u=r(u,vi,f.creator);break;case ai:case ot:case o(ot):f.participant=rr(e);u=r(u,ot,f.participant);break;case sr:f.user=l;u=r(u,sr,f.user);break;case kt:f.departament=l;u=r(u,kt,f.departament);break;case ct:f.mymilestones=c;u=r(u,ct,c);break;case p:f.milestone=a;u=r(u,p,f.milestone);break;case yi:f.participant="00000000-0000-0000-0000-000000000000";u=r(u,yi,c);break;case ni:f.myprojects=c;u=r(u,ni,c);break;case gt:f.projectId=a;u=r(u,gt,f.projectId);break;case bt:case o(bt):case st:case o(st):f.taskResponsible=rr(e);u=r(u,st,f.taskResponsible);break;case rt:f.follow=c;u=jq.changeParamValue(u,rt,c);break;case dt:f.tag=a;u=r(u,dt,f.tag);break;case ht:f.tag=-1;u=r(u,ht,c);break;case lt:case vr:case ar:case ti:case lr:case yr:case pr:case wr:f.status=a;u=r(u,lr,f.status);break;case ut:f.status="open";f.deadlineStop=tt.serializeTimestamp(new Date);u=r(u,ut,c);break;case pi:case wi:case ii:s=e.from;h=e.to;f.deadlineStart=tt.serializeTimestamp(new Date(s));f.deadlineStop=tt.serializeTimestamp(new Date(h));u=r(u,gu,s);u=r(u,nf,h);break;case wu:case kr:case br:case bu:case ku:case du:s=e.from;h=e.to;f.createdStart=tt.serializeTimestamp(new Date(s));f.createdStop=tt.serializeTimestamp(new Date(h));u=r(u,tf,s);u=r(u,rf,h);break;case ue:case fe:case ee:case oe:case se:case he:case ce:case le:case pu:s=e.from;h=e.to;f.periodStart=tt.serializeTimestamp(new Date(s));f.periodStop=tt.serializeTimestamp(new Date(h));u=r(u,uf,s);u=r(u,ff,h);break;case cr:f.FilterValue=a;u=r(u,cr,f.FilterValue);break;case ef:case of:case sf:case hf:case cf:case lf:case af:case vf:case dr:f.entity=a;u=r(u,dr,f.entity);break;case"sorter":f.sortBy=l;f.sortOrder=e.sortOrder;u=r(u,bi,f.sortBy);u=r(u,ki,f.sortOrder)}}return t==="anchor"?u:f},to=function(){var n=ASC.Projects.Master.Milestones,r,t,u;if(!n)return[];for(i&&(n=n.filter(function(n){return n.status===0&&n.projectId==i})),r=[{value:0,title:ASC.Projects.Resources.ProjectsJSResource.NoMilestone}],t=0,u=n.length;t<u;t++)r.push({value:n[t].id,title:jq.format("[{0}] {1}",n[t].displayDateDeadline,n[t].title)});return r},io=function(){return ASC.Projects.Master.Tags},ro=function(){return typeof ASC.Projects.Master.Team=="undefined"?[]:ASC.Projects.Master.Team.map(function(n){return{value:n.id,title:n.displayName}})},te=function(){typeof h!="undefined"&&typeof h.filter!="undefined"&&h.advansedFilter("resize")},eo=function(){typeof h!="undefined"&&h.hide()},oo=function(){if(typeof h!="undefined"){var n=jq("#ProjectsAdvansedFilter").is(":visible");n||(h.show(),te())}},so=function(r,h){var p=new Date,d=new Date(p.getFullYear(),p.getMonth(),p.getDate(),0,0,0,0),g=new Date(p.getFullYear(),p.getMonth(),p.getDate(),0,0,0,0),y,nt,b;return g.setDate(g.getDate()-7),y=[],h&&h.filters&&(y=h.filters),nt=y.length,t(typeof yt.userInProjectTeam(v)!="undefined"&&i!=null&&r,y,c,o(ai),n.MyDiscussions,n.Author+":",n.Author,f,u,k,{value:v}),t(i!=null&&r,y,c,o(ot),n.OtherParticipant,n.Author+":",n.ByParticipant,f,u,k,{value:v}),t(i==null&&r,y,s,ai,n.MyDiscussions,n.Author+":",n.Author,f,u,null,{id:v}),t(i==null&&r,y,s,ot,n.OtherUsers,n.Author+":",n.Author,f,u),ur(r,y),oi(r,y,[{value:lt,title:n.StatusOpenDiscussion},{value:ar,title:n.StatusArchivedDiscussion}]),t(r,y,l,wu,n.Today," ",n.ByCreateDate,ru,nu,null,{from:d.getTime(),to:d.getTime()}),t(r,y,l,kr,n.Recent," ",n.ByCreateDate,ru,nu,null,{from:g.getTime(),to:d.getTime()}),t(r,y,l,br,n.CustomPeriod," ",n.ByCreateDate,ru,nu),t(r,y,a,rt,n.FollowDiscussions,"",n.Other,rt),fr(y),si(y,nt,vu),b=[],h&&h.sorters&&(b=h.sorters),e(r,b,pe,n.ByComments,w,!0),e(r,b,ri,n.ByCreateDate,w),e(r,b,nr,n.ByTitle,w),{filters:y,sorters:b}},ho=function(r,h){var p=new Date,g=new Date(p.getFullYear(),p.getMonth(),p.getDate(),0,0,0,0),tt=new Date(p.getFullYear(),p.getMonth(),p.getDate(),0,0,0,0),y,it,b;return tt.setDate(tt.getDate()+7),y=[],h&&h.filters&&(y=h.filters),it=y.length,d(typeof yt.userInProjectTeam(v)!="undefined"&&i!=null&&r,y,o(wt),n.ByResponsible,u),t(typeof yt.userInProjectTeam(v)!="undefined"&&i!=null&&r,y,c,o(bt),n.MyTasks,n.Tasks+":",n.Tasks,f,gr,k,{value:v}),t(i!=null&&r,y,c,o(et),n.OtherParticipant,n.ByResponsible+":",n.ByResponsible,f,u,k,null,n.Select),t(i!=null&&r,y,c,o(st),n.OtherParticipant,n.ByResponsible+":",n.Tasks,f,u,k,null,n.Select),d(i==null&&r,y,wt,n.ByResponsible,u),t(i==null&&r,y,s,et,n.OtherUsers,n.ByResponsible+":",n.ByResponsible,f,u),t(i==null&&r,y,s,bt,n.MyTasks,n.Tasks+":",n.Tasks,f,gr,null,{id:v}),t(i==null&&r,y,s,st,n.OtherUsers,n.Tasks+":",n.Tasks,f,gr),oi(r,y,[{value:lt,title:n.StatusOpenMilestone},{value:ti,title:n.StatusClosedMilestone}]),t(r,y,a,ut,n.Overdue,"",n.DueDate,ut,ft),t(r,y,l,pi,n.Today," ",n.DueDate,vt,ft,null,{from:g.getTime(),to:g.getTime()}),t(r,y,l,wi,n.UpcomingMilestones," ",n.DueDate,vt,ii,null,{from:g.getTime(),to:tt.getTime()}),t(r,y,l,ii,n.CustomPeriod," ",n.DueDate,vt,ft),ur(r,y),fr(y),si(y,it,au),b=[],h&&h.sorters&&(b=h.sorters),e(r,b,kf,n.ByDeadline,nt,!0),e(r,b,ri,n.ByCreateDate,w),e(r,b,nr,n.ByTitle,nt),{filters:y,sorters:b}},co=function(i,r){var o=[],l,h;return r&&r.filters&&(o=r.filters),l=o.length,d(i,o,or,n.ProjectMenager,pf),t(i,o,s,li,n.OtherUsers,n.ProjectMenager+":",n.ProjectMenager,f,pf),d(i,o,er,n.TeamMember,u),t(i,o,s,ci,n.OtherUsers,n.TeamMember+":",n.TeamMember,f,u),t(i,o,di,di,n.Groups,n.Groups+":",n.TeamMember,bf,u),oi(i,o,[{value:lt,title:n.StatusOpenProject},{value:vr,title:n.StatusSuspend},{value:ti,title:n.StatusClosedProject}]),t(i,o,a,rt,n.FollowProjects,"",n.Other,rt),tr&&(t(i,o,c,dt,n.ByTag,n.Tag+":",n.Other,wf,null,tr,null,n.Select),t(i,o,a,ht,n.WithoutTag,"",n.Other,ht)),fr(o,2),si(o,l,lu),h=[],r&&r.sorters&&(h=r.sorters),e(i,h,nr,n.ByTitle,nt,!0),e(i,h,ri,n.ByCreateDate,w),{filters:o,sorters:h}},lo=function(r,h){var tt=new Date,rt=new Date(tt.getFullYear(),tt.getMonth(),tt.getDate(),0,0,0,0),et=new Date(tt.getFullYear(),tt.getMonth(),tt.getDate(),0,0,0,0),y,ot,b;return et.setDate(et.getDate()+7),y=[],h&&h.filters&&(y=h.filters),ot=y.length,d(typeof yt.userInProjectTeam(v)!="undefined"&&i!=null&&r,y,o(it),n.ByResponsible,u),t(i!=null&&r,y,s,o(g),n.OtherParticipant,n.ByResponsible+":",n.ByResponsible,f,u,k,null,n.Select),d(i==null&&r,y,it,n.ByResponsible,u),t(i==null&&r,y,s,g,n.OtherUsers,n.ByResponsible+":",n.ByResponsible,f,u),ie(r,y,n.ByResponsible,u),t(r,y,a,yi,n.NoResponsible,"",n.ByResponsible,"noresponsible",u),d(r,y,hr,n.ByCreator,yf),t(r,y,s,vi,n.OtherUsers,n.ByCreator+":",n.ByCreator,f,yf),ur(r,y),t(r,y,a,ct,n.MyMilestones,null,n.ByMilestone,"mymilestones",p),t(r,y,c,p,n.OtherMilestones,n.ByMilestone+":",n.ByMilestone,"milestone/{0}",p,eu,null,n.Select),oi(r,y,[{value:lt,title:n.StatusOpenTask},{value:ti,title:n.StatusClosedTask}]),t(r,y,a,ut,n.Overdue,null,n.DueDate,ut,ft),t(r,y,l,pi,n.Today," ",n.DueDate,vt,ft,null,{from:rt.getTime(),to:rt.getTime()}),t(r,y,l,wi,n.UpcomingMilestones," ",n.DueDate,vt,ft,null,{from:rt.getTime(),to:et.getTime()}),t(r,y,l,ii,n.CustomPeriod," ",n.DueDate,vt,ft),si(y,ot,cu),b=[],h&&h.sorters&&(b=h.sorters),e(r,b,kf,n.ByDeadline,nt,!0),e(r,b,"priority",n.ByPriority,w),e(r,b,ri,n.ByCreateDate,w),e(r,b,"start_date",n.ByStartDate,w),e(r,b,nr,n.ByTitle,nt),e(r,b,"sort_order",n.ByOrder,nt),{filters:y,sorters:b}},ao=function(r,h){var st=new Date,b=new Date(st.getFullYear(),st.getMonth(),st.getDate(),0,0,0,0),ft=new Date(b),ht,et,ot,tt,rt,y,lt,ut;return ft.setDate(b.getDate()-b.getDay()+1),ht=new Date(b),ht.setDate(b.getDate()-b.getDay()+7),et=new Date(ft),et.setDate(ft.getDate()-7),ot=new Date(ft),ot.setDate(ft.getDate()-1),tt=new Date(b),tt.setMonth(b.getMonth()-1),tt.setDate(1),rt=new Date(tt),rt.setMonth(tt.getMonth()+1),rt.setDate(rt.getDate()-1),et=et.getTime(),ot=ot.getTime(),tt=tt.getTime(),rt=rt.getTime(),y=[],h&&h.filters&&(y=h.filters),lt=y.length,ur(r,y),t(r,y,a,ct,n.MyMilestones,"",n.ByMilestone,ct,p),t(r,y,c,p,n.OtherMilestones,n.ByMilestone+":",n.ByMilestone,ye,p,eu,null,n.Select),d(typeof yt.userInProjectTeam(v)!="undefined"&&i!=null&&r,y,o(it),n.ByResponsible,u),t(i!=null&&r,y,s,o(g),n.OtherParticipant,n.ByResponsible+":",n.ByResponsible,f,u,k,null,n.Select),d(i==null&&r,y,it,n.ByResponsible,u),t(i==null&&r,y,s,g,n.OtherUsers,n.ByResponsible+":",n.ByResponsible,f,u),ie(r,y,n.ByResponsible,u),oi(r,y,[{value:yr,title:n.PaymentStatusNotChargeable},{value:pr,title:n.PaymentStatusNotBilled},{value:wr,title:n.PaymentStatusBilled}]),t(r,y,l,bu,n.PreviousWeek," ",n.TimePeriod,uu,tu,null,{from:et,to:ot}),t(r,y,l,ku,n.PreviousMonth," ",n.TimePeriod,uu,tu,null,{from:tt,to:rt}),t(r,y,l,du,n.CustomPeriod," ",n.TimePeriod,uu,tu),fr(y),si(y,lt,yu),ut=[],h&&h.sorters&&(ut=h.sorters),e(r,ut,"date",n.ByDate,w,!0),e(r,ut,"hours",n.ByHours,nt),e(r,ut,"note",n.ByNote,nt),e(r,ut,ri,n.ByCreateDate,w),{filters:y,sorters:ut}},vo=function(n){fi.call(this,vu,n,ei(!1,!1,!1,!0,!1))},yo=function(n){fi.call(this,au,n,ei(!1,!0,!1,!1,!1))},po=function(n){fi.call(this,lu,n,ei(!0,!1,!1,!1,!1))},wo=function(n){fi.call(this,cu,n,ei(!1,!1,!0,!1,!1))},bo=function(n){fi.call(this,yu,n,ei(!1,!1,!1,!1,!0))};return{add:re,addUser:ko,baseFilter:!0,resize:te,show:oo,hide:eo,createAdvansedFilterForDiscussion:vo,createAdvansedFilterForMilestones:yo,createAdvansedFilterForProjects:po,createAdvansedFilterForTasks:wo,createAdvansedFilterForTimeTracking:bo}}();typeof ASC=="undefined"&&(ASC={});typeof ASC.Projects=="undefined"&&(ASC.Projects={});ASC.Projects.PageNavigator=function(){function a(){if(r&&r!==""){var i=localStorage[f]?JSON.parse(localStorage[f]):{};i[r]={entryCountOnPage:n,currentPage:t};localStorage[f]=JSON.stringify(i)}}function w(i){isNaN(i)||n!=i&&(n=i*1,t=0,u.EntryCountOnPage=n,o.getData(!1))}function k(){var i=localStorage[f]?JSON.parse(localStorage[f]):undefined,u;u=i&&i.hasOwnProperty(r)?i[r]:{entryCountOnPage:r==="discussionsKeyForPagination"?10:ASC.Projects.Master.EntryCountOnPage,currentPage:0};n=parseInt(u.entryCountOnPage);t=parseInt(u.currentPage)}function v(){c.show()}var c=jq("#tableForNavigation"),f="projectsPagination",n=0,t=0,r,l,u,e,i,y=jq("#totalCount"),o,s=[10,20,30,40],h=[25,50,75,100],p=function(f,c){l=this;r=c.pagination;e=ASC.Projects.Resources.ProjectsJSResource;o=f;var v=jq.getURLParam("prjID");if(v&&(r+=v),k(),typeof i=="undefined"){i=jq("#countOfRows");i.advancedSelector({height:104,width:60,itemsSelectedIds:n,onechosen:!0,showSearch:!1,itemsChoose:s.concat(h).map(function(n){return{id:n,title:n}}),sortMethod:function(){return 0}}).on("showList",function(n,t){i.attr("data-id",t.id).text(t.title).attr("title",t.title);w(t.id)})}c.small?(i.advancedSelector("undisable",s),i.advancedSelector("disable",h)):(i.advancedSelector("undisable",h),i.advancedSelector("disable",s));i.advancedSelector("select",[n]);i.attr("data-id",n).text(n).attr("title",n);typeof l.pgNavigator=="undefined"?(u=new ASC.Controls.PageNavigator.init("ASC.Projects.PageNavigator.pgNavigator","#divForTaskPager",n,parseInt(ASC.Projects.Master.VisiblePageCount),t+1,e.PreviousPage,e.NextPage),u.NavigatorParent="#divForTaskPager"):(u.EntryCountOnPage=n,u.CurrentPageNumber=t+1);u.changePageCallback=function(n){t=n-1;o.getData(!0);a()}},b=function(n){y.text(n);u.drawPageNavigator(t+1,n);a();n&&v()},d=function(){c.hide()},g=function(i){var r=Math.floor(i/n);t>=r&&(t=r-1)},nt=function(){t=0};return{init:p,update:b,get entryCountOnPage(){return n},get currentPage(){return t},get pgNavigator(){return u},hide:d,show:v,setMaxPage:g,reset:nt}}();ASC.Projects.Base=function(){function vt(){ft||(ft=!0,rt=LoadingBanner,t=ASC.Projects.PageNavigator,e=ASC.Projects.ProjectsAdvansedFilter,h=ASC.Projects.Resources,i=h.TasksResource,u=h.CommonResource,f=h.ProjectResource,o=h.MilestoneResource,k=h.TimeTrackingResource,d=h.MessageResource,g=h.ProjectTemplatesResource,ct={projectRemoveWarning:r([f.DeleteProjectPopup,u.PopupNoteUndone],f.DeleteProject,f.DeleteProject),taskRemoveWarning:r([i.RemoveTaskPopup,u.PopupNoteUndone],i.RemoveTask,i.RemoveTask),tasksRemoveWarning:r([i.RemoveTasksPopup,u.PopupNoteUndone],i.RemoveTasks,i.RemoveTasks),milestoneRemoveWarning:r([o.DeleteMilestonePopup,u.PopupNoteUndone],o.DeleteMilestone,o.DeleteMilestone),milestonesRemoveWarning:r([o.DeleteMilestonesPopup,u.PopupNoteUndone],o.DeleteMilestones,o.DeleteMilestones),trackingRemoveWarning:r([k.DeleteTimersQuestion,u.PopupNoteUndone],k.DeleteTimers,k.DeleteTimers),discussionRemoveWarning:r([d.DeleteDiscussionPopup,u.PopupNoteUndone],d.DeleteMessage,d.DeleteMessage),projectTemplateRemoveWarning:r([g.RemoveQuestion,u.PopupNoteUndone],g.RemoveTemplateTitlePopup,g.RemoveTemplateTitlePopup),taskLinksRemoveWarning:r([jq.format(u.TaskMoveNote,"")],u.OneTaskMoveButton,u.MoveTaskHeader),taskLinksRemoveDeadlineWarning:r([jq.format(u.UpdateDeadlineNote,"")],u.TaskUpdateButton,u.UpdateDeadlineHeader),closedTaskQuestion:r([i.TryingToCloseTheTask,i.BetterToReturn],i.EndAllSubtasksCloseTask,i.ClosingTheTask),closedTasksQuestion:r([i.TryingToCloseTasks,i.BetterToReturnTasks],i.EndAllSubtasksCloseTasks,i.ClosingTasks),projectOpenTaskWarning:r([f.NotClosePrjWithActiveTasks],f.ViewActiveTasks,f.ViewActiveTasks),projectOpenMilestoneWarning:r([f.NotClosedPrjWithActiveMilestone],f.ViewActiveMilestones,f.CloseProject),closeMilestoneWithOpenTasks:r([o.NotCloseMilWithActiveTasks],f.ViewActiveTasks,o.CloseMilestone),createNewLinkError:r([i.ErrorCreateNewLink],f.OkButton,i.ErrorCreateNewLink)})}function yt(){if(nt)p.hide(),s.hide(),st.show();else{if(v>0)return;v=setTimeout(function(){rt.displayLoading(!0)},500)}}function gt(n){location.hash.indexOf(ot)>0&&ASC.Projects.Common.displayInfoPanel(n,!0)}function ni(){location.href=location.pathname+"?prjID="+jq.getURLParam("prjID")+"#"+ot}function ii(n,i,r){if(a=n.groupMenu,t&&t.pgNavigator&&t.update(r),i.length){kt.hide();typeof e!="undefined"&&e.show();a&&(ASC.Projects.GroupActionPanel.init(a,n.$container),y.show(),y.find(".contentMenu").show());n.$container.html(jq.tmpl(n.tmplName,i));n.$container.show();t&&t.pgNavigator&&t.show();ut();a&&ScrolledGroupMenu.resizeContentHeaderWidth(y.find(".contentMenu"));return}if(r==undefined||r===0){t.hide();a&&y.hide();var u;e.baseFilter?(e.hide(),u=n.baseEmptyScreen):u=jq.extend({img:"filter",button:{title:ASC.Projects.Resources.ProjectsFilterResource.ClearFilter,clear:!0,canCreate:function(){return!0}}},n.filterEmptyScreen);jq("#emptyScrCtrlPrj").html(jq.tmpl("projects_emptyScreen",u)).show();jq("#emptyScrCtrlPrj .addFirstElement").off(c).on(c,u.button.onclick);ut();return}if(t&&t.currentPage>0){t.setMaxPage(r);this.getData();return}ut()}function ri(n,i){yt();this.currentFilter.Count=t.entryCountOnPage;this.currentFilter.StartIndex=t.entryCountOnPage*t.currentPage;n({},{filter:this.currentFilter,success:function(n,t){pt();currentData=t;i.apply(null,arguments)}})}function wt(t,i){if(!t){i&&i.find(l).hide();return}i||(i=s);i.on(c,l,function(){var u,r,i,f;if(n&&(jq(l).removeClass(it),n.remove()),jq(this).is(b)){b=undefined;return}for(b=jq(this),u=t.call(this,bt(this)),n=ASC.Projects.Common.createActionPanel(s,"actionPanel",u),r=u.menuItems,i=r.length-1;i>=0;i--){f=function(t){return function(){n.hide();jq(".studio-action-panel").hide();jq(".entity-menu").removeClass("active");t.handler()}}(r[i]);jq("#"+r[i].id).on(c,f)}return ui.call(this)});i.on("contextmenu",tt,function(t){if(bt(t.target).find(l).click(),!n)return!0;var i=jq.fixEvent(t),r=document.body.clientWidth-(i.pageX-pageXOffset+n.innerWidth())>0?0:n.innerWidth(),u=document.body.clientHeight-(i.pageY-pageYOffset+n.innerHeight())>0?0:n.innerHeight();return n.css({top:i.pageY-u,left:i.pageX-r}),!1});jq("body").off(et+"1").on(et+"1",function(t){setTimeout(function(){var i=jq(t.target?t.target:t.srcElement);i.is(l)||i.parents(l).length||(n&&n.hide(),jq(".menuopen").removeClass("menuopen"),jq(l).removeClass(it),b=undefined)},1)})}function bt(n){var t=jq(n);return t.is(tt)||(t=t.parents(tt)),t}function ui(){var t=jq(this),i=t.offset(),r=i.left-n.outerWidth()+t.outerWidth(!0),u=fi(i.top+t.outerHeight(),t);n.find(".dropdown-item").show();t.addClass(it);n.css({left:r,top:u}).show()}function fi(t,i){var r=n.innerHeight(),u=jq(window),f=u.scrollTop(),e=u.height();return r<t&&e+f-r<=t&&(t=t-n.outerHeight(),i&&(t=t-i.outerHeight())),t}function ei(){typeof ht!="undefined"&&ht.unbind();typeof n!="undefined"&&n.unbind();s.unbind();w.unbind();at.unbind()}function r(n,t,i){return{notes:n,okButton:t,header:i}}var nt=!0,a=!1,v=-1,ft=!1,et="click.body",c="click",l=".entity-menu",tt=".with-entity-menu",it="active",ot="elementNotFound",p=jq("#filterContainer"),s=jq("#CommonListContainer"),w=jq("#commonPopupContainer"),st=jq(".mainPageContent .loader-page"),kt=jq("#emptyScrCtrlPrj"),y=jq("#groupActionContainer"),ht,n,b,rt,t,e,h,i,u,f,o,k,d,g,ct,lt=ASC.Projects.DescriptionPanel,at=ASC.Projects.EventBinder,dt=function(n,i,r,u,f,o){vt();yt();gt(n.elementNotFoundError);document.title=jq.format("{0} - {1}",n.moduleTitle,ASC.Projects.Resources.ProjectsJSResource.ProductName);i&&t.init(this,i);ASC.Projects.StatusList.init(r,s);wt(u);at.bind(f);lt.init(s,e,o)},ut=function(){nt?(nt=!1,st.hide(),p.show(),e&&e.resize(),s.show()):(v>0&&(clearTimeout(v),v=-1),p.is(":visible")||(p.show(),e&&e.resize()),rt.hideLoading())},ti=function(n,t,i){vt();var r=ct[n];w.html(jq.tmpl("common_containerTmpl",{options:{PopupContainerCssClass:"popupContainerClass",OnCancelButtonClick:"PopupKeyUpActionProvider.CloseDialog();",IsPopup:!0},header:{data:{title:r.header},title:"projects_common_popup_header"},body:{data:r,title:"projects_commonWarning"}}));w.off(c).on(c,".blue",t||function(){jq.unblockUI()}).on(c,".gray",i||function(){jq.unblockUI()});PopupKeyUpActionProvider.EnterAction="jq('.commonPopupContent .blue').click();";StudioBlockUIManager.blockUI(w,400,200,0)},pt=function(){lt.hide(!1);t&&t.hide();jq("#tableListProjects tbody, #milestonesList tbody, .taskList, #discussionsList, #timeSpendsList tbody, [id$='EmptyScreenForFilter'], [id^='emptyList'], .tab, .emptyScrCtrl, #descriptionTab, #descriptionTab > div").hide();var n=jq("#totalTimeText");n.length&&n.remove();y.hide()};return{baseInit:dt,clearTables:pt,getData:ri,showCommonPopup:ti,$commonListContainer:s,showOrHideData:ii,unbindEvents:ei,initActionPanel:wt,setElementNotFound:ni}}();ASC.Projects.SubtasksManager=function(){function st(n){return rt(n),!1}function ht(n,i){var r={title:n.title,responsible:c,description:""};return t.updatePrjSubtask({},i,n.id,r,{success:k}),!1}function ct(n,i){return u=jq(".subtasks[taskid="+i+"]"),t.copyPrjSubtask({taskid:i},i,n,{success:b}),!1}function lt(n,i){return t.removePrjSubtask({taskId:i},i,n,{success:pt}),!1}function at(n){var r=n.attr("id"),t=s(r),u=t.taskid,f=ASC.Projects.ActionMenuItem,i=[];return t.status!=2&&(t.responsible||i.push(new f("sta_accept",o.TasksResource.AcceptSubtask,ht.bind(null,t,u))),t.canEdit&&(i.push(new f("sta_edit",o.TasksResource.Edit,st.bind(null,r,u))),i.push(new f("sta_copy",o.CommonResource.Copy,ct.bind(null,r,u))))),t.canEdit&&i.push(new f("sta_remove",o.CommonResource.Delete,lt.bind(null,r,u))),{menuItems:i}}function b(t,i){if(u.find(".subtask").length){var r=u.find(".quickAddSubTaskLink");jq.tmpl("projects_subtaskTemplate",i).insertBefore(r)}else jq.tmpl("projects_subtaskTemplate",i).prependTo(u),u.show();jq(".subtask-loader").remove();n=jq(".subtask-name-input");n.removeAttr("disabled");n.val("");n.focus()}function k(n,t){jq('.subtask[id="'+t.id+'"]').replaceWith(jq.tmpl("projects_subtaskTemplate",t));f();bt(t)}function vt(n,t){y(n.find(".check"));setTimeout(function(){n.yellowFade()},0);var i={title:jq.trim(n.find(".taskName span").text()),responsible:c,status:"closed"};d({},t,n.attr("id"),i)}function d(n,i,r,u){t.updatePrjSubtask(n,i,r,u,{success:yt})}function yt(n,t){var i=p(t.id),r=jq(i).closest(".subtasks");i.remove();t.status==1?jq.tmpl("projects_subtaskTemplate",t).prependTo(r):jq.tmpl("projects_subtaskTemplate",t).appendTo(r);jq(".subtask-loader").remove()}function pt(n,t){p(t.id).remove()}function y(n){n.hasClass("check")&&n.find("input").hide();n.prepend('<div class="subtask-loader"><\/div>')}function g(n){r&&r.hasOwnProperty(n)?nt(r[n]):t.getPrjTeam({projectId:n},n,{success:function(n,t){r[n.projectId]=t;nt(t)}})}function nt(t){function e(n){return{id:n.id,title:n.displayName}}var i=h.excludeVisitors(t),f={id:"00000000-0000-0000-0000-000000000000",displayName:ASC.Projects.Resources.TasksResource.NoResponsible},u=jq(".subtask-responsible-selector"),r;i=h.removeBlockedUsersFromTeam(i);i=[f].concat(i);r=i.find(function(n){return n.id===a});r||(r=f);u.advancedSelector({showSearch:!1,onechosen:!0,itemsChoose:i.map(e),sortMethod:function(){return 0},inPopup:!0}).on("showList",function(t,i){u.attr("data-id",i.id).html(i.title).attr("title",i.title);n=jq(".subtask-name-input");n.focus()});u.advancedSelector("selectBeforeShow",e(r))}function tt(){var i,r;if(n=jq(".subtask-name-input"),u=n.closest(".subtasks"),i={title:n.val().trim()},i.title.length==0)return e?n.focus():f(),!1;i.responsible=jq(".subtask-responsible-selector").attr("data-id");i.taskId=u.attr("taskid");r={taskid:i.taskId};y(n.closest(".subtask-name"));e?(i.id=n.data("subtaskid"),t.updatePrjSubtask(r,i.taskId,i.id,i,{success:k})):t.addPrjSubtask(r,i.taskId,i,{success:b})}function rt(t){var r;f();e=!0;var u=p(t),i=s(t),c=i.taskid,l=ut(c),o={subtaskid:t,title:i.title,taskid:i.taskid,projectid:l.projectId,responsible:i.responsible==null?null:i.responsible.id};a=i.responsible==null?h.emptyGuid:i.responsible.id;jq.tmpl("projects_fieldForAddSubtask",o).insertAfter(u);g(o.projectid);u.find(".taskName").hide();r=jq("#quickAddSubTaskField");r.addClass("absolute");r.css("top",u.position().top+"px");r.removeClass("display-none");n=jq(".subtask-name-input");n.removeAttr("disabled");n.focus()}function f(){jq("#quickAddSubTaskField").remove();e||(jq(".task:not(.closed)").next().find(".quickAddSubTaskLink").show(),jq("#subtaskContainer .quickAddSubTaskLink").show());jq(".subtask .taskName").show();e=!1}function wt(n){i=n}function ut(n){for(var t=0,r=i.length;t<r;t++)if(i[t].id==n)return i[t]}function s(n){for(var u,t,e,r=0,f=i.length;r<f;r++)for(u=i[r].subtasks,t=0,e=u.length;t<e;t++)if(u[t].id==n)return u[t]}function bt(n){for(var u,t,e,r=0,f=i.length;r<f;r++)for(u=i[r].subtasks,t=0,e=u.length;t<e;t++)if(u[t].id==n.id){u[t]=n;return}}function p(n){return jq(".subtasks div[id="+n+"]:visible")}var h=ASC.Projects.Common,c,l,r={},u=null,e=!1,a=null,w,i,v="click",n,t,o=ASC.Projects.Resources,ft=27,et=13,ot=function(){if(!w){w=!0;t=Teamlab;c=t.profile.id;l=jq.getURLParam("prjID");l&&(r={},r[l]=ASC.Projects.Master.Team);ASC.Projects.DescriptionPanel.init(jq("#CommonListContainer"),null,{getItem:function(n){var t=jq(n),i=t.parents(".subtask");return s(i.attr("id"))},selector:".subtask .taskName span"});jq(document).on("dblclick",".subtask .taskName",function(){var n=jq(this),t;return!n.is(".canedit")||n.parent(".subtask").is(".closed")?!1:(t=n.parent(".subtask").attr("id"),rt(t),!0)});jq(document).on(v,".subtask-add-button .button",function(){return tt(),!1});jq(document).on("keydown",".subtask-name-input",function(n){switch(n.which){case ft:f();break;case et:jq(this).prop("disabled",!0);tt()}});jq(document).on("change",".subtask .check input",function(){var n=jq(this).parents(".subtask"),t=n.attr("id"),r=s(t),i=r.taskid;jq(this).is(":checked")?vt(n,i):(y(n.closest(".check")),d({},i,t,{status:"open"}))});jq(document).on(v,".quickAddSubTaskLink span",function(){return it(jq(this).parent()),!1});jq(document).on(v,"#quickAddSubTaskField",function(){n=jq(".subtask-name-input");n.focus()});t.bind(t.events.updatePrjTeam,function(n,t){r[n.projectId]=t})}},it=function(t){f();var i=ut(t.parents(".subtasks").attr("taskid"));i&&(jq.tmpl("projects_fieldForAddSubtask",{subtaskid:"-1",title:"",projectid:"",responsible:null}).insertAfter(t),a=null,g(i.projectId),t.hide(),jq("#quickAddSubTaskField").removeClass("display-none"),n=jq(".subtask-name-input"),n.focus())};return{init:ot,hideSubtaskFields:f,addFirstSubtask:it,setTasks:wt,showEntityMenu:at}}(jQuery);ASC.Projects.TasksManager=function(){function kt(){var v,r,e;if(i=Teamlab,it=i.profile.id,a=jq.getURLParam("prjID"),tt===!1){t=this;tt=!0;function s(n){return n.canCreateTask&&n.status===0}v=[{id:"gaClose",title:n.CloseTask,handler:ui,checker:function(n){return n.canEdit&&n.status===1}},{id:"gaMove",title:h.Move,handler:fi,checker:function(n,t,i){if(t>0){var r=i[t-1];if(r&&r.projectId!==n.projectId)return!1}return n.canEdit&&n.status!==2}},{id:"gaDelete",title:w.CommonResource.Delete,handler:ei,checker:function(n){return n.canDelete}}];t.showOrHideData=t.showOrHideData.bind(t,{$container:f,tmplName:ot,baseEmptyScreen:{img:"tasks",header:n.NoTasksCreated,description:jq.format(n.TasksHelpTheManage,n.DescrEmptyListTaskFilter),button:{title:n.AddFirstTask,onclick:ct,canCreate:function(){return a?s(et):g.Projects.some(s)}}},filterEmptyScreen:{header:n.NoTasks,description:n.DescrEmptyListTaskFilter},groupMenu:{actions:v,getItemByCheckbox:d,getLineByCondition:function(n){return u.filter(n).map(function(n){return f.find("[taskid="+n.id+"]")})},multiSelector:[{id:"gasOpen",title:n.Open,condition:function(n){return n.status===1}},{id:"gasClosed",title:n.Closed,condition:function(n){return n.status===2}}]}});t.getData=t.getData.bind(t,i.getPrjTasks,gi);ci()}r=ASC.Projects.Event;e=i.events;t.baseInit({moduleTitle:h.TasksModule,elementNotFoundError:h.TaskNotFound},{pagination:"tasksKeyForPagination"},{handler:li,getItem:d,statuses:[{cssClass:"open",text:n.Open,id:1},{cssClass:"closed",text:n.Closed,id:2}]},dt,[r(e.addPrjTask,nr),r(e.updatePrjTask,wt),r(e.updatePrjTaskStatus,fr),r(e.removePrjTask,tr),r(e.addSubtask,ir),r(e.removeSubtask,rr),r(e.updateSubtask,ur),r(e.getPrjProject,function(n,t){et=t})],{getItem:d,selector:".task .taskName a",getLink:function(n){return"tasks.aspx?prjID="+n.projectOwner.id+"&id="+n.id}});c.init();k.createAdvansedFilterForTasks(t);a&&(bt=g.Team);rt.on(l,".user",function(){k.addUser("tasks_responsible",jq(this).attr("userId"),["noresponsible"])});jq(".addTask").on(l,function(){return ct(),!1});f.on(l,".task .user",function(n){var r=jq(this).parent().attr(p),t=o(r),i=t.responsible?t.responsible.id:null;i==null?k.add("noresponsible",!0,["tasks_responsible","group"]):k.addUser("tasks_responsible",i,["noresponsible","group"]);n.stopPropagation()});f.on(l,".task .other",function(n){jq(".studio-action-panel").hide();rt.html(jq.tmpl("projects_taskListResponsibles",d(n.target)));bi.call(this);n.stopPropagation()});f.on(l,".task",function(n){var t=jq(n.target?n.target:n.srcElement);if(!t.is("a")&&!t.is(".changeStatusCombobox.canEdit")&&!t.parent().is(".changeStatusCombobox.canEdit")&&!t.is(".entity-menu")&&!t.is("input")&&!t.parent().is(".entity-menu")&&!t.is(".noSubtasks:not(.canedit)")){c.hideSubtaskFields();var r=jq(this).attr(p),i=o(r),u=!i.subtasks||i.subtasks.every(function(n){return n.status===2});lt(i,i.status===1&&u)}})}function dt(t){var s;if(c.hideSubtaskFields(),t.is(".subtask"))return c.showEntityMenu(t);var e=t.attr(p),i=o(e),u=[],f=ASC.Projects.ActionMenuItem;return i.status!==2&&(i.canEdit&&(u.push(new f("ta_edit",n.Edit,ni.bind(null,i))),u.push(new f("ta_move",n.MoveToMilestone,ii.bind(null,i))),u.push(new f("ta_mesres",n.MessageResponsible,si.bind(null,e)))),i.responsible||u.push(new f("ta_accept",n.AcceptSubtask,gt.bind(null,i))),i.canCreateSubtask&&u.push(new f("ta_subtask",n.AddSubtask,ti.bind(null,e))),s=r.getProjectById(i.projectId),s&&s.canCreateTask&&u.push(new f("ta_copy",w.CommonResource.Copy,oi.bind(null,i)))),i.canCreateTimeSpend&&u.push(new f("ta_time",n.TrackTime,hi.bind(null,i))),i.canDelete&&u.push(new f("ta_remove",w.CommonResource.Delete,ri.bind(null,e))),{menuItems:u}}function gt(n){var t={title:jq.trim(n.title),priority:n.priority,responsibles:[it]},u=n.deadline,r;return u&&(t.deadline=new Date(u),t.deadline.setHours(0),t.deadline.setMinutes(0),t.deadline=i.serializeTimestamp(t.deadline)),r=n.description,r&&(t.description=r),typeof n.milestone!="undefined"&&n.milestone!=null&&(t.milestoneid=n.milestone.id),i.updatePrjTask({},n.id,t),!1}function ni(n){return e.TaskAction.showUpdateTaskForm(n),!1}function ti(n){c.hideSubtaskFields();var t=b(n);return t.is(":visible")||yt(t),c.addFirstSubtask(t.find(".quickAddSubTaskLink")),!1}function ii(n){return pt([n]),!1}function ri(n){return t.showCommonPopup("taskRemoveWarning",function(){i.removePrjTask({taskId:n},n)}),!1}function ui(n){for(var f,u=n.map(o),i=!1,r=0;r<u.length;r++)if(f=u[r],i=f.subtasks.some(function(n){return n.status===1}),i)break;return i?t.showCommonPopup("closedTasksQuestion",function(){ht(n);jq.unblockUI()}):ht(n),!1}function ht(n){i.updatePrjTasksStatus({taskids:n,status:2},{success:function(n,t){for(var u=0;u<t.length;u++)i.call(i.events.updatePrjTaskStatus,this,[{disableMessage:!0},t[u]]);nt.deselectAll();r.displayInfoPanel(h.TasksUpdated)}})}function fi(n){return pt(n.map(o)),!1}function ei(n){return t.showCommonPopup("tasksRemoveWarning",function(){i.removePrjTasks({taskids:n},{success:function(n,t){for(var u=0;u<t.length;u++)i.call(i.events.removePrjTask,this,[{disableMessage:!0},t[u]]);r.displayInfoPanel(h.TasksRemoved)}})}),!1}function oi(n){return e.TaskAction.showCopyTaskForm(n),!1}function si(n){return yi({},n),!1}function hi(n){return r.showTimer(n.projectId,n.id,n.responsible||it),!1}function ci(){r.createActionPanel(t.$commonListContainer,"othersPanel",{menuItems:[]});jq("#othersPanel .dropdown-content").attr("id","othersListPopup");rt=jq("#othersListPopup");y=jq("#moveTaskPanel");y.on(l,".blue",function(){function e(){i.updatePrjTasksMilestone(s,{error:function(){jq.unblockUI()},success:function(n,t){for(var u=0;u<t.length;u++)i.call(i.events.updatePrjTask,this,[{disableMessage:!0},t[u]]);nt.deselectAll();r.displayInfoPanel(h.TasksUpdated)}})}for(var t,u=st,o=u.map(function(n){return n.id}),n=[],s={milestoneid:y.find(".milestonesList input:checked").attr("value"),taskids:o},f=0;f<u.length;f++)t=u[f],t.links&&t.links.length&&(n=n.concat(t.links));n.length?ASC.Projects.Base.showCommonPopup("taskLinksRemoveWarning",function(){for(var r,t=0;t<n.length;++t)r={dependenceTaskId:n[t].dependenceTaskId,parentTaskId:n[t].parentTaskId},i.removePrjTaskLink({},n[t].dependenceTaskId,r,{success:function(){}});e()},function(){jq.unblockUI();StudioBlockUIManager.blockUI(y,550,300,0)}):e()}).on(l,".gray",function(){return jq.unblockUI(),!1})}function li(n,t){var r,u,i;t===2?(r=o(n),u=r.subtasks.some(function(n){return n.status===1}),u?wi(n):at(n)):(i=s(n),i.find(".check div").hide(),i.find(".check").append(ut),vt({},n,1))}function ct(){e.TaskAction.showCreateNewTaskForm()}function lt(n,t){var i=b(n.id),r;return(t&&c.addFirstSubtask(i.find(".quickAddSubTaskLink")),r=n.subtasks.length,i.is(":visible"))?(i.hide(),!0):!r&&!t?!1:(r&&yt(i),i.show(),!0)}function o(n){for(var t=0,i=u.length;t<i;t++)if(u[t].id==n)return u[t]}function d(n){return o(jq(n).parents(".task").attr(p))}function ai(n){for(var t=0,i=u.length;t<i;t++)if(u[t].id==n.id){u[t]=n;break}}function vi(n,t){for(var i=0,r=n.subtasks.length;i<r;i++)if(n.subtasks[i].id===t.id){n.subtasks[i]=t;break}}function at(n){jq(".taskProcess").remove();s(n).find(".check").html(ut);vt({},n,2)}function vt(n,t,u){i.updatePrjTask(n,t,{status:u},{error:function(n,i){var u=s(t);u.find(".taskProcess").remove();u.find(".check div").show();r.displayInfoPanel(i[0],!0)}})}function yi(t,u){i.notifyPrjTaskResponsible(t,u,{success:r.displayInfoPanel.bind(null,n.MessageSend)})}function ft(n){var t=n.id,i=s(t),r=i.find(".subtasksCount");r.html(jq.tmpl("projects_numSubtasksTmpl",n))}function pi(n){return new Date>n}function yt(n){var t=n.find(".subtask.closed");n.find(".st_separater").after(t);n.show()}function wi(n){t.showCommonPopup("closedTaskQuestion",function(){at(n);jq.unblockUI()})}function pt(t){var f=g.Milestones.filter(function(n){return n.status===0&&n.projectId==t[0].projectId}).concat([{id:0,title:n.None}]),i,u;st=t;f.forEach(function(n){n.checked=t.some(function(t){return(t.milestoneId||0)==n.id})});t.length===1?(i=n.MoveTaskToAnotherMilestone,u={title:n.Task,description:t[0].title,moveToMilestone:n.MoveToMilestone}):(i=n.MoveTasksToAnotherMilestone,u={title:n.TasksCount,description:t.length,moveToMilestone:n.MoveTasksToMilestone});y.html(jq.tmpl("common_containerTmpl",{options:{PopupContainerCssClass:"popupContainerClass",OnCancelButtonClick:"PopupKeyUpActionProvider.CloseDialog();",IsPopup:!0},header:{data:{title:i},title:"projects_common_popup_header"},body:{title:"projects_move_task_panel",data:{milestones:f.sort(r.milestoneSort),describe:u}}}));StudioBlockUIManager.blockUI(y,550,300,0);PopupKeyUpActionProvider.EnterAction="$moveTaskPanel.find('.blue').click();"}function bi(){var r=jq(this),u=r.offset(),e=u.left,n=u.top+r.outerHeight(),t=jq("#othersPanel"),i=t.innerHeight(),f=jq(window),o=f.scrollTop(),s=f.height();i<n&&s+o-i<=n&&(n=n-i);t.css({left:e,top:n}).show();jq("body").off("click.body2").on("click.body2",function(){setTimeout(function(){t&&t.hide()},1)})}function ki(n){for(var i=0,t=0;t<n.length;t++)n[t].status!=2&&i++;return i}function di(){tt&&(t.unbindEvents(),f.unbind())}function gi(n,i){u=i;t.$commonListContainer.height("auto");f.height("auto");v=n.__total!=undefined?n.__total:0;t.showOrHideData(i,v);c.setTasks(i);f.off("click.taskItem").on("click.taskItem",".taskName a",e.Common.goToWithoutReload)}function nr(n,i){(a=jq.getURLParam("prjId"),a&&a!=i.projectId||jq.getURLParam("id")!==null)||(v++,u.unshift(i),t.showOrHideData(u,v),f.find(".task:first").yellowFade())}function wt(n,t){var i=t.id;b(i).remove();s(i).replaceWith(jq.tmpl(ot,t));s(i).yellowFade();ai(t);jq.unblockUI();n&&n.disableMessage||r.displayInfoPanel(h.TaskUpdated)}function tr(n,i){var f=i.id,e;s(f).remove();b(f).remove();v--;u=u.filter(function(n){return n.id!==f});t.showOrHideData(u,v);s(f).html(ut);jq.unblockUI();n&&n.disableMessage||r.displayInfoPanel(h.TaskRemoved);e=r.getProjectById(i.projectOwner.id);e&&e.taskCountTotal--;r.changeTaskCountInProjectsCache(i,2)}function ir(n,t){var i=o(t.taskid);i.subtasks.push(t);ft(i)}function rr(n,t){var r=t.taskid,i=o(r);i.subtasks=i.subtasks.filter(function(n){return n.id!==t.id});t.status==1&&ft(i);b(r).find(".subtask").length||lt(i)}function ur(n,t){var i=o(t.taskid);vi(i,t);ft(i)}function fr(n,t){r.changeTaskCountInProjectsCache(t,1);nt.deselectAll();wt(n,t);setTimeout(function(){s(t.Id).yellowFade()},0)}function s(n,t){return f.find(jq.format(".task[{0}={1}]{2}",p,n,t?":first":""))}function b(n,t){return f.find(jq.format(".subtasks[{0}={1}]{2}",p,n,t?":first":""))}var e=ASC.Projects,w=e.Resources,n=w.TasksResource,h=w.ProjectsJSResource,k=e.ProjectsAdvansedFilter,r=e.Common,c=e.SubtasksManager,g=e.Master,nt=e.GroupActionPanel,tt=!1,it,a,u=[],bt=undefined,v=0,f=jq(".taskList"),y,rt,et,t,i,l="click",ot="projects_taskListItemTmpl",p="taskid",ut='<div class="taskProcess"><\/div>',st;return jq.extend({init:kt,openedCount:ki,compareDates:pi,unbindListEvents:di,basePath:"sortBy=deadline&sortOrder=ascending"},ASC.Projects.Base)}(jQuery);ASC.Projects.TaskDescriptionPage=function(){function ur(){function i(t){n.files.push(t);lt.rewrite();ProjectDocumentsPopup.reset()}gt=n.project.projectFolder;ci=Encoder.htmlEncode(n.projectTitle);var t="task";o=Attachments;n.canEdit||o.banOnEditing();ProjectDocumentsPopup.init(gt,ci);o.isLoaded=!1;o.init(t,function(){return n.id});o.setFolderId(gt);o.loadFiles(n.files);o.bind("addFile",function(n,u){u.attachFromPrjDocFlag||u.isNewFile?r.addPrjEntityFiles(null,a,t,[u.id],{success:function(){i(u)}}):i(u)});o.bind("deleteFile",function(i,u){r.removePrjEntityFiles({},a,t,u,{success:function(){n.files=n.files.filter(function(n){return n.id!==u});o.deleteFileFromLayout(u);lt.rewrite()}})});o.bind("loadAttachments",function(n,t){t<1&&ri.show()});nt(r.events.getDocFolder,function(){for(var i=jq(".fileList li"),t=0,r=n.files.length;t<r;t++)i.find("input#"+n.files[t].id).prop("checked",!0)})}function vi(n){return n.forEach(function(n){n.commentList.length&&(n.commentList=vi(n.commentList))}),n.filter(function(n){return!(n.inactive&&n.commentList.length===0)})}function yi(){var i,t,f;if(kt=[],i=u.filterParamsForListTasks,i.projectId=bt,i.status=1,i.milestone=n.milestone?n.milestoneId:0,n.links)for(t=0;t<n.links.length;t++)f=n.links[t].parentTaskId==n.id?n.links[t].dependenceTaskId:n.links[t].parentTaskId,kt.push(f),tt[f]=n.links[t];r.getPrjTasks({},{success:vu,filter:i})}function pi(){setTimeout(function(){it||at.hide(100)},200)}function fr(n){CommentsManagerObj.isShowAddCommentBtn=n.canCreateComment;CommentsManagerObj.total=n.comments.length;CommentsManagerObj.isEmpty=n.comments.length===0;CommentsManagerObj.moduleName="projects_Task";CommentsManagerObj.comments=jq.base64.encode(JSON.stringify(n.comments));CommentsManagerObj.objectID="common";CommentsManagerObj.Init();CommentsManagerObj.objectID=n.id;jq("#hdnObjectID").val(n.id);jq("#commentsTitle").remove();ai.css("width","100%");var t=yt+".comments";jq("#btnCancel").off(t).on(t,function(){ht=!1;rt.select()});jq("#mainCommentsContainer div[id^='container_'] a[id^='edit_']").off(t).on(t,function(){ht=!0});jq(document).off("keydown.taskdescr").on("keydown.taskdescr",function(n){n.keyCode==27&&(st(!0),ot.show())})}function er(n){e.empty();e.attr("taskid",n.id);var t="projects_taskDescriptionSubtasksContainerTmpl";n.subtasks.length==0?jq.tmpl(t,n).prependTo(e):(jq.tmpl(t,n).prependTo(e),e.find(".st_separater").after(e.find(".closed")),n.status==2&&(e.find(".quickAddSubTaskLink").remove(),e.find(".subtask .check input").attr("disabled",!0)),v.selected&&e.show());jq(document).off("keydown.description").on("keydown.description",".subtask-name-input",function(n){switch(n.which){case 27:v.select()}})}function or(){var t={title:n.title,responsibles:[si],description:n.description,priority:n.priority};return n.deadline&&(t.deadline=n.deadline),n.milestoneId&&(t.milestoneid=n.milestoneId),r.updatePrjTask({},a,t),!1}function sr(){e.find(".subtask").length!=e.find(".subtask.closed").length?gr():tr()}function hr(){jq("body").css("cursor","wait");r.updatePrjTask({},a,{status:1},{success:nr});jq(".pm_taskTitleClosedByPanel").hide()}function cr(){p.TaskAction.showUpdateTaskForm(n)}function lr(){ASC.Projects.Base.showCommonPopup("taskRemoveWarning",function(){r.removePrjTask({},a)})}function ar(){u.showTimer(n.projectId,n.id)}function vr(n){bi(!0,n)}function yr(n){gi(n,!0)}function pr(i){var u="",e=jq.timeFormat(i.timeSpend).split(":"),o={hours:e[0],minutes:e[1]},r;i.status==2&&(u=i.updatedBy!=undefined?i.updatedBy.displayName:i.createdBy.displayName);r=ASC.Projects.DescriptionTab;r.init().push(f.ProjectResource.Project,ir(i.projectOwner.title),"tasks.aspx?prjID="+i.projectOwner.id).push(f.MilestoneResource.Milestone,i.milestone?jq.format("[{0}] {1}",i.milestone.displayDateDeadline,i.milestone.title):"").push(t.TaskStartDate,i.displayDateStart).push(t.EndDate,i.displayDateDeadline,undefined,ASC.Projects.TasksManager.compareDates(i.deadline)?"<span class='deadlineLate'>{0}<\/span>":undefined).push(t.Priority,i.priority===1?t.HighPriority:undefined,undefined,'<span class="colorPriority high"><span>{0}<\/span><\/span>').push(t.AssignedTo,i.responsibles.length===0?t.WithoutResponsible:i.responsibles.map(function(n){return n.displayName}).join(", ")).push(f.CommonResource.SpentTotally,i.canCreateTimeSpend&&i.timeSpend?jq.format("{0} {1}",o.hours+f.TimeTrackingResource.ShortHours,o.minutes+f.TimeTrackingResource.ShortMinutes):"","timetracking.aspx?prjID="+i.projectOwner.id+"&id="+i.id).push(t.CreatingDate,i.displayDateCrtdate).push(t.TaskProducer,i.createdBy.displayName).push(t.ClosingDate,i.status===2?i.displayDateUptdate:"").push(t.ClosedBy,u).push(f.CommonResource.Description,jq.linksParser(ir(i.description))).pushStatus(t.Open,1,hr).pushStatus(t.Closed,2,sr).setCurrentStatus(i.status).setStatusRight(n.canEdit).tmpl();ni.selected?r.show():r.hide();i.canEdit||jq("div.buttonContainer").remove();i.timeSpend&&jq(".timeSpend").show();jq(".subscribeLink").show()}function wr(t){var i=ct[t],r=n.startDate?n.startDate:n.crtdate,f=i.startDate?i.startDate:i.crtdate,e=n.deadline?n.deadline:undefined,o=i.deadline?i.deadline:undefined,s=u.getPossibleTypeLink(r,e,f,o,!0);s[2]==u.linkTypeEnum.start_end?ut.text(l.RelatedLinkTypeSE).data("value",u.linkTypeEnum.start_end):ut.text(l.RelatedLinkTypeES).data("value",u.linkTypeEnum.end_start)}function pt(n,t){var i=Math.abs(n.getTime()-t.getTime());return(i=Math.floor(i/864e5),i==0)?0:i==1?i+" "+l.DelayDay:i+" "+l.DelayDays}function br(t,i,r){var e=t.startDate?t.startDate:t.crtdate,o=i.startDate?i.startDate:i.crtdate,s=t.deadline?t.deadline:t.milestone?t.milestone.deadline:undefined,h=i.deadline?i.deadline:i.milestone?i.milestone.deadline:undefined,f={};f.invalidLink=!1;f.delay=0;f.possibleLinkType=u.getPossibleTypeLink(e,s,o,h,f);f.linkType=r.linkType;r.linkType==2&&(r.parentTaskId==n.id?(f.linkType=u.linkTypeEnum.end_start,f.possibleLinkType[3]!=u.linkTypeEnum.end_start&&(f.invalidLink=!0)):(f.linkType=u.linkTypeEnum.start_end,f.possibleLinkType[2]!=u.linkTypeEnum.start_end&&(f.invalidLink=!0)));switch(f.linkType){case u.linkTypeEnum.start_start:f.linkTypeText=l.RelatedLinkTypeSS;f.delay=pt(e,o);f.invalidLink=!1;break;case u.linkTypeEnum.end_end:f.linkTypeText=l.RelatedLinkTypeEE;f.delay=pt(s,h);f.invalidLink=!1;break;case u.linkTypeEnum.start_end:f.linkTypeText=l.RelatedLinkTypeSE;f.delay=pt(h,e);break;case u.linkTypeEnum.end_start:f.linkTypeText=l.RelatedLinkTypeES;f.delay=pt(s,o)}return f}function wi(t,i){var r=ct[t];return r?(r.relatedTaskObject=br(n,r,i),r):null}function bi(n,t){var r,f,u,e,o;n?(r=y.find("tr[data-taskid="+t+"]"),s.css("position","absolute"),f=r.offset().top-jq("#linkedTasksContainer").offset().top-1+"px",s.css("top",f),s.attr("data-edit","edit"),u=i.find("option[value="+t+"]"),u.removeClass(b),u.prop("selected",!0),i.change(),e=tt[t],c=e,c.targetTaskId=t,o=parseInt(r.find(".link-type").data("type")),ut.data("value",o)):(s.is(":visible")&&st(!0),s.addClass("border-top"),s.addClass("border-bottom"),y.css("marginTop","0"),i.val("-1"),ut.text(""));s.removeClass(b)}function st(n){c&&(n&&i.find("option[value="+c.targetTaskId+"]").addClass(b),c=null);i.val("-1");s.css("position","static");s.removeClass("border-top");s.removeClass("border-bottom");s.addClass(b);d.selected&&d.select()}function kr(){var n=i.find("option:first"),t,r;for(i.empty(),i.append(n),t=0,r=k.length;t<r;t++)n=document.createElement("option"),n.setAttribute("value",k[t].id),tt[k[t].id]&&n.setAttribute("class",b),n.appendChild(document.createTextNode(k[t].title)),i.append(n)}function wt(){i.find("."+b).length==i.find("option").length-1||n.status==2?ft.addClass("disabled"):ft.removeClass("disabled")}function dr(){for(var u,r=[],f=n.links.length,t=0;t<f;t++)u=n.links[t].parentTaskId==n.id?n.links[t].dependenceTaskId:n.links[t].parentTaskId,r.push(wi(u,n.links[t]));jq(".tab1").html(jq.tmpl("projects_taskLinksContainer",{canEdit:n.canEdit,tasks:r})).show();et=jq("#linkedTasksContainer");d.$container=et;s=jq("#editTable");y=jq("#relatedTasks");i=jq("#taskSelector");ut=jq("#linkTypeSelector");li=jq("#addLink");ft=jq("#addNewLink");at=jq("#hintInvalidLink");ot=jq(".linked-tasks-buttons");ASC.Projects.Base.initActionPanel(iu,et);y.on("mouseenter",".invalid-link",function(){it=!0;var n=this;setTimeout(function(){it&&jq(n).helper({BlockHelperID:"hintInvalidLink",addLeft:8,addTop:14})},1e3)});y.on("mouseleave",".invalid-link",function(){it=!1;pi()});at.mouseenter(function(){it=!0});at.mouseleave(function(){it=!1;pi()});ft.on(yt,function(){ft.hasClass("disabled")||(ot.hide(),bi(!1,{}))});li.on(yt,function(){var r={},t=parseInt(ut.data("value"));if(t=="-1"||i.val()=="-1"){st();ot.show();return}r=t==2?{parentTaskId:i.val(),dependenceTaskId:n.id,linkType:t}:{parentTaskId:n.id,dependenceTaskId:i.val(),linkType:t};t==3&&(r.linkType=2);w.displayLoading();c?(gi(c.targetTaskId,!1),di(r,c.targetTaskId)):di(r)});i.change(function(){var n=i.val();n!="-1"&&wr(n)})}function ki(t,r){var u,f;n.links?n.links.push(t):(n.links=[],n.links.push(t));u=t.parentTaskId==n.id?t.dependenceTaskId:t.parentTaskId;tt[u]=t;f=wi(u,t);r?r.after(jq.tmpl("projects_taskLinks",[f])):jq.tmpl("projects_taskLinks",[f]).prependTo(y);i.find("option[value="+u+"]").addClass(b)}function ei(n){pr(n);er(n);fr(n)}function gr(){ASC.Projects.Base.showCommonPopup("closedTaskQuestion",tr,pu)}function nu(){r.subscribeToPrjTask({},a,{success:function(){n.isSubscribed=!n.isSubscribed;var i="subscribed",r="unsubscribed";n.isSubscribed?(g.attr("title",t.UnfollowTask),g.removeClass(r).addClass(i)):(g.attr("title",t.FollowTask),g.removeClass(i).addClass(r))}})}function di(n,t){r.addPrjTaskLink({link:n,removedLinkTaskId:t},n.parentTaskId,n,{success:uu,error:fu})}function gi(n,t){var i=tt[n];r.removePrjTaskLink({taskId:n,removeElemFlag:t},i.dependenceTaskId,{dependenceTaskId:i.dependenceTaskId,parentTaskId:i.parentTaskId},{success:ru,error:function(){}})}function tu(){var i=[],r=ASC.Projects.ActionMenuItem;return n.status!==2&&n.canEdit&&(n.responsibles.length===0&&i.push(new r("ta_accept",t.Accept,or)),i.push(new r("ta_edit",t.EditTask,cr))),n.canDelete&&i.push(new r("ta_remove",t.RemoveTask,lr)),n.canCreateTimeSpend&&i.push(new r("ta_startTimer",f.CommonResource.AutoTimer,ar)),{menuItems:i}}function iu(n){var i=n.data("taskid"),r=[new ASC.Projects.ActionMenuItem("lta_edit",t.Edit,vr.bind(null,i)),new ASC.Projects.ActionMenuItem("lta_remove",f.CommonResource.Delete,yr.bind(null,i))];return{menuItems:r}}function ru(t){t.removeElemFlag&&(y.find("tr[data-taskid="+t.taskId+"]").remove(),w.hideLoading());n.links=n.links.filter(function(n){return n.dependenceTaskId!=t.taskId&&n.parentTaskId!=t.taskId});t.removeElemFlag&&d.select();delete tt[t.taskId];c=null;i.find("option[value="+t.taskId+"]").removeClass(b);wt()}function uu(n){if(st(),n.removedLinkTaskId){var t=y.find("tr[data-taskid="+n.removedLinkTaskId+"]");ki(n.link,t);t.remove()}else ki(n.link);ot.show();wt();d.select();w.hideLoading()}function fu(){w.hideLoading();ASC.Projects.Base.showCommonPopup("createNewLinkError");st();dt=!0;yi()}function eu(i,r){var e;n=r;yi();a=r.id;ur();r.comments=vi(r.comments);var o={img:"subtasks",header:t.SubtasksEmptyScreen_Header,description:t.SubtasksEmptyScreen_Describe,button:{title:t.AddNewSubtask,onclick:function(){vt.find(".quickAddSubTaskLink .link").click()},canCreate:function(){return n.status!==2&&n.canCreateSubtask}}},s={img:"relatedtasks",header:t.RelatedTasksEmptyScreen_Header,description:t.RelatedTasksEmptyScreen_Describe,button:{title:t.CreateNewLink,onclick:function(){ft.click()},canCreate:function(){return n.status===1&&n.canEdit&&k.length}}},c={img:"comments",header:t.CommentsEmptyScreen_Header,description:t.CommentsEmptyScreen_Describe,button:{title:ASC.Resources.Master.TemplateResource.AddNewCommentButton,onclick:function(){jq("#add_comment_btn").click()},canCreate:function(){return n.canCreateComment}}},u=ASC.Projects.Tab;ni=new u(f.ProjectsJSResource.OverviewModule,function(){return 0},"overViewModule",jq(".tab"),"#");v=new u(t.Subtasks,function(){return n.subtasks.length},"subtasksModule",vt,"#subtasks",function(){return n.canEdit||n.subtasks.length},o);lt=new u(ASC.Projects.Resources.CommonResource.DocsModuleTitle,function(){return n.files.length},"documentsModule",ri,"#documents",function(){return n.canReadFiles&&(n.canEditFiles||n.files.length)});d=new u(t.RelatedTask,function(){return n.links.length},"linksModule",et,"#links",function(){return n.canEdit||n.links.length},s);rt=new u(f.MessageResource.Comments,function(){return n.commentsCount},"commentsModule",ui,"#comments",function(){return!0},c);ti=new u(f.ProjectResource.GanttGart,function(){return 0},"ganttchartModule",null,"ganttchart.aspx",function(){return!jq.browser.mobile&&r.projectOwner.status===0});ti.href="ganttchart.aspx?prjID="+r.projectId;ii=new u(f.ProjectsJSResource.TimeTrackingModule,function(){var n=jq.timeFormat(r.timeSpend).split(":"),t={hours:n[0],minutes:n[1]};return jq.format("{0}:{1}",t.hours,t.minutes)},"timetrackingModule",null,"timetracking.aspx",function(){return r.canCreateTimeSpend&&r.timeSpend});ii.href="timetracking.aspx?prjID="+r.projectOwner.id+"&id="+r.id;e={uplink:ASC.Projects.Common.UpLink||"tasks.aspx?prjID="+r.projectId,icon:"tasks",title:r.title,subscribed:r.isSubscribed,subscribedTitle:r.isSubscribed?t.UnfollowTask:t.FollowTask};p.InfoContainer.init(e,tu,[ni,v,lt,d,rt,ii,ti]);g=jq("#subscribe");g.on(yt,nu);jq("#descriptionTab").show();w.hideLoading();h=[n];p.SubtasksManager.setTasks(h);ei(r)}function ou(t,i){n=i;!i.canEdit&&o&&o.banOnEditing();p.InfoContainer.updateTitle(i.title);ei(i);jq.unblockUI();u.displayInfoPanel(l.TaskUpdated)}function su(){jq.unblockUI();var n="tasks.aspx?prjID="+bt;window.location.replace(n)}function hu(n,t){h[0].subtasks=h[0].subtasks.filter(function(n){return n.id!==t.id});v.select()}function cu(n,t){h[0].subtasks.push(t);v.rewrite()}function lu(n,t){for(var i=0,r=h[0].subtasks.length;i<r;i++)if(h[0].subtasks[i].id===t.id){h[0].subtasks[i]=t;break}v.rewrite()}function nr(t,i){n=i;h[0].subtasks=n.subtasks;v.rewrite();ei(i);jq("body").css("cursor","default");wt();jq.unblockUI()}function au(n,t){var r=t.length,i;if(r)for(i=0;i<r;i++)t[i].status==2&&(ct[t[i].id]=t[i]);dr();kr();wt()}function vu(t,i){var f,u;if(hi=[],k=[],f=i.length,f)for(u=0;u<f;u++)i[u].id==n.id&&dt&&(dt=!1),i[u].status==1&&i[u].id!=n.id&&(hi.push(i[u]),(i[u].deadline||n.deadline)&&k.push(i[u])),ct[i[u].id]=i[u];r.getPrjTasksById({},{taskid:kt},{success:au})}function yu(){n.commentsCount--;rt.select();n.commentsCount===0&&rt.select()}function tr(){jq("body").css("cursor","wait");r.updatePrjTask({},a,{status:2},{success:nr})}function pu(){ASC.Projects.DescriptionTab.resetStatus(n.status);jq.unblockUI()}function ir(n){var t=n.replace(/</ig,"&lt;").replace(/>/ig,"&gt;").replace(/\n/ig,"<br/>");return t.replace("&amp;","&")}function wu(n){var t=new Date;return t>n?!0:t<=n?!1:void 0}function bu(){jq(".project-info-container").hide();jq("#descriptionTab").hide();jq(document).off("keydown.taskdescr");jq(document).off("keydown.description");o.unbind();ku()}function nt(n,t){fi.push(r.bind(n,t))}function ku(){while(fi.length){var n=fi.shift();r.unbind(n)}}var oi=!1,n={},h=[],a=undefined,bt=undefined,si,ht=!1,ct={},hi=[],k=[],kt=[],tt={},c=null,dt=!1,it=!1,gt,ci,ni,v,lt,d,rt,ti,ii,s,y,i,ut,li,ft,at,g,vt,ri,ui,ai,e,et,ot,p=ASC.Projects,f=p.Resources,l=f.ProjectsJSResource,t=f.TasksResource,u=p.Common,r,o,w,fi=[],b="display-none",yt="click",rr=function(){var t,i;oi===!1&&(oi=!0);vt=jq("#subtaskContainer");ri=jq("#filesContainer");ui=jq("#commonCommentsContainer");ai=ui.find("#mainCommentsContainer");e=vt.find(".subtasks");jq(".tab1").html(jq.tmpl("projects_taskLinksContainer",{canEdit:!1,tasks:[]}));et=jq("#linkedTasksContainer");r=Teamlab;w=LoadingBanner;w.displayLoading();si=Teamlab.profile.id;jq("#CommonListContainer").show();t=r.events;nt(t.addSubtask,cu);nt(t.removeSubtask,hu);nt(t.updateSubtask,lu);nt(t.updatePrjTask,ou);nt(t.removePrjTask,su);nt(t.addPrjComment,function(){ht?ht=!1:CommentsManagerObj.editorInstance.getData()&&(n.commentsCount++,rt.rewrite())});p.SubtasksManager.init();ASC.Projects.Base.initActionPanel(p.SubtasksManager.showEntityMenu,e);bt=jq.getURLParam("prjID");i=jq.getURLParam("id");i!=null?r.getPrjTask({},i,{success:eu,error:function(n,t){t[0]==="Item not found"&&ASC.Projects.Base.setElementNotFound()}}):(g.remove(),w.hideLoading())};return{init:rr,onDeleteComment:yu,compareDates:wu,unbindListEvents:bu}}(jQuery);typeof ASC=="undefined"&&(ASC={});typeof ASC.Projects=="undefined"&&(ASC.Projects={});ASC.Projects.Description=function(){function e(){if(t=Teamlab,r=ASC.Projects.AllProject,n){f();return}i=t.bind(t.events.getPrjProject,function(t,i){document.location.pathname.endsWith("projects.aspx")&&(n=i,f())})}function u(n){var t=n.replace(/</ig,"&lt;").replace(/>/ig,"&gt;").replace(/\n/ig,"<br/>");return t.replace("&amp;","&")}function f(){function c(){ASC.Projects.DescriptionTab.resetStatus(n.status);jq.unblockUI()}function o(i){i===1&&r.showQuestionWindow(n,c)||t.updatePrjProjectStatus({},n.id,{id:n.id,status:i},{success:function(){location.reload()}})}var f=ASC.Projects,i=f.Resources,s=i.ProjectResource,e=i.ProjectsJSResource,h;f.ProjectsAdvansedFilter.hide();f.Base.clearTables();h=n.tags.length?n.tags.reduce(function(n,t){return n+", "+t}):"";f.DescriptionTab.init().push(i.CommonResource.ProjectName,u(n.title)).push(s.ProjectLeader,n.responsible.displayName).push(i.ProjectsFilterResource.ByCreateDate,n.displayDateCrtdate).push(i.CommonResource.Description,jq.linksParser(u(n.description))).push(s.Tags,h).pushStatus(e.StatusOpenProject,0,o.bind(null,0)).pushStatus(e.StatusSuspendProject,2,o.bind(null,2)).pushStatus(e.StatusClosedProject,1,o.bind(null,1)).setCurrentStatus(n.status).setStatusRight(n.canEdit).tmpl();jq("#descriptionTab").show()}function o(){t.unbind(i);n=null}var n,t,i,r;return{init:e,unbindListEvents:o}}();ASC.Projects.AllProject=function(){function v(n){return jq.extend(n,{projLink:jq.format("{0}tasks.aspx?prjID={1}",s,n.id),linkMilest:jq.format("{0}milestones.aspx?prjID={1}#sortBy=deadline&sortOrder=ascending&status=open",s,n.id),linkTasks:jq.format("{0}tasks.aspx?prjID={1}#sortBy=deadline&sortOrder=ascending&status=open",s,n.id),participants:n.participantCount?n.participantCount-1:"",linkParticip:jq.format("{0}projectteam.aspx?prjID={1}",s,n.id),isSimpleView:e||!1})}function b(i,u){r=u;a=t.find("tbody");e||(p=i.__total!=undefined?i.__total:0);n.showOrHideData(r.map(v),p)}function ft(n,t){var i=h(t.projectOwner.id),r=st(t.projectOwner.id);i&&r.length&&(i.taskCount++,r.find("td.taskCount a").text(i.taskCount))}function et(n,t){if(t!==1||!k(n)){var i={id:n,status:t};u.updatePrjProjectStatus({},n,i,{success:function(n,t){ht(t);ot(t)}})}}function ot(n){var i=t.find("tr#"+n.id);i.find("span:first-child").attr("class",ASC.Projects.StatusList.getById(n.status).cssClass);n.isPrivate&&i.find("span:first-child").addClass("private");n.status!==0?(i.addClass("noActiveProj"),i.find(".linkHeaderMedium").addClass("gray-text")):(i.removeClass("noActiveProj"),i.find(".linkHeaderMedium").removeClass("gray-text"));i.removeClass("openList")}function k(t,i){n=typeof n=="undefined"?this:n;var r=typeof t=="number"?h(t):v(t);return r.taskCount?(n.showCommonPopup("projectOpenTaskWarning",function(){location.href=r.linkTasks},i),!0):r.milestoneCount?(n.showCommonPopup("projectOpenMilestoneWarning",function(){location.href=r.linkMilest},i),!0):!1}function h(n){return r.find(function(t){return t.id==n})}function d(n){return h(jq(n).parents("#tableListProjects tr").attr("id"))}function st(n){return t.find(jq.format("tr#{0}",n))}function ht(n){for(var t=0,i=r.length;t<i;t++)if(r[t].id===n.id){r[t]=n;break}}var c=!1,y,t=null,n,i,f,l,a,g,e,p=0,r,o="click",nt="click.projectsInit",w="projects_projectTmpl",u,tt=function(r){if(c===!1){c=!0;var s=ASC.Projects.Resources;u=Teamlab;t=jq("#tableListProjects");n=this;n.showOrHideData=n.showOrHideData.bind(n,{$container:t.find("tbody"),tmplName:w,baseEmptyScreen:{img:"projects",header:s?s.ProjectResource.EmptyListProjHeader:"",description:s?s.ProjectResource.EmptyListProjDescribe:"",button:{title:s?s.ProjectResource.CreateFirstProject:"",onclick:function(){location.href="projects.aspx?action=add"},canCreate:function(){return ASC.Projects.Master.CanCreateProject}}},filterEmptyScreen:{header:s?s.CommonResource.Filter_NoProjects:"",description:s?s.ProjectResource.DescrEmptyListProjFilter:""}});n.getData=n.getData.bind(n,u.getPrjProjects,b)}if(e=r,g=u.profile.id,!e){i=ASC.Projects;f=i.Resources.ProjectsFilterResource;l=i.Resources.ProjectsJSResource;y=i.ProjectsAdvansedFilter;y.createAdvansedFilterForProjects(n);n.baseInit({moduleTitle:l.ProjectsModule,elementNotFoundError:l.ProjectNotFound},{pagination:"projectsKeyForPagination"},{handler:et,getItem:d,statuses:[{cssClass:"open",text:f.StatusOpenProject,id:0},{cssClass:"paused",text:f.StatusSuspend,id:2},{cssClass:"closed",text:f.StatusClosedProject,id:1}]},undefined,[ASC.Projects.Event(u.events.addPrjTask,ft)],{getItem:d,selector:".nameProject a",getLink:function(n){return"projects.aspx?prjID="+n.id+"#"}});t.on(o,".nameProject a",i.Common.goToWithoutReload);t.on(o,".taskCount a",i.Common.goToWithoutReload);t.on(o,".responsible .participants",i.Common.goToWithoutReload);t.on(o,"td.responsible span.userLink",function(){var n=h(jq(this).parents("#tableListProjects tr").attr("id"));ASC.Projects.ProjectsAdvansedFilter.addUser("project_manager",n.responsible.id,["team_member"])})}},it=function(){c&&(t.unbind(),n.unbindEvents(),jq("body").off(nt))},rt=function(n){b({},n)},ut=function(n){a=t.find("tbody");n=v(n);jq.tmpl(w,n).prependTo(a);t.show()},s=StudioManager.getLocationPathToModule("projects");return jq.extend({addProjectsToSimpleList:ut,basePath:"sortBy=create_on&sortOrder=ascending",init:tt,renderListProjects:rt,unbindListEvents:it,showQuestionWindow:k},ASC.Projects.Base)}(jQuery);ASC.Projects.Templates=function(){var n=function(){var n=jq.getURLParam("id"),t=jq.getURLParam("action");(n==null&&t=="add"||n&&t=="edit")&&ASC.Projects.EditProjectTemplates.init();n==null&&t==null&&ASC.Projects.ListProjectsTemplates.init()};return{init:n}}(jQuery);ASC.Projects.ListProjectsTemplates=function(){function v(){jq("#"+t).remove();t=0;var i=n.find(r);i.length||(n.hide(),l());jq.unblockUI()}function l(){var n={img:"templates",header:s.ProjectTemplatesResource.EmptyListTemplateHeader,description:s.ProjectTemplatesResource.EmptyListTemplateDescr,button:{title:s.ProjectTemplatesResource.EmptyListTemplateButton,onclick:function(){location.href="projectTemplates.aspx?action=add"},canCreate:function(){return!0}}};jq("#emptyScrCtrlPrj").html(jq.tmpl("projects_emptyScreen",n)).show();jq("#emptyScrCtrlPrj .addFirstElement").off("click").on("click",n.button.onclick)}function y(n){var o=0,r=0,u={tasks:[],milestones:[]},t,f,i,e;try{u=jQuery.parseJSON(n.description)||{tasks:[],milestones:[]}}catch(s){}if(t=u.milestones,f=u.tasks,f&&(r=f.length),t)for(o=t.length,i=0;i<t.length;i++)e=t[i].tasks,e&&(r+=e.length);return{title:n.title,id:n.id,milestones:o,tasks:r}}function p(t,u){var f,e;if(u.length)for(f=0;f<u.length;f++)e=y(u[f]),jq.tmpl("projects_templateTmpl",e).appendTo(n);else l();jq.dropdownToggle({dropdownID:"templateActionPanel",switcherSelector:"#listTemplates .entity-menu",addTop:0,addLeft:10,rightPos:!0,showFunction:function(t,u){var f=jq(t).closest(r),e=n.find(r+"."+i);u.attr(c,f.attr("id"));e.removeClass(i);e.is(f)||u.hide();u.is(":hidden")&&f.addClass(i)},hideFunction:function(){n.find(r).removeClass(i)}})}function h(n){return jq(".studio-action-panel").hide(),jq(r).removeClass(i),n&&(window.onbeforeunload=null),u.attr(c)}var t,f="click",c="target",i="open",r=".template",n,u,e,o,s=ASC.Projects.Resources,a=function(){e=Teamlab;o=LoadingBanner;n=jq("#listTemplates");var i=ASC.Projects.Resources.ProjectTemplatesResource,r=[{id:"editTmpl",text:i.Edit},{id:"createProj",text:i.CreateProject},{id:"deleteTmpl",text:i.Delete}];u=ASC.Projects.Common.createActionPanel(n,"templateActionPanel",{menuItems:r});u.find("#editTmpl").on(f,function(){var n=h(!0);window.location.replace("projectTemplates.aspx?id="+n+"&action=edit")});u.find("#deleteTmpl").on(f,function(){t=parseInt(h());ASC.Projects.Base.showCommonPopup("projectTemplateRemoveWarning",function(){e.removePrjTemplate({tmplId:t},t,{success:v})},function(){t=0})});u.find("#createProj").on(f,function(){var n=h(!0);window.location.replace("projects.aspx?tmplid="+n+"&action=add")});e.getPrjTemplates({},{success:p,before:o.displayLoading,after:o.hideLoading})};return{init:a}}(jQuery);ASC.Projects.EditProjectTemplates=function(){function h(){return n.val().length||jq("#listAddedMilestone .milestone").length||jq("#noAssignTaskContainer .task").length}function c(t,r){i=r.id;ASC.Projects.EditMilestoneContainer.showTmplStructure(r);n.val(r.title)}function o(u){var v,w,h,o,s,b,k,y,c,p;if(!jq(this).hasClass("disable")){if(jq("."+f).removeClass(f),jq.trim(n.val())==""){e.addClass(f);jq.scrollTo(e);n.focus();return}for(jq(this).addClass("disable"),ASC.Projects.MilestoneContainer.hideAddTaskContainer(),ASC.Projects.MilestoneContainer.hideAddMilestoneContainer(),v={tasks:[],milestones:[]},w=jq("#noAssignTaskContainer .task"),o=0;o<w.length;o++)v.tasks.push({title:jq(w[o]).children(".titleContainer").text()});for(h=jq("#listAddedMilestone .milestone"),o=0;o<h.length;o++){for(s=jq(h[o]).children(".mainInfo").children(".daysCount").attr("value"),s=s.replace(",","."),s=parseFloat(s),b={title:jq(h[o]).children(".mainInfo").children(".titleContainerEdit").text(),duration:s,tasks:[]},k=jq(h[o]).children(".milestoneTasksContainer").children(".listTasks").children(".task"),y=0;y<k.length;y++)b.tasks.push({title:jq(k[y]).children(".titleContainer").text()});v.milestones.push(b)}c={title:jq.trim(n.val()),description:JSON.stringify(v)};p=l;u=="saveAndCreateProj"&&(p=a);i?(c.id=i,r.updatePrjTemplate({},c.id,c,{success:p,before:t.displayLoading,after:t.hideLoading})):r.createPrjTemplate({},c,{success:p,before:t.displayLoading,after:t.hideLoading})}}function l(){window.onbeforeunload=null;document.location.replace("projectTemplates.aspx")}function a(n,t){t.id&&(window.onbeforeunload=null,document.location.replace("projects.aspx?tmplid="+t.id+"&action=add"))}var i=null,u="click",f="requiredFieldError",n,e,r,t,s=function(){var s,f;for(r=Teamlab,t=LoadingBanner,n=jq("#templateTitle"),e=jq("#templateTitleContainer"),s=[],f=1;f<=12;f=f+.5)s.push(f);jq("#amContainer").html(jq.tmpl("projects_action_template",{edit:!0,month:s}));ASC.Projects.MilestoneContainer.init();i=jq.getURLParam("id");i&&r.getPrjTemplate({},i,{success:c,before:t.displayLoading,after:t.hideLoading});n.focus();jq("#saveTemplate").on(u,function(){return o.call(this,"save"),!1});jq("#createProject").on(u,function(){return o.call(this,"saveAndCreateProj"),!1});jq("#cancelCreateProjectTemplate").on(u,function(){window.onbeforeunload=null;window.location.replace("projectTemplates.aspx")});jq.confirmBeforeUnload(h)};return{init:s}}(jQuery);ASC.Projects.ProjectTeam=function(){function b(i){var u=i.attr("data-partisipantid"),s=n.TeamWithBlockedUsers.find(function(n){return n.id===u}),f=ASC.Projects.ActionMenuItem,o=ASC.Projects.Resources,r=[];return s.isVisitor||(e.canCreateTask&&r.push(new f("team_task",o.TasksResource.AddNewTask,k.bind(null,u))),t.profile.isVisitor||(r.push(new f("team_reportOpen",o.ReportResource.ReportOpenTasks,nt.bind(null,u))),r.push(new f("team_reportClosed",o.ReportResource.ReportClosedTasks,tt.bind(null,u)))),r.push(new f("team_view",o.ProjectsJSResource.ViewAllOpenTasks,d.bind(null,u)))),t.profile.id!==u&&(r.push(new f("team_email",o.ProjectResource.ClosedProjectTeamWriteMail,it.bind(null,s.email))),r.push(new f("team_jabber",o.ProjectResource.ClosedProjectTeamWriteInMessenger,g.bind(null,s.userName))),e.security.canEditTeam&&r.push(new f("team_remove",o.CommonResource.RemoveMemberFromTeam,rt.bind(null,u)))),{menuItems:r}}function k(t){var r=n.TeamWithBlockedUsers.find(function(n){return n.id===t});return i.TaskAction.showCreateNewTaskForm({responsibles:[r]}),!1}function d(n){var t="tasks.aspx#sortBy=deadline&sortOrder=ascending&tasks_responsible="+n;return window.open(t,"displayOpenUserTasks","status=yes,toolbar=yes,menubar=yes,scrollbars=yes,resizable=yes,location=yes,directories=yes,menubar=yes,copyhistory=yes"),!1}function g(n){return ASC.Controls.JabberClient.open(n),!1}function nt(n){var t="generatedreport.aspx?reportType=10&ftime=absolute&fu="+n+"&fms=open|closed&fts=open";return window.open(t,"displayReportWindow","status=yes,toolbar=yes,menubar=yes,scrollbars=yes,resizable=yes,location=yes,directories=yes,menubar=yes,copyhistory=yes"),!1}function tt(n){var t="generatedreport.aspx?reportType=10&ftime=absolute&fu="+n+"&fms=open|closed&fts=closed";return window.open(t,"displayReportWindow","status=yes,toolbar=yes,menubar=yes,scrollbars=yes,resizable=yes,location=yes,directories=yes,menubar=yes,copyhistory=yes"),!1}function it(n){return window.location.href="mailto:"+n,!1}function rt(n){return t.removePrjProjectTeamPerson({userId:n},u,{userId:n},{success:ut}),!1}function ut(t){jq("tr[data-partisipantid='"+t.userId+"']").remove();jq("#pm-projectTeam-Selector").useradvancedSelector("unselect",[t.userId]);for(var r=0,u=n.Team.length;r<u;r++)n.Team[r].id==t.userId&&n.Team.splice([r],1);i.TaskAction.onUpdateProjectTeam()}function ft(t){n.TeamWithBlockedUsers=t;n.Team=i.Common.removeBlockedUsersFromTeam(n.TeamWithBlockedUsers);i.TaskAction.onUpdateProjectTeam()}function a(n,t){et(t);ft(t)}function v(){var t=jq(window).width()-48,i=parseInt(jq(".mainPageLayout").css("min-width"),10),n=t<i?i:t,u=jq(".right-settings");u.length&&(n-=u.width());r.find(".user-info-container").each(function(){jq(this).css("max-width",n-72-jq(".mainPageTableSidePanel").width()-jq(".menupoint-container").width()-jq(".pm-projectTeam-userPhotoContainer").outerWidth(!0)+"px")});jq.browser.msie&&(r.find(".user-info-container").each(function(){jq(this).css("width",n+"px")}),r.find(".user-info").each(function(){jq(this).css("width",n+50+"px")}))}function et(n){r.html(ot(n,e))}function ot(n,t){return jq.tmpl("memberTemplate",{team:n.map(h),project:t})}function h(n){var t=ASC.Projects.Resources;return n.isManager=o===n.id,jq.extend({security:[f(n.canReadMessages,"Messages",t.MessageResource.Messages),f(n.canReadFiles,"Files",t.ProjectsFileResource.Documents),f(n.canReadTasks,"Tasks",t.TasksResource.AllTasks),f(n.canReadMilestones,"Milestone",t.MilestoneResource.Milestones),f(n.canReadContacts,"Contacts",t.CommonResource.ModuleContacts)]},n)}function f(n,t,i){return{check:n,flag:t,title:i}}function st(){t.unbind(l);r.off(c)}var u=null,o=null,y=null,i,n,p="pm-projectTeam-modulePermissionOff",r,t,s,c="click",e,l,w=function(){t=Teamlab;s=LoadingBanner;i=ASC.Projects;n=i.Master;y=t.profile.id;u=parseInt(jq.getURLParam("prjID"));i.ProjectsAdvansedFilter.hide();i.Base.clearTables();l=t.bind(t.events.getPrjProject,function(f,l){function k(n,i){var r=[],f;jq(i).each(function(n,t){r.push(t.id)});f={participants:r,notify:!0};t.updatePrjTeam({projectId:u},u,f,{before:s.displayLoading,success:a,after:s.hideLoading})}var y,w;o=l.responsibleId;y=i.Master.TeamWithBlockedUsers.sort(function(n,t){return n.isTerminated-t.isTerminated}).map(h);jq(".tab1").html(jq.tmpl("projects_team",{project:l,team:y,manager:l.responsible})).show();jq("#descriptionTab").show();e=l;jq(window).resize(v);r=jq("#team_container");jq("#CommonListContainer").show();ASC.Projects.Base.initActionPanel(b,r);r.on(c,".right-checker",function(){var n=jq(this),i;n.closest("tr").hasClass("disable")||n.hasClass("no-dotted")||(i={userId:jq(this).closest(".pm-projectTeam-participantContainer").attr("data-partisipantId"),security:n.attr("data-flag"),visible:n.hasClass(p)},t.setTeamSecurity({partisipant:i.userId,securityFlag:i.security},u,i,{success:a}))});v();w=n.TeamWithBlockedUsers.map(function(n){return n.id});jq("#pm-projectTeam-Selector").useradvancedSelector({showGroups:!0,itemsSelectedIds:w,itemsDisabledIds:[o]}).on("showList",k);jq("#PrivateProjectHelp").off("click").on("click",function(){jq(this).helper({BlockHelperID:"AnswerForPrivateProjectTeam"})});jq("#RestrictAccessHelp").off("click").on("click",function(){jq(this).helper({BlockHelperID:"AnswerForRestrictAccessTeam"})})})};return{init:w,unbindListEvents:st,mapTeamMember:h}}(jQuery);ASC.Projects.AllMilestones=function(){function st(n,t){if(t===1){var i=e(n);if(i&&i.activeTasksCount){rt(n);return}}u.updatePrjMilestone({milestoneId:n},n,{status:t},{error:kt})}function ht(n){var t=e(n),i={id:t.id,project:t.projectId,responsible:t.responsibleId,deadline:t.deadline,title:t.title,description:t.description,isKey:t.isKey,isNotify:t.isNotify};ASC.Projects.MilestoneAction.onGetMilestoneBeforeUpdate(i)}function ct(n){var t=e(n),i={milestoneId:n,projectId:t.projectId};ASC.Projects.TaskAction.showCreateNewTaskForm(i)}function lt(t){n.showCommonPopup("milestoneRemoveWarning",function(){a.displayLoading();u.removePrjMilestone(t);jq.unblockUI()})}function at(t){n.showCommonPopup("milestonesRemoveWarning",function(){a.displayLoading();u.removePrjMilestones({ids:t},{success:function(n,t){for(var i=0;i<t.length;i++)u.call(u.events.removePrjMilestone,this,[{disableMessage:!0},t[i]]);a.hideLoading();h.displayInfoPanel(s.MilestonesRemoved)}});jq.unblockUI()})}function vt(i,u){c=r.find("tbody");f=i.__total!=undefined?i.__total:0;t=u.map(b);n.showOrHideData(t,f)}function b(n){var i=n.id,r=n.projectId,t={id:i,isKey:n.isKey,isNotify:n.isNotify,title:n.title,activeTasksCount:n.activeTaskCount||0,activeTasksLink:it(r,i,"open"),closedTasksCount:n.closedTaskCount||0,closedTasksLink:it(r,i,"closed"),canEdit:n.canEdit,canDelete:n.canDelete,projectId:r,projectTitle:n.projectTitle,createdById:n.createdBy.id,createdBy:n.createdBy.displayName,description:n.description,created:n.displayDateCrtdate},u;return n.responsible?(t.responsible=n.responsible.displayName,t.responsibleId=n.responsible.id):(t.responsible=null,t.responsibleId=null),u=new Date,t.overdue=n.status===0&&u>=n.deadline,t.status=n.status,t.deadline=n.displayDateDeadline,t}function rt(t){n.showCommonPopup("closeMilestoneWithOpenTasks",function(){var n=e(t);location.href="tasks.aspx?prjID="+n.projectId+"#milestone="+t+"&status=open"})}function yt(n){var t=n.attr("id"),f=e(t),r=[],u=ASC.Projects.ActionMenuItem;return f.status!=="closed"&&(r.push(new u("updateMilestoneButton",i.TasksResource.Edit,ht.bind(null,t))),r.push(new u("addMilestoneTaskButton",i.TasksResource.AddTask,ct.bind(null,t)))),f.canDelete&&r.push(new u("removeMilestoneButton",i.CommonResource.Delete,lt.bind(null,t))),{menuItems:r}}function wt(i,r){(l=jq.getURLParam("prjId"),l&&l!=r.projectId)||(f++,t.unshift(b(r)),n.showOrHideData(t,f),c.find("tr:first").yellowFade(),ASC.Projects.MilestoneAction.unlockMilestoneActionPage(),jq.unblockUI())}function ut(n,i){var f=b(i),e,u;t=t.filter(function(n){return n.id!==i.id});t.push(f);e=r.find("#"+i.id);u=jq.tmpl(w,f);e.replaceWith(u);u.yellowFade();ASC.Projects.MilestoneAction.unlockMilestoneActionPage();jq.unblockUI();h.displayInfoPanel(s.MilestoneUpdated)}function bt(n,t){o.GroupActionPanel.deselectAll();h.changeMilestoneCountInProjectsCache(t,1);ut(n,t)}function kt(n,t){t[0]=="Can not close a milestone with open tasks"?rt(n.milestoneId):h.displayInfoPanel(t[0],!0)}function dt(i,u){var o=u.id,e=r.find("#"+o);e.yellowFade();e.remove();f--;t=t.filter(function(n){return n.id!==u.id});d.update(f);c.children("tr").length===0&&(d.hide(),n.showOrHideData([],f));ASC.Projects.Master.Milestones=ASC.Projects.Master.Milestones.filter(function(n){return n.id!==u.id});a.hideLoading();i&&i.disableMessage||h.displayInfoPanel(s.MilestoneRemoved);h.changeMilestoneCountInProjectsCache(u,2)}function gt(n,t){var i,r,u;t.milestone!=null&&(i=e(t.milestone.id),r=c.find("#"+t.milestone.id),i&&r.length)&&(i.activeTasksCount++,u=jq.tmpl(w,i),r.replaceWith(u),u.yellowFade())}function v(n){return e(jq(n).parents("#milestonesList tr").attr("id"))}function e(n){return t.find(function(t){return t.id==n})}var o=ASC.Projects,i=o.Resources,s=i.ProjectsJSResource,k=o.ProjectsAdvansedFilter,d=o.PageNavigator,h=o.Common,g,r,c,nt,y=!1,l,f=0,tt,n,t=[],p="click",ft=p+".milestonesInit",w="projects_milestoneTemplate",et=".entity-menu",u,a,ot=function(){var h,t,f;if(u=Teamlab,a=LoadingBanner,tt=u.profile.id,r=jq("#milestonesList"),c=r.find("tbody"),nt=jq("#emptyListMilestone"),l=jq.getURLParam("prjID"),y===!1){y=!0;n=this;function e(n){return n.canCreateMilestone&&n.status===0}h=[{id:"gaDelete",title:i.CommonResource.Delete,handler:at,checker:function(n){return n.canDelete}}];n.showOrHideData=n.showOrHideData.bind(n,{$container:r.find("tbody"),tmplName:w,baseEmptyScreen:{img:"milestones",header:i.MilestoneResource.MilestoneNotFound_Header,description:i.MilestoneResource.MilestonesMarkMajorTimestamps,button:{title:i.MilestoneResource.PlanFirstMilestone,onclick:ASC.Projects.MilestoneAction.showNewMilestonePopup,canCreate:function(){return l?e(g):ASC.Projects.Master.Projects.some(e)}}},filterEmptyScreen:{header:i.MilestoneResource.FilterNoMilestones,description:i.MilestoneResource.DescrEmptyListMilFilter},groupMenu:{actions:h,getItemByCheckbox:v}});n.getData=n.getData.bind(n,u.getPrjMilestones,vt)}t=ASC.Projects.Event;f=u.events;n.baseInit({moduleTitle:s.MilestonesModule},{pagination:"milestonesKeyForPagination"},{handler:st,getItem:v,statuses:[{cssClass:"open",text:s.StatusOpenMilestone,id:0},{cssClass:"closed",text:s.StatusClosedMilestone,id:1}]},yt,[t(f.addPrjTask,gt),t(f.addPrjMilestone,wt),t(f.updatePrjMilestone,ut),t(f.removePrjMilestone,dt),t(f.updatePrjMilestoneStatus,bt),t(f.getPrjProject,function(n,t){g=t})],{getItem:v,selector:"tr .title a"});k.createAdvansedFilterForMilestones(n);r.on(p,"td.responsible span",function(){var n=v(jq(this));k.addUser("responsible_for_milestone",n.responsibleId,["user_tasks"])});r.on(p,"td.activeTasksCount a, td.closedTasksCount a",o.Common.goToWithoutReload)},it=function(n,t,i){var r="tasks.aspx?prjID="+n+"#milestone="+t+"&status="+i;return location.hash.indexOf("user_tasks")>0&&(r+="&tasks_responsible="+jq.getAnchorParam("user_tasks",location.href)),r},pt=function(){for(var i=t,n=0;n<i.length;n++)i[n].responsibleId!=tt&&jq("tr#"+i[n].id).find(et).remove();nt.find(".emptyScrBttnPnl").remove()},ni=function(){y&&(r.unbind(),n.unbindEvents(),jq("body").off(ft))};return jq.extend({init:ot,removeMilestonesActionsForManager:pt,unbindListEvents:ni,basePath:"sortBy=deadline&sortOrder=ascending"},ASC.Projects.Base)}(jQuery);ASC.Projects.Discussions=function(n){function b(n,i){c=n.__total!=undefined?n.__total:0;t.showOrHideData(i.map(k),c);jq(".content-list p").filter(function(){return jq(this).html()=="&nbsp;"}).remove()}function k(n){var f=n.id,u=n.projectId,t="messages.aspx?prjID="+u+"&id="+f,i={createdDate:n.displayDateCrtdate,createdTime:n.displayTimeCrtdate,title:n.title,discussionUrl:t,authorAvatar:n.createdBy.avatar,authorId:n.createdBy.id,authorName:n.createdBy.displayName,authorPost:n.createdBy.title,status:n.status,projectId:u,text:n.text,hasPreview:n.text.search('class="asccut"')>0,commentsCount:n.commentsCount,commentsUrl:t+"#comments",writeCommentUrl:t+"#"+p,canComment:n.canCreateComment};return r||(i.projectTitle=n.projectTitle,i.projectUrl="projects.aspx?prjID="+n.projectId),i}var h=!1,r,c=0,i,t,u,e=ASC.Projects,l=e.Resources,f=l.MessageResource,a=l.ProjectsJSResource,o=e.ProjectsAdvansedFilter,v,y,p="addcomment",s="click",w=function(){if(r=n.getURLParam("prjID"),i=n("#discussionsList"),u=Teamlab,h===!1){h=!0;t=this;function c(n){return n.canCreateMessage&&n.status===0}t.showOrHideData=t.showOrHideData.bind(t,{$container:i,tmplName:"projects_discussionTemplate",baseEmptyScreen:{img:"discussions",header:f.DiscussionNotFound_Header,description:f.DiscussionNotFound_Describe,button:{title:f.StartFirstDiscussion,onclick:function(){location.href=jq.format("messages.aspx?action=add{0}",r!=null?"&prjID="+r:"")},canCreate:function(){return r?c(v):ASC.Projects.Master.Projects.some(c)}}},filterEmptyScreen:{header:f.FilterNoDiscussions,description:f.DescrEmptyListMilFilter}});t.getData=t.getData.bind(t,u.getPrjDiscussions,b)}t.baseInit({elementNotFoundError:a.DiscussionNotFound,moduleTitle:a.DiscussionsModule},{pagination:"discussionsKeyForPagination",small:!0});y=u.bind(u.events.getPrjProject,function(n,t){v=t});o.createAdvansedFilterForDiscussion(t);i.on(s,".title-list a",e.Common.goToWithoutReload);i.on(s,".title-list .status",function(){o.add("status","archived")});i.on(s,".name-list.project",function(){o.add("project",n(this).attr("data-projectId"),["tag"])});i.on(s,".name-list.author",function(){o.addUser("author",n(this).attr("data-authorId"))})},d=function(){h&&(i.unbind(),u.unbind(y))};return jq.extend({init:w,unbindListEvents:d,basePath:"sortBy=create_on&sortOrder=descending",addCommentHash:p},e.Base)}(jQuery);ASC.Projects.DiscussionDetails=function(n){function ti(u,c){var p,a;t=c;t.comments=pt(t.comments);ii();ri();ui();var g=ASC.Controls.AnchorController.getAnchor(),nt=g===ASC.Projects.Discussions.addCommentHash,v=r.MessageResource;ASC.Projects.DescriptionTab.init().push(r.ProjectResource.Project,t.projectOwner.title,"tasks.aspx?prjID="+t.projectOwner.id).push(v.AuthorTitle,t.createdBy.displayName).push(r.ProjectsFilterResource.ByCreateDate,t.displayDateTimeCrtdate).push(v.Description,t.text).pushStatus(v.OpenDiscussion,0,wt).pushStatus(v.ArchiveDiscussion,1,wt).setCurrentStatus(t.status).setStatusRight(t.canEdit).tmpl();p=function(){return t.status===0||t.commentsCount};a=ASC.Projects.Tab;h=new a(r.MessageResource.Comments,function(){return t.commentsCount},"commentsModule",vt,"#comments",p);w=new a(r.MessageResource.DiscussionParticipants,function(){return f.length},"subscribeModule",yt,"#subscribers");l=new a(r.CommonResource.DocsModuleTitle,function(){return t.files.length},"documentsModule",s,"#documents",function(){return t.canReadFiles&&(t.canEditFiles||t.files.length)});rt=new a(r.ProjectsJSResource.OverviewModule,function(){return 0},"overViewModule",jq(".tab"),"#");var k=t.subscribers.some(function(n){return n.id===i.profile.id}),tt={uplink:ASC.Projects.Common.UpLink||"messages.aspx?prjID="+t.projectId,icon:"messages",title:t.title,subscribed:k,subscribedTitle:k?r.CommonResource.UnSubscribeOnNewComment:r.CommonResource.SubscribeOnNewComment},d=[];d=p()?[h,w,l,rt]:[rt,w,l];ASC.Projects.InfoContainer.init(tt,fi,d);y=n("#subscribe");y.on(lt,function(){i.subscribeToPrjDiscussion({},e,{success:bt,error:b})});jq("#CommonListContainer").show();t.canEdit||o.hide();jq("#descriptionTab").show();nt&&p()&&jq("#add_comment_btn").click();ut()}function pt(n){return n.forEach(function(n){n.commentList.length&&(n.commentList=pt(n.commentList))}),n.filter(function(n){return!(n.inactive&&n.commentList.length===0)})}function ii(){f=t.subscribers;f.forEach(function(n){n.descriptionFlag=!0});jq(".tab1").html(jq.tmpl("projects_discussionTab",kt(f))).show();yt=jq("#discussionParticipantsContainer");o=n("#manageParticipantsSelector");p=n("#discussionParticipantsTable");t.status===1&&o.hide();var r=f.map(function(n){return n.id});o.useradvancedSelector("select",r);o.useradvancedSelector({showGroups:!0,itemsSelectedIds:r}).on("additionalClickEvent",function(){jq(".project-title .menu-small").removeClass("active")}).on("showList",function(n,t){for(var u,o,s,h=[],f=[],r=0;r<t.length;r++)u=t[r].id,o=t[r].title,h.push({id:u,displayName:o,descriptionFlag:!0}),f.push(u);s={projectId:v,participants:f.join(),notify:!1};i.updatePrjDiscussion({},e,s,{before:k,success:bt,error:b,after:ut})});p.on("mouseenter",ot+"."+st,function(){jq(this).helper({BlockHelperID:"hintSubscribersPrivateProject",addLeft:45,addTop:12})});p.on("mouseleave",ot+"."+st,function(){jq("#hintSubscribersPrivateProject").hide()})}function ri(){function f(n){t.files.push(n);l.rewrite();ProjectDocumentsPopup.reset()}if(s.length&&window.Attachments){var n="marginBottom",r="message";u=Attachments;d=parseInt(t.project.projectFolder);et=Encoder.htmlEncode(t.projectTitle);t.canEditFiles||u.banOnEditing();ProjectDocumentsPopup.init(d,et);u.isLoaded=!1;u.init(r,function(){return t.id});u.setFolderId(d);u.loadFiles(t.files);t.files.length>0&&s.css(n,"18px");u.bind("addFile",function(u,e){e.attachFromPrjDocFlag||e.isNewFile?i.addPrjEntityFiles(null,t.id,r,[e.id],{success:function(){f(e)},error:b}):f(e);s.css(n,"18px")});u.bind("deleteFile",function(f,e){i.removePrjEntityFiles({},t.id,r,e,{success:function(){u.deleteFileFromLayout(e);t.files=t.files.filter(function(n){return n.id!==e});t.files.length===0&&s.css(n,"0px");l.rewrite()},error:b})});dt(i.events.getDocFolder,function(){for(var i=jq(".fileList li"),n=0,r=t.files.length;n<r;n++)i.find("input#"+t.files[n].id).prop("checked",!0)})}}function ui(){var r,n;CommentsManagerObj.isShowAddCommentBtn=t.status===0&&t.canCreateComment;CommentsManagerObj.total=t.comments.length;CommentsManagerObj.isEmpty=t.comments.length===0;CommentsManagerObj.moduleName="projects_Message";CommentsManagerObj.comments=jq.base64.encode(JSON.stringify(t.comments));CommentsManagerObj.objectID="common";CommentsManagerObj.Init();CommentsManagerObj.objectID=t.id;jq("#hdnObjectID").val(t.id);t.commentsCount>0?(jq("#hideCommentsButton").show(),c.css(tt,"15px")):c.css(tt,"-6px");c.show();r=ASC.Controls.AnchorController.getAnchor();r==ASC.Projects.Discussions.addCommentHash&&CommentsManagerObj&&ckeditorConnector.load(CommentsManagerObj.AddNewComment);dt(i.events.addPrjComment,function(){a?a=!1:(jq("#hideCommentsButton").show(),c.css(tt,"15px"),t.commentsCount++,h.rewrite())});n=lt+".comments";jq("#btnCancel").off(n).on(n,function(){a=!1;h.select()});jq("a[id^=edit_]").off(n).on(n,function(){a=!0})}function fi(){var n=[],i=ASC.Projects.ActionMenuItem,u;return t.canEdit&&(n.push(new i("da_edit",r.MessageResource.EditMessage,ei)),n.push(new i("da_delete",r.MessageResource.DeleteMessage,si))),u=at.getProjectById(t.projectId),u&&u.canCreateTask&&n.push(new i("da_createTask",r.MessageResource.CreateTaskOnDiscussion,oi)),{menuItems:n}}function wt(){i.updatePrjDiscussionStatus({},e,{status:t.status===1?0:1},{before:k,success:li,after:ut})}function ei(){location.href="messages.aspx?prjID="+t.projectId+"&id="+t.id+"&action=edit"}function oi(){jq("body").click();k();i.addPrjTaskByMessage({},v,e,{success:function(n,t){window.onbeforeunload=null;location.href="tasks.aspx?prjID="+v+"&id="+t.id}})}function si(){jq(".project-title .menu-small").removeClass("active");ASC.Projects.Base.showCommonPopup("discussionRemoveWarning",function(){i.removePrjDiscussion({},e,{success:ci,error:ASC.Projects.DiscussionDetails.onDeleteDiscussionError})})}function b(){window.onbeforeunload=null;window.location.reload()}function bt(n,t){f=t.subscribers;f.forEach(function(n){n.descriptionFlag=!0});p.html(jq.tmpl("projects_subscribedUsers",kt(f)));var r=f.some(function(n){return n.id==i.profile.id});r?(y.removeClass(ct).addClass(ht),o.useradvancedSelector("select",[nt])):(y.removeClass(ht).addClass(ct),o.useradvancedSelector("disable",[nt]));w.rewrite()}function kt(n){var f=[],s=[],c=g.length,r,h,i,e,u,o;if(t.projectOwner.isPrivate)for(r=0,h=n.length;r<h;r++){for(i=n[r],e=!1,u=0;u<c;u++)o=g[u],i.id==o.id&&o.canReadMessages&&(f.push(i),e=!0);e||(i.hidden=!0,s.push(i))}else f=n;return{newListParticipants:f,notSeePartisipant:s}}function ci(n,t){i.fckeRemoveCommentComplete(t.id.toString(),"discussion",function(){window.onbeforeunload=null;window.location.replace("messages.aspx?prjID="+t.projectId)})}function li(){location.reload()}function k(){it.displayLoading()}function ut(){it.hideLoading()}function ai(){jq(".project-info-container").hide();jq("#descriptionTab").hide();u.unbind();vi()}function dt(n,t){ft.push(i.bind(n,t))}function vi(){while(ft.length){var n=ft.shift();i.unbind(n)}}var d,et,s,g,nt,a=!1,tt="marginTop",ot=".items-display-list_i",st="gray",ht="subscribed",ct="unsubscribed",e,v,t,lt="click",u,i,it,at,f,y,c,vt,gt,o,yt,p,r=ASC.Projects.Resources,rt,w,l,h,ni=function(){i=Teamlab;at=ASC.Projects.Common;it=LoadingBanner;e=jq.getURLParam("id");v=jq.getURLParam("prjID");nt=i.profile.id;c=n("#commonComments");vt=n("#commonCommentsContainer");gt=n("#mainCommentsContainer");s=n("#filesContainer");g=ASC.Projects.Master.Team;k();i.getPrjDiscussion({},e,{success:ti,error:function(n,t){t[0]==="Item not found"&&ASC.Projects.Base.setElementNotFound()}})},hi=function(){t.commentsCount--;h.rewrite();t.commentsCount==0&&h.select()},ft=[];return{init:ni,onDeleteComment:hi,unbindListEvents:ai}}(jQuery);ASC.Projects.DiscussionAction=function(n){function ni(){return u.length&&u.attr("data-id").length||jq("[id$=discussionTitle]").val().length||nt.ckEditor.getData().length||at.length}function vt(n,t){t.forEach(function(n){n.descriptionFlag=!1});d.useradvancedSelector("select",t.map(function(n){return n.id}));pt(t)}function ti(n){g.removeClass(e);r.find(i).remove();ft=n.isPrivate;jq("#errorAllParticipantsProject").hide();wt({},n.id);h.focus()}function ii(){var n=ASC.Projects.Master.Projects.filter(function(n){return n.canCreateMessage});u.projectadvancedSelector({itemsChoose:n,onechosen:!0});u.on("showList",function(n,t){u.attr("data-id",t.id).text(t.title).attr("title",t.title);ti(t)})}function ri(n){t.addPrjDiscussion({},n.projectid,n,{success:ui,error:yt})}function ui(n,t){li(t)}function yt(){this.__errors[0]=="Access denied."&&(window.onbeforeunload=null,window.location.replace("messages.aspx"));si()}function fi(n){t.updatePrjDiscussion({},n.messageid,n,{success:ei,error:yt})}function ei(n,i){t.fckeEditCommentComplete({},{commentid:i.id.toString(),domain:"discussion",html:i.text,isedit:!0},function(){window.onbeforeunload=null;window.location.replace("messages.aspx?prjID="+i.projectId+"&id="+i.id)})}function oi(){u.attr(f,f).addClass(f);h.attr(l,l).addClass(f);jq("iframe[id^=ctl00_ctl00]").contents().find("iframe").contents().find("#fckbodycontent").attr(l,l).addClass(f);tt(!0)}function si(){u.removeAttr(f).removeClass(f);h.removeAttr(l).removeClass(f);jq("iframe[id^=ctl00_ctl00]").contents().find("iframe").contents().find("#fckbodycontent").removeAttr(l).removeClass(f);tt(!1)}function pt(n){var r,u,t,f,i,e;if(at=n,r=[],u=[],ft)for(t=0;t<n.length;t++){for(f=!1,i=0;i<a.length;i++)n[t].id==a[i].id&&a[i].canReadMessages&&(r.push(n[t]),f=!0);f||(n[t].hidden=!0,u.push(n[t]))}else r=n;e="projects_subscribedUser";jq.tmpl(e,r).appendTo(y);u.length&&jq.tmpl(e,u).addClass(ht).appendTo(y)}function hi(){rt=parseInt(v.attr("data-projectfolderid"));lt=v.attr("data-projectName").trim();ot=="edit"&&ci()}function ci(){var n=jq.getURLParam("id");ProjectDocumentsPopup.init(rt,lt);c.setFolderId(rt);c.loadFiles();c.bind("addFile",function(i,r){t.addPrjEntityFiles(null,n,st,[r.id],function(){})});c.bind("deleteFile",function(i,r){t.removePrjEntityFiles({},n,st,r,function(){});c.deleteFileFromLayout(r)})}function li(n){var i=function(){window.onbeforeunload=null;window.location.replace("messages.aspx?prjID="+n.projectId+"&id="+n.id)},r=kt.concat(dt);r.length?t.addPrjEntityFiles(null,n.id,st,r,i):t.fckeEditCommentComplete({},{commentid:n.id.toString(),domain:"discussion",html:n.text,isedit:!1},i)}function wt(n,i){ct?bt({},ASC.Projects.Master.Team):t.getPrjTeam(n,i,{before:b.displayLoading,success:bt,after:b.hideLoading})}function bt(n,u){var e,o,s,f,h;if(a=u,e=u?u.length:0,o=[],!(e<=0)){for(s=r.find(i).length?jq("#discussionParticipantsContainer "+i):[],f=0;f<e;f++)h=s.some(function(n){return n.attr("guid")==u[f].id}),h||(u[f].descriptionFlag=u[f].id==t.profile.id,o.push(u[f]));vt(null,o)}}function ai(n){for(var i="0",t=[i+n.getDate(),i+(n.getMonth()+1),i+n.getFullYear(),i+n.getHours(),i+n.getMinutes()],r=0;r<t.length;r++)t[r]=t[r].slice(-2);return t[0]+"."+t[1]+"."+t[2]+" "+t[3]+":"+t[4]}function tt(n){var t="#discussionActionPage";n?b.showLoaderBtn(t):b.hideLoaderBtn(t)}var o,it,ct=!1,rt,lt,ut,ft,kt=[],dt=[],a=[],at=[],v,r,d,y,p,s,h,w,u,g,et,nt,c,t,b,ot,st="message",i=".items-display-list_i",ht="gray",e="requiredFieldError",k="disable",f="disabled",l="readonly",gt=function(){var l,rt,st,f;t=Teamlab;ut=t.profile.id;o=jq.getURLParam("prjID");it=jq.getURLParam("id");ot=jq.getURLParam("action");nt=ASC.Projects.Common;typeof Attachments!="undefined"&&(c=Attachments);b=LoadingBanner;v=n("#discussionFilesContainer");u=n("#discussionProjectSelect");g=n("#discussionProjectContainer");w=n("#discussionPreviewButton");r=n("#discussionParticipantsContainer");d=n("#manageParticipantsSelector");y=n("#discussionParticipants");p=n("#discussionPreviewContainer");s=n("#discussionTitleContainer");et=n("#discussionTextContainer");h=s.find("input");it&&t.getSubscribesToPrjDiscussion({},it,{success:vt});v.length&&hi();jq("[id$=discussionTitle]").focus();l=[];r.find(i).each(function(){l.push(jq(this).attr("guid"))});d.useradvancedSelector({showGroups:!0,itemsSelectedIds:l}).on("showList",function(n,t){r.find(i).remove();var u=t.map(function(n){var t=[];return n.groups.forEach(function(n){t.push(n.name)}),{id:n.id,displayName:n.title,department:t.join(),descriptionFlag:!1,profileUrl:n.profileUrl}});pt(u)});o?(ct=!0,ot!="edit"?wt({},o):a=ASC.Projects.Master.Team,ft=ASC.Projects.Master.Projects.some(function(n){return n.id==o&&n.isPrivate}),jq(".mainPageContent").children(".loader-page").hide()):ii();rt=".reset-action";r.on("click",i+" "+rt,function(){var n=jq(this).closest("li").attr("guid");n!=ut&&(jq(this).closest("li").remove(),d.useradvancedSelector("unselect",[n]))});r.find(i).each(function(){var n=jq(this).attr("guid");n==ut&&jq(this).find(rt).remove()});jq("#hideDiscussionPreviewButton").click(function(){p.hide()});s.find("input").keyup(function(){jq.trim(jq(this).val())!=""&&s.removeClass(e)});w.click(function(){if(!w.hasClass(k)){var n=this;t.getPrjDiscussionPreview({takeThis:n},nt.ckEditor.getData(),{before:function(){tt(!0)},after:function(){tt(!1)},success:function(n,t){var i=jq(n.takeThis),r={title:h.val(),authorName:i.attr("authorName"),authorTitle:i.attr("authorTitle"),authorPageUrl:i.attr("authorPageUrl"),authorAvatarUrl:i.attr("authorAvatarUrl"),createOn:ai(new Date),content:t};p.find(".discussionContainer").remove();jq.tmpl("projects_discussionActionTemplate",r).prependTo(p);p.show()}})}});st=n("#discussionCancelButton");st.click(function(){if(!st.hasClass(k)){var n=jq.getURLParam("prjID");window.onbeforeunload=null;window.history?window.history.go(-1):window.location.replace("messages.aspx?prjID="+n)}});f=n("#discussionActionButton");f.click(function(){var c,w,n,l,a;if(!f.hasClass(k)){g.removeClass(e);s.removeClass(e);et.removeClass(e);var v=o?o:u.attr("data-id"),y=jq.trim(h.val()),p=nt.ckEditor.getData(),t=!1;if(v||(g.addClass(e),t=!0),y==""&&(s.addClass(e),t=!0),c=document.createElement("DIV"),c.innerHTML=p,(c.textContent==""||c.innerText=="")&&(et.addClass(e),t=!0),t){w=jq("#pageHeader").offset().top;jq("body, html").animate({scrollTop:w},500);return}n={projectid:v,title:y,content:p};l=f.attr("discussionId");l!=-1&&(n.messageid=l);a=[];r.find(i).each(function(){a.push(jq(this).attr("guid"))});n.participants=a.join();oi();l==-1?ri(n):fi(n)}});jq.switcherAction("#switcherParticipantsButton",r);jq.switcherAction("#switcherFilesButton",v);y.on("mouseenter",i+"."+ht,function(){jq(this).helper({BlockHelperID:"hintSubscribersPrivateProject",addLeft:45,addTop:12})});y.on("mouseleave",i+"."+ht,function(){jq("#hintSubscribersPrivateProject").hide()});jq.confirmBeforeUnload(ni)},vi=function(){this.getData()==""?w.addClass(k):w.removeClass(k)};return{init:gt,showHidePreview:vi}}(jQuery);ASC.Projects.TimeSpendActionPage=function(){function yt(n){var t=ot(n),i=t.task,u=i.id,f=i.title,e=t.note,o=t.date,r=jq.timeFormat(t.hours).split(":"),s=(t.person||t.createdBy).id,h=t.task.projectOwner.id;y.TimeTrakingEdit.showPopup(h,u,f,n,{hours:parseInt(r[0],10),minutes:parseInt(r[1],10)},o,e,s)}function pt(n){r.removePrjTime({timeid:n},{timeids:[n]},{success:ni,error:ii})}function wt(n){t.showCommonPopup("trackingRemoveWarning",function(){l.displayLoading();r.removePrjTime({},{timeids:n},{success:function(){jq.unblockUI();c.displayInfoPanel(b.TimesRemoved);t.getData()}});jq.unblockUI()})}function d(n,t,i){l.displayLoading();r.changePaymentStatus({textStatus:n},{status:t,timeIds:i},it)}function bt(n,t){l.displayLoading();r.changePaymentStatus({},{status:t,timeIds:[n]},it)}function it(n,t){for(var r,u=ASC.Projects.StatusList.getById(t[0].paymentStatus).cssClass,i=0,f=t.length;i<f;i++)r=t[i],jq(".timeSpendRecord[timeid="+r.id+"] .changeStatusCombobox span:first").attr("class",u),et(r);st();l.hideLoading()}function rt(t){var o=t.length,r,u,i,f,e;if(o){for(r=0,u=0,i=0;i<o;i++)r+=t[i].hours,t[i].paymentStatus==2&&(u+=t[i].hours);f=jq.timeFormat(r).split(":");n.find(".total-count .hours").text(f[0]);n.find(".total-count .minutes").text(f[1]);e=jq.timeFormat(u).split(":");n.find(".billed-count .hours").text(e[0]);n.find(".billed-count .minutes").text(e[1]);n.addClass("float-none");n.css("visibility","visible")}}function g(){t.showOrHideData(i,v);i.length||n.css("visibility","hidden")}function ut(){f.Count=31;f.StartIndex=nt;k.status?(r.getTotalTimeByFilter({},{filter:f,success:ft}),n.find(".billed-count").hide()):(delete f.status,r.getTotalTimeByFilter({},{filter:f,success:ft}),f.status=2,r.getTotalTimeByFilter({},{filter:f,success:dt}))}function kt(r,u){if(f=r.__filter,Object.keys(f).length>4){n=t.$commonListContainer.prepend(jq.tmpl("projects_totalTimeText",{})).find("#totalTimeText");ut();var h=n.find("span").first(),c=o?s.TimeSpentForTask:s.TotalTimeNote;h.text(c)}i=u;nt+=u.length;r.mode!="next"&&e.find("tbody").html("");v=r.__total!=undefined?r.__total:0;i.length||n.css("visibility","hidden");t.showOrHideData(i,v)}function ft(t,r){if(r!=0&&i.length){var u=jq.timeFormat(r).split(":");n.find(".total-count .hours").text(u[0]);n.find(".total-count .minutes").text(u[1]);n.find(".billed-count .hours").text("0");n.find(".billed-count .minutes").text("00");n.css("visibility","visible")}else n.css("visibility","hidden")}function dt(t,i){var r=n.find(".billed-count"),u;i!=0?(u=jq.timeFormat(i).split(":"),r.find(".hours").text(u[0]),r.find(".minutes").text(u[1])):(r.find(".hours").text("0"),r.find(".minutes").text("00"))}function gt(n,t){c.displayInfoPanel(b.TimeUpdated);e.find(".timeSpendRecord[timeid="+t.id+"]").replaceWith(jq.tmpl("projects_timeTrackingTmpl",t));et(t);st()}function ni(n,t){for(var u,f=0,r=0;r<t.length;r++)u=jq("#timeSpendRecord"+t[r].id),f+=t[r].hours,u.animate({opacity:"hide"},500),v--,u.remove(),i=i.filter(function(n){return n.id!==t[r].id}),g();l.hideLoading();c.displayInfoPanel(b.TimeRemoved)}function ti(n,t){if(!t.length){g();return}rt(t);var u=ASC.Projects.Resources.TasksResource,r=t[0].task,f={uplink:"tasks.aspx?prjID="+r.projectId+"&id="+r.id,icon:"tasks",title:r.title,subscribed:r.isSubscribed,subscribedTitle:r.isSubscribed?u.UnfollowTask:u.FollowTask};ASC.Projects.InfoContainer.init(f);i=t;v=n.__total!=undefined?n.__total:0;g()}function et(n){for(var t=0,r=i.length;t<r;t++)if(i[t].id==n.id){i[t]=n;break}}function ot(n){return i.find(function(t){return t.id==n})}function p(n){return ot(jq(n).parents("tr.timeSpendRecord").attr("timeid"))}function st(){o?rt(i):ut({},f)}function ii(n){jq("div.entity-menu[timeid="+n.timeid+"]").hide()}function ri(){w&&(e.unbind(),t.unbindEvents(),ASC.Projects.GroupActionPanel.hide())}var o=!1,w=!1,t,a,ht,nt,v=0,n,e,y=ASC.Projects,u=y.Resources,b=u.ProjectsJSResource,h=u.ProjectsFilterResource,s=u.TimeTrackingResource,k=y.ProjectsAdvansedFilter,c=y.Common,r,l,ct,lt,at="click",i=[],f,tt,vt=function(){function rt(n){var t=n.attr("timeid");return{menuItems:[{id:"ta_edit",text:u.TasksResource.Edit,handler:yt.bind(null,t)},{id:"ta_remove",text:u.CommonResource.Delete,handler:pt.bind(null,t)}]}}var g,f,v;if(e=jq("#timeSpendsList"),r=Teamlab,a=jq.getURLParam("prjID"),ht=r.profile.id,o=jq.getURLParam("id")!=null,w===!1){w=!0;t=this;function b(n){return n.canCreateTimeSpend&&n.status===0&&n.taskCountTotal>0}g=[{id:"gaBilled",title:s.PaymentStatusBilled,handler:d.bind(null,"billed",2),checker:function(n){return n.canEditPaymentStatus}},{id:"gaNotBilled",title:s.PaymentStatusNotBilled,handler:d.bind(null,"not-billed",1),checker:function(n){return n.canEditPaymentStatus}},{id:"gaNotChargeable",title:s.PaymentStatusNotChargeable,handler:d.bind(null,"not-chargeable",0),checker:function(n){return n.canEditPaymentStatus}},{id:"gaDelete",title:u.CommonResource.Delete,handler:wt,checker:function(n){return n.canEdit}}];t.showOrHideData=t.showOrHideData.bind(t,{$container:e.find("tbody"),tmplName:"projects_timeTrackingTmpl",baseEmptyScreen:{img:"time_tracking",header:u.TimeTrackingResource.NoTtimers,description:u.TimeTrackingResource.NoTimersNote,button:{title:u.TimeTrackingResource.StartTimer,onclick:function(){if(o){var n=jq.getURLParam("ID");c.showTimer(a,n)}else a!=null?c.showTimer(a):c.showTimer()},canCreate:function(){return a?b(tt):ASC.Projects.Master.Projects.some(b)}}},filterEmptyScreen:{header:u.TimeTrackingResource.NoTimersFilter,description:u.TimeTrackingResource.DescrEmptyListTimersFilter},groupMenu:{actions:g,getItemByCheckbox:p,getLineByCondition:function(n){return i.filter(n).map(function(n){return e.find("[timeid="+n.id+"]")})},multiSelector:[{id:"gasBilled",title:h.PaymentStatusBilled,condition:function(n){return n.paymentStatus===2}},{id:"gasNotBilled",title:h.PaymentStatusNotBilled,condition:function(n){return n.paymentStatus===1}},{id:"gasNotChargeable",title:h.PaymentStatusNotChargeable,condition:function(n){return n.paymentStatus===0}}]}});t.$commonListContainer.find("#totalTimeText").length||(n=t.$commonListContainer.prepend(jq.tmpl("projects_totalTimeText",{})).find("#totalTimeText"));t.getData=t.getData.bind(t,r.getPrjTime,kt)}l=LoadingBanner;f=ASC.Projects.Event;v=r.events;t.baseInit({moduleTitle:u.CommonResource.TimeTracking},o?undefined:{pagination:"timeKeyForPagination"},{handler:bt,getItem:p,statuses:[{cssClass:"not-chargeable",text:h.PaymentStatusNotChargeable,id:0},{cssClass:"not-billed",text:h.PaymentStatusNotBilled,id:1},{cssClass:"billed",text:h.PaymentStatusBilled,id:2}]},rt,[f(v.updatePrjTime,gt),f(v.getPrjProject,function(n,t){tt=t;o&&r.getPrjTaskTime({},jq.getURLParam("id"),{success:ti})})],{getItem:function(n){return p(n).task},selector:".pm-ts-noteColumn a"});ct=jq("#emptyListTimers");lt=jq(".studio-action-panel");var nt=jq.getURLParam("prjid"),it=n.find("span").first(),y="";o?(r.getPrjProject({},nt),y=s.TimeSpentForTask):(k.createAdvansedFilterForTimeTracking(t),e.addClass("forProject"),y=s.TotalTimeNote);it.text(y);e.on(at,".pm-ts-personColumn span",function(n){var t=p(n.target);k.addUser("tasks_responsible",t.person!=null?t.person.id:t.createdBy.id,["noresponsible"])})};return jq.extend({init:vt,unbindListEvents:ri},ASC.Projects.Base)}(jQuery);ASC.Projects.TimeTraking=function(n){function yt(n){return parseInt(n,10)==n}function ni(){kt(!0);u.val("").removeClass(o);i.val("").removeClass(o);e.empty();ct=setInterval(ti,1e3)}function ti(){c++;c==60&&(c=0,h++,h==60&&(h=0,tt++));wt({h:tt,m:h,s:c})}function pt(){lt=ii();window.clearTimeout(ct)}function wt(n){p=n.h*3600+n.m*60+n.s;a.text(st(n.h));v.text(st(n.m));y.text(st(n.s))}function st(n){return n<10?"0"+n:n}function ii(){return{h:parseInt(a.text(),10),m:parseInt(v.text(),10),s:parseInt(y.text(),10)}}function ri(n,t){var i={h:n.h+t.h,m:n.m+t.m,s:n.s+t.s};return i.s>=60&&(i.m++,i.s-=60),i.m>=60&&(i.h++,i.m-=60),i}function bt(){ht();pt();var n="00";a.text(n);v.text(n);y.text(n);w=!0;p=0;c=0;h=0;tt=0;s=null;ut=!1;r.removeClass(it).attr("title",r.attr("data-title-start"))}function kt(n){var r="true";u.attr(t,r);i.attr(t,r);n||(f.attr(t,r),d.attr(t,r))}function ht(){u.removeAttr(t);i.removeAttr(t);f.removeAttr(t);d.removeAttr(t)}function rt(){r.add(k).add(l).addClass(g);kt()}function nt(){r.add(k).add(l).removeClass(g);ht()}function dt(){w?(r.addClass(it).attr("title",r.attr("data-title-pause")),w=!1,s=new Date,ni()):(r.removeClass(it).attr("title",r.attr("data-title-start")),w=!0,ut=!0,s=null,pt())}function ui(){e.removeClass(o).addClass(ot);e.text(ft.SuccessfullyAdded);d.val("");u.val("");i.val("");a.add(v).add(y).val("00");nt()}function fi(t,i){var r=n("#teamList");r.find("option").remove();i=ASC.Projects.Common.excludeVisitors(i);i.forEach(function(n){n.displayName!="profile removed"&&r.append('<option value="'+n.id+'" id="optionUser_'+n.id+'">'+n.displayName+"<\/option>")});r.find("option").length==0?rt():nt()}function ei(t,i){n("#selectUserTasks option").remove();i.forEach(function(t){var i='<option value="'+t.id+'" id="optionUser_'+t.id+'">'+n.htmlEncodeLight(t.title)+"<\/option>";t.status==1&&at.append(i);t.status==2&&vt.append(i)});n("#selectUserTasks option").length===0?rt():nt()}function oi(){return p>0||u.val()!=""||i.val()!=""}var ct,p=0,tt=0,h=0,c=0,s=null,lt=null,ut=!1,w=!0,i,u,f,e,l,ft=ASC.Projects.Resources.ProjectsJSResource,b=Teamlab,a,v,y,r,k,d,at,vt,et="click",g="disable",o="error",ot="success",t="disabled",it="stop",gt=function(){var ct,st;if(i=n("#inputTimeMinutes"),u=n("#inputTimeHours"),f=n("#inputDate"),e=n("#timeTrakingErrorPanel"),ct=n("#timerTime"),r=ct.find(".start"),k=ct.find(".reset"),l=n("#addLog"),st=n("#firstViewStyle"),a=st.find(".h"),v=st.find(".m"),y=st.find(".s"),d=n("#textareaTimeDesc"),at=n("#openTasks"),vt=n("#closedTasks"),window.onfocus=function(){var n={},t;if(s&&p>0&&!w){var i=new Date,o=i.getHours(),r=i.getMinutes(),u=i.getSeconds(),l=s.getHours(),f=s.getMinutes(),e=s.getSeconds();n.h=o>l?o-l:0;r>=f?n.m=r-f:n.h>0?(n.m=r+60-f,n.h--,n.m===60&&(n.m=0,n.h++)):n.m=0;u>=e?n.s=u-e:n.m>0?(n.s=u+60-e,n.m--,n.s===60&&(n.s=0,n.m++)):n.s=0;t=ut?ri(lt,n):n;tt=t.h;h=t.m;c=t.s;wt(t)}},l.length){window.onbeforeunload=function(){return r.hasClass(it)?(dt(),""):oi()?"":void 0};ht();u.focus();(n("#teamList option").length==0||n("#selectUserTasks option").length==0)&&rt();f.hasClass("hasDatepicker")||f.datepicker({selectDefaultDate:!1,onSelect:function(){f.blur()}});f.mask(ASC.Resources.Master.DatePatternJQ);f.datepicker("setDate",b.getDisplayDate(new Date));n("#timerTime #selectUserProjects").bind("change",function(){var i=parseInt(n("#selectUserProjects option:selected").val());b.getPrjTeam({},i,{before:function(){n("#teamList").attr(t,t);n("#selectUserTasks").attr(t,t)},success:fi,after:function(){n("#teamList").removeAttr(t);n("#selectUserTasks").removeAttr(t)}});b.getPrjTasks({},{success:ei,filter:{sortBy:"title",sortOrder:"ascending",projectId:i}})});r.bind(et,function(){r.hasClass(g)||dt()});k.bind(et,function(){k.hasClass(g)||bt()});l.bind(et,function(){var s;if(!l.hasClass(g)){rt();var r,t,h,k=parseInt(n("#selectUserProjects option:selected").attr("value")),tt=n("#teamList option:selected").attr("value"),it=parseInt(n("#selectUserTasks option:selected").attr("value")),ut=n.trim(d.val()),c=!1,w;if(u.removeClass(o),i.removeClass(o),e.empty(),p>0)r=parseInt(a.text(),10),t=parseInt(v.text(),10),h=parseInt(y.text(),10),r>0||(r=0),t>0||(t=0),h>0||(h=0),w=r+t/60+h/3600,bt();else{if(u.val()===""&&i.val()===""){e.addClass(o).removeClass(ot);e.text(ft.TimerNoData);nt();return}if(r=parseInt(u.val(),10),t=parseInt(i.val(),10),(r<0||!yt(r))&&(u.addClass(o),c=!0),(t>59||t<0||!yt(t))&&(i.addClass(o),c=!0),c){e.addClass(o).removeClass(ot);e.text(ft.InvalidTime).show();nt();return}r>0||(r=0);t>0||(t=0);w=r+t/60}s={hours:w,note:ut,personId:tt,projectId:k};s.date=f.datepicker("getDate");s.date.setHours(0);s.date.setMinutes(0);s.date=b.serializeTimestamp(s.date);b.addPrjTime({},it,s,{success:ui})}});i.on("blur",function(){var n=i.val();n.length==1&&i.val("0"+n)})}};return{init:gt}}(jQuery);ASC.Projects.TimeTrakingEdit=function(n){function y(){if(!e){var t=v.clone();t.attr("id","timeTrakingPopup");n("#CommonListContainer").append(t);f=t;f.html(jq.tmpl("common_containerTmpl",{options:{PopupContainerCssClass:"popupContainerClass",OnCancelButtonClick:"PopupKeyUpActionProvider.CloseDialog();",IsPopup:!0},header:{data:{title:ASC.Projects.Resources.CommonResource.TimeTracking},title:"projects_common_popup_header"},body:{data:{},title:"projects_editTimerPopup"}}))}}function w(u,f,e){var s=!1;return(parseInt(f,10)>59||parseInt(f,10)<0||!c(f))&&(r.text(o.InvalidTime),t.focus(),s=!0),(parseInt(u,10)<0||!c(u))&&(r.text(o.InvalidTime),i.focus(),s=!0),n.trim(e)!=""&&e!=null&&n.isDateFormat(e)||(r.text(o.IncorrectDate),n("#timeTrakingPopup #timeTrakingDate").focus(),s=!0),s&&(r.show(),setInterval(function(){n("#timeTrakingErrorPanel").hide()},5e3)),s}function c(n){return parseInt(n,10)==n}function k(t,i){var r=i.reduce(function(n,t){return n+t.hours},0),u=n.timeFormat(r);n(".addLogPanel-infoPanelBody #TotalHoursCount").text(u)}function l(t){var i=n("select#teamList");t.forEach(function(t){s==t.id?i.append(n('<option value="'+t.id+'" selected="selected"><\/option>').html(t.displayName)):i.append(n('<option value="'+t.id+'"><\/option>').html(t.displayName))})}function d(t){n("div.entity-menu[timeid="+t.timeid+"]").hide()}function g(n,t){var i=t;i.length&&l(ASC.Projects.Common.excludeVisitors(i))}var s,e,h={},a=!1,v=n("#commonPopupContainer"),f,t,i,r,o=ASC.Projects.Resources.ProjectsJSResource,u=Teamlab,p=function(){y();e||(e=!0);t=n("#inputTimeMinutes");i=n("#inputTimeHours");r=n("#timeTrakingErrorPanel");t.on("blur",function(){var n=t.val();n.length==1&&t.val("0"+n)});n("#timeTrakingPopup .middle-button-container a.button.blue.middle").bind("click",function(){var r=i.val(),f=t.val(),e;w(r,f,n("#timeTrakingPopup #timeTrakingDate").val())||(f=parseInt(f,10),r=parseInt(r,10),r>0||(r=0),f>0||(f=0),e=n("#timeTrakingPopup").attr("timeid"),u.updatePrjTime({oldTime:h,timeid:e},e,{hours:r+f/60,date:u.serializeTimestamp(n("#timeTrakingPopup #timeTrakingDate").datepicker("getDate")),note:n("#timeTrakingPopup #timeDescription").val(),personId:n("#teamList option:selected").attr("value")},{error:d}),n.unblockUI())})},b=function(r,e,o,c,v,y,p,w){$timerDate=n("#timeTrakingDate");s=w;f.attr("timeid",c);n("#timeDescription").val(p);n("#TimeLogTaskTitle").text(o);n("#TimeLogTaskTitle").attr("taskid",e);h=v;i.val(v.hours);v.minutes>9?t.val(v.minutes):t.val("0"+v.minutes);y=u.getDisplayDate(new Date(y));$timerDate.mask(ASC.Resources.Master.DatePatternJQ);$timerDate.datepicker({popupContainer:"#timeTrakingPopup",selectDefaultDate:!0});$timerDate.datepicker("setDate",y);n("select#teamList option").remove();u.getPrjTaskTime({},e,{success:k});a?(n("select#teamList option").remove(),ASC.Projects.Master.Team.length&&l(ASC.Projects.Common.excludeVisitors(ASC.Projects.Master.Team))):u.getPrjProjectTeamPersons({},r,{success:g});StudioBlockUIManager.blockUI(f,550,400,0,"absolute");i.focus()};return{init:p,showPopup:b}}(jQuery);ASC.Projects.GantChart=function(n){function h(n){var t,i;if(!n)return n;if([Number,String,Boolean].forEach(function(i){n instanceof i&&(t=i(n))}),"undefined"==typeof t)if("[object Array]"===Object.prototype.toString.call(n))t=[],n.forEach(function(n,i){t[i]=h(n)});else if("object"==typeof n)if(n.nodeType&&"function"==typeof n.cloneNode)t=n.cloneNode(!0);else if(n.prototype)t=n;else if(n instanceof Date)t=new Date(n);else{t={};for(i in n)t[i]=h(n[i])}else t=n;return t}function c(n){n.preventDefault?n.preventDefault():n.returnValue&&(n.returnValue=!1);n.stopPropagation&&n.stopPropagation()}function p(t){var i=null;return t||(t=n.event),t.target?i=t.target:t.srcElement&&(i=t.srcElement),3==i.nodeType&&(i=i.parentNode),i}function w(n){return n>>0}function l(n){return 0>n?~n++:n}function f(n,t,i,r,u,f){return i-5<=n&&r-5<=t&&u+5>=n&&f+5>=t}function v(n,t){return n&&n.length>t?n.substr(0,t-3)+"...":n}function nt(){this.root=null;this.zg=[];this.data=null}function ht(n){this.p=n}function k(n,t){this.d=n;this.sa=t;this.ed=[]}function tr(){function i(t,i){var r=document.createElement("div"),u;return r.className=t,document.body.appendChild(r),u=n.getComputedStyle(r,null).getPropertyValue(i),document.body.removeChild(r),u}var t=null;return{width:function(n,r){null==t&&(t=document.createElement("canvas"),t.width=450,t.height=100,document.body.appendChild(t));var u=i(r,"font-family"),f=i(r,"font-weight"),e=i(r,"font-size");return t.getContext("2d").font=f+" "+e+" "+u,t.getContext("2d").measureText(n+"W").width},clear:function(){t&&(document.body.removeChild(t),t=null)},jl:i}}function ui(){this.Ke="";this.ve=this.hi("")}function fi(n){this.zc(n)}function ei(n,t){this.p=t;this.d=n;this.step=this.Qa=this.position=0;this.ba={x:0,y:0};this.ef={x:0,y:0};this.Xa=!1;this.He=-1;this.Gb=this.Kf=0;this.sf=!0;this.Qg=!1}function oi(n,t){this.p=t;this.d=n;this.r=this.d.canvas.width;this.U=this.d.canvas.height;this.anchor=this.end=this.eb=0;this.ba={x:0,y:0};this.ef={x:0,y:0};this.Xa=!1}function si(n){this.p=n;this.element=null;this.anchor={b:void 0,c:void 0,a:void 0};this.gm=!0;this.l=null;this.ce="";this.enable=!1}function d(n){if(0==n.length)return" (0/0)";for(var r=0,u=0,t=n.length-1;0<=t;--t)n[t].filter||(i===n[t].o&&++r,++u);return" ("+r+"/"+u+")"}function tt(t,i){if(null===t.$a)return"";var r=t.$a.length;return r?1<r?n.Gantt.Localize_strings.responsibles.format(r):n.Encoder.htmlDecode(t.$a[0].displayName):i}function it(t,i){var r=t.$a;return r?n.Encoder.htmlDecode(r.displayName):i}function rt(n,t){return i===n.o?gt:n.P&&-1===t?et:0>=n.m&&(!n.P||-1!==t)?ni:et}function a(n,t){return t?Teamlab.getDisplayDate(n):n.toLocaleDateString()}function hi(n,t,i){this.Rg=t;this.Jc=this.wa=void 0;this.th=i;this.h=n;this.em=this.Yf=this.Fa=this.Ij=this.We=this.ub=void 0;this.Ci="normal 16px Semibold, sans-serif";this.Je=new tr}function ct(n,t,i){this.h=n;this.th=t;this.Hj=i}function lt(n){this.zc(n)}function at(n,t){this.zc(n,t)}function ci(n,t){this.p=n;this.wg=ur;this.zoom=1;this.Fh=15*this.zoom;this.R=35*this.zoom;this.Md=9*this.zoom;this.font=this.Md+"pt "+e;this.d=n.d;this.r=this.d.canvas.width;this.U=this.d.canvas.height;this.B=t;this.Kb=this.Uc=this.cc=this.pc=this.tc=this.zd=0;this.fb=1;this.xb=7;this.ld=this.p.j;this.Od=.55*this.ld+1;this.Wc=1.65*this.ld}function r(n,t,i,r,u,f,e,s,h,c,l,a,v,y){this.q=parseInt(n);this.Vc=parseInt(t)||-1;this.Q=i;this.Of=r;this.$a=a||[];this.dc=u;this.zb=f;this.bb=e;this.o=s||o;this.gb=void 0!==h?parseInt(h):-1;this.tf=parseInt(c)||0;this.Sh=l||0;this.links=v||[];this.ab=y||!1;this.kb=this.P=!1;e&&(this.kb=f.getTime()===e.getTime());void 0==e?(this.m=this.k=this.pe(this.zb),this.P=!0):(this.k=Math.min(this.pe(this.zb),this.pe(this.bb)),this.m=Math.max(this.pe(this.zb),this.pe(this.bb)));this.duration=this.m-this.k;this.duration=Math.max(this.duration,24);this.m=Math.max(this.m,this.k+this.duration);this.le=!1;this.Mb=-1;this.vb=this.Ac=!1;this.nc=this.Xd=null;this.fc=!0;this.Q&&(this.Q=this.Q.replace(/^\s+/,"").replace(/\s+$/,""));this.dc&&(this.dc=this.dc.replace(/^\s+/,"").replace(/\s+$/,""));this.fd(!0)}function vt(n,t,i){return new r(i,n,"","","",new Date,new Date,o,t)}function g(n,t,i,r,u,f,e,o){this.q=parseInt(n);this.Vc=parseInt(t);this.Q=i;this.dc=r;this.$a=u||null;this.bb=this.zb=f;this.o=e||0;this.Ph=o||!1;this.k=this.pe(f);this.m=this.k+0;this.jh=nr;this.a=[];this.dj=!0;this.duration=0;this.le=!0;this.Mb=-1;this.Jg="";this.vb=!1;this.nc=this.Xd=null;this.Q&&(this.Q=this.Q.replace(/^\s+/,"").replace(/\s+$/,""));this.dc&&(this.dc=this.dc.replace(/^\s+/,"").replace(/\s+$/,""));this.rb();this.Ac=this.collapse=!1}function yt(n,t,i,r,u,f,e,o){this.q=parseInt(n);this.Q=t;this.dc=i?i:"";this.$a=r||null;this.Sl=u?u:new Date;this.m=this.k=null;this.duration=0;this.P=!1;this.nc=null;this.vb=!1;this.c=[];this.a=[];this.Mb=-1;this.sort=!0;this.Q&&(this.Q=this.Q.replace(/^\s+/,"").replace(/\s+$/,""));this.dc&&(this.dc=this.dc.replace(/^\s+/,"").replace(/\s+$/,""));this.Yl=this.Rb=this.collapse=!1;this.Og=f;this.Qh=e;this.o=o||0;this.$e()&&(this.Rb=this.collapse=!0)}function li(){this.b=[];this.c=[];this.a=[];this.Eh=this.Ri=this.Yi=-1;this.dj=!0;this.he=this.ie=null;this.Zl=!0}function pt(n){this.p=n;this.O=this.top=null}function wt(n){this.p=n;this.onshowhint=this.onchangetimescale=null;this.gh=!1;this.position=null}function ai(n){this.p=n;this.Gg=!1;this.sd=0;this.Ud=!1;this.Td=0;this.scrollTo=!1;this.ke=this.Dd=this.Wd=0;this.Hd=null;this.$f=!0;this.Vd=void 0;this.de={D:0,N:0}}function vi(n){this.a=n;this.Dc=1;this.rel=this.Wb=this.wb=0;this.Ul=15;this.ph=new Image;this.ph.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAOCAYAAADwikbvAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAOVJREFUeNpibO7oZSAXMDFQAKii2QCIdwDxdyD+AsTzkdSgy60FYmWQBAsQGwHxISDmRtJwBUpjkwsCYlsgNgfZ3A2V3AnEakCsBcSToK6ahUXuMBCLAnETyGYHqIkJQPwCyYYUIDbGIpcKxDeA2BFk+n+o4G8kjQJA3AaV80cz9BeU/g/SvBfKATlVEIhFgHgB1GmLgHgTlA2T64eq3wVydhEQHwPiKCCOBGJGqORLIK6AsidgkasH2XwViPWgUfARiN8C8VIgNoM6lxWI2bDIPWGBmvQQiENwpAVQWIQOruQJEGAAibMzZdYXHDkAAAAASUVORK5CYII="}function yi(n){this.a=n;this.bound={x:0,y:0,u:0,C:0};this.W={x:0,y:0,u:0,C:0};this.direction=0;this.link=this.Kc=null;this.gc=0;this.sc={x:0,y:0};this.bk=!1}function pi(n){this.a=n;this.l=null;this.bound={x:0,y:0,u:0,C:0};this.Ad={x:0,y:0,u:0,C:0};this.href=null}function bt(n,t){this.Dh(1);this.Pk(n,t);this.Rk();this.Qk();this.Sk();this.Ea=!1;this.td=this.Zf=!0;this.Le=this.Y=!1;this.offsetX=this.Xb=this.da=this.uc=0;this.Jb=this.$=!0;this.Cc=this.Jf=!1;this.X=0;this.oa=-1;this.sb=0;this.xa=this.la=this.ta=this.qa=-1;this.Ab=0;this.xd=null;this.Xa=!1;this.V={x:0,y:0};this.S={x:0,y:0};this.ca={b:-1,c:-1,a:-1};this.Pc={x:0,y:0};this.bc={x:0,y:0,Id:!1};this.zi=!1;this.Yb=null;this.Jd=0;this.J=[];this.Wa=y;this.M=this.n=this.Oa=void 0;this.ka={x:0,y:0,width:0,height:0,Ic:0,Ld:0,time:0,ng:!1};this.K={a:-1,c:-1,b:-1};this.va={a:-1,c:-1,b:-1};this.Te=!1;this.Da=null;this.rh=0;this.zh=this.il=this.bd=!1;this.Ee=[];this.pd=[];this.Rh=!1}var ot,ii,ri,b,st,o=1,i=2,s=2,wi="#CC3300",kt="#BDDA7F",u=[4,2],ir=[4,2],ut="#bdda7f",dt="#cc3300",rr="#4fa7d1",bi="rgba(100,100,100,0.1)",ki="#ffffff",di="#6699ff",gi="#cc3300",e="arial",ft=[1,2],gt="#83888d",ni="#cc3300",et="#333333",ur=8,nr=168,y=100,ti,t;ot="#ffffff";ii="#999999";ri="#666666";b=170;st=300;ti=new Image;Array.prototype.Zc||(Array.prototype.Zc=function(){return this[this.length-1]});Date.prototype.Bf||(Date.prototype.Bf=function(){var t=this.getUTCDate(),i=this.getMonth()+1,n=this.getFullYear().toString();return 10>i&&(i="0"+i.toString()),10>t&&(t="0"+t.toString()),n=n.slice(n.length-2,n.length),t+"."+i+"."+n});Date.prototype.eh||(Date.prototype.eh=function(){var n=this.getUTCDate(),t=this.getMonth()+1,i=this.getFullYear().toString();return 10>t&&(t="0"+t.toString()),10>n&&(n="0"+n.toString()),n+"."+t+"."+i});nt.prototype={createNode:function(){var n=new nt;return this.zg.push(n),n},ud:function(n,t){t(n,this.root,this.data);n=this.root;for(var i=0;i<this.zg.length;++i)this.zg[i].ud(n,t,this.zg[i].data)}};ht.prototype={tl:function(n){n&&(e=n,this.p.nf())}};k.prototype={Qc:function(n,t,i,r,u,f){n.beginPath();var s=r-t,e=t,o=i;for(n.moveTo(t,i),t=0,i=!0;!((0>s?e<=r:e>=r)&&o>=u);){var h=f[t++%f.length],e=e+h,e=0>s?Math.max(r,e):Math.min(r,e),o=Math.min(u,o);i?n.lineTo(e,o):n.moveTo(e,o);i=!i}n.closePath();n.stroke()},Yc:function(n,t,i,r,u,f){n.beginPath();var s=u-i,o=t,e=i;for(n.moveTo(t,i),t=0,i=!0;!(o>=r&&(0>s?e<=u:e>=u));){var h=f[t++%f.length],o=Math.min(r,o),e=e+h,e=0>s?Math.max(u,e):Math.min(u,e);i?n.lineTo(o,e):n.moveTo(o,e);i=!i}n.closePath();n.stroke()},uk:function(n,t,i,r,u,f){this.d.strokeStyle=u;this.d.lineWidth=f;this.d.beginPath();this.d.moveTo(n,t);this.d.lineTo(i,r);this.d.closePath();this.d.stroke()},lineTo:function(n,t,i,r,u,f){t===r&&i!==u&&this.Yc(n,t,Math.min(i,u),r,Math.max(i,u),f);t!==r&&i===u&&this.Qc(n,Math.min(t,r),i,Math.max(t,r),u,f)},oe:function(n,t,i,r,u){this.ed.push({x:n,y:t,width:i,height:r,margin:u})},pj:function(n,t){this.ed.push({x:n.x,y:n.y,width:n.u,height:n.C,margin:t})},mc:function(n){if(n)for(n=this.ed.length-1;0<=n;--n)this.sa.clearRect(this.ed[n].x-this.ed[n].margin,this.ed[n].y-this.ed[n].margin,this.ed[n].width+2*this.ed[n].margin,this.ed[n].height+2*this.ed[n].margin);this.ed=[]},xi:function(n,t,i,r,u,f){n.strokeStyle=f;n.lineWidth=1;n.beginPath();n.moveTo(t,i);n.lineTo(t+r,i);n.moveTo(t+r,i-.5);n.lineTo(t+r,i+u);n.lineTo(t,i+u);n.lineTo(t,i);n.stroke()},ui:function(n,t,i,r){this.d.moveTo(n+20/120*i,t+100/120*r);this.d.lineTo(n+20/120*i,t+80/120*r);this.d.lineTo(n+79/120*i,t+20/120*r);this.d.lineTo(n+.825*i,t+40/120*r);this.d.lineTo(n+40/120*i,t+100/120*r)},vi:function(n,t,i,r){this.d.moveTo(n+.3*i,t+.17*r);this.d.lineTo(n+.71*i,t+.49*r);this.d.lineTo(n+.3*i,t+.82*r)},lg:function(n,t,i,r){this.d.moveTo(n+.16*i,t+.3*r);this.d.lineTo(n+.3*i,t+.15*r);this.d.lineTo(n+.5*i,t+.35*r);this.d.lineTo(n+.7*i,t+.15*r);this.d.lineTo(n+.85*i,t+.3*r);this.d.lineTo(n+.65*i,t+.49*r);this.d.lineTo(n+.85*i,t+.68*r);this.d.lineTo(n+.7*i,t+.82*r);this.d.lineTo(n+.5*i,t+.63*r);this.d.lineTo(n+.3*i,t+.82*r);this.d.lineTo(n+.16*i,t+.68*r);this.d.lineTo(n+.36*i,t+.49*r)},ih:function(n,t,i,r){this.d.moveTo(n+20/120*i,t+20/120*r);this.d.lineTo(n+59/120*i,t+59/120*r);this.d.lineTo(n+20/120*i,t+.825*r);this.d.lineTo(n+20/120*i,t+20/120*r);this.d.lineTo(n+61/120*i,t+59/120*r);this.d.lineTo(n+.825*i,t+20/120*r);this.d.lineTo(n+.825*i,t+.825*r);this.d.lineTo(n+61/120*i,t+59/120*r)},ek:function(n,t,i,r){this.d.moveTo(n+20/120*i,t+.425*r);this.d.lineTo(n+50/120*i,t+.425*r);this.d.lineTo(n+50/120*i,t+.175*r);this.d.lineTo(n+68/120*i,t+.175*r);this.d.lineTo(n+68/120*i,t+.425*r);this.d.lineTo(n+98/120*i,t+.425*r);this.d.lineTo(n+98/120*i,t+.575*r);this.d.lineTo(n+68/120*i,t+.575*r);this.d.lineTo(n+68/120*i,t+.825*r);this.d.lineTo(n+50/120*i,t+.825*r);this.d.lineTo(n+50/120*i,t+.575*r);this.d.lineTo(n+20/120*i,t+.575*r)},qi:function(n,t,i,r){this.d.moveTo(n+16/120*i,t+.45*r);this.d.lineTo(n+29/120*i,t+40/120*r);this.d.lineTo(n+.45*i,t+65/120*r);this.d.lineTo(n+91/120*i,t+28/120*r);this.d.lineTo(n+.875*i,t+.35*r);this.d.lineTo(n+.45*i,t+.775*r)},tk:function(n,t,i,r){this.d.fillRect(n+i/8>>0,t+r/8>>0,6*i/16>>0,r/4>>0);this.d.fillRect(n+i/2>>0,t+10*r/16>>0,6*i/16>>0,r/4>>0);this.d.lineWidth=1;this.d.beginPath();this.d.moveTo((n+i/4>>0)+.5,(t+3*r/16>>0)+.5);this.d.lineTo((n+11*i/16>>0)+.5,(t+3*r/16>>0)+.5);this.d.moveTo((n+11*i/16>>0)+.5,t+3*r/16>>0);this.d.lineTo((n+11*i/16>>0)+.5,(t+7*r/16>>0)+.5);this.d.lineTo((n+11*i/16>>0)+.5,(t+7*r/16>>0)+.5);this.d.lineTo((n+i/4>>0)+.5,(t+7*r/16>>0)+.5);this.d.lineTo((n+i/4>>0)+.5,(t+11*r/16>>0)+.5);this.d.lineTo((n+9*i/16>>0)+.5,(t+11*r/16>>0)+.5);this.d.stroke()},si:function(n,t,i,r){this.d.moveTo(n+.19*i,t+.82*r);this.d.lineTo(n+.19*i,t+.7*r);this.d.lineTo(n+.4*i,t+.6*r);this.d.lineTo(n+.4*i,t+.53*r);this.d.lineTo(n+.59*i,t+.53*r);this.d.lineTo(n+.59*i,t+.6*r);this.d.lineTo(n+.8*i,t+.7*r);this.d.lineTo(n+.8*i,t+.82*r);this.d.fill();this.d.closePath();n+=.5*i;t+=.36*r;i*=.42;r*=.37;this.d.beginPath();this.d.moveTo(n,t-r/2);this.d.bezierCurveTo(n+i/2,t-r/2,n+i/2,t+r/2,n,t+r/2);this.d.bezierCurveTo(n-i/2,t+r/2,n-i/2,t-r/2,n,t-r/2);this.d.fill();this.d.closePath()},pi:function(n,t,i,r){this.d.beginPath();this.d.moveTo(n+.4*i,t+.47*r);this.d.lineTo(n+.85*i,t+.18*r);this.d.lineTo(n+.85*i,t+.77*r);this.d.closePath();this.d.fill()},oi:function(n,t,i,r){this.d.beginPath();this.d.moveTo(n+.85*i,t+.47*r);this.d.lineTo(n+.4*i,t+.18*r);this.d.lineTo(n+.4*i,t+.77*r);this.d.closePath();this.d.fill()},fk:function(n,t,i,r){this.d.beginPath();this.d.moveTo(n+.77*i,t+.18*r);this.d.lineTo(n+.47*i,t+.69*r);this.d.lineTo(n+.18*i,t+.18*r);this.d.closePath();this.d.fill()},sk:function(n,t,i,r){n.fillRect(t-8*r,i-14*r,2*r,8*r);n.fillRect(t-8*r,i-14*r,7*r,2*r);n.fillRect(t-3*r,i-14*r,2*r,8*r);n.fillRect(t-8*r,i-8*r,7*r,2*r);n.fillRect(t-17*r,i-14*r,3*r,5*r);n.fillRect(t-17*r,i-11*r,10*r,2*r);n.fillRect(t-13*r,i-14*r,2*r,5*r)},rk:function(n,t,i,r,u){n.fillStyle=u;n.beginPath();n.moveTo(t+r/3,i+10*r/18);n.lineTo(t+r/3,i+14*r/18);n.lineTo(t+10*r/18,i+14*r/18);n.lineTo(t+10*r/18,i+10*r/18);n.lineTo(t+13*r/18,i+10*r/18);n.lineTo(t+8*r/18,i+3.5*r/18);n.lineTo(t+r/6,i+10*r/18);n.closePath();n.fill()},ri:function(n,t,i,r,u){n.moveTo(t+.16*r,i+.3*u);n.lineTo(t+.3*r,i+.15*u);n.lineTo(t+.5*r,i+.35*u);n.lineTo(t+.7*r,i+.15*u);n.lineTo(t+.85*r,i+.3*u);n.lineTo(t+.65*r,i+.49*u);n.lineTo(t+.85*r,i+.68*u);n.lineTo(t+.7*r,i+.82*u);n.lineTo(t+.5*r,i+.63*u);n.lineTo(t+.3*r,i+.82*u);n.lineTo(t+.16*r,i+.68*u);n.lineTo(t+.36*r,i+.49*u)},Fe:function(n,t,i,r,u,f){n.beginPath();n.moveTo(t+f,i);n.lineTo(t+r-f,i);n.quadraticCurveTo(t+r,i,t+r,i+f);n.lineTo(t+r,i+u-f);n.quadraticCurveTo(t+r,i+u,t+r-f,i+u);n.lineTo(t+f,i+u);n.quadraticCurveTo(t,i+u,t,i+u-f);n.lineTo(t,i+f);n.quadraticCurveTo(t,i,t+f,i);n.closePath()}};ui.prototype={Wj:function(n){this.Ke=n;this.Ke.length&&this.Xj()},oncopy:function(n){n.clipboardData&&(n.preventDefault(),n.clipboardData.setData("text/plain",this.Ke))},clear:function(){this.Ke="";this.ve&&document.body.removeChild(this.ve)},hi:function(){var n=document.createElement("div");return n&&(n.setAttribute("contentEditable",!0),n.style.position="absolute",n.style.left="-10000px",n.style.top="-10000px",n.style.width="1000px",n.style.height="100px",n.style.overflow="hidden",n.style.zIndex=-1e3,n.setAttribute("contentEditable",!0),document.body.appendChild(n)),n},ol:function(t){var i=document.createRange();i.selectNodeContents(t);t=n.getSelection();t.removeAllRanges();t.addRange(i)},Xj:function(){n.clipboardData?n.clipboardData.setData("Text",this.Ke):(this.ve||(this.ve=this.hi(this.Ke)),this.ve.textContent=this.Ke,this.ol(this.ve),document.execCommand("copy",!1,null),n.$l&&document.body.removeChild(this.ve))}};fi.prototype={zc:function(n){this.parent=n;this.d=this.parent.s;this.font="9pt "+e;this.text="";this.select={D:0,N:0};this.dg=new ui;this.Sd="";this.bound={x:0,y:0,u:0,C:0};this.hb={x:0,y:0,u:0,C:0};this.Ge=0;this.ob={left:0,right:0};this.Ob=this.Yg=this.fe=this.Re=this.aa=0;this.xf=!0;this.kg=null;this.Ub=this.ac=0;this.a=this.c=this.b=-1;this.Tg=this.status=this.enable=!1;this.qd="";this.xg=this.$b=this.Lb=null;this.qe=!1;this.Yb=void 0;this.Vf=!1;this.fm=[]},nf:function(){this.font="9pt "+e},je:function(){this.enable=!0;this.fe=this.Re=0;this.aa=this.text.length;this.Ob=0;this.xf=!0;this.Ge=this.Ub=this.ac=0},Ed:function(n){this.parent.s.font=n?this.font:this.parent.Kg},Pa:function(n){this.Re=41;this.aa=n;this.aa=Math.max(0,this.aa);this.aa=Math.min(this.text.length,this.aa);this.select={D:this.aa,N:this.aa};this.xf=!0},te:function(){if(!(!this.enable||0>=this.hb.u||0>=this.hb.C||this.ob.left>this.ob.right)){this.jk();this.Ed(!0);var n=this.Rj(this.d,this.text,this.select.D,this.select.N);this.d.save();this.d.beginPath();this.d.rect(Math.floor(this.ob.left),Math.floor(this.bound.y-2),this.ob.right-this.ob.left-this.Ge+2,this.bound.C+4);this.d.clip();0===this.text.length?(this.d.fillStyle="#999999",this.d.fillText(this.Sd,this.bound.x-this.Ob,this.bound.y+.75*this.bound.C)):(this.d.fillStyle="#333333",this.d.fillText(this.text,this.bound.x-this.Ob,this.bound.y+.75*this.bound.C));n||this.kk();this.d.restore();this.Ck(n);this.Ed(!1)}},jk:function(){var n=this.d;n.fillStyle="#FAFAFA";n.fillRect(this.ob.left,this.bound.y,this.ob.right-this.ob.left+2,this.bound.C);n.fillStyle="#4FA7D1";n.lineWidth=1;this.parent.t.lineTo(n,Math.floor(this.ob.left)+.5,Math.floor(this.bound.y)+.5,Math.floor(this.ob.right+2)+.5,Math.floor(this.bound.y)+.5,ft);this.parent.t.lineTo(n,Math.floor(this.ob.left)+.5,Math.floor(this.bound.y+this.bound.C)+.5,Math.floor(this.ob.right+2)+.5,Math.floor(this.bound.y+this.bound.C)+.5,ft);this.parent.t.lineTo(n,Math.floor(this.ob.left)+.5,Math.floor(this.bound.y)+.5,Math.floor(this.ob.left)+.5,Math.floor(this.bound.y+this.bound.C)+.5,ft);this.parent.t.lineTo(n,Math.floor(this.ob.right+2)+.5,Math.floor(this.bound.y)+.5,Math.floor(this.ob.right+2)+.5,Math.floor(this.bound.y+this.bound.C)+.5,ft)},kk:function(){if(this.Re++,80<this.Re&&(this.Re=0),!(40>this.Re)){var n=Math.floor(this.bound.x+this.fe-this.Ob);n<=this.parent.da||(this.d.fillStyle="#000000",this.d.fillRect(n,Math.floor(this.bound.y+2),2,Math.floor(this.bound.C-3)))}},Ck:function(n){var t,i;n&&(t=Math.floor(this.bound.x-this.Ob+n.D)-this.Ge,n=t+Math.floor(n.N-n.D)+this.Ge,t<this.hb.x&&(t=this.hb.x),n>this.hb.x+this.hb.u&&(n=this.hb.x+this.hb.u),i=this.parent.da,t<i&&(t=i),i=n-t,this.parent.da>=n||t>=this.parent.r-24||0>i||(this.d.fillStyle="#3399FF",this.d.fillRect(t,Math.floor(this.bound.y+2),i,this.bound.C-3),this.d.save(),this.d.beginPath(),this.d.rect(t,Math.floor(this.bound.y-2),i,this.bound.C+4),this.d.clip(),this.d.fillStyle="#FFFFFF",this.d.fillText(this.text,this.bound.x-this.Ob,this.bound.y+.75*this.bound.C),this.d.restore()))},Oj:function(){if(this.enable){this.Ed(!0);this.dd=this.d.measureText(this.text).width;this.fe=this.d.measureText(this.text.substring(0,this.aa)).width;this.bound.u=Math.max(this.dd,this.bound.u);this.hb.u=this.bound.u;this.$b&&(this.bound.x-=this.bound.u+2,this.hb.x=this.bound.x);var n=this.parent.da;this.hb.u=Math.min(this.parent.r-this.hb.x-24,this.hb.u);this.Ge=0;this.xf&&(this.hb.x+this.hb.u>this.bound.x+this.dd-this.Ob&&(this.Ob-=this.hb.x+this.hb.u-(this.bound.x+this.dd-this.Ob)),this.Nj(),this.xf=!1);this.dd<=this.hb.u&&(this.Ob=0);this.ob.left=this.bound.x-this.Ge;this.ob.right=this.ob.left+this.hb.u+this.Ge;this.ob.left<this.hb.x&&(this.ob.left=this.hb.x);this.ob.right>this.hb.x+this.hb.u&&(this.ob.right=this.hb.x+this.hb.u);this.ob.left<n&&(this.ob.left=n);this.Ed(!1)}},Nj:function(){this.enable&&(this.Ed(!0),this.fe=this.d.measureText(this.text.substring(0,this.aa)).width,this.hb.u+this.Ob<this.fe?this.Ob=this.fe-this.hb.u:this.Ob>this.fe&&(this.Ob=this.fe),this.Ed(!1))},reset:function(n){this.bound={x:0,y:0,u:0,C:0};this.Sd=this.qd=this.text="";this.enable=!1;this.Yb=void 0;this.Lb&&(this.Lb.Ac=!1,n||this.parent.Bb().gd(!0));this.$b&&(this.$b.Ac=!1,n||this.parent.Bb().gd(!0));this.xg=this.$b=this.Lb=null;this.parent.sa.style.cursor="";this.parent.v.reset();this.parent.H.reset();this.parent.w.save();this.parent.update();this.parent.ta=-1;this.parent.la=-1;this.parent.xa=-1;this.parent.Jb=!0;this.parent.$=!0;this.parent.Oa=void 0;this.parent.n=void 0;this.parent.Wa=y;this.parent.oa=-1;this.select={D:0,N:0};this.Vf=!1},tb:function(n,t){return this.bound.x>n||n>this.bound.x+this.bound.u||this.bound.y>t||t>this.bound.y+this.bound.C},Ta:function(n,t,i,r){if(this.enable){var u=this.bound.u,f=this.bound.x;this.bound={x:n,y:t,u:Math.max(100,i),C:r};this.hb={x:n,y:t,u:Math.max(100,i),C:r};this.Tg=!0;this.Oj();(this.bound.u!==u||this.bound.x!==f)&&(this.xf=!0)}},Ze:function(n,t){return this.$b&&this.Yb&&5>Math.abs(n-(this.bound.x+this.bound.u))&&t-(this.bound.y+this.bound.C)<this.parent.j?!0:this.bound.x-5<=n&&n<=this.bound.x+this.bound.u+5&&this.bound.y<=t&&t<=this.bound.y+this.bound.C},cancel:function(n,t){(this.Lb||this.$b)&&(this.qd.length?n&&this.parent.L.Qb(0):(this.Me(),this.parent.L.Qb(0)),this.reset(t))},Me:function(){-1===this.c?this.parent.f.b[this.b].a.splice(this.a,1):(this.$b?this.parent.f.b[this.b].c.splice(this.c,1):this.parent.f.b[this.b].c[this.c].a.splice(this.a,1),this.xg&&this.xg.rb())},complete:function(){if(this.text=this.text.replace(/^\s+/,"").replace(/\s+$/,""),250<this.text.length&&(this.text=this.text.substring(0,250)),0===this.text.length&&0<this.Sd.length&&(this.text=this.Sd),this.Oe&&!this.text.length)return this.Me(),this.reset(),this.parent.L.Qb(0),!0;this.qd.length&&!this.text.length&&(this.text=this.qd);var n=null;return this.Lb&&(n=this.Lb,this.Lb.Q=this.text,this.Lb.Ac=!1,this.Lb.update(),this.Lb=null),this.$b&&(n=this.$b,this.$b.Ac=!1,this.$b.Q=this.text,this.$b.update()),this.text.length?this.qd!==this.text||this.Oe?this.parent.L.kc(0,n):this.parent.L.Qb(0):(this.Me(),this.parent.L.Qb(0)),this.reset(),!1},onkeypress:function(t){t=n.event||t;var i=t.keyCode?t.keyCode:t.which?t.which:t.charCode;this.dh=0;switch(i){case 13:return this.complete();case 46:if(0===t.charCode)return!0;break;case 35:case 36:case 37:case 8:case 27:case 38:case 40:case 33:if(t.shiftKey)break;else return!1;case 34:return!1}return t.ctrlKey||t.metaKey?!0:(this.select.D!==this.select.N&&(this.text=this.text.substring(0,this.select.D)+this.text.substring(this.select.N,this.text.length),this.Pa(this.select.D)),t=String.fromCharCode(i),this.aa!==this.text.length?(this.text=this.text.substring(0,this.aa)+t+this.text.substring(this.aa,this.text.length),this.Pa(this.aa+1)):(this.text+=t,this.Pa(this.text.length)),!0)},onkeydown:function(t){var r,i,u;t=n.event||t;r=!1;i=t.keyCode?t.keyCode:t.which?t.which:t.charCode;this.dh=0;switch(i){case 35:t.shiftKey?(u=this.aa,r=this.select.D,i=this.select.N,this.Pa(this.text.length),this.select=r!==i?1===this.ac?{D:r,N:this.text.length}:{D:i,N:this.text.length}:{D:u,N:this.text.length}):(this.Pa(this.text.length),this.ac=0,this.Ub=this.aa,this.select={D:this.aa,N:this.aa});r=!0;break;case 36:t.shiftKey?(u=this.aa,r=this.select.D,i=this.select.N,this.Pa(0),this.select=r!==i?1===this.ac?{D:0,N:r}:{D:0,N:i}:{D:0,N:u}):(this.Pa(0),this.ac=0,this.Ub=this.aa,this.select={D:this.aa,N:this.aa});r=!0;break;case 37:t.ctrlKey||t.metaKey?this.Pa(this.lh(this.text,this.aa)):t.shiftKey?(-1===this.ac?this.select.N>this.Ub?(this.select.N--,this.select.N=Math.min(this.select.N,this.text.length),u=this.select.N):(this.select.D--,this.select.D=Math.max(this.select.D,0),u=this.select.D):this.select.N<=this.Ub?(this.select.D--,this.select.D=Math.max(this.select.D,0),u=this.select.D):(this.select.N--,this.select.N=Math.min(this.select.N,this.text.length),u=this.select.N),r=this.select.D,i=this.select.N,this.Pa(u),this.select={D:r,N:i}):(this.select.D!==this.select.N?this.Pa(this.select.D):this.Pa(this.aa-1),this.ac=0,this.Ub=this.aa,this.select={D:this.aa,N:this.aa});r=!0;break;case 39:t.ctrlKey||t.metaKey?this.select.D!==this.select.N?this.Pa(this.lh(this.text,this.select.N,!0)):this.Pa(this.lh(this.text,this.aa,!0)):t.shiftKey?(-1===this.ac?this.select.D<this.Ub?(this.select.D++,this.select.D=Math.min(this.select.D,this.Ub),u=this.select.D):(this.select.N++,this.select.N=Math.min(this.select.N,this.text.length),u=this.select.N):this.select.D>=this.Ub?(this.select.N++,this.select.N=Math.min(this.select.N,this.text.length),u=this.select.N):(this.select.D++,this.select.D=Math.max(this.select.D,0),u=this.select.D),r=this.select.D,i=this.select.N,this.Pa(u),this.select={D:r,N:i}):(this.select.D!==this.select.N?this.Pa(this.select.N):this.Pa(this.aa+1),this.ac=0,this.Ub=this.aa,this.select={D:this.aa,N:this.aa});r=!0;break;case 8:this.text.length&&(this.select.D!==this.select.N?(this.text=this.text.substring(0,this.select.D)+this.text.substring(this.select.N,this.text.length),this.Pa(this.select.D)):(this.text=this.text.substring(0,this.aa-1)+this.text.substring(this.aa,this.text.length),this.Pa(this.aa-1)),this.ac=0,this.Ub=this.aa,this.select={D:this.aa,N:this.aa});r=!0;break;case 46:this.text.length&&(this.select.D!==this.select.N?(this.text=this.text.substring(0,this.select.D)+this.text.substring(this.select.N,this.text.length),this.Pa(this.select.D)):(this.text=this.text.substring(0,this.aa)+this.text.substring(this.aa+1,this.text.length),this.Pa(this.aa)),this.ac=0,this.Ub=this.aa,this.select={D:this.aa,N:this.aa});r=!0;break;case 27:this.qd.length||this.Me();this.parent.L.Qb(0);this.reset();r=!0;break;case 65:(t.ctrlKey||t.metaKey)&&(this.Pa(this.text.length),this.select={D:0,N:this.text.length},this.ac=1,this.Ub=0,r=!0);break;case 86:if((t.ctrlKey||t.metaKey)&&n.clipboardData&&(i=n.clipboardData.getData("Text"))&&(i=this.og(i),i.length))return this.select.D!==this.select.N&&(this.text=this.text.substring(0,this.select.D)+this.text.substring(this.select.N,this.text.length),this.aa=this.select.D),t=this.text.length,this.text=this.text.substring(0,this.aa)+i+this.text.substring(this.aa,t),this.Pa(this.aa+i.length),this.parent.$=!0;break;case 67:if((t.ctrlKey||t.metaKey)&&this.select.D!==this.select.N&&this.dg&&(i=this.text.substring(this.select.D,this.select.N),i.length))return this.dg.Wj(i),!0;break;case 88:if(t.ctrlKey||t.metaKey)return this.text.length&&this.select.D!==this.select.N&&(this.text=this.text.substring(0,this.select.D)+this.text.substring(this.select.N,this.text.length),this.Pa(this.select.D),this.parent.$=!0),c(t),!1}return r&&c(t),this.parent.$=!0,!1},onmousedown:function(n){if(null!==this.Lb||null!==this.$b)if(this.Ze(n.x,n.y)){if(!this.parent.bd){var t=(new Date).getTime();if(this.kg){if(t-=this.kg.getTime(),this.kg=null,350>t){this.Pa(this.text.length);this.select={D:0,N:this.text.length};this.ac=1;this.Ub=0;this.Zg=new Date;return}}else if(this.Zg&&350>t-this.Zg.getTime()){this.ondblclick(n);this.Zg=new Date;return}this.Kl(n.x+this.Ob);this.Ub=this.aa;this.Vf=this.qe=!0;this.Yg=this.aa;this.parent.$=!0}}else{if(this.qd.length)this.qd===this.text&&void 0==this.Oe?this.parent.L.Qb(0):this.Oe&&!this.text.length?(this.parent.L.Qb(0),this.Me(),this.reset()):this.Lb&&this.parent.L.kc(0,this.Lb);else{if(0!==this.text.length)return this.complete();this.Me();this.parent.L.Qb(0)}this.reset();this.qe=!0}},onmouseup:function(n){if(this.Vf){this.Ed(!0);var t=this.bound.x;this.dd>=this.bound.u&&(t=this.bound.x+this.bound.u-this.dd);n=this.Hg(this.d,this.text,n.x-t+this.Ob);void 0!==n&&(t=this.Yg,this.Pa(n),this.select={D:Math.min(t,n),N:Math.max(t,n)},this.ac=0,this.Ub>this.aa&&(this.ac=-1),this.Ub<this.aa&&(this.ac=1))}this.Vf=this.qe=!1},onmousemove:function(n){var t,i,r;return null===this.Lb&&null===this.$b?!1:(this.Vf&&(this.Ed(!0),t=this.bound.x,this.dd>=this.bound.u&&(t=this.bound.x+this.bound.u-this.dd),i=this.select.D,r=this.select.N,n=this.Hg(this.d,this.text,n.x-t+this.Ob),void 0!==n&&(t=this.Yg,this.Pa(Math.max(t,n)),this.select={D:Math.min(t,n),N:Math.max(t,n)},this.select.D<i?(this.Pa(this.select.D),this.select={D:Math.min(t,n),N:Math.max(t,n)}):this.select.N>r?(this.Pa(this.select.N),this.select={D:Math.min(t,n),N:Math.max(t,n)}):this.select.N===this.select.D&&(this.select={D:this.aa,N:this.aa}),this.parent.$=!0)),!0)},ondblclick:function(n){if(this.Ze(n.x,n.y)){this.kg=new Date;var t=this.bound.x;this.dd>=this.bound.u&&(t=this.bound.x+this.bound.u-this.dd);this.Ed(!0);n=this.Hg(this.d,this.text,n.x-t+this.Ob);void 0!==n&&(n=this.pl(this.text,n))&&(this.select.D===n.D&&this.select.N===n.N?(this.Pa(this.text.length),this.select={D:0,N:this.text.length},this.ac=1,this.Ub=0):(this.Pa(n.N),this.select={D:n.D,N:n.N},this.ac=1,this.Ub=n.D))}},Kl:function(n){this.Ed(!0);var t=this.bound.x;this.dd>=this.bound.u&&(t=this.bound.x+this.bound.u-this.dd);n=this.Hg(this.parent.s,this.text,n-t);void 0!==n&&(this.Pa(n),this.select={D:n,N:n})},Rj:function(n,t,i,r){if(i!==r)return{D:n.measureText(t.substring(0,i)).width,N:n.measureText(t.substring(0,r)).width}},Hg:function(n,t,i){var e=t.length,r=0,o=0,u=0,s="",f=0;if(0!==e){if(0>=i)return 0;if(n.measureText(t).width<=i)return e;for(r=0;r<e;++r){if(s+=t[r],f=u,u=n.measureText(s).width,f=.5*(u-f)+f,o<=i&&i<=u)return i>=f?r+1:r;o=u}}},pl:function(n,t){var i,f=n.length,r="",u,e=t,o=t+1;if(f&&(r+=n[t],-1===" .,<>?;:{}[]~!@#$%^&&*()_+*=-".indexOf(r))){for(i=t+1;i<f;++i){if(u=n[i],-1!==" .,<>?;:{}[]~!@#$%^&&*()_+*=-".indexOf(u))break;r+=u;o++}for(i=t-1;0<=i;--i){if(u=n[i],-1!==" .,<>?;:{}[]~!@#$%^&&*()_+*=-".indexOf(u))break;r=u+r;--e}}return{hm:r,D:e,N:o}},lh:function(n,t,i){var u=n.length,r=t;if(u)if(i){if(-1===" .,<>?;:{}[]~!@#$%^&&*()_+*=-".indexOf(n[t]))for(;t<u&&(r=t,-1===" .,<>?;:{}[]~!@#$%^&&*()_+*=-".indexOf(n[t]));++t);else for(;t<u&&(r=t,-1!==" .,<>?;:{}[]~!@#$%^&&*()_+*=-".indexOf(n[t]));++t);for(t=r;t<u;++t)if(-1===" .,<>?;:{}[]~!@#$%^&&*()_+*=-".indexOf(n[t])){if(t===u-1)break;return t}}else{if(0<t&&-1!==" .,<>?;:{}[]~!@#$%^&&*()_+*=-".indexOf(n[t-1])&&--t,-1===" .,<>?;:{}[]~!@#$%^&&*()_+*=-".indexOf(n[t])){for(;0<=t;--t)if(r=t,-1!==" .,<>?;:{}[]~!@#$%^&&*()_+*=-".indexOf(n[t]))return t+1;for(t=r;0<=t;--t)if(-1===" .,<>?;:{}[]~!@#$%^&&*()_+*=-".indexOf(n[t]))return t}else{for(;0<=t&&(r=t,-1!==" .,<>?;:{}[]~!@#$%^&&*()_+*=-".indexOf(n[t]));--t);for(t=r;0<=t;--t)if(-1!==" .,<>?;:{}[]~!@#$%^&&*()_+*=-".indexOf(n[t]))return t+1}return 0}return u},onpaste:function(t){var r,i,u;if(t.clipboardData)if(t.clipboardData.types)for(u=0;u<t.clipboardData.types.length;)r=t.clipboardData.types[u],"text/plain"===r&&(i=t.clipboardData.getData(r))&&(i=this.og(i),i.length&&(this.select.D!==this.select.N&&(this.text=this.text.substring(0,this.select.D)+this.text.substring(this.select.N,this.text.length),this.aa=this.select.D),r=this.text.length,this.text=this.text.substring(0,this.aa)+i+this.text.substring(this.aa,r),this.Pa(this.aa+i.length))),++u;else(i=t.clipboardData.getData("text/plain"))&&(i=this.og(i),i.length&&(this.select.D!==this.select.N&&(this.text=this.text.substring(0,this.select.D)+this.text.substring(this.select.N,this.text.length),this.aa=this.select.D),r=this.text.length,this.text=this.text.substring(0,this.aa)+i+this.text.substring(this.aa,r),this.Pa(this.aa+i.length)));n.clipboardData&&(i=n.clipboardData.getData("Text"))&&(i=this.og(i),i.length&&(this.select.D!==this.select.N&&(this.text=this.text.substring(0,this.select.D)+this.text.substring(this.select.N,this.text.length),this.aa=this.select.D),r=this.text.length,this.text=this.text.substring(0,this.aa)+i+this.text.substring(this.aa,r),this.Pa(this.aa+i.length)))},oncopy:function(n){if(this.dg)this.dg.oncopy(n)},og:function(n){return n.replace(/(\r\n|\n|\r)/gm," ")}};ei.prototype={zc:function(n,t,i,r){this.Ya=t;this.cg=n;this.cb=i+this.Kf;this.r=r;this.U=this.d.canvas.height;this.el()},refresh:function(){0===this.cb||1>this.cb-this.Ya||(this.cb-this.Ya<this.Ya-50?(this.Qa=this.Ya-(this.cb-this.Ya),this.step=1):(this.Qa=50,this.step=(this.cb-this.Ya)/(this.Ya-50)),-1!=this.He&&(this.position=this.He/this.step,this.He=-1),this.d.fillStyle="rgba(0, 0, 0, 0.1)",this.d.fillRect(this.r-10,this.cg,8,this.U-12-this.cg),this.d.fillStyle=this.Xa&&this.sf?"rgba(0, 0, 0, 0.5)":"rgba(0, 0, 0, 0.25)",this.p.t.Fe(this.d,this.r-10,this.cg+this.position,8,this.Qa,2),this.d.fill())},value:W("Gb"),md:function(){return this.cb-this.Ya},save:function(n){this.He=this.position*this.step;this.Qg=n},di:function(){0<this.step&&(this.position>(this.cb-this.Ya)/this.step&&this.me(),this.p&&this.p.update())},onmousemove:function(n){return 0!=this.cb&&this.Xa?(this.ba=n,this.Wi=!0,this.sf&&(this.position+=(this.ba.y-this.ef.y)/this.p.j*this.p.j,this.ef.y=this.ba.y),this.sf=!0,this.me(),n=this.p,this.Gb=(this.position*this.step/n.j>>0)*n.j-.0001,this.p&&this.p.update(),!0):!1},onmousedown:function(n){return 0!=this.cb&&this.Ff(n)?(this.ba.y>=this.cg+this.position&&this.ba.y<this.cg+this.position+this.Qa&&(this.ef.y=this.ba.y,this.sf=this.Xa=!0,this.Wi=!1,n=this.p,this.Gb=(this.position*this.step/n.j>>0)*n.j-.0001,n.update()),!0):!1},onmouseup:function(n){return this.Wi=this.Xa=!1,0!=this.cb&&this.Ff(n)?(n=this.p,this.Gb=(this.position*this.step/n.j>>0)*n.j-.0001,n.update(),!0):!1},onmousewheel:function(t){if(1>this.cb-this.Ya)return!1;t=t||n.event;var i=t.deltaY||t.detail||t.wheelDelta;return t.deltaY&&(i*=-1),t.detail&&(i*=-1),t=this.p,0!=this.cb&&0!=i?(i=-i/Math.abs(i),t.Y?this.position+=40*i/this.step:(i=((this.position*this.step+i*t.j)/t.j+.5>>0)*t.j,i=Math.max(i,0),i=Math.min(i,this.cb-this.Ya),i=(i/t.j>>0)*t.j-.0001,this.Fg(i)),this.me(),t.update(),t.ya(),t.Te=!0):!1},Zi:function(n,t){0!==n&&("home"===t?(this.position=(this.cb-this.Ya)/this.step,this.Gb=this.position*this.step):"end"===t?this.Gb=this.position=0:(this.position=this.Wg(n),this.Gb=this.position*this.step,this.me()),this.p&&this.p.update())},Wg:function(n){return this.position-n/Math.abs(n)*(this.Ya/(this.cb-this.Ya))*(this.cb-this.Ya)/this.step},nh:function(n){0<this.step?(this.position-=n/this.step,this.me(),n=this.p,this.Gb=this.position*this.step,n.update()):this.Gb=this.position=0},Fg:function(n,t){0<this.step?(this.position=n/this.step,this.me(t),this.Gb=this.position*this.step):this.Gb=this.position=0},yl:function(){this.Gb=this.position=0},Ff:function(n){return this.ba=n,this.ba.x>=this.r-12&&this.ba.x<this.r},el:function(){-1!=this.He&&(0==this.cb||1>this.cb-this.Ya?this.Gb=this.position=0:(this.cb-this.Ya<this.Ya-50?(this.Qa=this.Ya-(this.cb-this.Ya),this.step=1):(this.Qa=50,this.step=(this.cb-this.Ya)/(this.Ya-50)),this.position=this.He/this.step,this.Gb=this.position*this.step,this.me()),this.He=-1)},Ch:V("Kf"),focus:V("sf"),me:function(n){this.position=Math.max(this.position,0);n&&this.position>(this.cb-this.Ya)/this.step?this.nh((this.md()/this.p.j>>0)*this.p.j-.0001):(this.position=Math.min(this.position,(this.cb-this.Ya)/this.step),this.Gb=this.position*this.step,this.Qg&&(this.Gb=((this.Gb+.0001)/this.p.j>>0)*this.p.j-.0001,this.position=this.Gb/this.step,this.Qg=!1));this.cb<this.Ya&&(this.Gb=this.position=0)}};oi.prototype={Jh:function(n,t,i){this.eb=n.eb;this.end=n.end;this.r=t-16;this.U=i;this.Rc=this.p.da+2},refresh:function(){if(!(51>this.r-this.Rc)&&this.eb<this.end){this.d.fillStyle="rgba(0, 0, 0, 0.1)";this.d.fillRect(0,this.U-10,this.r,8);this.d.fillStyle=this.Xa?"rgba(0, 0, 0, 0.5)":"rgba(0, 0, 0, 0.25)";var i=this.cd(),t=i*(this.end-this.eb),n=this.Rc+i*this.eb;50>t&&(t=50,n=.5*(this.end+this.eb),n=.5+(n-.5)*(1+(this.end-this.eb)),n=this.Rc+(i-t)*n);this.p.t.Fe(this.d,n,this.U-10,t,8,2);this.d.fill()}},onmousemove:function(n){if(0!=this.cb&&this.Xa){this.ba=n;n=this.p;var i,t,r,f,u,e;if(n)return n.ja.stop(),f=n.ia.duration,u=n.ia.Nd,i=n.i.R/n.i.B,r=this.Rc/i,t=this.cd(),e=t*(this.end-this.eb),50>e?(t=(this.ba.x-this.anchor-this.Rc)/(t-50),i=n.ia.cf(),r=n.ia.df(),n.offsetX=t*(i-r)+r,n.offsetX=Math.max(n.offsetX,i),n.offsetX=Math.min(n.offsetX,r)):(t=(this.ba.x-this.anchor-this.Rc)/t,t=Math.max(Math.min(u-t,u)*f,(n.ia.eg/n.ia.cd()-1+u)*f)+r,n.offsetX=t*i/n.i.R),n.ia.uh(),n.bg(),!0}return!1},onmousedown:function(n){if(51>this.r-this.Rc)return!1;if(this.eb<this.end&&this.Ff(n)){n=this.cd();var t=n*(this.end-this.eb),i=this.Rc+n*this.eb;return 50>t&&(t=.5*(this.end+this.eb),t=.5+(t-.5)*(1+(this.end-this.eb)),i=this.Rc+(n-50)*t),this.Xa=!0,this.anchor=this.ba.x-i,this.p.ya(),this.p.yb(),!0}return!1},onmouseup:function(){this.Xa=!1},onmousewheel:function(n){return this.p.onmousewheel(n)},Ff:function(n){if(51>this.r-this.Rc)return!1;if(this.ba=n,this.ba.y>=this.U-12&&this.ba.y<this.U&&this.eb<this.end){n=this.cd();var i=n*(this.end-this.eb),t=this.Rc+n*this.eb;return 50>i&&(i=50,t=.5*(this.end+this.eb),t=.5+(t-.5)*(1+(this.end-this.eb)),t=this.Rc+(n-i)*t),this.ba.x>t&&this.ba.x<t+i}return!1},cd:function(){return this.r-this.Rc}};si.prototype={create:function(t){if(this.element=document.createElement("input")){this.element.id="editControl";this.element.type="text";this.element.value="";this.element.style.position="absolute";this.element.style.backgroundColor="white";this.element.style.width="100px";this.element.style.height="20px";this.element.style.border="solid";this.element.style.borderColor="#CCCCCC";this.element.style.borderWidth="1px";this.element.style.outline="none";this.show(!1);var i=this;this.element.onkeypress=function(t){t=n.event||t;t=t.keyCode?t.keyCode:t.which?t.which:t.charCode;this.dh=0;switch(t){case 13:t=this.value.replace(/^\s+/,"").replace(/\s+$/,"");250<t.length&&(t=t.substring(0,250));i.ce.length&&!t.length&&(t=i.ce);var r=null;return i.l&&(r=i.l,i.l.Q=t,i.l.Ac=!1,i.l.update(),i.l=null),t.length?i.ce===t?i.p.L.Qb(0):i.p.L.kc(0,r):i.p.L.Qb(0),i.close(),i.p.yb(),!1}return!0};this.element.onkeydown=function(t){t=n.event||t;switch(t.keyCode?t.keyCode:t.which?t.which:t.charCode){case 27:return i.p.L.Qb(0),i.close(),i.p.yb(),!1;case 13:t=this.value.replace(/^\s+/,"").replace(/\s+$/,"");250<t.length&&(t=t.substring(0,250));i.ce.length&&!t.length&&(t=i.ce);var r=null;return i.l&&(r=i.l,i.l.Q=t,i.l.Ac=!1,i.l.update(),i.l=null),t.length?i.ce===t?i.p.L.Qb(0):i.p.L.kc(0,r):i.p.L.Qb(0),i.close(),i.p.yb(),!1}return!0};t?t.appendChild(this.element):document.body.appendChild(this.element)}},nf:G(),zl:function(n){this.element&&(this.ce=n)},xl:function(n,t,i,r){this.l=n;this.anchor={b:t,c:i,a:r};this.enable=void 0!==this.anchor.b||void 0!==this.anchor.c||void 0!==this.anchor.a},Il:function(){this.element&&(this.element.value="",this.element.value=this.ce,this.element.focus(),this.element.selectionStart=this.element.selectionEnd=this.element.value.length)},show:function(n){n?""!==this.element.style.display&&(this.element.style.overflow="",this.element.style.zIndex=1e3,this.element.style.display="",this.Il()):"none"!==this.element.style.display&&(this.element.style.display="none",this.element.style.overflow="hidden",this.element.style.zIndex=-1e3)},close:function(){this.p.yb();this.l&&(this.p.L.Qb(0),this.l=null);this.anchor={b:void 0,c:void 0,a:void 0};this.enable=!1;this.show(!1)},Ze:function(n){return this.enable&&this.element.style.left<=n.clientX&&this.element.style.left+this.element.style.width>=n.clientX},qh:function(n,t,i){return n===this.anchor.b&&t===this.anchor.c&&i===this.anchor.a}};hi.prototype={F:{elements:[],Rl:[],Xl:[],ra:[]},select:{b:void 0,a:void 0,c:void 0},Ia:{b:void 0,a:void 0,c:void 0},width:250,maxWidth:250,kh:50,yc:10,Mf:-7,Li:52,rows:[{name:"Name",enable:!0,minWidth:265,wa:null,Sa:0,mb:!1,translate:"Name"},{name:"Responsibility",enable:!0,minWidth:140,wa:document.createElement("div"),Sa:0,mb:!1,translate:"Responsible(-s)"},{name:"BeginDate",enable:!1,minWidth:95,wa:document.createElement("div"),Sa:0,mb:!1,translate:"Begin Date"},{name:"EndDate",enable:!1,minWidth:95,wa:document.createElement("div"),Sa:0,mb:!1,translate:"End Date"},{name:"Status",enable:!1,minWidth:60,wa:document.createElement("div"),Sa:0,mb:!1,translate:"Status"},{name:"Priority",enable:!1,minWidth:65,wa:document.createElement("div"),Sa:0,mb:!1,translate:"Priotity"}],ea:[],Oh:-1,mi:!1,zc:function(n){var t=this,i=this.h;this.ub=n;this.Rg&&(this.wa=document.createElement("div"))&&(this.Ci=this.Je.jl("line-project","font"),this.wa.className="left-panel",this.Rg.appendChild(this.wa),this.Jc=document.createElement("div"),this.Jc.style.width="100%",this.Jc.style.height="100%",this.Jc.style.position="absolute",this.wa.appendChild(this.Jc),this.wa.onmouseout=function(){i.Bb().ua.zf()},this.wa.onmousewheel=function(n){t.Ia=void 0;t.h.g.enable&&t.Ye(t.h.g.b,-1===t.h.g.c?void 0:t.h.g.c,-1===t.h.g.a?void 0:t.h.g.a);i.onmousewheel(n);return!0},this.wa.addEventListener("MozMousePixelScroll",function(n){t.Ia=void 0;t.h.g.enable&&t.Ye(t.h.g.b,-1===t.h.g.c?void 0:t.h.g.c,-1===t.h.g.a?void 0:t.h.g.a);i.onmousewheel(n)},!1),this.Jc.oncontextmenu=aa(!1),this.Kj(this.Rg),this.Lj(this.wa),this.Jj(),this.Pj(),this.Pe(void 0),this.g=new si(this.h),this.g.create(this.Jc))},Pj:function(){this.yg=n.Gantt.Localize_strings.noResponsible;this.rows[1].minWidth=Math.max(140,this.yc+this.Je.width(n.Gantt.Localize_strings.responsibles2||"Responsible(-s)","row-tab"));this.rows[2].minWidth=Math.max(95,this.yc+this.Je.width(n.Gantt.Localize_strings.beginDate||"Begin Date","row-tab"));this.rows[3].minWidth=Math.max(95,this.yc+this.Je.width(n.Gantt.Localize_strings.endDate||"End Date","row-tab"));this.rows[4].minWidth=Math.max(60,this.yc+this.Je.width(n.Gantt.Localize_strings.status||"Status","row-tab"));this.rows[5].minWidth=Math.max(65,this.yc+this.Je.width(n.Gantt.Localize_strings.priotity||"Priotity","row-tab"));this.Je.clear()},ul:function(n){this.wa&&this.Oh!=n&&(this.Oh=n,this.wa.style.height=n-61+"px")},Kj:function(n){var t=this,u=document.createElement("div"),i,c,r,h,o;if(u){u.oncontextmenu=aa(!1);u.className="header-element";n.appendChild(u);n=document.createElement("div");n.style.cssText="height:100%; width:100%;position:absolute;";u.appendChild(n);u=n;i=document.createElement("div");i.style.cssText="height:100%; width:100%;overflow:hidden;position:relative;background:#D3D3D3;border-right: 1px solid #CCCCCC;";u.appendChild(i);u=i;i=document.createElement("div");i.className="header-element-down";u.appendChild(i);for(var l=!1,s=this.h,e={},f=1;f<this.rows.length;++f)this.rows[f].wa.className="row-tab",this.rows[f].wa.style.top="26px",u.appendChild(this.rows[f].wa),i=document.createElement("div"),i.className="cell-text-button",this.rows[f].wa.appendChild(i),c=document.createElement("div"),c.className="cell-close-button",this.rows[f].wa.appendChild(c),i.onmousedown=function(){return function(n){l=!0;e=void 0;t.Pb();n=n.clientX-s.d.canvas.offsetLeft;for(var r=t.rows[0].minWidth,i=0;i<t.ea.length;++i){if(n>=r&&n<=r+t.ea[i].width){e={};e.index=i;e.name=t.ea[i].name;break}r+=t.ea[i].width}return e?(document.onmousemove=function(n){for(var i=0,r=1e3,u=0,f=n.clientX-s.d.canvas.offsetLeft,o=t.rows[0].minWidth,i=0;i<t.ea.length&&!t.Hi(t.ea[i].name).mb;++i)r=Math.min(r,t.ea[i].width);for(i=0;i<t.ea.length&&!t.Hi(t.ea[i].name).mb;++i){if(u=o+.5*t.ea[i].width,f>=u-.5*r&&f<=u+.5*r&&e.name!==t.ea[i].name){for(r=[],u=t.ea[i].name,f=0;f<t.ea.length;++f)r.push(t.ea[f].name);for(r[e.index]=u,r[i]=e.name,e.index=i,i=t.Ve(),t.ea=[],u=0;u<r.length;++u)t.Pe(r[u]);if(t.lf(i),t.Bc(void 0),t.ub.onfieldsfilter)t.ub.onfieldsfilter(n,!0,0,0,t.qg());break}o+=t.ea[i].width}},document.onmouseup=function(n){if(l){if(t.Bc(void 0),t.ub.onfieldsfilter)t.ub.onfieldsfilter(n,!0,0,0,t.rg(),t.Ve());document.onmousemove=function(n){s.onmousemove(n)};document.onmouseup=function(n){s.onmouseup(n)}}},!0):!1}}(f),i.onmouseup=function(){return function(n){if(l=!0,t.ub.onfieldsfilter)t.ub.onfieldsfilter(n,!0,0,0,t.qg());return document.onmousemove=function(n){s.onmousemove(n)},document.onmouseup=function(n){s.onmouseup(n)},!0}}(f),c.onclick=function(n){var i=f;return function(){var r=t.Ve(t.rows[i].name);if(t.Pb(),t.$j(t.rows[i].name),t.lf(r),t.Bc(void 0),t.ub.onfieldsfilter)t.ub.onfieldsfilter(n,!0,0,0,t.qg());return!0}}(f);this.Qf=this.Pf=this.gl=this.fl=0;(i=document.createElement("div"))&&(i.id="gantt-filter-projects",i.className="filter-projects",n.appendChild(i),r=document.createElement("div"),r&&(r.id="gantt-filter-fields",r.className="filter-fields",r.style.top="26px",n.appendChild(r),r.onclick=function(n){if(t.Pb(),!t.mi){var i=t.Fa.getBoundingClientRect();if(t.ub.onfieldsfilter)t.ub.onfieldsfilter(n,!1,i.left+i.width,i.top+i.height,t.qg())}return!0},h=document.createElement("div"),h&&(h.className="filter-fields",h.style.top="26px",u.appendChild(h)),this.fl=i.offsetLeft+i.offsetWidth+this.h.d.canvas.offsetLeft,this.gl=i.offsetTop+i.offsetHeight+this.h.d.canvas.offsetTop,this.Pf=r.offsetLeft+r.offsetWidth+this.h.d.canvas.offsetLeft,this.Qf=r.offsetTop+r.offsetHeight+this.h.d.canvas.offsetTop),o=document.createElement("div"),o&&(o.id="gantt-filter-hidden-fields",o.className="filter-hidden-fields",o.style.top="26px",o.style.display="none",n.appendChild(o),o.onclick=function(n){if(t.Pb(),t.ub.onhiddenfieldsfilter)t.ub.onhiddenfieldsfilter(n,!1,t.Bg,t.Cg,t.rg(),t.Ve());return!0},this.bm=i.offsetLeft+2*i.offsetWidth+this.h.d.canvas.offsetLeft,this.cm=i.offsetTop+i.offsetHeight+this.h.d.canvas.offsetTop,this.Bg=r.offsetLeft+r.offsetWidth+this.h.d.canvas.offsetLeft,this.Cg=r.offsetTop+r.offsetHeight+this.h.d.canvas.offsetTop));this.We=u;this.Ij=i;this.Fa=r;this.wf=h;this.Hb=o}},Jj:function(){for(var i=this,n=null,t=0;t<this.kh;++t)(n=document.createElement("div"))&&(n.style.top=(30*t|0)+"px",n.style.height="29px",n.className="line-element",this.Bj(t,n),this.yj(t,n),this.Dj(t,n),this.wj(t,n),this.Aj(t,n),this.Ej(t,n),this.Cj(t,n),this.xj(t,n),this.zj(t,n),this.Jc.appendChild(n),this.F.elements.push(n),n.onmouseover=function(){var n=t;return function(t){return i.ca(t,i,n)}}(t),n.onmouseout=function(){return function(n){return i.g.enable?!0:(n=p(n),"line-element"!==n.className&&(n=n.parentNode),n.style.background="#F3F3F3",i.Ia=void 0,!0)}}(t),n.onclick=function(){return i.g.enable?(i.Pb(),!0):!1},n.onmouseup=function(){var r=t,u=n;return function(n){2===n.button&&(c(n),i.h.g.enable&&i.h.g.cancel(),i.Pb(),i.select={b:i.F.ra[r].b,c:i.F.ra[r].c,a:i.F.ra[r].a,oc:r},i.ub.Bl(n,i.select,u))}}(t))},Lj:function(n){var o=document.createElement("div"),i;if(o&&(o.className="gantt-splitter-fake",n.appendChild(o),i=document.createElement("div"),i)){i.className="gantt-splitter";n.appendChild(i);var r=this.h,t=this,u=!1,s=!1,f=!1,h=0,e=0;i.onmousemove=function(){t.zf()};i.onmousedown=function(n){0!==t.ea.length&&(e=n.clientX,u=!0,h=e-i.getBoundingClientRect().left,c(n),0!==t.ea.length&&(document.onmousemove=function(n){if(e!=n.clientX){if(e=n.clientX,!s){t.zf();n=t.rows[0].minWidth;for(var u=0;u<t.ea.length;++u)t.Xe(t.ea[u].name,!0),n+=t.ea[u].width+t.yc;t.wf.style.left=n-4+"px";t.Hb.style.display="none";t.Bc(void 0);s=!0}f=!0;n=Math.min(Math.max(e-h-8,t.rows[0].minWidth),t.maxWidth);i.style.left=n-300+"px";i.style.width="584px";t.wa.style.width=n+"px";t.We.style.width=n+"px";t.width=n;t.Fa.style.display="none";t.zf();r.$=!0}},document.onmouseup=function(n){if(u){if(f){for(var o=t.rows[0].minWidth,e=Math.min(Math.max(n.clientX,o),t.maxWidth),c=o,h=0,l=0,a=!0;h<t.ea.length;++h){if(o=c,c+=t.ea[h].width+t.yc,e>=o&&e<c){e=o;a=!1;break}h+1===t.ea.length&&e>c-t.yc&&(e=t.maxWidth)}for(;l<t.ea.length;++l)t.Xe(t.ea[l].name,l<h);if(a||(e+=t.Li,t.Hb.style.display="",t.Hb.style.left=e-t.Fa.offsetWidth-59+"px"),i.style.left=e-250+"px",i.style.width="584px",t.wa.style.width=e+"px",t.We.style.width=e+"px",t.width=e,t.Fa.style.left=t.width-t.Fa.offsetWidth-34+"px",t.wf.style.left=t.Fa.style.left,t.Pf=t.Fa.offsetLeft+t.Fa.offsetWidth+t.h.d.canvas.offsetLeft,t.Qf=t.Fa.offsetTop+t.Fa.offsetHeight+t.h.d.canvas.offsetTop,t.Bg=t.Hb.offsetLeft+t.Hb.offsetWidth+t.h.d.canvas.offsetLeft,t.Cg=t.Hb.offsetTop+t.Hb.offsetHeight+t.h.d.canvas.offsetTop,r.$=!0,i.style.left.replace("px",""),i.style.width.replace("px",""),i.style.left=e-16+"px",i.style.width="16px",t.Bc(void 0),t.ub.onhiddenfieldsfilter)t.ub.onhiddenfieldsfilter(n,!0,0,0,t.rg(),t.Ve());t.Fa.style.display="";u=s=!1}f=!1;document.onmousemove=function(n){r.onmousemove(n)};document.onmouseup=function(n){r.onmouseup(n)}}}))};i.onmouseup=function(n){if(u){if(f){for(var o=t.rows[0].minWidth,e=Math.min(Math.max(n.clientX-0,o),t.maxWidth),c=o,h=0,l=0,a=!0;h<t.ea.length;++h){if(o=c,c+=t.ea[h].width+t.yc,e>=o&&e<c){e=o;a=!1;break}h+1===t.ea.length&&e>c-t.yc&&(e=t.maxWidth)}for(;l<t.ea.length;++l)t.Xe(t.ea[l].name,l<h);if(a||(e+=t.Li,t.Hb.style.display="",t.Hb.style.left=e-t.Fa.offsetWidth-59+"px"),i.style.left=e-250+"px",i.style.width="584px",t.wa.style.width=e+"px",t.We.style.width=e+"px",t.width=e,t.Fa.style.left=t.width-t.Fa.offsetWidth-34+"px",t.wf.style.left=t.width-t.Fa.offsetWidth-34+"px",t.Pf=t.Fa.offsetLeft+t.Fa.offsetWidth+t.h.d.canvas.offsetLeft,t.Qf=t.Fa.offsetTop+t.Fa.offsetHeight+t.h.d.canvas.offsetTop,t.Bg=t.Hb.offsetLeft+t.Hb.offsetWidth+t.h.d.canvas.offsetLeft,t.Cg=t.Hb.offsetTop+t.Hb.offsetHeight+t.h.d.canvas.offsetTop,r.$=!0,i.style.left.replace("px",""),i.style.width.replace("px",""),i.style.left=e-16+"px",i.style.width="16px",t.Bc(void 0),t.ub.onhiddenfieldsfilter)t.ub.onhiddenfieldsfilter(n,!0,0,0,t.rg(),t.Ve());t.Fa.style.display="";u=s=!1}f=!1;document.onmousemove=function(n){r.onmousemove(n)};document.onmouseup=function(n){r.onmouseup(n)}}};this.Yf=i;this.ej=o}},Bj:function(t,i){function e(n,t){r.Pb();r.F.ra[t].Cf||(r.select={b:r.F.ra[t].b,c:r.F.ra[t].c,a:r.F.ra[t].a,oc:t},r.ub.Gk(r.select))}var r=this,f=0,u=document.createElement("span");u&&(u.className="name-column",i.appendChild(u),u.ondblclick=function(){return function(i){if(void 0!==r.F.ra[t].b&&void 0===r.F.ra[t].c&&void 0===r.F.ra[t].a){var u=r.h.f.b[r.F.ra[t].b].id();return c(i),n.open("tasks.aspx?prjID="+u),!0}f=2;r.Pb();r.select={b:r.F.ra[t].b,c:r.F.ra[t].c,a:r.F.ra[t].a,oc:t};r.Al(r)}}(t),u.onclick=function(){return function(){var n=this;setTimeout(function(){var i=f;0<i?f=i-1:e.call(n,0,t)},300)}}(t),u.onmousemove=function(){return function(n){return r.ca(n,r,t)}}(t))},yj:function(n,t){var i=document.createElement("span");i&&(i.className="name-column-counter",t.appendChild(i))},Dj:function(n,t){var i=this,r=document.createElement("span");r&&(r.className="name-column-resp",t.appendChild(r),r.onclick=function(){return function(t){c(t);i.h.g.enable||(i.Pb(),i.select={b:i.F.ra[n].b,c:i.F.ra[n].c,a:i.F.ra[n].a,oc:n},i.ub.Sj(t,i.select,p(t)))}}(n))},wj:function(n,t){var i=this,r=document.createElement("span");r&&(r.className="name-column-begin-date",t.appendChild(r),r.onclick=function(){return function(t){c(t);i.h.g.enable||(i.Pb(),i.select={b:i.F.ra[n].b,c:i.F.ra[n].c,a:i.F.ra[n].a,oc:n},i.ub.ci(t,i.select,p(t),!1))}}(n))},Aj:function(n,t){var i=this,r=document.createElement("span");r&&(r.className="name-column-end-date",t.appendChild(r),r.onclick=function(){return function(t){c(t);i.h.g.enable||(i.Pb(),i.select={b:i.F.ra[n].b,c:i.F.ra[n].c,a:i.F.ra[n].a,oc:n},i.ub.ci(t,i.select,p(t),!0))}}(n))},Ej:function(n,t){var i=this,r=document.createElement("span");r&&(r.className="name-column-status",t.appendChild(r),r.onclick=function(){return function(t){c(t);i.h.g.enable||(i.Pb(),i.select={b:i.F.ra[n].b,c:i.F.ra[n].c,a:i.F.ra[n].a,oc:n},i.ub.Tj(t,i.select,p(t)))}}(n))},Cj:function(n,t){var i=document.createElement("span");i&&(i.className="name-column-priority",t.appendChild(i))},xj:function(n,t){var i=this,r=document.createElement("div");r&&(r.className="button-colapse-open",t.appendChild(r),r.onclick=function(){return function(t){c(t);i.Pb();i.select={b:i.F.ra[n].b,c:i.F.ra[n].c,a:i.F.ra[n].a,oc:n,Cf:i.F.ra[n].Cf};i.ub.Uj(t,i.select)}}(n))},zj:function(n,t){var i=this.h,r=this,o,s,u=void 0,f=null,e=document.createElement("div");e&&(e.className="button-drag-drop",t.appendChild(e),e.onmousedown=function(){return function(e){c(e);var h=t.getBoundingClientRect();if(o=e.clientX-h.left,s=e.clientY-h.top,u=t.cloneNode(!0)){for(u.className="element-drag-drop",u.style.background="",u.style.zIndex="1000",u.style.width=r.rows[0].minWidth+"px",u.style.left=-o+e.clientX+"px",u.style.top=-s+e.clientY+"px",e=1;e<u.childNodes.length-1;++e)u.childNodes[e].style.display="none";document.body.appendChild(u)&&(document.body.style.overflow="hidden",(f=document.createElement("div"))&&(f.style.zIndex="990",f.style.position="absolute",f.style.background="transparent",f.style.left="0",f.style.top="0",f.style.width="100%",f.style.height="100%",f.style.cursor="pointer",document.body.appendChild(f)),"onmousewheel"in document?(f.onmousewheel=function(n){i.onmousewheel(n);return!0},u.onmousewheel=function(n){i.onmousewheel(n);return!0}):(u.addEventListener("MozMousePixelScroll",function(n){i.onmousewheel(n);return!0},!1),f.addEventListener("MozMousePixelScroll",function(n){i.onmousewheel(n);return!0},!1)),void 0!==r.Zb&&(r.F.elements[r.Zb].childNodes[8].style.display="none",r.F.elements[r.Ia.oc].style.background="#F3F3F3",r.Zb=void 0,r.zf()),i.K={},i.K.b=void 0!==r.F.ra[n].b?r.F.ra[n].b:-1,i.K.c=void 0!==r.F.ra[n].c?r.F.ra[n].c:-1,i.K.a=void 0!==r.F.ra[n].a?r.F.ra[n].a:-1,r.hh=!0,i.Wa=200,void 0===r.F.ra[n].a&&(i.lc().ii(!1),i.lc().collapse(!0),i.yb(),i.Jb=!0,i.Kd()),document.onmousemove=function(n){i.ba=i.Fd(n.clientX,n.clientY);i.ba.Sg=n;u.style.left=-o+n.clientX+"px";u.style.top=-s+n.clientY+"px";i.Qe(n);r.Ye(i.ca.b,-1===i.ca.c?void 0:i.ca.c,i.ca.a+1);r.Kh();u.style.border=i.K.b===i.ca.b?"2px solid #bdda7f":"2px solid #ff0000";(n=i.f.lb(i.ca.b))&&-1!==i.ca.a&&(-1===i.ca.c?n.collapse&&(n.collapse=!1,i.yb(),i.Jb=!0,i.Kd()):(n=n.ma(i.ca.c),n.collapse&&(n.Mc(!1),i.yb(),i.Jb=!0,i.Kd())))},document.onmouseup=function(n){r.hh=void 0;i.Wa=y;t.getBoundingClientRect();i.ka={x:n.clientX,y:n.clientY-2*i.j,width:0,height:i.G,Ld:0,Ic:0};i.Qe(n);i.K.b===i.ca.b&&(i.Xi(n,i.ca),i.yb());document.body.removeChild(f);document.body.removeChild(u);f=null;document.body.style.overflow="";document.onmousemove=function(n){i.onmousemove(n)};document.onmouseup=function(n){i.onmouseup(n)}})}}}(n))},ql:function(n){this.mi=n;this.Yf&&(this.Yf.style.display=n?"none":"");this.ej&&(this.ej.style.display=n?"none":"");this.Fa&&(this.Fa.className=n?"filter-fields-disable":"filter-fields");n&&(this.Pe(void 0),this.lf([]))},ca:function(n,t,r){return(void 0!==t.Zb&&(t.F.elements[t.Zb].childNodes[8].style.display="none",t.Zb=void 0),t.g.enable)?!0:t.h.g.enable?(t.Ye(t.h.g.b,-1===t.h.g.c?void 0:t.h.g.c,-1===t.h.g.a?void 0:t.h.g.a),!0):(n=p(n),"line-element"!==n.className&&(n=n.parentNode),t.F.ra[r].disabled)?(t.Kh(),!0):(n.style.background="#E1E1E1",t.Ia={b:t.F.ra[r].b,c:t.F.ra[r].c,a:t.F.ra[r].a,oc:r},(n=t.h.f.lb(t.Ia.b))&&0===n.status()&&void 0!==t.F.ra[r].a&&void 0===t.hh&&(n=t.h.f.A(t.Ia.b,t.Ia.c,t.Ia.a),void 0!==n&&i!==n.o&&(t.F.elements[r].childNodes[8].style.display="",t.Zb=r)),t.Kh(),!0)},Bc:function(t){function b(){wt.h.g.enable&&wt.Ye()}var ht,ut,w,k;if(this.Ol)this.Jc.style.top=-this.h.w.value()+"px";else{for(var wt=this,y=this.h,ii=n.Gantt.Localize_strings.taskWithoutMilestones||"Task Without Milestones",bt=n.Gantt.Localize_strings.highPriority||"high",lt=n.Gantt.Localize_strings.openStatus||"open",at=n.Gantt.Localize_strings.closeStatus||"close",st=n.Gantt.Localize_strings.addDate||"add",f,h,p=0,v,s=0,l,o,r,u=this.kh-1;0<=u;--u)this.F.elements[u].className="line-element",this.F.elements[u].style.display="none",this.F.elements[u].style.background="#F3F3F3",this.F.elements[u].childNodes[0].style.font="",this.F.elements[u].childNodes[0].style.color="#333333",this.F.elements[u].childNodes[1].style.color="#333333",this.F.elements[u].childNodes[2].style.color="#333333",this.F.elements[u].childNodes[3].style.color="#333333",this.F.elements[u].childNodes[4].style.color="#333333",this.F.elements[u].childNodes[5].style.color="#333333",this.F.elements[u].childNodes[0].className="name-column",this.F.elements[u].childNodes[2].className="name-column-resp",this.F.elements[u].childNodes[3].className="name-column-begin-date",this.F.elements[u].childNodes[4].className="name-column-end-date",this.F.elements[u].childNodes[5].className="name-column-status",this.F.elements[u].childNodes[6].className="name-column-priority",this.F.elements[u].childNodes[1].textContent="",this.F.elements[u].childNodes[2].textContent="",this.F.elements[u].childNodes[3].textContent="",this.F.elements[u].childNodes[4].textContent="",this.F.elements[u].childNodes[5].textContent="",this.F.elements[u].childNodes[6].textContent="",this.F.elements[u].childNodes[7].style.display="none",this.F.elements[u].childNodes[8].style.display="none";ht=25;ut=34;(void 0!==n.netscape||void 0!==n.clipboardData)&&(--ut,--ht);var ht=ht+"px",ut=ut+"px",ft=void 0!==Teamlab&&void 0!==Teamlab.getDisplayDate;t=y.w.value();this.F.ra=[];this.ql(0===y.f.b.length);w=-((y.w.value()+.5)%y.j)+1;u=y.j;t=(t+.5)/u>>0;k=Math.min(y.U/u+1,this.kh-1);y.w.value();y.i.height();y.i.height();var c=!1,e=y.f.b,ri=e.length,ct=this.rows[1].Sa+"px",kt=this.rows[2].Sa+"px",vt=this.rows[3].Sa+"px",yt=this.rows[4].Sa+"px",dt=this.rows[5].Sa+"px",g=!this.rows[1].mb,pt=!this.rows[2].mb,nt=!this.rows[3].mb,ot=!this.rows[4].mb,ti=!this.rows[5].mb;for(f=0;f<ri;++f){if(c=e[f].$e()||e[f].Ni(),p>=t&&(r=this.F.elements[s],h=e[f].Q,h=h.substring(0,30),r.style.top=(30*s+w|0)+"px",r.childNodes[0].textContent=h,r.childNodes[0].title=e[f].Q,r.childNodes[0].style.left="16px",r.childNodes[0].style.font=this.Ci,g&&(r.childNodes[2].style.left=ct,r.childNodes[2].textContent=it(e[f],this.yg),r.childNodes[2].className="name-column-resp gantt-cell-disable"),r.childNodes[7].className=e[f].Rb?"button-colapse-close":"button-colapse-open",r.childNodes[7].style.display="",c&&(r.childNodes[0].style.color="#83888d",r.childNodes[1].style.color="#83888d",r.childNodes[2].style.color="#83888d",r.childNodes[0].className="name-column gantt-cell-pointer",r.childNodes[2].className="name-column-resp gantt-cell-disable"),e[f].$e()&&(r.childNodes[2].className="name-column-resp gantt-cell-disable",r.childNodes[7].style.display="none"),e[f].Qh&&(r.className="line-element icon-private"),r.style.display="",this.F.ra.push({b:f,c:void 0,a:void 0,text:h,disabled:!0}),++s,k<s)){b();this.Jc.style.display="";return}if(++p,!e[f].Rb){for(u=0;u<e[f].c.length;++u)if(!e[f].c[u].filter){if(p>=t&&(r=this.F.elements[s],h=e[f].c[u].Q,h=h.substring(0,30),l=1===e[f].c[u].o?gt:0>=e[f].c[u].m?ni:et,r.style.top=(30*s+w|0)+"px",r.childNodes[0].textContent=h,r.childNodes[0].title=e[f].c[u].Q,r.childNodes[0].style.fontWeight="bold",r.childNodes[0].style.left="26px",c||(r.childNodes[0].style.color=l),r.childNodes[1].textContent=d(e[f].c[u].a),c||(r.childNodes[1].style.color=l),g&&(r.childNodes[2].style.left=ct,r.childNodes[2].textContent=it(e[f].c[u],this.yg),c||(r.childNodes[2].style.color=l),i-1===e[f].c[u].o&&(r.childNodes[2].className="name-column-resp gantt-cell-disable")),nt&&(r.childNodes[4].textContent=a(e[f].c[u].bb,ft),r.childNodes[4].style.left=vt,c||(r.childNodes[4].style.color=l),i-1===e[f].c[u].o&&(r.childNodes[4].className="name-column-end-date gantt-cell-disable")),ot&&(r.childNodes[5].style.left=yt,r.childNodes[5].textContent=i-1===e[f].c[u].o?at:lt),e[f].c[u].a.length&&(r.childNodes[7].className=e[f].c[u].collapse?"button-colapse-close":"button-colapse-open",r.childNodes[7].style.display=""),c&&(r.childNodes[0].style.color="#83888d",r.childNodes[1].style.color="#83888d",r.childNodes[2].style.color="#83888d",r.childNodes[3].style.color="#83888d",r.childNodes[4].style.color="#83888d",r.childNodes[5].style.color="#83888d",r.childNodes[6].style.color="#83888d",r.childNodes[7].style.color="#83888d",r.childNodes[0].className="name-column gantt-cell-pointer",r.childNodes[2].className="name-column-resp gantt-cell-disable",r.childNodes[3].className="name-column-begin-date gantt-cell-disable",r.childNodes[5].className="name-column-status gantt-cell-disable",r.childNodes[6].className="name-column-priority gantt-cell-disable"),r.style.display="",this.F.ra.push({b:f,c:u,a:void 0,text:h}),this.g.enable&&this.g.qh(f,u,void 0)?(this.g.element.style.left=ht,this.g.element.style.top=(30*s+w|0)+3+"px",this.g.element.className="milestone-edit",this.g.element.style.display="",r.style.background="#E1E1E1"):this.Ia&&this.Ia.b===f&&this.Ia.c===u&&void 0===this.Ia.a&&(r.style.background="#E1E1E1"),++s,k<s)){b();this.Jc.style.display="";return}if(++p,y.Y||!e[f].c[u].collapse)for(v=0;v<e[f].c[u].a.length;++v)if(!e[f].c[u].a[v].filter){if(p>=t&&(r=this.F.elements[s],o=e[f].c[u].a[v],h=o.Q,h=h.substring(0,30),l=rt(o,u),r.style.top=(30*s+w|0)+"px",r.childNodes[0].textContent=h,r.childNodes[0].title=o.Q,r.childNodes[0].style.left="35px",r.childNodes[0].style.fontWeight="",c||(r.childNodes[0].style.color=l),g&&(r.childNodes[2].style.left=ct,r.childNodes[2].textContent=tt(o,this.yg),c||(r.childNodes[2].style.color=l),i===o.o&&(r.childNodes[2].className="name-column-resp gantt-cell-disable")),pt&&(r.childNodes[3].textContent=o.ab?st:a(o.vd(),ft),r.childNodes[3].style.left=kt,c||(r.childNodes[3].style.color=l),i===o.o&&(r.childNodes[3].className="name-column-begin-date gantt-cell-disable")),nt&&(r.childNodes[4].textContent=o.P?st:a(o.hd(),ft),r.childNodes[4].style.left=vt,c||(r.childNodes[4].style.color=l),i===o.o&&(r.childNodes[4].className="name-column-end-date gantt-cell-disable")),ot&&(r.childNodes[5].style.left=yt,r.childNodes[5].textContent=i===o.o?at:lt),o.tf&&ti&&(r.childNodes[6].textContent=bt,r.childNodes[6].style.left=dt,c||(r.childNodes[6].style.color=l)),c&&(r.childNodes[0].style.color="#83888d",r.childNodes[1].style.color="#83888d",r.childNodes[2].style.color="#83888d",r.childNodes[3].style.color="#83888d",r.childNodes[4].style.color="#83888d",r.childNodes[5].style.color="#83888d",r.childNodes[6].style.color="#83888d",r.childNodes[7].style.color="#83888d",r.childNodes[0].className="name-column gantt-cell-pointer",g&&(r.childNodes[2].className="name-column-resp gantt-cell-disable"),nt&&(r.childNodes[3].className="name-column-begin-date gantt-cell-disable"),nt&&(r.childNodes[4].className="name-column-end-date gantt-cell-disable"),ot&&(r.childNodes[5].className="name-column-status gantt-cell-disable"),r.childNodes[6].className="name-column-priority gantt-cell-disable"),r.style.display="",this.F.ra.push({b:f,c:u,a:v,text:h}),this.g.enable&&this.g.qh(f,u,v)?(this.g.element.style.left=ut,this.g.element.style.top=(30*s+w|0)+3+"px",this.g.element.className="task-edit",this.g.element.style.display="",r.style.background="#E1E1E1"):this.Ia&&this.Ia.b===f&&this.Ia.c===u&&this.Ia.a===v&&(r.style.background="#E1E1E1"),++s,k<s)){b();this.Jc.style.display="";return}++p}}if(p>=t){if(r=this.F.elements[s],r.style.top=(30*s+w|0)+"px",r.childNodes[0].textContent=ii,r.childNodes[0].title="",r.childNodes[0].style.fontWeight="bold",r.childNodes[0].style.left="26px",r.childNodes[1].textContent=d(e[f].a),r.childNodes[7].style.display="",e[f].a.length?(r.childNodes[7].className=e[f].collapse?"button-colapse-close":"button-colapse-open",r.childNodes[7].style.display=""):r.childNodes[7].style.display="none",c&&(r.childNodes[0].style.color="#83888d",r.childNodes[1].style.color="#83888d"),r.childNodes[0].className="name-column gantt-cell-disable",r.style.display="",this.F.ra.push({b:f,c:void 0,a:void 0,text:h,disabled:!0,Cf:!0}),++s,k<s){b();this.Jc.style.display="";return}++p}if(++p,!e[f].collapse)for(v=0;v<e[f].a.length;++v)if(!e[f].a[v].filter){if(p>=t&&(r=this.F.elements[s],o=e[f].a[v],h=o.Q,h=h.substring(0,30),l=rt(o,-1),r.style.top=(30*s+w|0)+"px",r.childNodes[0].textContent=h,r.childNodes[0].title=o.Q,r.childNodes[0].style.left="35px",r.childNodes[0].style.fontWeight="",c||(r.childNodes[0].style.color=l),g&&(r.childNodes[2].style.left=ct,r.childNodes[2].textContent=tt(o,this.yg),c||(r.childNodes[2].style.color=l),i===o.o&&(r.childNodes[2].className="name-column-resp gantt-cell-disable")),pt&&(r.childNodes[3].textContent=o.ab?st:a(o.vd(),ft),r.childNodes[3].style.left=kt,c||(r.childNodes[3].style.color=l),i===o.o&&(r.childNodes[3].className="name-column-begin-date gantt-cell-disable")),nt&&(r.childNodes[4].textContent=o.P?st:a(o.hd(),ft),r.childNodes[4].style.left=vt,c||(r.childNodes[4].style.color=l),i===o.o&&(r.childNodes[4].className="name-column-end-date gantt-cell-disable")),ot&&(r.childNodes[5].style.left=yt,r.childNodes[5].textContent=i===o.o?at:lt),o.tf&&ti&&(r.childNodes[6].textContent=bt,r.childNodes[6].style.left=dt,r.childNodes[6].style.color=l),c&&(r.childNodes[0].style.color="#83888d",r.childNodes[1].style.color="#83888d",r.childNodes[2].style.color="#83888d",r.childNodes[3].style.color="#83888d",r.childNodes[4].style.color="#83888d",r.childNodes[5].style.color="#83888d",r.childNodes[0].className="name-column gantt-cell-pointer",g&&(r.childNodes[2].className="name-column-resp gantt-cell-disable"),pt&&(r.childNodes[3].className="name-column-begin-date gantt-cell-disable"),nt&&(r.childNodes[4].className="name-column-end-date gantt-cell-disable"),ot&&(r.childNodes[5].className="name-column-status gantt-cell-disable"),r.childNodes[6].className="name-column-priority gantt-cell-disable"),r.style.display="",this.F.ra.push({b:f,c:void 0,a:v,text:h}),this.g.enable&&this.g.qh(f,void 0,v)?(this.g.element.style.left=ut,this.g.element.style.top=(30*s+w|0)+3+"px",this.g.element.className="task-edit",this.g.element.style.display="",r.style.background="#E1E1E1"):this.Ia&&this.Ia.b===f&&void 0===this.Ia.c&&this.Ia.a===v&&(r.style.background="#E1E1E1"),++s,k<s)){b();this.Jc.style.display="";return}++p}}}b()}},Pe:function(t){for(var r=0,i=0,i=0;i<this.ea.length;++i)r+=this.ea[i].width+this.yc;if(void 0===t){for(this.ea=[],i=1;i<this.rows.length;++i)this.rows[i].Sa=-1e3,this.rows[i].wa.style.left=this.rows[i].Sa+"px",this.Xe(i,!0);this.Hb.style.display="none"}else"Responsibility"===t?(this.ea.push({width:this.rows[1].minWidth,name:"Responsibility"}),this.rows[1].Sa=this.rows[0].minWidth+r,this.rows[1].translate=n.Gantt.Localize_strings.responsibles2||"Responsible(-s)",this.rows[1].wa.style.left=this.rows[1].Sa+this.Mf+"px",this.rows[1].wa.style.width=this.rows[1].minWidth+"px",this.rows[1].wa.childNodes[0].textContent=this.rows[1].translate):"BeginDate"===t?(this.ea.push({width:this.rows[2].minWidth,name:"BeginDate"}),this.rows[2].Sa=this.rows[0].minWidth+r,this.rows[2].translate=n.Gantt.Localize_strings.beginDate||"Begin Date",this.rows[2].wa.style.left=this.rows[2].Sa+this.Mf+"px",this.rows[2].wa.style.width=this.rows[2].minWidth+"px",this.rows[2].wa.childNodes[0].textContent=this.rows[2].translate):"EndDate"===t?(this.ea.push({width:this.rows[3].minWidth,name:"EndDate"}),this.rows[3].Sa=this.rows[0].minWidth+r,this.rows[3].translate=n.Gantt.Localize_strings.endDate||"End Date",this.rows[3].wa.style.left=this.rows[3].Sa+this.Mf+"px",this.rows[3].wa.style.width=this.rows[3].minWidth+"px",this.rows[3].wa.childNodes[0].textContent=this.rows[3].translate):"Status"===t?(this.ea.push({width:this.rows[4].minWidth,name:"Status"}),this.rows[4].Sa=this.rows[0].minWidth+r,this.rows[4].translate=n.Gantt.Localize_strings.status||"Status",this.rows[4].wa.style.left=this.rows[4].Sa+this.Mf+"px",this.rows[4].wa.style.width=this.rows[4].minWidth+"px",this.rows[4].wa.childNodes[0].textContent=this.rows[4].translate):"Priority"===t&&(this.ea.push({width:this.rows[5].minWidth,name:"Priority"}),this.rows[5].Sa=this.rows[0].minWidth+r,this.rows[5].translate=n.Gantt.Localize_strings.priotity||"Priotity",this.rows[5].wa.style.left=this.rows[5].Sa+this.Mf+"px",this.rows[5].wa.style.width=this.rows[5].minWidth+"px",this.rows[5].wa.childNodes[0].textContent=this.rows[5].translate);for(i=r=0;i<this.ea.length;++i)r+=this.ea[i].width+this.yc;this.maxWidth=this.width=this.rows[0].minWidth+r+this.Fa.offsetWidth+this.yc;this.wa.style.width=this.width+"px";this.We.style.width=this.width+"px";this.Fa.style.left=this.width-this.Fa.offsetWidth-14+"px";this.wf.style.left=this.Fa.style.left;this.Pf=this.Fa.offsetLeft+this.Fa.offsetWidth+this.h.d.canvas.offsetLeft;this.Qf=this.Fa.offsetTop+this.Fa.offsetHeight+this.h.d.canvas.offsetTop;this.Yf.style.left=this.width-16+"px"},$j:function(n){var t=[],i=0,r=0;for(t.push(void 0);i<this.ea.length;++i)n!==this.ea[i].name&&t.push(this.ea[i].name);for(;r<t.length;++r)this.Pe(t[r]);this.Bc(this.h.w.value());this.h.$=!0},qg:function(){for(var n=0,t=[];n<this.ea.length;++n)t.push(this.ea[n].name);return t},lf:function(n){var t=0,r,i;if(n){if(n.length!==this.ea.length)for(t=0;t<this.ea.length;++t)this.Xe(this.ea[t].name,!1);for(t=0;t<n.length;++t)this.Xe(n[t],!0);for(r=t=0,r=0;r<this.ea.length;++r){n:{for(i=this.rows.length-1;0<=i;--i)if(this.rows[i].name===this.ea[r].name){i=this.rows[i];break n}i=null}i&&!i.mb&&(t+=this.ea[r].width+this.yc)}n.length!==this.ea.length&&(t+=22,this.Hb.style.display="",this.Hb.style.left=this.rows[0].minWidth+t-this.Fa.offsetWidth-9+"px");this.width=this.rows[0].minWidth+t+this.Fa.offsetWidth+this.yc;this.wa.style.width=this.width+"px";this.We.style.width=this.width+"px";this.Fa.style.left=this.width-this.Fa.offsetWidth-14+"px";this.wf.style.left=this.Fa.style.left;this.Pf=this.Fa.offsetLeft+this.Fa.offsetWidth+this.h.d.canvas.offsetLeft;this.Qf=this.Fa.offsetTop+this.Fa.offsetHeight+this.h.d.canvas.offsetTop;this.Bg=this.Hb.offsetLeft+this.Hb.offsetWidth+this.h.d.canvas.offsetLeft;this.Cg=this.Hb.offsetTop+this.Hb.offsetHeight+this.h.d.canvas.offsetTop;this.Yf.style.left=this.width-16+"px"}},Xe:function(n,t){"Responsibility"===n||1===n?(this.rows[1].wa.style.display=t?"":"none",this.rows[1].mb=!t):"BeginDate"===n||2===n?(this.rows[2].wa.style.display=t?"":"none",this.rows[2].mb=!t):"EndDate"===n||3===n?(this.rows[3].wa.style.display=t?"":"none",this.rows[3].mb=!t):"Status"===n||4===n?(this.rows[4].wa.style.display=t?"":"none",this.rows[4].mb=!t):("Priority"===n||5===n)&&(this.rows[5].wa.style.display=t?"":"none",this.rows[5].mb=!t)},rg:function(){for(var n=null,t=0,i=[];t<this.ea.length;++t){n:{for(n=this.rows.length-1;0<=n;--n)if(this.rows[n].name===this.ea[t].name){n=this.rows[n];break n}n=null}n&&n.mb&&i.push(this.ea[t].name)}return i},Ve:function(n){for(var t,r=[],i=0;i<this.ea.length;++i){n:{for(t=this.rows.length-1;0<=t;--t)if(this.rows[t].name===this.ea[i].name){t=this.rows[t];break n}t=null}t&&!t.mb&&n!==this.ea[i].name&&r.push(this.ea[i].name)}return r},Hi:function(n){for(var t=this.rows.length-1;0<=t;--t)if(this.rows[t].name===n)return this.rows[t];return null},Al:function(n){var t=n.h,u,r;return t.Ea?!1:(u=h(n.select),t.g.cancel(),void 0!==n.select.b&&0!==t.f.lb(n.select.b).status())?!1:(n.select=h(u),r=u=null,void 0!==n.select.a?(r=t.f.A(n.select.b,n.select.c,n.select.a))&&(i!==r.o?(u=t.f.jc(n.select.b,n.select.c,n.select.a),t.L.add(700,{b:n.select.b,c:n.select.c,a:r,index:n.select.a,ha:u.a,fa:u.c,ga:u.b,Nc:!0})):(r=null,this.select=void 0)):(r=t.f.ma(n.select.b,n.select.c))&&(i-1!==r.o?(u=t.f.$c(n.select.b,n.select.c),t.L.add(800,{b:this.select.b,c:n.select.c,a:r,index:n.select.a,ha:u.a,fa:u.c,ga:u.b,Nc:!0})):(r=null,this.select=void 0)),r?(n.g.element.style.width="175px",n.g.element.style.height=.6*t.j+"px",n.g.xl(r,this.select.b,this.select.c,this.select.a),n.g.zl(r.Q),t.la=void 0===n.g.anchor.a?-1:n.g.anchor.a,t.xa=void 0===n.g.anchor.c?-1:n.g.anchor.c,t.ta=n.g.anchor.b,t.$=!0,n.g.show(!0),n.Bc(void 0),!0):!1)},Pb:function(n,t){(this.g.close(),this.select&&this.select.oc&&(this.F.elements[this.select.oc].style.background="#F3F3F3",t))||(this.Ia=this.select=void 0,n&&this.Bc(void 0))},Kh:function(){this.Ia&&this.Ia.oc?this.h.g.enable||(this.h.la=void 0===this.Ia.a?-1:this.Ia.a,this.h.xa=void 0===this.Ia.c?-1:this.Ia.c,this.h.ta=this.Ia.b):(this.h.la=-1,this.h.xa=-1,this.h.ta=-1);this.h.$=!0},Ye:function(n,t,r){this.Ia&&this.Ia.oc&&(this.F.elements[this.Ia.oc].style.background="#F3F3F3",this.F.elements[this.Ia.oc].childNodes[8].style.display="none",this.Ia=void 0,void 0!==this.Zb&&(this.F.elements[this.Zb].childNodes[8].style.display="none",this.Zb=void 0));this.h.g.enable&&(n=this.h.g.b,t=-1===this.h.g.c?void 0:this.h.g.c,r=-1===this.h.g.a?void 0:this.h.g.a);for(var u=this.F.ra.length-1;0<=u;--u)if(this.F.ra[u].b===n&&this.F.ra[u].c===t&&this.F.ra[u].a===r){this.Ia={b:n,c:t,a:r,oc:u};this.F.elements[u].style.background="#E1E1E1";void 0===this.hh&&void 0!==this.Ia.a&&i!==this.h.f.A(this.Ia.b,this.Ia.c,this.Ia.a).o&&(this.F.elements[u].childNodes[8].style.display="");void 0!==this.Zb&&(this.F.elements[this.Zb].childNodes[8].style.display="none",this.Zb=void 0);break}},zf:function(){(-1!==this.h.la||-1!==this.h.xa||-1!==this.h.ta)&&(this.h.la=-1,this.h.xa=-1,this.h.ta=-1,this.h.$=!0);void 0!==this.Zb&&(this.F.elements[this.Zb].childNodes[8].style.display="none",this.Zb=void 0)}};ct.prototype={th:void 0,ua:void 0,zc:function(){(this.ua=new hi(this.h,this.Hj,this.th))&&this.ua.zc(this)},kf:function(n){this.ua&&this.ua.Bc(n)},Bc:function(){this.ua&&this.ua.Bc(void 0)},vj:function(n){if(this.ua.Pe(void 0),n)for(var t=0;t<n.length;++t)this.ua.Pe(n[t]);this.ua.Bc(this.h.w.value());this.h.$=!0},lf:function(n){this.ua.lf(n);this.ua.Bc(this.h.w.value());this.h.$=!0},gd:function(n,t){this.ua.Pb(n,t)},Mg:function(n,t,i){this.ua.Ye(n,t,i)},fi:function(){void 0!==this.ua.Zb&&(this.ua.F.elements[this.ua.Zb].childNodes[8].style.display="none",this.ua.Zb=void 0)},Gk:function(n){if(this.ua.Pb(),void 0===n.a&&void 0!==n.c&&void 0!==n.b&&this.h.ja.Lc(this.h.f.ma(n.b,n.c).m),void 0!==n.a&&void 0!==n.c&&void 0!==n.b&&this.h.ja.Lc(this.h.f.A(n.b,n.c,n.a).k),void 0!==n.a&&void 0===n.c&&void 0!==n.b&&this.h.ja.Lc(this.h.f.A(n.b,void 0,n.a).k),void 0===n.a&&void 0===n.c&&void 0!==n.b){var r,u=this.h,t=this.h.f.lb(n.b);for(n=0;n<t.c.length;++n)for(r=0;r<t.c[n].a.length;++r)if(i!=t.c[n].a[r].status()){t.Wf(!1);t.c[n].Mc(!1);u.yb();u.Jb=!0;u.Kd();u.lc().fg(t.c[n].a[r].id(),!1,function(){u.Zd()});return}for(r=0;r<t.a.length;++r)if(i!=t.a[r].status()){t.Mc(!1);t.Wf(!1);u.yb();u.Jb=!0;u.Kd();u.lc().fg(t.a[r].id(),!1,function(){u.Zd()});break}}},Sj:function(n,t,r){var f;if(void 0!==t.b&&0!==this.h.f.lb(t.b).status())return!1;this.ua.Pb();var u=null,u=null,u=r.getBoundingClientRect();return(r={left:u.left,top:u.top+1.2*u.height},f=this.h.J["503"],!f)?!1:void 0===t.a&&void 0!==t.c&&void 0!==t.b?(u=this.h.f.ma(t.b,t.c),i-1===this.h.f.b[t.b].c[t.c].status())?!1:(this.h.Za.O={b:t.b,c:t.c,a:void 0,status:this.h.f.b[t.b].c[t.c].status(),l:this.h.f.b[t.b].c[t.c],na:this.h.f.$c(t.b,t.c)},c(n),f(u,r,!0),!0):void 0!==t.a&&void 0!==t.c&&void 0!==t.b?(u=this.h.f.A(t.b,t.c,t.a),i===u.status())?!1:(this.h.Za.O={b:t.b,c:t.c,a:t.a,status:u.status(),l:u,fc:!0,na:this.h.f.jc(t.b,t.c,t.a)},f(u,r,!0),!0):void 0!==t.a&&void 0===t.c&&void 0!==t.b?(u=this.h.f.A(t.b,void 0,t.a),i===u.status())?!1:(this.h.Za.O={b:t.b,c:t.c,a:t.a,status:u.status(),l:u,fc:!0,na:this.h.f.jc(t.b,t.c,t.a)},f(u,r,!0),!0):!1},Tj:function(n,t,i){if(this.ua.Pb(),void 0!==t.b&&0!==this.h.f.lb(t.b).status())return!1;var r=null,r=null;return n=this.h.J["500"],i=i.getBoundingClientRect(),i={left:i.left,top:i.top+1.2*i.height},n?void 0===t.a&&void 0!==t.c&&void 0!==t.b?(r=this.h.f.ma(t.b,t.c),this.h.Za.O={b:t.b,c:t.c,a:void 0,status:this.h.f.b[t.b].c[t.c].status(),l:this.h.f.b[t.b].c[t.c],na:this.h.f.$c(t.b,t.c)},n(r,i,!0),!0):void 0!==t.a&&void 0!==t.c&&void 0!==t.b?(r=this.h.f.A(t.b,t.c,t.a),this.h.Za.O={b:t.b,c:t.c,a:t.a,status:r.status(),l:r,fc:!0,na:this.h.f.jc(t.b,t.c,t.a)},n(r,i,!0),!0):void 0!==t.a&&void 0===t.c&&void 0!==t.b?(r=this.h.f.A(t.b,void 0,t.a),this.h.Za.O={b:t.b,c:t.c,a:t.a,status:r.status(),l:r,fc:!0,na:this.h.f.jc(t.b,t.c,t.a)},n(r,i,!0),!0):!1:!1},ci:function(n,t,r,u){if(this.onchangetimes){if(this.ua.Pb(),void 0!==t.b&&0!==this.h.f.lb(t.b).status())return!1;var f=n=n=null;if(r=r.getBoundingClientRect(),r={left:r.left,top:r.top+1.2*r.height},void 0===t.a&&void 0!==t.c&&void 0!==t.b){if(n=this.h.f.ma(t.b,t.c),i-1===this.h.f.b[t.b].c[t.c].status())return!1;this.h.Za.O={b:t.b,c:t.c,a:void 0,status:this.h.f.b[t.b].c[t.c].status(),l:this.h.f.b[t.b].c[t.c],na:this.h.f.$c(t.b,t.c)};this.onchangetimes(r,n,!1);return!0}if(void 0!==t.a&&void 0!==t.c&&void 0!==t.b){if(n=this.h.f.A(t.b,t.c,t.a),i===n.status())return!1;if(this.h.Za.O={b:t.b,c:t.c,a:t.a,status:n.status(),l:n,fc:!0,na:this.h.f.jc(t.b,t.c,t.a)},f=this.h.J["500"])return this.onchangetimes(r,n,u),!0}if(void 0!==t.a&&void 0===t.c&&void 0!==t.b){if(n=this.h.f.A(t.b,void 0,t.a),i===n.status())return!1;this.h.Za.O={b:t.b,c:t.c,a:t.a,status:n.status(),l:n,fc:!0,na:this.h.f.jc(t.b,t.c,t.a)};this.onchangetimes(r,n,u);return!0}}return!1},Uj:function(n,t){if(this.h.g.enable)return!1;var i=null,i=null;return void 0===t.a&&void 0!==t.c&&void 0!==t.b?(i=this.h.f.ma(t.b,t.c),n.ctrlKey||n.metaKey?this.h.lc().collapse(!i.collapse):i.Mc(!i.collapse),this.h.w.save(!0),this.h.Jb=!0,this.h.yb(),!0):void 0!==t.b&&void 0!==t.Cf?(i=this.h.f.lb(t.b),n.ctrlKey||n.metaKey?this.h.lc().collapse(!i.collapse):i.Mc(!i.collapse),this.h.w.save(!0),this.h.Jb=!0,this.h.yb(),!0):void 0!==t.b&&void 0===t.Cf&&void 0===t.a&&void 0===t.c?(i=this.h.f.lb(t.b),n.ctrlKey||n.metaKey?this.h.lc().ii(!i.Rb):i.Wf(!i.Rb),this.h.w.save(!0),this.h.Jb=!0,this.h.yb(),!0):!1},Bl:function(n,t,i){if(0!==this.h.f.lb(t.b).status()&&i)return!1;var r=null,r=null,u=this.h.J["502"];return(i=i.getBoundingClientRect(),n={left:n.clientX-this.h.d.canvas.offsetLeft,top:i.top+1*i.height},!u)?!1:(this.ua.Pb(),void 0===t.a&&void 0!==t.c&&void 0!==t.b&&(r=this.h.f.ma(t.b,t.c),this.h.J["502"]&&!this.h.Ea)?(this.h.Cd().O={b:t.b,c:t.c,a:void 0,na:this.h.f.$c(t.b,t.c),fc:!1,gb:r,l:r},u(n,r,!1,this.h.f.lb(t.b).id()),!0):void 0!==t.a&&void 0!==t.c&&void 0!==t.b&&(r=this.h.f.A(t.b,t.c,t.a),this.h.J["502"]&&!this.h.Ea)?(this.h.Cd().O={b:t.b,c:t.c,a:t.a,na:this.h.f.jc(t.b,t.c,t.a),fc:!0,I:r,l:r},u(n,r,!0,this.h.f.lb(t.b).id()),!0):void 0!==t.a&&void 0===t.c&&void 0!==t.b&&(r=this.h.f.A(t.b,void 0,t.a),this.h.J["502"]&&!this.h.Ea)?(this.h.Cd().O={b:t.b,c:void 0,a:t.a,na:this.h.f.jc(t.b,t.c,t.a),fc:!0,I:r,l:r},u(n,r,!0,this.h.f.lb(t.b).id()),!0):!1)}};lt.prototype={zc:function(n){this.h=n;this.Ma=[];this.La=-1;this.mf=null},reset:function(){this.Tl=null;this.Ma=[];this.La=-1;this.$d()},ji:function(){return this.Ma&&this.Ma.length?this.Ma[this.La]:null},add:function(n,t){999===n&&this.Ma.length&&999===this.Ma.Zc().id||(++this.La,this.nj(),this.Ma.push({id:n,e:h(t)}),2>this.Ma.length&&this.$d())},Uh:function(n,t){this.mf={id:n,e:h(t)}},li:function(){this.mf=null},Wh:function(){this.mf&&(this.add(this.mf.id,this.mf.e),this.mf=null)},Nf:function(n){-1!==this.La&&this.h&&this.Ma.length&&(this.Ag(this.La,void 0,n),this.$d())},kc:function(n,t,i){if(-1!==this.La&&this.h&&this.Ma.length){if(t&&this.La<this.Ma.length&&0<=this.La){var r=this.Ma[this.La];switch(r.id){case 300:t.le||(r.e.Lf=r.e.a.Q,r.e.Af=t.Q,r.e.a.rd(t.k,t.m),r.e.a.Q=t.Q);break;case 400:t.le&&(r.e.Lf=r.e.a.Q,r.e.Af=t.Q,r.e.a.Q=t.Q);break;case 800:r.e.Lf=r.e.a.Q;r.e.Af=t.Q;break;case 700:r.e.Lf=r.e.a.Q;r.e.Af=t.Q}}this.Ag(this.La,void 0,n,t,i);this.$d()}},Ag:function(n,t,i,r,u){if(!(n>this.Ma.length-1||0>n)){var o=null,s,h,c,l,v=!1,a=!1,y=!1,p=!1,e=this.h.f,f=this.Ma[n];switch(f.id){case 300:t?this.h.J["111"]&&this.h.J["111"](f.e.ga,f.e.fa,f.e.ha,r?r:f.e.a,f.e.Eb):this.h.J["101"]&&this.h.J["101"](f.e.ga,f.e.fa,f.e.ha,r?r:f.e.a,f.e.Eb);break;case 500:t?this.h.J["101"]&&this.h.J["101"](f.e.ga,f.e.fa,f.e.ha,r?r:f.e.a,f.e.Eb):this.h.J["111"]&&this.h.J["111"](f.e.ga,f.e.fa,f.e.ha,r?r:f.e.a,f.e.Eb);break;case 400:t?this.h.J["112"]&&this.h.J["112"](f.e.ga,f.e.fa,f.e.a):this.h.J["102"]&&this.h.J["102"](f.e.ga,f.e.fa,f.e.a);break;case 600:t?this.h.J["102"]&&this.h.J["102"](f.e.ga,f.e.fa,f.e.a):this.h.J["112"]&&this.h.J["112"](f.e.ga,f.e.fa,f.e.a);break;case 700:r||(t?(s=f.e.a.Q,f.e.a.Q=f.e.Lf):(s=f.e.a.Q,f.e.a.Q=f.e.Af));this.h.J["121"]&&this.h.J["121"](f.e.ga,f.e.fa,f.e.ha,r?r:f.e.a);r||(f.e.a.Q=s);break;case 800:r||(t?(s=f.e.a.Q,f.e.a.Q=f.e.Lf):(s=f.e.a.Q,f.e.a.Q=f.e.Af));this.h.J["122"]&&this.h.J["122"](f.e.ga,f.e.fa,r?r:f.e.a);r||(f.e.a.Q=s);break;case 100:if(u)o=[],u.left&&u.left.ud(r?r:f.e.a,function(n,t){t&&t.change&&!0===t.change&&(o.push(t),v=!0)}),u.right&&u.right.ud(r?r:f.e.a,function(n,t){t&&t.change&&!0===t.change&&(o.push(t),v=!0)});else if((u=f.e.Da)&&u.length)for(o=[],n=0;n<u.length;++n)o.push(e.A(u[n].b,u[n].c,u[n].a));if(i&&!v&&(c=e.A(f.e.b,f.e.c,f.e.index).k,l=e.A(f.e.b,f.e.c,f.e.index).m,c===f.e.a.k&&l===f.e.a.m)){this.Qb(0);return}r||(t?(a=f.e.a.P,y=f.e.a.kb,p=f.e.a.ab,f.e.a.P=e.A(f.e.b,f.e.c,f.e.index).P):(a=f.e.a.P,f.e.a.P=e.A(f.e.b,f.e.c,f.e.index).P,y=f.e.a.kb,p=f.e.a.ab,c=f.e.a.k,l=f.e.a.m,f.e.a.rd(e.A(f.e.b,f.e.c,f.e.index).k,e.A(f.e.b,f.e.c,f.e.index).m)),f.e.a.kb=e.A(f.e.b,f.e.c,f.e.index).kb,f.e.a.ab=e.A(f.e.b,f.e.c,f.e.index).ab);this.h.J["123"]&&this.h.J["123"](f.e.ga,f.e.fa,f.e.ha,r?r:f.e.a,o);r||(t?f.e.a.P=a:(f.e.a.P=a,f.e.a.rd(c,l)),f.e.a.kb=y,f.e.a.ab=p);break;case 200:if(i&&(c=e.ma(f.e.b,f.e.c).k,l=e.ma(f.e.b,f.e.c).m,c===f.e.a.k&&l===f.e.a.m)){this.Qb(0);return}this.h.J["123"]&&this.h.J["123"](f.e.ga,f.e.fa,void 0,r?r:f.e.a);break;case 900:this.h.J["130"]&&this.h.J["130"](f.e.ga,f.e.fa,f.e.ha,f.e.De,f.e.od,r?r:f.e.a,f.e.Eb,t);break;case 905:this.h.J["150"]&&this.h.J["150"](t?f.e.Xf:f.e.se,f.e.Dl);break;case 910:r||(t?(h=f.e.a.o,f.e.a.o=f.e.Be):(h=f.e.a.o,f.e.a.o=f.e.xe));this.h.J["124"]&&this.h.J["124"](f.e.ga,f.e.fa,f.e.ha,r?r:f.e.a);r||(f.e.a.o=h);break;case 920:r||(t?(h=f.e.a.o,f.e.a.o=f.e.Be):(h=f.e.a.o,f.e.a.o=f.e.xe));this.h.J["125"]&&this.h.J["125"](f.e.ga,f.e.fa,r?r:f.e.a);r||(f.e.a.o=h);break;case 950:t?this.h.J["145"]&&(r?this.h.J["145"](r):(t=f.e.link.za||f.e.link.parentTaskId,n=f.e.link.Ca||f.e.link.dependenceTaskId,this.h.J["145"](f.e.link,e.Vb(n).l,e.Vb(t).l))):this.h.J["140"]&&(r?this.h.J["140"](r):(t=f.e.link.za||f.e.link.parentTaskId,n=f.e.link.Ca||f.e.link.dependenceTaskId,this.h.J["140"](f.e.link,e.Vb(n).l,e.Vb(t).l)));break;case 955:t?this.h.J["140"]&&(r?this.h.J["140"](r):(t=f.e.link.za||f.e.link.parentTaskId,n=f.e.link.Ca||f.e.link.dependenceTaskId,this.h.J["140"](f.e.link,e.Vb(n).l,e.Vb(t).l))):this.h.J["145"]&&(r?this.h.J["145"](r):(t=f.e.link.za||f.e.link.parentTaskId,n=f.e.link.Ca||f.e.link.dependenceTaskId,this.h.J["145"](f.e.link,e.Vb(n).l,e.Vb(t).l)));break;case 960:!i&&this.h.J["160"]&&this.h.J["160"](r)}this.$d()}},Qb:function(){-1!==this.La&&this.h&&this.Ma.length&&(--this.La,this.Ma.splice(this.Ma.length-1,1),this.$d())},Bi:function(){return this.Ma.length&&999===this.Ma[this.Ma.length-1].id?(this.Qb(0),!0):!1},ij:function(){var t,n,r,i,u,f,e;if(this.h.g.enable&&this.h.g.cancel(!0),this.h.Bb().gd(),-1!==this.La&&this.h&&this.Ma.length){t=this.h.f;n=this.Ma[this.La];u=null;switch(n.id){case 300:this.h.w.save();t.b[n.e.b].Fb(n.e.index,n.e.c);break;case 500:if(this.h.w.save(),t.Nb(n.e.a,n.e.index),f=n.e.Eb.length,void 0!==n.e.c)for(r=0;r<f;++r)u=n.e.Eb[r],u.link.Ca!==n.e.ha&&(i=t.b[n.e.b].c[n.e.c].a[u.La],i.links.splice(u.index,1,u.link));else for(r=0;r<f;++r)u=n.e.Eb[r],u.link.Ca!==n.e.ha&&(i=t.b[n.e.b].a[u.La],i.links.splice(u.index,1,u.link));break;case 700:r=t.A(n.e.b,n.e.c,n.e.index).Q;t.A(n.e.b,n.e.c,n.e.index).Q=n.e.a.Q;n.e.a.Q=r;break;case 400:this.h.w.save();t.b[n.e.b].Tf(n.e.index);break;case 600:this.h.w.save();t.b[n.e.b].a.splice(t.b[n.e.b].a.length-n.e.a.a.length,n.e.a.a.length);t.ne(n.e.a,n.e.index);break;case 800:r=t.ma(n.e.b,n.e.c).Q;t.ma(n.e.b,n.e.c).Q=n.e.a.Q;n.e.a.Q=r;break;case 100:f=t.A(n.e.b,n.e.c,n.e.index).k;var o=t.A(n.e.b,n.e.c,n.e.index).m,s=t.A(n.e.b,n.e.c,n.e.index).P,c=t.A(n.e.b,n.e.c,n.e.index).kb,l=t.A(n.e.b,n.e.c,n.e.index).ab;if(t.A(n.e.b,n.e.c,n.e.index).rd(n.e.a.k,n.e.a.m),t.A(n.e.b,n.e.c,n.e.index).P=n.e.a.P,t.A(n.e.b,n.e.c,n.e.index).kb=n.e.a.kb,t.A(n.e.b,n.e.c,n.e.index).ab=n.e.a.ab,n.e.a.k=f,n.e.a.m=o,n.e.a.P=s,n.e.a.kb=c,n.e.a.ab=l,u=n.e.Da)for(r=0;r<u.length;++r)i=u[r],f=t.A(i.b,i.c,i.a).k,o=t.A(i.b,i.c,i.a).m,s=t.A(i.b,i.c,i.a).P,c=t.A(i.b,i.c,i.a).kb,l=t.A(i.b,i.c,i.a).ab,t.A(i.b,i.c,i.a).rd(i.l.k,i.l.m),t.A(i.b,i.c,i.a).P=i.l.P,t.A(i.b,i.c,i.a).kb=i.l.kb,t.A(i.b,i.c,i.a).ab=i.l.ab,i.l.k=f,i.l.m=o,i.l.P=s,i.l.kb=c,i.l.ab=l;void 0===n.e.c&&t.b[n.e.b].Ec();break;case 200:r=h(t.ma(n.e.b,n.e.c));t.b[n.e.b].Tf(n.e.index);t.ne(n.e.a,n.e.index);n.e.a=r;break;case 900:if(t.b[n.e.Ua].Fb(n.e.ad,n.e.ib),r=h(n.e.a),r.gb=void 0==n.e.Na?-1:n.e.fa,t.Nb(r,n.e.index),n.e.Eb)if(f=n.e.Eb.length,void 0!==n.e.Na)for(r=0;r<f;++r)u=n.e.Eb[r],i=t.b[n.e.Ja].c[n.e.Na].a[u.La],i.links.splice(u.index,0,u.link);else for(r=0;r<f;++r)u=n.e.Eb[r],i=t.b[n.e.Ja].a[u.La],i.links.splice(u.index,0,u.link);break;case 905:if(u=n.e.group,"MtoF"===n.e.type){for(i=t.b[n.e.Ua].c[n.e.Na],r=0;r<u.length;++r)u[r].I.gb=n.e.Xf,t.b[n.e.Ja].c[n.e.Na].Nb(u[r].I,u[r].index);t.b[n.e.Ua].a.splice(t.b[n.e.Ua].a.length-u.length,u.length);i.rb();t.b[n.e.Ua].Ec()}if("MtoM"===n.e.type){for(i=t.b[n.e.Ua].c[n.e.ib],r=0;r<u.length;++r)u[r].I.gb=n.e.Xf,t.b[n.e.Ja].c[n.e.Na].Nb(u[r].I,u[r].index);t.b[n.e.Ua].c[n.e.ib].a.splice(i.a.length-u.length,u.length);i.rb();t.b[n.e.Ua].c[n.e.ib].rb();t.b[n.e.Ua].Ec()}if("FtoM"===n.e.type){for(i=t.b[n.e.Ua].c[n.e.ib],r=0;r<u.length;++r)u[r].I.gb=-1,t.Nb(u[r].I,u[r].index);t.b[n.e.Ua].c[n.e.ib].a.splice(i.a.length-u.length,u.length);i.rb();t.b[n.e.Ua].Ec()}break;case 910:r=t.A(n.e.b,n.e.c,n.e.index).o;t.A(n.e.b,n.e.c,n.e.index).o=n.e.a.o;n.e.a.o=r;break;case 920:r=t.ma(n.e.b,n.e.c).o;t.ma(n.e.b,n.e.c).o=n.e.a.o;n.e.a.o=r;break;case 950:i=t.A(n.e.b,n.e.c,n.e.a);i.links.splice(n.e.Hf,1);break;case 955:i=t.A(n.e.b,n.e.c,n.e.a);i.links.splice(n.e.Hf,0,n.e.link);break;case 960:(e=n.e.af?t.ma(n.e.b,n.e.c):t.A(n.e.b,n.e.c,n.e.index))&&(e.$a=h(n.e.wh))}this.Ag(this.La,!0,void 0,e);this.h.ya();this.h.Cb();this.h.Te=!0;this.h.kj();--this.La}this.$d()},$i:function(){var r,n,i,t,u,f,e;if(this.h.g.enable&&this.h.g.cancel(!0),this.h.Bb().gd(),this.h&&this.Ma.length&&this.La!==this.Ma.length-1){++this.La;r=this.h.f;n=this.Ma[this.La];u=null;switch(n.id){case 300:this.h.w.save();r.Nb(n.e.a,n.e.index);break;case 500:if(this.h.w.save(),f=n.e.Eb.length,void 0!==n.e.c)for(i=0;i<f;++i)u=n.e.Eb[i],u.link.Ca!==n.e.ha&&(t=r.b[n.e.b].c[n.e.c].a[u.La],t.links.splice(u.index,1));else for(i=0;i<f;++i)u=n.e.Eb[i],u.link.Ca!==n.e.ha&&(t=r.b[n.e.b].a[u.La],t.links.splice(u.index,1));r.b[n.e.b].Fb(n.e.index,n.e.c);break;case 400:this.h.w.save();r.ne(n.e.a,n.e.index);break;case 600:for(this.h.w.save(),t=r.b[n.e.b].a,i=0;i<n.e.a.a.length;++i)t.push(n.e.a.a[i]),t.Zc().gb=-1;r.b[n.e.b].Tf(n.e.index);break;case 700:i=r.A(n.e.b,n.e.c,n.e.index).Q;r.A(n.e.b,n.e.c,n.e.index).Q=n.e.a.Q;n.e.a.Q=i;break;case 800:i=r.ma(n.e.b,n.e.c).Q;r.ma(n.e.b,n.e.c).Q=n.e.a.Q;n.e.a.Q=i;break;case 100:f=r.A(n.e.b,n.e.c,n.e.index).k;var o=r.A(n.e.b,n.e.c,n.e.index).m,s=r.A(n.e.b,n.e.c,n.e.index).P,c=r.A(n.e.b,n.e.c,n.e.index).kb,l=r.A(n.e.b,n.e.c,n.e.index).ab;if(r.A(n.e.b,n.e.c,n.e.index).rd(n.e.a.k,n.e.a.m),r.A(n.e.b,n.e.c,n.e.index).P=n.e.a.P,r.A(n.e.b,n.e.c,n.e.index).kb=n.e.a.kb,r.A(n.e.b,n.e.c,n.e.index).ab=n.e.a.ab,n.e.a.k=f,n.e.a.m=o,n.e.a.P=s,n.e.a.kb=c,n.e.a.ab=l,u=n.e.Da)for(i=0;i<u.length;++i)t=u[i],f=r.A(t.b,t.c,t.a).k,o=r.A(t.b,t.c,t.a).m,s=r.A(t.b,t.c,t.a).P,c=r.A(t.b,t.c,t.a).kb,l=r.A(t.b,t.c,t.a).ab,r.A(t.b,t.c,t.a).rd(t.l.k,t.l.m),r.A(t.b,t.c,t.a).P=t.l.P,r.A(t.b,t.c,t.a).kb=t.l.kb,r.A(t.b,t.c,t.a).ab=t.l.ab,t.l.k=f,t.l.m=o,t.l.P=s,t.l.kb=c,t.l.ab=l;void 0===n.e.c&&r.b[n.e.b].Ec();break;case 200:i=h(r.ma(n.e.b,n.e.c));r.b[n.e.b].Tf(n.e.index);r.ne(n.e.a,n.e.index);n.e.a=i;break;case 900:if(n.e.Eb)if(f=n.e.Eb.length,void 0!==n.e.Na)for(i=0;i<f;++i)u=n.e.Eb[i],t=r.b[n.e.Ja].c[n.e.Na].a[u.La],t.links.splice(u.index,1);else for(i=0;i<f;++i)u=n.e.Eb[i],t=r.b[n.e.Ja].a[u.La],t.links.splice(u.index,1);i=n.e.index;void 0===n.e.Na&&void 0===n.e.ib?i=n.e.ad:void 0===n.e.Na&&void 0!==n.e.ib&&(i=n.e.ad);r.b[n.e.Ua].Fb(n.e.index,n.e.Na);t=h(n.e.a);void 0==n.e.Na?(t.gb=void 0===n.e.od?-1:n.e.od,r.Nb(t,i)):(t.gb=n.e.od?n.e.od:-1,r.Nb(t,n.e.ad));break;case 905:if(t=n.e.group,"MtoF"===n.e.type){for(i=0;i<t.length;++i)t[i].I.gb=-1,r.b[n.e.Ja].be(t[i].I,!0);for(i=t.length-1;0<=i;--i)r.b[n.e.Ja].c[n.e.Na].Fb(t[i].index);r.b[n.e.Ja].c[n.e.Na].rb();r.b[n.e.Ja].Ec()}if("MtoM"===n.e.type){for(i=0;i<t.length;++i)t[i].I.gb=n.e.se,r.b[n.e.Ua].c[n.e.ib].a.push(t[i].I);for(i=t.length-1;0<=i;--i)r.b[n.e.Ja].c[n.e.Na].Fb(t[i].index);r.b[n.e.Ja].c[n.e.Na].rb();r.b[n.e.Ua].c[n.e.ib].rb()}if("FtoM"===n.e.type){for(u=r.b[n.e.Ua].c[n.e.ib],i=0;i<t.length;++i)t[i].I.gb=n.e.se,r.b[n.e.Ua].c[n.e.ib].a.push(t[i].I);for(i=t.length-1;0<=i;--i)r.b[n.e.Ja].Fb(t[i].index);u.rb();r.b[n.e.Ja].Ec()}break;case 910:i=r.A(n.e.b,n.e.c,n.e.index).o;r.A(n.e.b,n.e.c,n.e.index).o=n.e.a.o;n.e.a.o=i;break;case 920:i=r.ma(n.e.b,n.e.c).o;r.ma(n.e.b,n.e.c).o=n.e.a.o;n.e.a.o=i;break;case 950:t=r.A(n.e.b,n.e.c,n.e.a);n.e.link.dependenceTaskId=r.A(n.e.fh.b,n.e.fh.c,n.e.fh.a).q;n.e.link.parentTaskId=r.A(n.e.yh.b,n.e.yh.c,n.e.yh.a).q;t.links.push(n.e.link);break;case 955:t=r.A(n.e.b,n.e.c,n.e.a);t.links.splice(n.e.Hf,1);break;case 960:(e=n.e.af?r.ma(n.e.b,n.e.c):r.A(n.e.b,n.e.c,n.e.index))&&(e.$a=h(n.e.vh))}this.Ag(this.La,void 0,void 0,e);this.h.ya();this.h.Cb();this.h.Te=!0;this.h.kj()}this.$d()},nj:function(){this.Ma.length&&(1>this.La&&(this.Ma=[]),this.Ma.splice(this.La,this.Ma.length-this.La))},$d:function(){this.h.J.UndoRedoUI&&(this.Ma.length&&this.Ma.Zc().e.Nc?this.Ma.Zc().e.Nc=void 0:this.h.J.UndoRedoUI(-1<this.La&&this.La<this.Ma.length&&0<this.Ma.length,1<this.Ma.length-this.La&&0<this.Ma.length))}};at.prototype={zc:function(n,t){var i=this;this.Fc=n;this.p=t;n instanceof HTMLCanvasElement||(this.Oc=document.createElement("canvas"),this.Oc.id="ZoomBarId",this.Oc.width=this.Fc.clientWidth,this.Oc.height=this.Fc.clientHeight,this.Fc.style.backgroundColor="#ffffff",this.Fc.appendChild(this.Oc));this.Oc&&(this.d=this.Oc.getContext("2d"),this.r=this.d.canvas.width,this.U=this.d.canvas.height,this.Xc=this.d.canvas.getBoundingClientRect(),this.Fc.onmousemove=function(n){i.onmousemove(n)},this.Fc.onmousedown=function(n){i.onmousedown(n)},this.Fc.onmouseup=function(n){i.onmouseup(n)},this.Fc.ondblclick=function(n){i.ondblclick(n)},this.Fc.oncontextmenu=aa(!1),"onwheel"in this.Fc?this.Fc.addEventListener("wheel",function(n){i.onmousewheel(n)},!1):"onmousewheel"in document?this.Fc.addEventListener("mousewheel",function(n){i.onmousewheel(n)},!1):this.Fc.addEventListener("MozMousePixelScroll",function(n){i.onmousewheel(n)},!1),this.i=t.i,this.$=!0,this.Ga=new Date,this.Ga.setHours(0),this.Ga.setMilliseconds(0),this.Ga.setMinutes(0),this.Ga.setSeconds(0),this.ic=new Date(this.Ga.getTime()+31104e6),this.Sb=new Date(this.Ga.getTime()-31104e6),this.ic.setUTCDate(0),this.ic.setHours(0),this.ic.setMilliseconds(0),this.ic.setMinutes(0),this.ic.setSeconds(0),this.Sb.setUTCDate(0),this.Sb.setHours(0),this.Sb.setMilliseconds(0),this.Sb.setMinutes(0),this.Sb.setSeconds(1),this.aj=new Date(this.ic.getTime()-1),this.Qi=new Date(this.Sb.getTime()),this.Ig=this.duration=0,this.Xa=!1,this.ba={x:0,y:0},this.ef={x:0,y:0},this.anchor=this.Kc=0,this.Qa={eb:0,end:0,vf:0},this.Qd=4,this.we=.5*(this.Qd+2),this.hj=this.rc=this.qc=this.Eg=this.tg=this.gi=this.button=0)},dk:W("Fc"),canvas:W("Oc"),uh:function(){this.Cc=!0},Uf:function(){this.$&&this.d&&(this.Xc=this.d.canvas.getBoundingClientRect(),this.r=this.d.canvas.width,this.U=this.d.canvas.height,this.Vg(),this.Cc&&(this.Cc=!1,this.d.clearRect(0,0,this.r,this.U),this.d.fillStyle=20!==this.qc?"#E2E2E2":"#CCCCCC",this.d.fillRect(this.rc+.5,2,this.qc,this.U-4),20!==this.qc&&(this.d.fillStyle="#CCCCCC",this.d.fillRect(this.rc+.5-1,2,1,this.U-4),this.d.fillRect(Math.floor(this.rc+this.qc),2,1,this.U-4),this.d.beginPath(),this.d.moveTo(this.rc+.5,.5*this.U-this.Qd),this.d.lineTo(this.rc-this.Qd-.5,.5*this.U),this.d.lineTo(this.rc+.5,.5*this.U+this.Qd),this.d.closePath(),this.d.fill(),this.d.beginPath(),this.d.moveTo(Math.floor(this.rc+this.qc),.5*this.U-this.Qd),this.d.lineTo(Math.floor(this.rc+this.qc+this.Qd+1),.5*this.U),this.d.lineTo(Math.floor(this.rc+this.qc),.5*this.U+this.Qd),this.d.closePath(),this.d.fill()),this.ll(),this.d.fillStyle="#6699FF",this.d.fillRect(this.Zj,0,1,this.U),this.kl()))},kl:function(){function n(n){var t="",i=n.getDate(),r=n.getMonth()+1,t=10>i?t+("0"+i):t+i;return(10>r?t+(".0"+r):t+("."+r))+("."+String(n.getUTCFullYear()).substring(2,4))}this.d.fillStyle="#999999";this.d.fillText(n(this.Qi),5,.6*this.U);this.d.fillText(n(this.aj),this.r-50,.6*this.U)},ll:function(){var n,t,u,i,f=!0,e=!1,o,r=this.p.f.b,s=r.length;if(s){n=this.cd();var h=n*this.Nd+this.we,c=this.U-this.Qd,l=n/this.duration;for(this.d.lineWidth=1,this.d.strokeStyle="#E2E2E2",t=0;t<s;++t)for(o=r[t].c.length,n=0;n<o;++n)u=(l*r[t].c[n].m+h>>0)+.5,i=0>=r[t].c[n].m?dt:"#7e7e7e",1===r[t].c[n].o&&(i=ut),i!==this.d.strokeStyle&&(e=!0,0<n&&this.d.stroke(),this.d.beginPath(),this.d.strokeStyle=i),f&&(this.d.beginPath(),this.d.strokeStyle=i,f=!1),this.d.moveTo(u,this.Qd),this.d.lineTo(u,c);e&&this.d.stroke()}},releaseCapture:function(){this.Xa=!1;this.Kc=0},vl:function(n){if(n){var t=this.Ga.getTime()+Math.abs(36e5*n)+54432e5;n=this.Ga.getTime()-Math.abs(36e5*n)-54432e5;(t>this.ic.getTime()||n<this.Sb.getTime())&&(this.Sb=new Date(n),this.ic=new Date(t),this.ic.setUTCDate(0),this.ic.setHours(0),this.ic.setMilliseconds(0),this.ic.setMinutes(0),this.ic.setSeconds(0),this.Sb.setUTCDate(0),this.Sb.setHours(0),this.Sb.setMilliseconds(0),this.Sb.setMinutes(0),this.Sb.setSeconds(1),this.aj=new Date(this.ic.getTime()-1),this.Qi=new Date(this.Sb.getTime()))}this.Cc=!0},Vg:function(){var t=this.p;this.duration=(this.ic.getTime()-this.Sb.getTime())/36e5;this.Ig=(this.Ga.getTime()-this.Sb.getTime())/36e5;this.Nd=(this.Ga.getTime()-this.Sb.getTime())/36e5/this.duration;var i=this.cd(),r=this.i.R/this.i.B,n=(t.r-t.da)/r,t=t.da/r;this.Zj=Math.floor(Math.abs(this.Ig/this.duration*i)+this.we);this.Qa.eb=(this.Ig-this.i.Uc*this.i.B+t)/this.duration;this.Qa.end=(this.Ig-this.i.Uc*this.i.B+n+t)/this.duration;this.Qa.vf=n/this.duration;this.tg=this.Qa.eb*i+this.we;this.Eg=this.Qa.end*i+this.we;this.Gf=Math.floor(this.tg);this.Ah=Math.floor(this.Eg);this.eg=Math.floor(this.Qa.vf*i);this.qc=this.Eg-this.tg;this.rc=Math.floor(this.Gf)+.5;this.hj=.5*(this.Eg+this.tg);20>=this.qc&&(this.qc=20,this.rc=Math.floor(this.hj-.5*this.qc)+.5,n=.5*(this.Qa.end+this.Qa.eb),n=.5+(n-.5)*(1+(this.Qa.end-this.Qa.eb)),this.rc=(i-this.qc)*n+this.we)},mj:function(n,t){return{x:n-this.Xc.left*(this.r/this.Xc.width),y:t-this.Xc.top*(this.U/this.Xc.height)}},Mi:function(n){return this.ba=this.mj(n.clientX,n.clientY),20===this.qc?this.ba.x>this.rc&&this.ba.x<this.rc+this.qc:this.ba.x>=this.Gf&&this.ba.x<=this.Ah},Yh:function(n){return this.ba=this.mj(n.clientX,n.clientY),20===this.qc?this.ba.x>this.rc&&this.ba.x<this.rc+this.qc&&(this.Kc=0):this.Kc=7>Math.abs(this.ba.x-this.Gf)?-1:7>Math.abs(this.ba.x-this.Ah)?1:0,this.Kc},cd:function(){return this.r-2*this.we},cl:function(){var u,n,e,o,f=0,t=this.p,i=t.f.b,s=i.length;if(!s)return!1;var r=this.cd(),h=this.duration*this.Nd/this.duration*r+this.we,c=r/this.duration,r=t.j;for(n=0;n<s;++n)if(!i[n].kd()){for(o=i[n].c.length,u=0;u<o;++u){if(e=(c*i[n].c[u].m+h>>0)+.5-this.ba.x,5>l(e))return t.ja.Lc(i[n].c[u].m),0===u&&0===n&&(f=.0001),i=(t.w.md()/r>>0)*r,t.Y||(f=(f/r>>0)*r-.0001),t.ja.Ib(Math.min(f,i-.0001)),t.ya(),t.Cb(),this.Cc=!0;f+=r+i[n].c[u].a.length*r;0===i[n].c[u].a.length&&t.Y&&(f+=t.j)}i[n].a.length&&(f+=i[n].a.length*r+t.G)}return!1},cf:function(){var n=this.p,t=n.i.R/n.i.B;return((this.eg/this.cd()-1+this.Nd)*this.duration+n.da/t)*t/this.i.R},df:function(){var n=this.p,t=n.i.R/n.i.B;return(this.Nd*this.duration+n.da/t)*t/this.i.R},onmousedown:function(n){this.Kc=0;this.button=n.button;(this.Mi(n)||0!==this.Yh(n))&&(this.Xa=!0,this.ef.x=this.ba.x,this.Vg(),this.anchor=this.ba.x-this.Gf);this.gi=this.Kc},onmousemove:function(n){var r,o;if(2!==this.button){var t=this.p,u=this.Mi(n),i=this.cd(),f,e;e=this.duration;r=this.Nd;o=f=0;0!==t.f.b.length&&(t.wd.onmouseup(n),t.w.onmouseup(n),this.Xa?(n=t.i.R/t.i.B,u=t.da/n,0===this.Kc?(t.ja.stop(),f=(this.ba.x-this.anchor)/i,f=.5-((-r+.5)*(r-f)/r+.5*f/r),e=Math.max(Math.min(f,r)*e,(this.eg/i-1+r)*e)+u,t.offsetX=e*n/this.i.R,t.bg(),this.Oc.style.cursor="pointer",this.Cc=!0):-1===this.Kc?(t.ja.stop(),i=this.ba.x/i,0<this.Qa.end-i&&(i=this.Qa.end-i,n=i/this.Qa.vf,i=i+r-this.Qa.end,u=t.i.B,t.i.B*=n,i>=r?(t.B=u,t.update()):(28>=t.i.B&&(n*=28/t.i.B,t.i.B=28),270<=t.i.B&&(n*=270/t.i.B,t.i.B=270),i=this.Qa.vf*n,i=r-(this.Qa.end-i),n=t.i.R/t.i.B,u=t.da/n,t.offsetX=(i*e+u)*n/t.i.R,t.bg()),t.Gd.yf()),this.Oc.style.cursor="w-resize"):1===this.Kc&&(t.ja.stop(),i=this.ba.x/i,0<i-this.Qa.eb&&(i-=this.Qa.eb,n=i/this.Qa.vf,i=r-this.Qa.eb,u=t.i.B,t.i.B*=n,29>t.i.B||270<t.i.B||i>=r?(t.i.B=u,t.update()):(n=t.i.R/t.i.B,u=t.da/n,t.offsetX=(i*e+u)*n/t.i.R,t.bg()),t.Gd.yf()),this.Oc.style.cursor="w-resize"),f=(t.w.md()/t.j>>0)*t.j,o=t.Ji().height-t.j*!t.Y,t.Y||(o=(o/t.j>>0)*t.j-.0001),t.vc>=t.U-2*t.j&&(t.ja.Ib(Math.min(o,f-.0001)),t.ya(),t.Cb()),this.Cc=!0):this.Oc.style.cursor=u?"pointer":this.Yh(n)?"w-resize":"")}},onmouseup:function(){if(0!==this.p.f.b.length){var r=this.p,n,i,u,t;this.releaseCapture();2===this.button?(this.cl(),this.button=0):r&&(n=this.cd(),i=this.duration,t=this.Nd,u=.5*this.eg/n,0===this.gi&&(-7>this.ba.x-this.Gf||7<this.ba.x-this.Ah)&&(n=this.ba.x/n,n=.5-((.5-t)*(t-n)/t+.5*n/t),i=Math.max(Math.min(n,t-u)*i,(t-1+u)*i),r.ja.stop(),r.ja.Lc(-i),r.bg(),this.Cc=!0))}},ondblclick:G(),onmousewheel:function(t){if(0!==this.p.f.b.length){t=t||n.event;var i=t.deltaY||t.detail||t.wheelDelta;t.deltaY&&(i*=-1);t.detail&&(i*=-1);t=this.p.i.B;0<i?(t-=24,28>t&&28<this.p.i.B?this.p.lc().Ud(28):this.p.lc().Ud(Math.min(Math.max(t,28),270))):(t+=24,28>this.p.i.B?this.p.lc().Ud(28):this.p.lc().Ud(Math.min(Math.min(t,500),270)));this.Cc=!0}}};ci.prototype={nf:function(){this.font=this.Md+"pt "+e},Db:function(n){this.Uc=n;this.$h()},height:function(){return 2*this.p.j},lj:function(){if(3===this.Kb)return null;var n=(new Date).getDay();return--n,-1===n&&(n=6),{x:24*(5-n)*this.R/this.B,width:48*this.R/this.B,hc:168*this.R/this.B}},update:G(),Dh:function(n){this.zoom=Math.max(.1,n);this.Fh=15*this.zoom;this.R=35*this.zoom;this.Md=9*this.zoom;this.font=this.Md+"pt "+e;this.ld=this.p.j;this.Od=.55*this.ld;this.Wc=1.65*this.ld},refresh:function(){this.r=this.d.canvas.width;this.U=this.d.canvas.height;var n=new Date;this.tc=n.getDay();--this.tc;-1===this.tc&&(this.tc=6);this.zd=n.getUTCDate();this.pc=n.getMonth();this.cc=n.getFullYear();this.$h()},te:function(){this.d.strokeStyle="#CCCCCC";this.d.lineWidth=1;this.d.fillStyle="#999999";this.d.font=this.font;this.d.beginPath();2===this.Kb?this.Dk():1===this.Kb?this.mk():0===this.Kb?this.qk():3===this.Kb&&this.yk();this.d.closePath();this.d.stroke()},qk:function(){var r,u,t,i,e,n,o=!1,c=this.r,f=this.R/this.B*this.fb,l=this.r/f+2*this.fb,a=this.Uc*this.B/this.fb,s=this.xc(this.pc+1,this.cc),h=this.zd,v=this.R*this.Uc/f>>0;for(i=this.pc,e=this.cc,u=0,r=this.tc,t=0;u<l-v;++u,t+=this.fb){if(n=(u+a)*f,n>c+100)break;24<=t&&(t=0,++r,6<r&&(r=0),o=!0,h++,h>=s+1&&(i++,12<=i&&(i=0,e++),h-=s,s=this.xc(i+1,e)));n<-f||(o&&(this.d.moveTo(n+.5,2+this.wg),this.d.lineTo(n+.5,this.Fh+2+this.wg),o=!1),this.d.fillText(t,n+.5+2,1.7*this.Fh+2+this.wg))}},mk:function(){var u,i,f,r,o,s,l=!1,a=this.r,h=this.R/this.B*this.fb,v=a/h,y=this.Uc*this.B/this.fb,p=this.R*this.Uc/h>>0,c=this.xc(this.pc+1,this.cc),t=this.zd,k;o=-h*this.xb;var g=Math.floor(v-p)+this.xb,w=9<=this.xb?n.Gantt.Teamlab_shortmonths:n.Gantt.Teamlab_months,d=340<this.B,b=.5*(h-this.d.measureText("0").width);if(s=.5*(h-this.d.measureText("10").width),k=!0,1===this.xb){for(u=0,i=this.pc+1,f=this.cc,o=this.tc;u<v-p;++u,++t,++o)r=(u+y)*h,t>c&&(t=1,i++,12<i&&(i=1,++f),c=this.xc(i,f)),6<o&&(o=0),r<3*-h||(this.d.fillStyle=5==o||6==o?"#FFC78F":"#999999",1===t&&(this.d.fillStyle="#D9D9D9",this.d.fillRect(r>>0,0,1,this.p.j),this.d.fillStyle="#999999",this.d.fillText(w[i-1]+" "+f,r+.25*this.ld,this.Od)),this.d.fillText(t,r+(10<=t?s:b),this.Wc));for(t=this.zd,u=0,i=this.pc+1,f=this.cc,o=this.tc;u>=-p-v;--u,--t,--o)r=(u+y)*h,1>t&&(--i,1>i&&(i=12,--f),t=this.xc(i,f)),0>o&&(o=6),r<3*-h||r>a||(this.d.fillStyle=5==o||6==o?"#FFC78F":"#999999",1===t&&(this.d.fillStyle="#D9D9D9",this.d.fillRect(r>>0,0,1,this.p.j),this.d.fillStyle="#999999",this.d.fillText(w[i-1]+" "+f,r+.25*this.ld,this.Od)),k&&0===u&&(this.d.fillStyle="#666666",this.d.font="bold "+this.Md+"pt "+e),this.d.fillText(t,r+(10<=t?s:b),this.Wc),k&&(k=!1,0===u&&(this.d.font=this.font)))}else{for(c=this.xc(this.pc+1,this.cc),t=this.zd,u=0,i=this.pc,f=this.cc;u<g;++u,t+=this.xb){if(r=(u+y)*h,r>a+100)break;t>=c&&(l=!0,i++,12<=i&&(i=0,++f),t-=c,c=this.xc(i+1,f));r<-h||(l&&(this.d.fillStyle="#D9D9D9",this.d.fillRect(r>>0,0,1,this.p.j),this.d.fillStyle="#999999",s=d?f%100:f,1===s.length&&(s="0"+s),this.d.fillText(w[i]+" "+s,r+.25*this.ld,this.Od),l=!1),0===t&&++t,this.d.fillText(t,r+.5+2-b*(10<t?.75:1),this.Wc))}for(t=this.zd,u=0,i=this.pc+1,f=this.cc;u>=-p-v;--u,t-=this.xb){if(r=(u+y)*h,r<o)break;1>t&&(l=!0,--i,0>i&&(i=11,--f),c=this.xc(i+1,f),t+=c);r>a||(l&&(this.d.fillStyle="#D9D9D9",this.d.fillRect(r>>0,0,1,this.p.j),this.d.fillStyle="#999999",s=d?f%100:f,1===s.length&&(s="0"+s),this.d.fillText(w[i]+" "+s,r+.25*this.ld,this.Od),l=!1),0===t&&++t,this.d.fillText(t,r+.5+2-b*(10<t?.75:1),this.Wc))}}},Dk:function(){var o,i,f,u,s,h=!1,c=0,p=this.r,t=this.R/this.B*this.fb,w=p/t,b=this.Uc*this.B/this.fb,k=this.R*this.Uc/t>>0,l=this.xc(this.pc+1,this.cc),e=this.zd-this.tc;s=this.Fi(new Date);var d=this.oh(this.cc),it=-t*this.xb,y=Math.floor(w-k)+this.xb,g=n.Gantt.Teamlab_shortmonths,a=n.Gantt.Localize_strings.week||"week",nt=.5*(t-this.d.measureText(a+" ").width),tt=.5*(t-this.d.measureText(a+" 10").width),r=this.Ki(new Date),v=t/this.xb;for(o=0,i=this.pc,f=this.cc;o<y;++o,e+=this.xb,s+=this.xb){if(u=(o+b)*t,u>p+2*t)break;0<=s-d&&(s=new Date("31 Dec "+f),s=s.getDay(),d=this.oh(f+1),r=1);e>=l&&(h=!0,i++,12<=i&&(i=0,++f),e-=l,l=this.xc(i+1,f),c=u+(1-e-this.tc)*v);u<2*-t||(h&&(this.d.fillStyle="#D9D9D9",this.d.fillRect(c>>0,0,1,this.p.j),this.d.fillStyle="#999999",this.d.fillText(g[i]+" "+f,c+.5*this.ld,this.Od),h=!1),10<=r?this.d.fillText(a+" "+r,u+tt+t-this.tc*v,this.Wc):this.d.fillText(a+" "+r,u+nt+t-this.tc*v,this.Wc));++r}for(y=!0,r=this.Ki(new Date)-1,e=this.zd-this.tc,s=this.Fi(new Date)+1,this.oh(this.cc),o=0,i=this.pc+1,f=this.cc;o>=-k-w;--o,e-=this.xb,s+=this.xb){if(u=(o+b)*t,u<it)break;0>=r&&(r=this.Mk(f-1));0>e&&(h=!0,--i,0>i&&(i=11,--f),l=this.xc(i+1,f),e+=l,c=u+(l-e-this.tc+1+i%2)*v);u>p?--r:(h&&(this.d.fillStyle="#D9D9D9",this.d.fillRect(c>>0,0,1,this.p.j),this.d.fillStyle="#999999",this.d.fillText(g[i]+" "+f,c+.5*this.ld,this.Od),h=!1),y?y=!1:(10<=r?this.d.fillText(a+" "+r,u+tt+t-this.tc*v,this.Wc):this.d.fillText(a+" "+r,u+nt+t-this.tc*v,this.Wc),--r))}},yk:function(){for(var s=0,r=0,f=0,t=0,t="",y=this.p.j,h=!1,c=!1,e=0,w=this.r,u=this.R/this.B*this.fb,k=w/u,l=this.Uc*this.B/this.fb,d=this.R*this.Uc/u>>0,a=this.xc(this.pc+1,this.cc),o=this.zd,rt=Math.floor(k-d)+32,g=9<=this.xb?n.Gantt.Teamlab_shortmonths:n.Gantt.Teamlab_months,nt=n.Gantt.Localize_strings.year||"year",tt=340<this.B,b=48*u,v=0,i=l*u+-o*u,p=void 0,it=!0,s=0,r=this.pc,f=this.cc;s<=rt;++s,o+=this.xb,++v){if(t=(s+l)*u,t>w+b)break;o>=a&&(h=!0,e=i,r++,12<=r&&(r=0,++f,c=!0),o-=a,a=this.xc(r+1,f),i=l*u+(v+1)*u,e=i-e);t<2*-u||!h||(this.d.fillStyle="#D9D9D9",this.d.fillRect(i>>0,y,1,this.U),t=tt?f%100:f,1===t.length&&(t="0"+t),t=g[r]+" "+t,this.d.fillStyle="#999999",this.d.fillText(t,i+.5*e-.5*this.d.measureText(t).width,this.Wc),c&&(this.d.fillStyle="#D9D9D9",this.d.fillRect(i+e>>0,0,1,y),c=!1),6===r&&(t=nt+" "+f,this.d.fillStyle="#999999",this.d.fillText(t,i+.5*e-.5*this.d.measureText(t).width,this.Od)),void 0===p&&(p=i),h=!1)}for(o=this.zd,v=this.tc-1,i=(this.xc(this.pc,this.cc)+l)*u,s=0,r=this.pc+1,f=this.cc;s>=-d-k;--s,o-=this.xb,--v){if(t=(s+l)*u,t<-b)break;0>o&&(e=i,--r,0>r&&(r=11,--f,c=!0),a=this.xc(r+1,f),o+=a,h=!0,i=l*u+v*u+(r%2-1)*u,e-=i);t>w+b||!h||(this.d.fillStyle="#D9D9D9",this.d.fillRect(i>>0,y,1,this.U),t=tt?f%100:f,1===t.length&&(t="0"+t),t=g[r]+" "+t,this.d.fillStyle="#999999",it?(p&&this.d.fillText(t,.5*(i+p)-.5*this.d.measureText(t).width,this.Wc),it=!1):this.d.fillText(t,i+.5*e-.5*this.d.measureText(t).width,this.Wc),h=!1,c&&(this.d.fillStyle="#D9D9D9",this.d.fillRect(i+e>>0,0,1,y),c=!1),6===r&&(t=nt+" "+f,this.d.fillStyle="#999999",this.d.fillText(t,i+.5*e-.5*this.d.measureText(t).width,this.Od)))}},vk:function(){var n,t,i,u;if(3!==this.Kb){n=(new Date).getDay();--n;-1===n&&(n=6);i=this.R/this.B*this.fb;u=this.r/i+2;t=this.Uc*this.B/this.fb;var f=this.p.j+.5,r=Math.floor(t),e=t-r;if(this.Ql=t-r,this.d.strokeStyle="#D9D9D9",this.d.lineWidth=1,this.d.beginPath(),2===this.Kb)for(r=i/7*n,n=0;n<u;++n)t=Math.floor((n+e)*i-r)+.5,this.d.moveTo(t,f),this.d.lineTo(t,this.U);this.d.closePath();this.d.stroke()}},$h:function(){this.Kb=0;this.xb=7;this.fb=1;1.5<=this.B&&3>this.B?(this.Kb=0,this.fb=2):3<=this.B&&4>this.B?(this.Kb=0,this.fb=4):4<=this.B&&8>this.B?(this.Kb=0,this.fb=8):8<=this.B&&12>this.B?(this.Kb=0,this.fb=12):12<=this.B&&40>this.B?(this.Kb=1,this.fb=24,this.xb=1):40<=this.B&&100>this.B?(this.Kb=2,this.fb=168,this.xb=7):100<=this.B&&275>this.B?(this.Kb=3,this.fb=24,this.xb=1):275<=this.B&&5e4>this.B&&(this.Kb=3,this.fb=168,this.xb=30)},xc:function(n,t){return 1>n||12<n?0:[[31,28,31,30,31,30,31,31,30,31,30,31],[31,29,31,30,31,30,31,31,30,31,30,31]][0!=t%4||0==t%100&&0!=t%400?0:1][n-1]},Ki:function(n){return n.setHours(0,0,0),n.setDate(n.getDate()+4-(n.getDay()||7)),Math.ceil(((n-new Date(n.getFullYear(),0,1))/864e5+1)/7)},Fi:function(n){n.setHours(0);n.setMinutes(0);n.setMilliseconds(0);var t=(new Date).setFullYear((new Date).getFullYear(),0,1);return n.setHours(0),n.setMinutes(0),n.setMilliseconds(1),Math.ceil((n.getTime()-t)/864e5)},oh:function(n){var t=(new Date).setFullYear(n,0,1);return n=(new Date).setFullYear(n+1,0,1),Math.ceil((n-t)/864e5)},Mk:function(n){n=new Date("31 Dec "+n);var t=new Date(n.getFullYear(),0,4);return Math.ceil(((n-t)/864e5+t.getDay()+1)/7)}};r.prototype={q:-1,Vc:-1,gb:-1,Q:"",Of:"",o:o,$a:[],Sh:0,links:[],k:null,m:null,le:!1,Mb:-1,Ac:!1,Db:function(n){var t=this.m-this.k;this.k=n;this.m=n+t;this.fd()},Yd:function(n,t,i){n+24<this.m||this.P?(this.k=t&&this.P?Math.min(n,t-24):n,this.duration=this.m-this.k,0>this.duration&&this.ab&&(this.ab=!1,this.duration=24,this.m=this.k+this.duration)):(this.k=this.m-24,this.duration=this.m-this.k);i&&!this.P&&(this.kb=i,this.k+=24,this.duration=24,this.m=this.k+24);this.fd(i)},Tc:function(n,t){this.m=n-24>this.k?n:this.k+24;this.duration=this.m-this.k;t&&(this.kb=t);this.fd(t)},jj:function(n,t){n.setHours(0);n.setMilliseconds(0);n.setMinutes(0);n.setSeconds(0);this.Yd((n.getTime()-r.yd)/36e5,void 0,t)},Lg:function(n,t){n.setHours(0);n.setMilliseconds(0);n.setMinutes(0);n.setSeconds(0);this.Tc((n.getTime()-r.yd)/36e5,t)},rd:function(n,t){this.k=n;this.m=t;this.duration=this.m-this.k;this.fd()},pe:function(n){return void 0==r.Ga&&(r.Ga=new Date,r.Ga.setHours(0),r.Ga.setMilliseconds(0),r.Ga.setMinutes(0),r.Ga.setSeconds(0),r.yd=r.Ga.getTime()),(n.getTime()-r.Ga.getTime())/36e5},update:function(){this.Mb=-1;this.nc=this.Xd=null},mh:function(n){return this.zb.setHours(12),n=n?this.zb.eh():this.zb.Bf(),this.zb.setHours(0),n},pg:function(n){if(this.P)return"...";this.bb.setHours(12);var t=new Date(this.bb);return this.kb&&t.setDate(t.getDate()-1),n=n?t.eh():t.Bf(),this.bb.setHours(0),n},Lk:function(){var t,i,r;return this.zb.setHours(12),t=this.zb.getUTCDate(),10>t&&(t="0"+t.toString()),i=this.zb.getMonth()+1,10>i&&(i="0"+i.toString()),this.zb.setHours(0),r=t+"."+i+". - ",this.bb.setHours(12),t=this.bb.getUTCDate(),10>t&&(t="0"+t.toString()),i=this.bb.getMonth()+1,10>i&&(i="0"+i.toString()),this.bb.setHours(0),r+=t+"."+i+" ("+(this.m-this.k)/24,2>(this.m-this.k)/24?r+(" "+n.Gantt.Localize_strings.day+")"):r+(" "+n.Gantt.Localize_strings.days+")")},ki:function(){return-Math.floor((this.m-24)/24)},Gi:function(n){for(var i,t=this.links.length-1;0<=t;--t)if(i=this.links[t].za||this.links[t].parentTaskId,i==n)return this.links[t]},fd:function(n){void 0==r.Ga&&(r.Ga=new Date,r.Ga.setHours(0),r.Ga.setMilliseconds(0),r.Ga.setMinutes(0),r.Ga.setSeconds(0),r.yd=r.Ga.getTime());this.zb=new Date(r.yd+36e5*(this.k+12));this.bb=new Date(r.yd+36e5*this.m);this.zb.setHours(0);this.zb.setMilliseconds(0);this.zb.setMinutes(0);this.zb.setSeconds(0);this.bb.setHours(0);this.bb.setMilliseconds(0);this.bb.setMinutes(0);this.bb.setSeconds(0);n||(this.ab=this.kb=!1)},title:W("Q"),id:W("q"),xh:W("Vc"),vd:W("zb"),hd:function(){return this.kb?this.zb:this.bb},description:W("dc"),af:W("le"),status:W("o"),gj:W("Sh"),Dg:W("$a"),Xk:W("P"),Wk:W("ab")};g.prototype={q:-1,Vc:-1,Q:"",Of:"",le:!0,k:null,m:null,a:[],dj:!1,Mb:-1,Jg:"",collapse:!1,add:function(n){this.a.push(n);this.k=Math.min(this.m-this.jh,Math.min(n.k,this.k));this.duration=this.m-this.k;n.P&&n.Tc(this.m);this.Mb=-1;this.fd()},Nb:function(n,t){n.gb=this.q;this.a.splice(t,0,n)},Fb:function(n){this.a.splice(n,1);this.rb()},update:function(){this.Mb=-1;this.nc=this.Xd=null;this.fd()},Db:function(n){var t=this.m-this.k;this.k=n;this.m=n+t;this.Mb=-1;this.fd()},Yd:G(),Tc:function(n){var r=!1,t;if(n<this.m)for(t=0;t<this.a.length;++t)if(i!==this.a[t].o&&this.m>=this.a[t].m&&n<=this.a[t].m){var u=this.a[t].duration,f=this.a[t].m,e=this.a[t].k;this.a[t].m=n;this.a[t].k=n-u;this.a[t].fd();(f!==this.a[t].m||e!==this.a[t].k)&&(r=!0)}for(t=0;t<this.a.length;++t)this.a[t].P&&this.a[t].Tc(this.m);return this.m=n,this.duration=this.m-this.k,this.rb(),r},Lg:function(n){n.setHours(0);n.setMilliseconds(0);n.setMinutes(0);n.setSeconds(0);this.Tc((n.getTime()-r.yd)/36e5)},pe:function(n){return void 0==r.Ga&&(r.Ga=new Date,r.Ga.setHours(0),r.Ga.setMilliseconds(0),r.Ga.setMinutes(0),r.Ga.setSeconds(0),r.yd=r.Ga.getTime()),(n.getTime()-r.Ga.getTime())/36e5},rb:function(){var n,t;for(this.k=this.m,this.k=this.m-this.jh,n=0;n<this.a.length;++n)this.k=Math.min(this.m-this.jh,Math.min(this.a[n].k,this.k));for(this.duration=this.m-this.k,n=!1,t=0;t<this.a.length;++t)this.a[t].P&&this.a[t].Tc(this.m)&&(n=!0);return this.Mb=-1,this.fd(),n},mh:function(){return this.zb.Bf()},pg:function(){this.bb.setHours(12);var n=this.bb.Bf();return this.bb.setHours(0),n},ki:function(){return-Math.floor((this.m-24)/24)},fd:function(){void 0==r.Ga&&(r.Ga=new Date,r.Ga.setHours(0),r.Ga.setMilliseconds(0),r.Ga.setMinutes(0),r.Ga.setSeconds(0),r.yd=r.Ga.getTime());this.zb=new Date(r.yd+36e5*this.k);this.bb=new Date(r.yd+36e5*this.m);var n=this.bb.getMonth()+1;this.Jg=this.Q+" "+(9<this.bb.getDate()?this.bb.getDate():"0"+this.bb.getDate())+"."+(9<n?n:"0"+n)+"."+this.bb.getFullYear()%100},Mc:function(n){this.collapse=n;0===this.a.length&&(this.collapse=!1)},title:W("Q"),id:W("q"),Cl:W("a"),xh:W("Vc"),vd:W("zb"),hd:W("bb"),description:W("dc"),af:W("le"),status:W("o"),Dg:W("$a")};yt.prototype={be:function(n){for(var t=0;t<this.c.length;++t)if(this.c[t].q==n.gb)return this.c[t].add(n),-1;return this.a.push(n),this.Ec(),this.a.length},Nb:function(n,t){this.a.splice(t,0,n)},Ne:function(n){this.c.push(n);this.Ec()},ne:function(n,t){this.c.splice(t,0,n)},Tf:function(n){0<=n&&n<this.c.length&&this.c.splice(n,1)},Fb:function(n,t){void 0===t?(0<=n&&n<this.a.length&&this.a.splice(n,1),this.Ec()):0<=t&&t<this.c.length&&this.c[t].Fb(n)},ma:function(n){return this.c[n]},kd:function(){return!(this.a.length||this.c.length)},refresh:G(),Ec:function(){if(this.a.length){this.P=!1;this.k=this.a[0].k;this.m=this.a[0].m;this.a[0].P&&(this.P=!0);for(var n=this.a.length-1;0<=n;--n)this.k=Math.min(this.a[n].k,this.k),this.m=Math.max(this.a[n].m,this.m),this.a[n].P&&(this.P=!0)}},Mc:function(n){this.collapse=n;this.$e()&&(this.collapse=!0)},Wf:function(n){this.Rb=n;this.$e()&&(this.Rb=!0)},$e:function(){return 1===this.o||2===this.o},Ni:function(){return 1e3===this.o},title:W("Q"),id:W("q"),description:W("dc"),Dg:W("$a"),status:W("o")};li.prototype={Pg:function(n){this.Yi=Math.max(this.Yi,n.q);this.b.push(n);for(var i,t=0;t<this.c.length;++t)this.c[t].Vc==n.q&&(n.Ne(this.c[t]),this.c.splice(this.c.indexOf(t),1));for(i=0;i<this.a.length;++i)if(n.q===this.a[i].Vc){for(t=n.c.length-1;0<=t;--t)if(n.c[t].q===this.a[i].gb){n.c[t].add(this.a[i]);n.refresh();return}this.b[i].add(this.a[i])}n.refresh()},Ne:function(n){for(this.Ri=Math.max(this.Ri,n.q),this.ie=this.ie?Math.min(n.k,this.ie):n.k,this.he=this.he?Math.max(n.m,this.he):n.m,t=0;t<this.a.length;++t)this.a[t].gb==n.q&&(n.add(this.a[t]),this.a.splice(this.a.indexOf(t),1));for(var t=this.b.length-1;0<=t;--t)if(this.b[t].q==n.Vc){this.b[t].Ne(n);this.b[t].refresh();return}this.c.push(n)},ne:function(n,t){for(var i=this.b.length-1;0<=i;--i)if(this.b[i].q==n.Vc)return this.b[i].c.splice(t,0,n),!0;return!1},be:function(n){var t,i;for(this.Eh=Math.max(this.Eh,n.q),this.ie=this.ie?Math.min(n.k,this.ie):n.k,this.he=this.he?Math.max(n.P?n.k:n.m,this.he):n.P?n.k:n.m,t=this.b.length-1;0<=t;--t)if(this.b[t].q===n.Vc){for(i=this.b[t].c.length-1;0<=i;--i)if(this.b[t].c[i].q===n.gb)return this.b[t].c[i].add(n),this.b[t].refresh(),!0;return this.b[t].be(n),!0}return this.a.push(n),!1},Nb:function(n,t){for(var r,i=this.b.length-1;0<=i;--i)if(this.b[i].q===n.Vc){if(-1===n.gb||void 0===n.gb)return this.b[i].a.splice(t,0,n),!0;for(r=this.b[i].c.length-1;0<=r;--r)if(this.b[i].c[r].q===n.gb)return this.b[i].c[r].a.splice(t,0,n),!0}return!1},clear:function(){this.b=[];this.c=[];this.a=[]},Ai:function(){if(0!==this.b.length)return this.b.Zc()},A:function(n,t,i){if(!(n>=this.b.length))return void 0===t?i>=this.b[n].a.length?void 0:this.b[n].a[i]:t>=this.b[n].c.length||i>=this.b[n].c[t].a.length?void 0:this.b[n].c[t].a[i]},ma:function(n,t){return this.b[n].c[t]},lb:function(n){if(!(n>=this.b.length))return this.b[n]},Ok:function(n,t,i){return-1===n||-1===i?null:-1===t?this.b[n].a[i]:this.b[n].c[t].a[i]},Vb:function(n){for(var i,r,t=this.b.length-1;0<=t;--t){for(i=this.b[t].a.length-1;0<=i;--i)if(this.b[t].a[i].q===n)return{b:t,c:void 0,a:i,ha:this.b[t].a[i].q,fa:void 0,ga:this.b[t].q,l:this.b[t].a[i]};for(i=this.b[t].c.length-1;0<=i;--i)for(r=this.b[t].c[i].a.length-1;0<=r;--r)if(this.b[t].c[i].a[r].q===n)return{b:t,c:i,a:r,ha:this.b[t].c[i].a[r].q,fa:this.b[t].c[i].q,ga:this.b[t].q,l:this.b[t].c[i].a[r]}}},Vi:function(n){for(var i,t=this.b.length-1;0<=t;--t)for(i=this.b[t].c.length-1;0<=i;--i)if(this.b[t].c[i].q===n)return{b:t,c:i,fa:n,ga:this.b[t].q,l:this.b[t].c[i]}},$c:function(n,t){return{b:this.b[n].q,c:this.b[n].c[t].q}},jc:function(n,t,i){return void 0===t?{b:this.b[n].q,a:this.b[n].a[i].q}:{b:this.b[n].q,c:this.b[n].c[t].q,a:this.b[n].c[t].a[i].q}},Ef:function(){return++this.Eh},Fl:function(n){var i,t,r=[];if(this.b.length){for(i=0;i<this.b[n].c.length;++i)for(t=0;t<this.b[n].c[i].a.length;++t)r.push(this.b[n].c[i].a[t].q);for(i=this.b[n].a.length,t=0;t<i;++t)r.push(this.b[n].a[t].q)}return r},El:function(n){var t,i,r=[];if(this.b.length)for(i=this.b[n].c.length,t=0;t<i;++t)r.push(this.b[n].c[t].q);return r},Gh:function(n){return{tasks:this.Fl(n),milestones:this.El(n)}},Ug:function(){for(var r,e,t,i,c,u,l,a=0,h,f,o,n=0,s=0;s<this.b.length;++s)if((t=this.b[s],t.Og)&&(i=[],o=[],e=this.b[s].Og.milestones,void 0!==e)){if(e.length){for(u=e.length,n=0;n<u;++n)for(c=e[n],l=t.c.length,r=0;r<l;++r)if(t.c[r].id()===c){i.push(t.c[r]);o.push(r);break}if(this.b[s].c.length>i.length)for(n=0;n<l;++n)-1==o.indexOf(n)&&i.push(t.c[n]);this.b[s].c=i}if(e=this.b[s].Og.tasks,e.length){for(l=t.c.length,r=0;r<l;++r)if(i=[],o=[],u=t.c[r].a.length){for(n=a+u,h=a;h<n;++h)for(c=e[h],f=0;f<u;++f)if(t.c[r].a[f].id()===c){i.push(t.c[r].a[f]);o.push(f);break}if(u>i.length)for(n=0;n<u;++n)-1==o.indexOf(n)&&i.push(t.c[r].a[n]);t.c[r].a=i;a+=u}if(i=[],o=[],u=t.a.length){for(n=a+u,h=a;h<n;++h)for(c=e[h],f=0;f<u;++f)if(t.a[f].id()===c){i.push(t.a[f]);o.push(f);break}if(u>i.length)for(n=0;n<u;++n)-1==o.indexOf(n)&&i.push(t.a[n]);t.a=i}}}}};pt.prototype={ae:function(n,t,i){var r=this.p,u,f;if(r){u=r.f.$c(t,i);f=r.f.ma(t,i);this.top={id:n,b:t,c:i,a:void 0,na:u};switch(n){case"220":r.J[n]?r.J[n](u.b,u.c,f):this.jg(this.top);break;case"260":r.J[n]?r.J[n](u.b,u.c,f):this.hg(this.top)}}},Hc:function(n,t,i,r){var u=this.p,e,f;if(u)if("280"===n)this.top={id:n,link:t},u.J[n]&&(i=u.f.Vb(t.dependenceTaskId),r=u.f.Vb(t.parentTaskId),u.J[n](t,i.l,r.l));else if("270"===n)(this.top={id:n,link:t},u.J[n])&&u.J[n](t,t.task,t.parent);else if("300"===n)(this.top={id:n,move:t},u.J[n])&&u.J[n](t);else if("360"===n)(this.top={id:n,element:t},u.J[n])&&u.J[n](t);else switch(f=u.f.jc(t,i,r),e=u.f.A(t,i,r),this.top={id:n,b:t,c:i,a:r,na:f},n){case"200":u.J[n]?u.J[n](f.b,f.c,f.a,e,this.Ue(t,i,e.q)):this.jg(this.top);break;case"240":u.J[n]?u.J[n](f.b,f.c,f.a,e):this.hg(this.top)}},Ik:function(n){if(this.top){switch(this.top.id){case"200":this.jg(this.top);break;case"220":this.jg(this.top);break;case"260":this.hg(this.top);break;case"240":this.hg(this.top);break;case"270":this.rj(this.top.link);break;case"280":this.ak(this.top.link);break;case"300":"SaveConnections"===n?this.$k(this.top.move):this.bl(this.top.move)}this.top=null}},clear:function(){var n=this.p;n&&(n.L.reset(),n.f.clear(),n.Oa=void 0,n.ia.uh(),n.Cb(),n.ya(),n.Zd(),n.lc().fj())},jg:function(n){var t=this.p,i,u,r;if(t){if(i=null,r=0,void 0===n.b&&(n.b=-1),void 0===n.c&&(n.c=-1),void 0===n.a&&(n.a=-1),t.w.save(),-1!==n.c&&-1===n.a&&-1!==n.b&&(i=t.f.ma(n.b,n.c))){for(i.vb=!1,t.L.add(600,{b:n.b,c:n.c,a:i,index:n.c,ha:void 0,fa:n.na.c,ga:n.na.c}),t.L.kc(0,i),u=t.f.b[n.b].a,r=0;r<i.a.length;++r)u.push(i.a[r]),u.Zc().gb=-1;t.f.b[n.b].Tf(n.c)}-1===n.c&&-1!==n.a&&-1!==n.b&&(t.Aa.tb(null),i=t.f.A(n.b,void 0,n.a))&&(this.Ue(n.b,void 0,n.na.a),this.Sf(n.b,void 0,n.na.a),t.f.b[n.b].Fb(n.a),t.L.reset());-1!==n.c&&-1!==n.a&&-1!==n.b&&(t.Aa.tb(null),i=t.f.A(n.b,n.c,n.a))&&(this.Ue(n.b,n.c,n.na.a),this.Sf(n.b,n.c,n.na.a),t.f.b[n.b].c[n.c].Fb(n.a),t.L.reset());t.ya();t.Cb();t.t.mc(!0);t.Jb=!0;t.Bb().gd();t.update()}},hg:function(n){var u=this.p,t=null,f,r;u&&(void 0===n.b&&(n.b=-1),void 0===n.c&&(n.c=-1),void 0===n.a&&(n.a=-1),-1!==n.c&&-1===n.a&&-1!==n.b&&(t=u.f.ma(n.b,n.c))&&(f=r=t.o,r=r!=i-1?i-1:o-1,u.L.add(920,{b:n.b,c:n.c,a:t,index:n.c,xe:r,Be:f,ha:void 0,fa:n.na.c,ga:n.na.c}),t.o=r,u.L.kc(0,t)),-1===n.c&&-1!==n.a&&-1!==n.b&&(t=u.f.A(n.b,void 0,n.a))&&(f=r=t.o,r=r!=i?i:o,u.L.add(910,{b:n.b,c:void 0,a:t,index:n.a,xe:r,Be:f,ha:n.na.a,fa:n.na.c,ga:n.na.c}),t.o=r,u.L.kc(0,t)),-1!==n.c&&-1!==n.a&&-1!==n.b&&(t=u.f.A(n.b,n.c,n.a))&&(f=r=t.o,r=r!=i?i:o,u.L.add(910,{b:n.b,c:n.c,a:t,index:n.a,xe:r,Be:f,ha:n.na.a,fa:n.na.c,ga:n.na.c}),t.o=r,u.L.kc(0,t)),u.Bb().gd(),u.yb())},bi:function(n,t,i,r){var f=this.p,u=null;f&&(void 0===n.b&&(n.b=-1),void 0===n.c&&(n.c=-1),void 0===n.a&&(n.a=-1),-1!==n.c&&-1===n.a&&-1!==n.b&&(u=f.f.ma(n.b,n.c))&&(f.L.add(200,{b:n.b,c:n.c,a:u,index:n.c,xe:void 0,Be:void 0,ha:void 0,fa:n.na.c,ga:n.na.c}),u.Lg(t),f.L.kc(0,u)),-1===n.c&&-1!==n.a&&-1!==n.b&&(u=f.f.A(n.b,void 0,n.a))&&(f.L.add(100,{b:n.b,c:void 0,a:u,index:n.a,xe:void 0,Be:void 0,ha:n.na.a,fa:n.na.c,ga:n.na.c}),i?(u.Lg(t,r),u.P=!1):u.jj(t,r),f.L.kc(0,u)),-1!==n.c&&-1!==n.a&&-1!==n.b&&(u=f.f.A(n.b,n.c,n.a))&&(f.L.add(100,{b:n.b,c:n.c,a:u,index:n.a,xe:void 0,Be:void 0,ha:n.na.a,fa:n.na.c,ga:n.na.c}),i?(u.Lg(t,r),u.P=!1):u.jj(t,r),f.L.kc(0,u)),f.yb())},ai:function(n,t){function u(n,t){if(n.length!=t.length)return!1;for(var r=n.length,u=[],i=0,i=0;i<r;++i)u.push(n[i].id);for(i=0;i<r;++i)if(-1===u.indexOf(t[i].id))return!1;return!0}var i=this.p,r=null;if(i){if(void 0===n.b&&(n.b=-1),void 0===n.c&&(n.c=-1),void 0===n.a&&(n.a=-1),-1!==n.c&&-1===n.a&&-1!==n.b&&(r=i.f.ma(n.b,n.c))){if(n.l.$a&&t&&n.l.$a.id===t.id)return;i.L.add(960,{b:n.b,c:n.c,af:!0,index:n.c,vh:t,wh:n.l.$a,ha:void 0,fa:n.na.c,ga:n.na.c});r.$a=t;i.L.kc(!0,r)}if(-1===n.c&&-1!==n.a&&-1!==n.b&&(r=i.f.A(n.b,void 0,n.a))){if(u(n.l.$a,t))return;i.L.add(960,{b:n.b,c:void 0,index:n.a,vh:t,wh:n.l.$a,ha:n.na.a,fa:n.na.c,ga:n.na.c});r.$a=t;i.L.kc(!0,r)}if(-1!==n.c&&-1!==n.a&&-1!==n.b&&(r=i.f.A(n.b,n.c,n.a))){if(u(n.l.$a,t))return;i.L.add(960,{b:n.b,c:n.c,index:n.a,vh:t,wh:n.l.$a,ha:n.na.a,fa:n.na.c,ga:n.na.c});r.$a=t;i.L.kc(!0,r)}i.yb()}},Gj:function(n){var i=this.p,t=null,t=null;i&&(n=parseInt(n),(t=i.L.ji())&&!isNaN(n)&&(t.e.ha=n,t.e.a.q=n,t=i.f.A(t.e.b,t.e.c,t.e.index)))&&(t.q=n)},Fj:function(n,t){var r=this.p,i;r&&(n=parseInt(n),(i=r.L.ji())&&!isNaN(n))&&(i.e.fa=n,i.e.a.q=n,t&&(i.$a=t),(i=r.f.ma(i.e.b,i.e.index))&&(i.q=n,t&&(i.$a=t)),r.yb())},be:function(n,t,i,u,f,e,o,s,h,c,l,a,v,y,p){var b=this.p,w=null,w=null;b&&(w=new r(n,t,i,u,f,e,o,s,h,c,l,a,v,p),b.f.be(w),y&&(w=b.f.Vb(n))&&b.L.add(300,{b:w.b,c:w.c,a:w.l,index:w.a,ha:w.ha,fa:w.fa,ga:w.ga}))},Ne:function(n,t,i,r,u,f,e,o,s){var c=this.p,h=null,h=null;c&&(h=new g(n,t,i,r,u,f,e,o),c.f.Ne(h),s&&(h=c.f.Vi(n))&&c.L.add(400,{b:h.b,c:h.c,a:h.l,index:h.c,fa:h.fa,ga:h.ga}))},Pg:function(n,t,i,r,u,f,e,o){var s=this.p,h=null;s&&(h=new yt(n,t,i,r,u,f,e,o),s.f.Pg(h))},bl:function(n){var t=this.p,i=0,r=0,i=null;t&&("MtoF"===n.type&&(this.Sf(n.Ja,n.Na,n.ha),n.a.gb=-1,i=t.f.b[0].be(n.a),t.f.b[0].c[n.c].Fb(n.index),r=t.jd(0,-1,i),t.ja.Ib(Math.min(Math.max(0,r-.5*t.U),t.w.cb-t.w.Ya)),n.ad=i-1),"MtoM"===n.type&&(this.Sf(n.Ja,n.Na,n.ha),t.f.b[n.Ua].c[n.ib].Nb(n.a,n.ad),t.f.b[n.Ja].c[n.Na].Fb(n.index),t.f.b[n.Ja].c[n.Na].rb(),t.f.b[n.Ua].c[n.ib].rb()),"FtoM"===n.type?(this.Sf(n.Ja,n.Na,n.ha),(i=t.f.b[n.Ua].c[n.ib])&&n.a.P&&n.a.k>=i.m&&n.a.Yd(i.m-24),t.f.b[n.Ua].c[n.ib].Nb(n.a,n.ad),t.f.b[n.Ja].Fb(n.index),i.rb(),t.L.add(900,n),n.a.P&&n.a.k>=i.m&&n.a.Yd(i.m-24)):t.L.add(900,n),t.L.Nf(),t.yb())},$k:function(n){var i=this.p,t=0,u,f,r;if(i){if(t=this.ah(n.Ja,n.Na,n.ha),r=this.bh(n.Ja,n.Na,t),n.group=r,n.Dl=t,"MtoF"===n.type){for(n.Xf=i.f.b[n.Ja].c[n.Na].q,n.se=void 0,t=0;t<r.length;++t)r[t].I.gb=-1,f=i.f.b[n.Ja].be(r[t].I,!0),n.ha===r[t].id&&(u=f);for(t=r.length-1;0<=t;--t)i.f.b[n.Ja].c[n.Na].Fb(r[t].index);i.f.b[n.Ja].c[n.Na].rb();i.f.b[n.Ja].Ec();t=i.jd(0,-1,u);i.ja.Ib(Math.min(Math.max(0,t-.5*i.U),i.w.cb-i.w.Ya))}if("MtoM"===n.type){for(n.Xf=i.f.b[n.Ja].c[n.Na].q,n.se=i.f.b[n.Ua].c[n.ib].q,t=0;t<r.length;++t)r[t].I.gb=n.se,i.f.b[n.Ua].c[n.ib].a.push(r[t].I);for(t=r.length-1;0<=t;--t)i.f.b[n.Ja].c[n.Na].Fb(r[t].index);i.f.b[n.Ja].c[n.Na].rb();i.f.b[n.Ua].c[n.ib].rb()}if("FtoM"===n.type){for(n.Xf=void 0,n.se=i.f.b[n.Ua].c[n.ib].q,u=i.f.b[n.Ua].c[n.ib],t=0;t<r.length;++t)r[t].I.P&&r[t].I.k>=u.m&&r[t].I.Yd(u.m-24),r[t].I.gb=n.se,i.f.b[n.Ua].c[n.ib].a.push(r[t].I);for(t=r.length-1;0<=t;--t)i.f.b[n.Ja].Fb(r[t].index);u.rb();i.f.b[n.Ja].Ec()}i.L.add(905,n);i.L.Nf()}},rj:function(n){var f=this.p,e=s,r=0,i=0,t=null,u={},r=i=t=null;f&&(-10===n.parentSide&&10===n.side?(t=n.parent,r=n.task.q,i=n.parent.q):(-10===n.parentSide&&-10===n.side?e=0:10===n.parentSide&&10===n.side&&(e=1),t=n.task,r=n.parent.q,i=n.task.q),s===e&&(u={},u.dependenceTaskId=i,u.linkType=e,u.parentTaskId=r,u.type="link",t.links.push(u),t=f.f.Vb(i)))&&(i=f.f.Vb(i),r=f.f.Vb(r),f.L.add(950,{b:t.b,c:t.c,a:t.a,link:t.l.links[t.l.links.length-1],Hf:t.l.links.length-1,ha:t.ha,fa:t.fa,ga:t.ga,fh:i,yh:r}))},ak:function(n){var u=this.p,i=0,f,e,o,s,t=null,r=-1;if(u&&n&&(i=n.Ca||n.dependenceTaskId,t=u.f.Vb(i))){for(i=t.l.links.length-1;0<=i;--i)if(f=n.Ca||n.dependenceTaskId,e=n.za||n.parentTaskId,o=t.l.links[i].Ca||t.l.links[i].dependenceTaskId,s=t.l.links[i].za||t.l.links[i].parentTaskId,o===f&&s===e){r=i;break}-1!==r&&(u.L.add(955,{b:t.b,c:t.c,a:t.a,link:t.l.links[r],Hf:r,ha:t.ha,fa:t.fa,ga:t.ga}),t.l.links.splice(r,1),u.yb())}},Ue:function(n,t,i){var o=this.p,h=[],r=0,u=null,f=0,s=0,c=0,e=null,e=null;if(o)for(e=void 0!==t?o.f.ma(n,t):o.f.b[n],r=e.a.length-1;0<=r;--r)for(f=e.a[r].links.length-1;0<=f;--f)u=e.a[r].links[f],c=u.za||u.parentTaskId,s=u.Ca||u.dependenceTaskId,i!==s&&i!==c||e.a[r].id()!==s||h.push({link:u,index:f,La:r});return h},Sf:function(n,t,i){var o=this.p,u=0,r=null,f=0,s=r=0,e=null,e=null;if(o)for(e=void 0!==t?o.f.ma(n,t):o.f.b[n],u=e.a.length-1;0<=u;--u)for(f=e.a[u].links.length-1;0<=f;--f)r=e.a[u].links[f],s=r.za||r.parentTaskId,r=r.Ca||r.dependenceTaskId,i!==r&&i!==s||e.a[u].links.splice(f,1)},ah:function(n,t,i){var s,r,u,h=[],e={},o,f,c;if(r=null,u=[],f=[],this.p){if(u=this.sg(n,t),0===u.length)return h;for(n=u.length-1;0<=n;--n)for(r=u[n].links.length-1;0<=r;--r){if(t=u[n].links[r],f=t.za||t.parentTaskId,c=t.Ca||t.dependenceTaskId,e[c]||(e[c]={links:[]}),o=e[c].links){for(s=!0,t=o.length-1;0<=t;--t)if(o[t]===f){s=!1;break}s&&o.push(f)}if(e[f]||(e[f]={links:[]}),o=e[f].links){for(s=!0,t=o.length-1;0<=t;--t)if(o[t]===c){s=!1;break}s&&o.push(c)}}if(r=e[i],!r)return[];for(u=[],h.push(i),u.push(i),n=r.links.length-1;0<=n;--n)u.push(r.links[n]),h.push(r.links[n]);for(;;){for(f=[],n=u.length-1;0<=n;--n)if(i!==u[n])for(r=e[u[n]],t=r.links.length-1;0<=t;--t)-1===h.indexOf(r.links[t])&&(f.push(r.links[t]),h.push(r.links[t]));if(0===f.length)break;u=f}return h}return[]},sg:function(n,t){return void 0!==t?this.p.f.ma(n,t).a:this.p.f.b[n].a},bh:function(n,t,i){var r=0,u=[];for(n=this.sg(n,t),t=n.length,r=0;r<t;++r)-1!==i.indexOf(n[r].q)&&u.push({I:n[r],index:r,id:n[r].q});return u},$g:function(n,t,r){function d(n){for(var i=0,t=n.length-1;0<=t;--t)n[t].links.length&&++i;return i}function g(r,f){var e,h;for(++l,e=0,e=0;e<u.length;++e)if(u[e].links.length&&u[e].q!==r.data.id&&f!==u[e].q&&(v=w.indexOf(u[e].q),-1!==v&&(o=u[e].Gi(r.data.id))&&(o.Sc||o.linkType)==s&&u[e].o!==i)){if(c={b:n,c:t,a:e,l:u[e],id:u[e].q},h=r.createNode(),h.root=u[e],h.data=c,y<l){a=!0;return}if(g(h,u[e].q),a)return}--l}function tt(r){++l;for(var e=0,e=0;e<r.data.l.links.length;++e)if((o=r.data.l.links[e])&&(o.Sc||o.linkType)==s)for(f=0;f<u.length;++f)if(u[f].q===(o.za||o.parentTaskId)&&u[f].o!==i){if(c={b:n,c:t,a:f,l:u[f],id:u[f].q},h=r.createNode(),h.root=u[f],h.data=c,y<l){a=!0;return}if(u[f].links.length&&tt(h),a)return;break}--l}var f=0,e=0,o=null,v=-1,c=[],h=null,a=!1,y=0,l=0,w=null,p=this.p.f.Vb(r).l,u=this.sg(n,t),b=new nt,k=new nt,w=this.Vj(n,t,r);if(w.length)for(b.root=p,y=d(u),e=l=0;e<u.length;++e)u[e].links.length&&u[e].q!==r&&(v=w.indexOf(u[e].q),-1!==v&&(o=u[e].Gi(r))&&(o.Sc||o.linkType)==s&&u[e].o!==i&&(c={b:n,c:t,a:e,l:u[e],id:u[e].q},h=b.createNode(),h.root=u[e],h.data=c,g(h,u[e].q)));if(a)return null;for(k.root=p,y=d(u),e=l=0;e<p.links.length;++e)if((o=p.links[e])&&(o.Sc||o.linkType)==s)for(f=0;f<u.length;++f)if(u[f].q===(o.za||o.parentTaskId)&&u[f].o!==i){c={b:n,c:t,a:f,l:u[f],id:u[f].q};h=k.createNode();h.root=u[f];h.data=c;u[f].links.length&&tt(h);break}return a?null:{right:b,left:k}},Vj:function(n,t,i){var e=this.p,o,l,r,u,a=[],h={},c,f;if(u=null,r=-1,f=null,r=[],f=[],e){if(u=this.sg(n,t),0===u.length)return a;for(n=u.length-1;0<=n;--n)for(t=u[n].links.length-1;0<=t;--t)if(r=u[n].links[t],f=r.Sc||r.linkType,f===s){if(f=r.Ca||r.dependenceTaskId,r=r.za||r.parentTaskId,h[f]||(h[f]={links:[]}),c=h[f].links){for(l=!0,o=c.length-1;0<=o;--o)if(c[o]===r){l=!1;break}l&&c.push(r)}if(h[r]||(h[r]={links:[]}),c=h[r].links){for(l=!0,o=c.length-1;0<=o;--o)if(c[o]===f){l=!1;break}l&&c.push(f)}}if(u=h[i],!u)return[];for(f=e.f.Vb(i),t=f.l.links.length-1;0<=t;--t)r=f.l.links[t].za||f.l.links[t].parentTaskId,r=u.links.indexOf(r),-1!==r&&u.links.splice(r,r);for(r=[],a.push(i),r.push(i),n=u.links.length-1;0<=n;--n)r.push(u.links[n]),a.push(u.links[n]);for(;;){for(f=[],n=r.length-1;0<=n;--n)if(i!==r[n])for(u=h[r[n]],e=u.links.length-1;0<=e;--e)-1===a.indexOf(u.links[e])&&(f.push(u.links[e]),a.push(u.links[e]));if(0===f.length)break;r=f}return a}return[]},sl:function(n){var t=this.p;t&&(t.L.reset(),t.Oa=void 0,this.ei(!1),this.Hl(n),t.Zd(!0),t.lc().Hh(),t.Cb())},Hl:function(n){var t,u,i,r=this.p.f.b,f;if(r.length){for(i=r.length-1;0<=i;--i){for(t=r[i].c.length-1;0<=t;--t)for(n(r[i].c[t]),u=r[i].c[t].a.length-1;0<=u;--u)n(r[i].c[t].a[u]);for(t=r[i].a.length-1;0<=t;--t)n(r[i].a[t])}for(i=r.length-1;0<=i;--i){for(t=r[i].c.length-1;0<=t;--t)for(u=r[i].c[t].a.length-1;0<=u;--u)if(r[i].c[t].a[u].filter)for(n=this.ah(i,t,r[i].c[t].a[u].id()),f=this.bh(i,t,n),n=f.length-1;0<=n;--n)if(!f[n].I.filter){r[i].c[t].a[u].filter=void 0;r[i].c[t].a[u].ug=!0;break}for(t=r[i].a.length-1;0<=t;--t)if(r[i].a[t].filter)for(n=this.ah(i,void 0,r[i].a[t].id()),f=this.bh(i,void 0,n),n=f.length-1;0<=n;--n)if(!f[n].I.filter){r[i].a[t].filter=void 0;r[i].a[t].ug=!0;break}}}},ei:function(n){var t,u,i,r=this.p.f.b;if(r.length)for(i=r.length-1;0<=i;--i){for(t=r[i].c.length-1;0<=t;--t)for(r[i].c[t].filter=void 0,u=r[i].c[t].a.length-1;0<=u;--u)r[i].c[t].a[u].filter=void 0,r[i].c[t].a[u].ug=void 0;for(t=r[i].a.length-1;0<=t;--t)r[i].a[t].filter=void 0,r[i].a[t].ug=void 0}n&&(this.p.Zd(!0),this.p.lc().Hh())},sj:function(n){var r=this.p,t=null,i={};r&&(t=r.f.Vb(n.dependenceTaskId))&&(i.dependenceTaskId=n.dependenceTaskId,i.linkType=n.linkType,i.parentTaskId=n.parentTaskId,i.type="link",t.l.links.push(i),r.L.add(950,{b:t.b,c:t.c,a:t.a,link:t.l.links[t.l.links.length-1],Hf:t.l.links.length-1,ha:t.ha,fa:t.fa,ga:t.ga}))},Kk:function(n){this.O&&(void 0!==this.O.a?(n=n?i:o,n!==this.O.status&&this.Hc("240",this.O.b,this.O.c,this.O.a)):(n=n?i-1:o-1,n!==this.O.status&&this.ae("260",this.O.b,this.O.c)),this.O=null)},Jk:function(n,t){var r=this.p,u;if(r&&this.O){if(this.O.fc){if("edit"===n)r.mg(this.O.b,void 0===this.O.c?-1:this.O.c,this.O.a);else if("delete"===n)this.Hc("200",this.O.b,this.O.c,this.O.a);else if("open"===n)this.O.l&&i===this.O.l.status()&&this.Hc("240",this.O.b,this.O.c,this.O.a);else if("closed"===n)this.O.l&&i!==this.O.l.status()&&this.Hc("240",this.O.b,this.O.c,this.O.a);else if("addlink"===n)i!==this.O.I.o&&r.J["350"]&&r.J["350"](r.f.A(this.O.b,this.O.c,this.O.a));else if("responsible"===n)this.ai(this.O,t);else if("timechanage"===n){if(r=!1,r=t.time,t.direction){if(u=this.O.l.hd(),u.getUTCDate()===r.getUTCDate()&&u.getMonth()===r.getMonth()&&u.getFullYear()===r.getFullYear())return;u=this.O.l.vd();r=u.getUTCDate()===r.getUTCDate()&&u.getMonth()===r.getMonth()&&u.getFullYear()===r.getFullYear();this.O.l.vd().getTime()>=t.time.getTime()&&(r=!0)}else{if(u=this.O.l.vd(),u.getUTCDate()===r.getUTCDate()&&u.getMonth()===r.getMonth()&&u.getFullYear()===r.getFullYear())return;u=this.O.l.hd();r=u.getUTCDate()===r.getUTCDate()&&u.getMonth()===r.getMonth()&&u.getFullYear()===r.getFullYear();this.O.l.hd().getTime()<=t.time.getTime()&&(r=!0)}this.bi({b:this.O.b,c:this.O.c,a:this.O.a,na:this.O.na},t.time,t.direction,r)}}else"edit"===n?r.mg(this.O.b,this.O.c,-1):"delete"===n?this.ae("220",this.O.b,this.O.c):"open"===n?this.O.l&&i-1===this.O.l.status()&&this.ae("260",this.O.b,this.O.c):"closed"===n?this.O.l&&i-1!==this.O.l.status()&&this.ae("260",this.O.b,this.O.c):"addMilestoneTask"===n?r.Th(this.O.b,this.O.c):"fitToScreen"===n?this.p.lc().Ng(this.O.b,this.O.c):"responsible"===n?this.ai(this.O,t):"timechanage"===n&&this.O.l.hd().getTime()!==t.time.getTime()&&this.bi({b:this.O.b,c:this.O.c,a:void 0,na:this.O.na},t.time);this.O=null}},Gh:function(n){if(void 0===n)n=0;else for(var t=this.p.f.b.length-1;0<=t;--t)if(n===this.p.f.b[t].q){n=t;break}return this.p.f.Gh(n)},Ug:function(){return this.p.f.Ug()}};wt.prototype={Ud:function(n,t,i){var r=this.p;r&&(this.gh=void 0!==i,t?r.ja.scale(n,void 0,void 0,!0):r.ja.scale(n))},fj:function(){var n=this.p;n&&this.Db(n.uc/n.i.R)},Db:function(n){var t=this.p;t&&(t.offsetX=n,t.i&&t.i.Db(n),t.$=!0)},Hh:function(){var n=this.p,t=null,i=0,t=null,t=0;n&&n.ia&&(n.ia.Vg(),t=n.Ji(),n.Y||(t.height=Math.max(.0001,t.height-n.j)),t.empty?(t=n.Nk(),t.x&&t.height&&(n.offsetX=(-t.x+24)/n.i.B+n.da/n.i.R,n.i.Db(n.offsetX))):(n.Y||(t.height=(t.height/n.j>>0)*n.j-.0001),i=(n.w.md()/n.j>>0)*n.j-.0001,n.w.Fg(Math.min(t.height,i),!0)),t=-Math.max(Math.abs(n.f.ie?n.f.ie:0),Math.abs(n.f.he?n.f.he:0)),n.ia.vl(t))},fg:function(n,t,i,r){var u=this.p,f;u&&n&&(f=null,(f=t?u.f.Vi(n):u.f.Vb(n))&&(n=u.jd(f.b,-1<f.c?f.c:-1,-1<f.a?f.a:-1)-.5*u.U,t=(u.w.md()/u.j>>0)*u.j,n=(n/u.j>>0)*u.j,u.ja.Ib(Math.min(Math.max(.0001,n),t),i),void 0===r&&u.ja.Lc(f.l.k)))},Mj:function(n){var t=this.p;return t&&n?(t.ia||(t.ia=new at(n,t),t.Jb=!0),t.ia):null},Hk:function(n){var t=this.p;t&&(t.ja.Gg=n,t.ja.Ud=n,t.ja.scrollTo=n)},Ng:function(n,t){var i=this.p,u=0,f=0,e=0,r=0,e=0;i&&i.ia&&(u=i.f.ma(n,t).k,f=i.f.ma(n,t).m,e=(i.ia.ic.getTime()-i.ia.Sb.getTime())/36e5,r=(i.ia.Qa.eb-.5)*e,e*=i.ia.Qa.end-.5,e-r<f-u?(this.gh=!1,r=i.i.B*1.05*((f-u)/(e-r)),r=Math.min(Math.max(r,28),270),i.ja.al(r,.5*(f+u))):i.ja.Lc(.5*(f+u)))},Y:function(){var n=this.p;n&&(n.ya(),n.Cb(),n.t.mc(!0),n.Jb=!0,n.$=!0)},ck:function(n){if(void 0!==n){var t=this.p;t&&(t.td=!n,t.ya(),t.Xa=!1,t.$=!0)}},collapse:function(n){var t=this.p,i,r;if(t&&!t.Y)for(n=n||!1,i=t.f.b.length-1;0<=i;--i){for(r=t.f.b[i].c.length-1;0<=r;--r)t.f.b[i].c[r].Mc(n);t.f.b[i].Mc(n)}},ii:function(n){var t=this.p,i;if(t&&!t.Y)for(n=n||!1,i=t.f.b.length-1;0<=i;--i)t.f.b[i].Wf(n)},nl:function(){return this.p.i.B},ml:function(){var n=this.p,i,t;if(n&&(this.position={Sa:n.offsetX,Ce:n.w.value(),collapse:[],Di:!1},n.f.b.length)){for(i=n.f.b[0].c.length,t=0;t<i;++t)this.position.collapse.push({id:n.f.b[0].c[t].id(),status:n.f.b[0].c[t].collapse});this.position.Di=n.f.b[0].collapse}},Yk:function(n){var t=this.p,i,r;if(t&&this.position&&void 0===n&&(t.offsetX=this.position.Sa,t.w.Fg(this.position.Ce),t.f.b.length)){n=this.position.collapse;var u=t.f.b[0].c,f=n.length,e=t.f.b[0].c.length;if(0<e&&0<f)for(i=0;i<f;++i)for(r=0;r<e;++r)n[i].id===u[r].id()&&(u[r].collapse=n[i].status);t.f.b[0].collapse=this.position.Di}this.position=null},yf:function(){if(!this.gh&&this.onchangetimescale)this.onchangetimescale(this.p.i.B)}};ai.prototype={update:function(){var n=this.p,t,i;if(n&&(0!=this.sd&&(t=this.sd-n.offsetX,0<t?.01>t?(n.offsetX=this.sd,this.sd=0):n.offsetX+=.15*t:-.01<t?(n.offsetX=this.sd,this.sd=0):n.offsetX+=.15*t,n.i.Db(n.offsetX),n.$=!0,n.ia&&(n.ia.Cc=!0)),0!=this.Wd&&(t=this.Wd-this.Dd,0<t?.5>t?(this.Dd=Math.max(this.Wd,0),this.Wd=0,this.Hd&&(this.Hd(),this.Hd=null)):this.Dd+=.2*t:-.5<t?(this.Dd=Math.max(this.Wd,0),this.Wd=0,this.Hd&&(this.Hd(),this.Hd=null)):this.Dd+=.2*t,n.w.Fg(this.Dd),n.$=!0,n.ia&&(n.ia.Cc=!0),n.Ka&&n.Ka.kf(n.w.value())),0!=this.Td)){if(t=n.i.B,i=this.Td-n.i.B,0<i?.15>i?(n.i.B=this.Td,this.Td=0,this.$f=!0,this.Vd=void 0):n.i.B+=.15*i:-.15<i?(n.i.B=this.Td,this.Td=0,this.$f=!0,this.Vd=void 0):n.i.B+=.15*i,this.$f)t/=n.i.B,n.offsetX=(n.uc-(-n.offsetX*n.i.R+n.uc)*t)/n.i.R,this.de.D!==this.de.N&&(this.de.D=n.ia.df(),this.de.N=n.ia.cf(),n.offsetX=Math.max(n.offsetX,this.de.N),n.offsetX=Math.min(n.offsetX,this.de.D)),n.i.Db(n.offsetX);else if(void 0!=this.Vd){var t=t/n.i.B,i=n.i.B*n.offsetX,r=Math.abs(this.Vd-i);i<this.Vd?(n.offsetX+=(i-r*(1-t))/n.i.B,i=n.i.B*n.offsetX,i>this.Vd&&(n.offsetX=this.Vd/n.i.B)):n.offsetX=this.Vd/n.i.B;n.i.Db(n.offsetX)}this.ke&&(this.sd=n.uc/n.i.R-this.ke/n.i.B);n.Gd.yf();n.$=!0;n.ia&&(n.ia.Cc=!0)}},stop:function(){this.sd=0;this.Hd=null;this.ke=0},Lc:function(n){var t=this.p;t&&(n=t.uc/t.i.R-n/t.i.B,this.ke=0,this.Gg?this.sd=n:(t.offsetX=n,t.i.Db(n),t.update()))},uf:function(n){var t=this.p;t&&(n=t.offsetX-n,this.ke=0,this.Gg?this.sd=n:(t.offsetX=n,t.i.Db(n),t.update()))},Ib:function(n,t,i){if(t){if(this.Hd)return;this.Hd=t}(t=this.p)&&(this.scrollTo&&!i?(this.Dd=t.w.value(),this.Wd=n):(this.Dd=this.Wd=n,t.w.nh(n)))},scale:function(n,t,i,r){var u=this.p;u&&n&&(t&&(this.$f=!1),i&&(this.Vd=i),this.ke=0,t=u.i.B/n,this.Ud&&!r?(this.Td=n,this.$=!0,u.ia&&(this.de.D=u.ia.df(),this.de.N=u.ia.cf())):(this.o=1,u.i.B=Math.max(1,n),i&&(u.offsetX=i/u.i.B),this.$f&&(u.offsetX=(u.uc-(-u.offsetX*u.i.R+u.uc)*t)/u.i.R,u.i&&u.i.Db(u.offsetX)),u.Gd.yf(),u.$=!0))},al:function(n,t){var i=this.p;i&&(this.Gg&&this.Ud?(this.ke=t,this.sd=i.uc/i.i.R-this.ke/i.i.B,this.Td=n):(i.i.B=n,i.offsetX=i.uc/i.i.R-t/i.i.B,i.i.Db(i.offsetX),i.Gd.yf()),i.$=!0)},status:function(){return 0!==this.Td},Vk:function(){return 0!==this.Wd}};vi.prototype={hl:function(){this.ye=this.a.i.R*this.a.offsetX;this.scrollY=this.a.w.value()>>0;this.Dc=this.a.i.R/this.a.i.B},yi:function(n,t,r,f,e,o,s){var h,y,p,w;if(this.wb=this.ye+n.k*this.Dc,this.Wb=n.duration*this.Dc,this.rel=t-this.scrollY,h=this.a.G,!(this.rel+this.a.G<=this.a.Xb)){n.P&&-1===e&&(this.Wb=-this.wb+this.a.r-45,this.Wb=Math.max(this.Wb,45),this.wb<=this.a.da-1&&(this.Wb=Math.min(-this.wb+.75*this.a.r,this.Wb)));var b=!1,v=!1,l=!1,c=kt,a="#9EB56C";if(i===n.o?(c=kt,a="#9EB56C",this.a.g.enable||this.a.Ka.ua.g.enable||(this.a.la===o&&this.a.xa===e&&this.a.ta===f&&(c="#9AC54A",a="#729335",l=!0),r&&this.a.la===o&&-1===this.a.xa&&this.a.ta===f&&(c="#9AC54A",a="#729335",l=!0),this.a.oa===o&&this.a.qa===e&&this.a.X===f&&(c="#9AC54A",a="#729335",l=b=!0))):0>=n.m&&(!n.P||-1!==e)?(c=wi,a="#872200",this.a.g.enable||this.a.Ka.ua.g.enable||(this.a.la===o&&this.a.xa===e&&this.a.ta===f&&(c="#B00600",a="#840701",l=!0),r&&this.a.la===o&&-1===this.a.xa&&this.a.ta===f&&(c="#B00600",a="#840701",l=!0),this.a.oa===o&&this.a.qa===e&&this.a.X===f&&(c="#B00600",a="#840701",l=b=!0))):(c="#A4C7E5",a="#82A0B9",this.a.g.enable||this.a.Ka.ua.g.enable||(r&&(c="#A4C7E5"),this.a.la===o&&this.a.xa===e&&this.a.ta===f&&(c="#78A8D6",a="#567da1",l=!0),r&&this.a.la===o&&-1===this.a.xa&&this.a.ta===f&&(c="#78A8D6",a="#567da1",l=!0),this.a.oa===o&&this.a.qa===e&&this.a.X===f&&(c="#78A8D6",a="#567da1",l=b=!0))),this.wb>this.a.r-24&&this.a.Xb<this.rel&&(this.a.d.fillStyle=c,this.a.t.oi(this.a.r-30,this.rel+2,16,16)),this.wb+this.Wb<this.a.da+2&&this.a.Xb<this.rel&&(this.a.d.fillStyle=c,this.a.t.pi(this.a.da-2,this.rel+2,16,16)),this.wb>this.a.r||0>this.wb+this.Wb||this.rel>this.a.U)n.vb&&this.a.Aa.set(this.wb,this.rel+this.a.G,n,null);else if(this.a.g.enable&&f==this.a.g.b&&e==this.a.g.c&&o===this.a.g.a)this.a.g.Ta(this.wb,this.rel,this.Wb,this.a.G),this.a.d.font=this.a.Kg,this.a.d.fillStyle="#999999",this.a.d.strokeStyle="#999999",this.a.d.fillText(n.Lk(),this.wb,this.rel+this.a.G+this.a.Ra);else if(!(0>=this.rel)){if(0<this.a.Xb){if(h=this.rel+h-this.a.Xb-1,0>=h)return;h<this.a.G?this.rel+=this.a.G-h:h=this.a.G}if(300===this.a.Wa&&this.a.n&&(this.a.n.gf===f&&this.a.n.ff===e&&this.a.n.Rf===o&&(v=!0),this.a.n.b===f&&this.a.n.c===e&&this.a.n.a===o&&(v=!0)),r=(this.wb>>0)+.5,e=(this.rel>>0)+.5,o=this.Wb>>0,y=h>>0,this.a.ja.status()&&(r=this.wb+.5,e=this.rel+.5,o=this.Wb+.5,y=h+.5),this.a.d.fillStyle=n.ug?"rgba(0, 0, 0, 0)":c,this.a.d.fillRect(r,e,o,y),c=0<n.links.length,!c)for(p=s.length-1;0<=p;--p)for(w=s[p].links.length-1;0<=w;--w)if(n.q===(s[p].links[w].za||s[p].links[w].parentTaskId)){c=!0;break}c||v?(s=u,v?(this.a.d.strokeStyle="#24547E",s=ir,this.a.d.lineWidth=2,r=this.wb>>0,e=this.rel>>0,o=this.Wb>>0,y=h>>0):(this.a.t.xi(this.a.d,r,e,this.Wb>>0,h>>0,"#FFFFFF"),this.a.d.strokeStyle="#4980C3",this.a.d.lineWidth=1),this.a.ja.status()&&(r=(this.wb>>0)+.5,e=(this.rel>>0)+.5,o=(this.Wb>>0)+.5,y=h>>0),this.a.t.Qc(this.a.d,r,e,r+o,e,s),this.a.t.Qc(this.a.d,r,e+y,r+o,e+y,s),this.a.t.Yc(this.a.d,r,e,r,e+y,s),this.a.t.Yc(this.a.d,r+o,e,r+o,e+y,s)):this.a.t.xi(this.a.d,r,(this.rel>>0)+.5,this.Wb>>0,h>>0,a);f=0!==this.a.f.lb(f).status();v=!1;!l||this.a.Ea||f||(l=(e>>0)+.5,i!==n.o&&(this.a.d.fillStyle="#628BAE",this.a.d.fillRect(r-10>>0,l+.5*h-3>>0,8,8),this.a.d.fillStyle="#FFFFFF",this.a.d.fillRect(r-7>>0,l+.5*h-.5>>0,2,2),v=!0,n.P||(this.a.d.fillStyle="#628BAE",this.a.d.fillRect(r+3+o>>0,l+.5*h-3>>0,8,8),this.a.d.fillStyle="#FFFFFF",this.a.d.fillRect(r+3+o+3>>0,l+.5*h-.5>>0,2,2),v=!0)));!this.a.Ea&&this.a.Ha&&!v&&this.a.Ha.bf&&this.a.Ha.bf===n.q&&(this.a.d.fillStyle="#628BAE",this.a.d.fillRect(r-10>>0,e+.5*h-3>>0,8,8),this.a.d.fillStyle="#FFFFFF",this.a.d.fillRect(r-7>>0,e+.5*h>>0,2,2),this.a.Ha.I.P||(this.a.d.fillStyle="#628BAE",this.a.d.fillRect(r+3+o>>0,e+.5*h-3>>0,8,8),this.a.d.fillStyle="#FFFFFF",this.a.d.fillRect(r+3+o+3>>0,e+.5*h-.5>>0,2,2)));n.tf&&!v&&this.Wb>.8*this.a.G&&this.a.t.rk(this.a.d,this.wb,this.rel,this.a.G,"#FFFFFF");n.vb?(this.a.Aa.set(this.wb,this.rel+this.a.G,n,a),this.a.Mh=t,this.a.Lh=this.wb):(this.a.Y&&0<this.wb+this.Wb&&(this.a.d.fillStyle="#333333",this.a.d.strokeStyle="#333333",this.a.d.lineWidth=1,this.a.d.fillText(n.Q,Math.max(this.wb+this.a.Ie*this.a.zoom,0),this.rel+this.a.G+this.a.Ra)),-1===n.Mb&&(n.Mb=this.a.d.measureText(n.Q).width/this.a.zoom));this.a.Ea||!b||this.a.bd||i===n.o||300===this.a.Wa||f||(n.P||10!==this.a.sb&&0!=this.a.sb||(this.a.d.fillStyle="#FFFFFF",this.a.t.Fe(this.a.d,r+o+13,this.rel+.5*(this.a.G-15),63,15,4),this.a.d.fill(),this.a.d.strokeStyle="#999999",this.a.t.Fe(this.a.d,r+o+13,this.rel+.5*(this.a.G-15),63,15,4),this.a.d.stroke(),this.a.d.fillStyle="#999999",this.a.d.fillText(n.pg(!0),r+o+13+4,this.rel+.5*(this.a.G-15)+15-4)),-10!==this.a.sb&&0!=this.a.sb)||(this.a.d.fillStyle="#FFFFFF",this.a.t.Fe(this.a.d,r-76,this.rel+.5*(this.a.G-15),63,15,4),this.a.d.fill(),this.a.d.strokeStyle="#999999",this.a.t.Fe(this.a.d,r-76,this.rel+.5*(this.a.G-15),63,15,4),this.a.d.stroke(),this.a.d.fillStyle="#999999",this.a.d.fillText(n.mh(!0),r-72,this.rel+.5*(this.a.G-15)+15-4));n.P&&this.a.d.drawImage(this.ph,this.wb+this.Wb+5,this.rel+2);this.wb<this.a.da+2&&this.wb+this.Wb>this.a.da+2&&(this.a.d.fillStyle="#FFFFFF",this.a.t.pi(this.a.da-2,this.rel+2,16,16))}}},xk:function(n,t,i,r,u){var f=t-this.scrollY,e=this.ye+n.k*this.Dc,o=n.duration*this.Dc,s=f+this.a.G,h;if(e>this.a.r||0>e+o||f>this.a.U)n.vb&&this.a.Tb.set(e+o,0,n,null);else if(h=0===u&&this.a.Y?1.5*this.a.j:(u+.5)*this.a.j,h=h+this.a.Xb,!(0>=f+h||!this.a.Y&&2>=f+h-this.a.j)){if(this.a.Va.enable||this.a.Va.b==i&&this.a.Va.c==r){if(!this.a.Y&&(f=t-this.scrollY-.5*this.a.G>>0,s=f+this.a.G,h=0===u&&this.a.Y?1.5*this.a.j:(u+.5)*this.a.j,s<this.a.Xb&&(u=2*this.a.j-s,s=2*this.a.j,h-=u,0>h)))return;(this.a.Y||!n.collapse)&&(this.a.d.fillStyle=bi,this.a.d.fillRect(e,s,o,h))}s=f+this.a.G-this.a.nd*this.a.zoom;s<this.a.Xb||(this.a.d.fillStyle=0>=n.m?dt:"#7e7e7e",1===n.o&&(this.a.d.fillStyle=ut),this.a.d.fillRect(e,s,o,this.a.nd*this.a.zoom),this.a.d.beginPath(),this.a.d.moveTo(e+o,s),this.a.d.lineTo(e+o,f+this.a.G+2*this.a.nd*this.a.zoom),this.a.d.lineTo(e+o-2*this.a.nd*this.a.zoom,f+this.a.G),this.a.d.closePath(),this.a.d.fill(),-1===n.Mb&&(n.Mb=this.a.d.measureText(n.Jg).width),this.a.g.enable&&i==this.a.g.b&&r==this.a.g.c&&-1===this.a.g.a?this.a.g.Ta(e+o,f-this.a.nd*this.a.zoom,-1,this.a.G):(i=n.Mb+(n.Ph?this.a.Zk*this.a.zoom:0),r=e+o-i,e+o>this.a.r&&(r=this.a.r-i),n.Ph&&this.a.t.sk(this.a.d,r+i>>0,f+this.a.G+2*!this.a.Y>>0,this.a.zoom),n.o&&(this.a.d.fillStyle="#7e7e7e"),n.vb&&(this.a.Tb.set(e+o,f+.5*this.a.j+this.a.nd*this.a.zoom-1,n,n.o?ut:this.a.d.fillStyle),this.a.Mh=t,this.a.Lh=this.wb),this.a.Y&&this.a.d.fillText(n.Jg,r,f+this.a.Ra-this.a.nd*this.a.zoom)))}},ti:function(n,t,i,r){var f,g,e;if(n.length){0<this.a.Xb&&(this.a.d.save(),this.a.d.rect(this.a.da,this.a.Xb,this.a.r,this.a.U),this.a.d.clip());var c,l,a,v,o,h=void 0,nt=-1,tt=-1;this.a.Z.link&&(nt=this.a.Z.link.Ca||this.a.Z.link.dependenceTaskId,tt=this.a.Z.link.za||this.a.Z.link.parentTaskId);var p=null,w=this.a.j,b=.5*this.a.G>>0,d=0,y=0,k=i-r;for(this.a.d.strokeStyle="#4980C3",this.a.d.lineWidth=1,f=0;f<n.length;++f)for(i=n[f],i.filter&&d++,g=0;g<i.links.length;++g)if(y=i.links[g],r=y.za||y.parentTaskId,n[f].q!==r)for(o=y.Sc||y.linkType,e=y=0;e<n.length;++e)if(n[e].filter&&y++,!(n[e].filter&&n[f].filter||n[e].q!==r)){if(s===o){if(a=(t+(n[e].k+n[e].duration)*this.Dc+5>>0)-.5,v=(t+n[f].k*this.Dc-5>>0)-.5,c=(k+w*(e-y)+b>>0)+.5,l=(k+w*(f-d)+b>>0)+.5,this.a.M&&o===this.a.M.pa.linkType&&r==this.a.M.pa.parentTaskId&&n[f].q==this.a.M.pa.dependenceTaskId){p={Sc:o,of:a+.5,qf:c+.5,pf:v+.5,rf:l+.5};continue}if(n[e].k+n[e].duration>n[f].k){if(r===tt&&i.id()===nt){h={Sc:o,of:a+.5,qf:c+.5,pf:v+.5,rf:l+.5,linkColor:"#CC3300"};continue}this.a.d.strokeStyle="#FFFFFF";this.a.ec.ue(o,a,c,v,l);this.a.d.strokeStyle="#CC3300";this.a.ec.ue(o,a,c,v,l,!0);continue}}else 0===o?(a=(t+n[e].k*this.Dc>>0)+.5,v=(t+n[f].k*this.Dc>>0)+.5,c=(k+w*(e-y)+b>>0)+.5,l=(k+w*(f-d)+b>>0)+.5):1===o&&(a=(t+(n[e].k+n[e].duration)*this.Dc>>0)+.5,v=(t+(n[f].k+n[f].duration)*this.Dc>>0)+.5,c=(k+w*(e-y)+b>>0)+.5,l=(k+w*(f-d)+b>>0)+.5);this.a.M&&o===this.a.M.pa.linkType&&r==this.a.M.pa.parentTaskId&&n[f].q==this.a.M.pa.dependenceTaskId?p={Sc:o,of:a+.5,qf:c+.5,pf:v+.5,rf:l+.5}:r===tt&&i.id()===nt?h={Sc:o,of:a+.5,qf:c+.5,pf:v+.5,rf:l+.5,linkColor:"#4980C3"}:(this.a.d.strokeStyle="#FFFFFF",this.a.ec.ue(o,a,c,v,l),this.a.d.strokeStyle="#4980C3",this.a.ec.ue(o,a,c,v,l,!0))}p&&(this.a.d.beginPath(),this.a.d.lineWidth=2,this.a.d.strokeStyle="#24547E",u=[6,2],this.a.ec.ue(p.Sc,p.of,p.qf,p.pf,p.rf,!0),u=[4,2],this.a.d.stroke());h&&(this.a.d.beginPath(),this.a.d.lineWidth=2,this.a.d.strokeStyle="#FFFFFF",this.a.ec.ue(h.Sc,h.of>>0,h.qf>>0,h.pf>>0,h.rf>>0,!0),this.a.d.strokeStyle=h.linkColor,this.a.ec.ue(h.Sc,h.of>>0,h.qf>>0,h.pf>>0,h.rf>>0,!0),this.a.d.stroke());0<this.a.Xb&&this.a.d.restore()}},ue:function(n,t,i,r,f,e){s===n?i<f?t<r?e?(this.a.t.lineTo(this.a.d,t-5,i,t,i,u),this.a.t.lineTo(this.a.d,t,i,t,f,u),this.a.t.lineTo(this.a.d,t,f,r+5+1,f,u)):(this.a.d.beginPath(),this.a.d.moveTo(t-5,i),this.a.d.lineTo(t,i),this.a.d.lineTo(t,f),this.a.d.lineTo(r+5+1,f),this.a.d.stroke()):e?(this.a.t.lineTo(this.a.d,t-5,i,t,i,u),this.a.t.lineTo(this.a.d,t,i,t,f-this.a.G,u),this.a.t.lineTo(this.a.d,r,f-this.a.G,t,f-this.a.G,u),this.a.t.lineTo(this.a.d,r,f-this.a.G,r,f,u),this.a.t.lineTo(this.a.d,r,f,r+5+1,f,u)):(this.a.d.beginPath(),this.a.d.moveTo(t-5,i),this.a.d.lineTo(t,i),this.a.d.lineTo(t,f-this.a.G),this.a.d.lineTo(r,f-this.a.G),this.a.d.lineTo(r,f),this.a.d.lineTo(r+5+1,f),this.a.d.stroke()):t<r?e?(this.a.t.lineTo(this.a.d,t-5,i,t,i,u),this.a.t.lineTo(this.a.d,t,f,t,i,u),this.a.t.lineTo(this.a.d,t,f,r+5,f,u)):(this.a.d.beginPath(),this.a.d.moveTo(t-5,i),this.a.d.lineTo(t,i),this.a.d.lineTo(t,f),this.a.d.lineTo(r+5,f),this.a.d.stroke()):e?(this.a.t.lineTo(this.a.d,r,f,r+5+1,f,u),this.a.t.lineTo(this.a.d,r,f,r,i-this.a.G,u),this.a.t.lineTo(this.a.d,r,i-this.a.G,t,i-this.a.G,u),this.a.t.lineTo(this.a.d,t,i-this.a.G,t,i,u),this.a.t.lineTo(this.a.d,t-5,i,t,i,u)):(this.a.d.beginPath(),this.a.d.moveTo(r+5+1,f),this.a.d.lineTo(r,f),this.a.d.lineTo(r,i-this.a.G),this.a.d.lineTo(t,i-this.a.G),this.a.d.lineTo(t,i),this.a.d.lineTo(t-5,i),this.a.d.stroke()):0===n?i<f?t<r?e?(this.a.t.lineTo(this.a.d,t-5,i,t+1,i,u),this.a.t.lineTo(this.a.d,t-5,i,t-5,f,u),this.a.t.lineTo(this.a.d,t-5,f,r+5,f,u)):(this.a.d.beginPath(),this.a.d.moveTo(t+1,i),this.a.d.lineTo(t-5,i),this.a.d.lineTo(t-5,f),this.a.d.lineTo(r+5,f),this.a.d.stroke()):e?(this.a.t.lineTo(this.a.d,r-5,i,t+1,i,u),this.a.t.lineTo(this.a.d,r-5,i,r-5,f,u),this.a.t.lineTo(this.a.d,r-5,f,r+1,f,u)):(this.a.d.beginPath(),this.a.d.moveTo(t+1,i),this.a.d.lineTo(r-5,i),this.a.d.lineTo(r-5,f),this.a.d.lineTo(r+1,f),this.a.d.stroke()):t<r?e?(this.a.t.lineTo(this.a.d,t-5,i,t+1,i,u),this.a.t.lineTo(this.a.d,t-5,f,t-5,i,u),this.a.t.lineTo(this.a.d,t-5,f,r+5,f,u)):(this.a.d.beginPath(),this.a.d.moveTo(t+1,i),this.a.d.lineTo(t-5,i),this.a.d.lineTo(t-5,f),this.a.d.lineTo(r+5,f),this.a.d.stroke()):e?(this.a.t.lineTo(this.a.d,r-5,f,r+1,f,u),this.a.t.lineTo(this.a.d,r-5,f,r-5,i,u),this.a.t.lineTo(this.a.d,r-5,i,t+1,i,u)):(this.a.d.beginPath(),this.a.d.moveTo(r+1,f),this.a.d.lineTo(r-5,f),this.a.d.lineTo(r-5,i),this.a.d.lineTo(t+1,i),this.a.d.stroke()):1===n&&(i<f?t<r?e?(this.a.t.lineTo(this.a.d,r,f,r+5,f,u),this.a.t.lineTo(this.a.d,r+5,i,r+5,f,u),this.a.t.lineTo(this.a.d,t,i,r+5,i,u)):(this.a.d.beginPath(),this.a.d.moveTo(r,f),this.a.d.lineTo(r+5,f),this.a.d.lineTo(r+5,i),this.a.d.lineTo(t,i),this.a.d.stroke()):e?(this.a.t.lineTo(this.a.d,r,f,t+5,f,u),this.a.t.lineTo(this.a.d,t+5,i,t+5,f,u),this.a.t.lineTo(this.a.d,t,i,t+5,i,u)):(this.a.d.beginPath(),this.a.d.moveTo(r,f),this.a.d.lineTo(t+5,f),this.a.d.lineTo(t+5,i),this.a.d.lineTo(t,i),this.a.d.stroke()):t<r?e?(this.a.t.lineTo(this.a.d,t,i,r+5,i,u),this.a.t.lineTo(this.a.d,r+5,f,r+5,i,u),this.a.t.lineTo(this.a.d,r,f,r+5,f,u)):(this.a.d.beginPath(),this.a.d.moveTo(t,i),this.a.d.lineTo(r+5,i),this.a.d.lineTo(r+5,f),this.a.d.lineTo(r,f),this.a.d.stroke()):e?(this.a.t.lineTo(this.a.d,t,i,t+5,i,u),this.a.t.lineTo(this.a.d,t+5,f,t+5,i,u),this.a.t.lineTo(this.a.d,r,f,t+5,f,u)):(this.a.d.beginPath(),this.a.d.moveTo(t,i),this.a.d.lineTo(t+5,i),this.a.d.lineTo(t+5,f),this.a.d.lineTo(r,f),this.a.d.stroke()))},gk:function(n,t,i,r){this.a.g.enable&&n===this.a.g.b&&-1===this.a.g.c&&this.a.g.a===i&&(2*this.a.j<r&&(this.a.d.fillStyle="rgba(100,100,100,0.15)",this.a.Y?this.a.d.fillRect(0,r,this.a.r,this.a.G):this.a.d.fillRect(0,r-.5*this.a.G,this.a.r,this.a.j)),this.a.Jd=r+this.a.G);this.a.Ka.ua.g.enable&&this.a.Ka.ua.g.anchor.b===n&&void 0===this.a.Ka.ua.g.anchor.c&&-1===t&&this.a.Ka.ua.g.anchor.a===i?(2*this.a.j<r&&(this.a.d.fillStyle="rgba(100,100,100,0.15)",this.a.Y?this.a.d.fillRect(0,r,this.a.r,this.a.G):this.a.d.fillRect(0,(r-.5*this.a.G>>0)-.5,this.a.r,this.a.j+.5)),this.a.Jd=r+this.a.G):(this.a.la===i&&-1===this.a.xa&&this.a.ta===n||this.a.oa===i&&-1===this.a.qa&&this.a.X===n)&&!this.a.g.enable&&(2*this.a.j<r&&(this.a.d.fillStyle="rgba(100,100,100,0.15)",this.a.Y?this.a.d.fillRect(0,r,this.a.r,this.a.G):this.a.d.fillRect(0,r-.5*this.a.G,this.a.r,this.a.j)),this.a.Jd=r+this.a.G)},ik:function(n,t,i,r){this.a.g.enable&&n==this.a.g.b&&t==this.a.g.c&&this.a.g.a===i&&(2*this.a.j<r&&(this.a.d.fillStyle="rgba(100,100,100,0.15)",this.a.Y?this.a.d.fillRect(0,r,this.a.r,this.a.G):this.a.d.fillRect(0,(r-.5*this.a.G>>0)-.5,this.a.r,this.a.j+.5)),this.a.Jd=r+this.a.G);this.a.Ka.ua.g.enable&&this.a.Ka.ua.g.anchor.b===n&&this.a.Ka.ua.g.anchor.c===t&&this.a.Ka.ua.g.anchor.a===i?(2*this.a.j<r&&(this.a.d.fillStyle="rgba(100,100,100,0.15)",this.a.Y?this.a.d.fillRect(0,r,this.a.r,this.a.G):this.a.d.fillRect(0,(r-.5*this.a.G>>0)-.5,this.a.r,this.a.j+.5)),this.a.Jd=r+this.a.G):(this.a.la===i&&this.a.xa===t&&this.a.ta===n||this.a.oa===i&&this.a.qa===t&&this.a.X===n)&&!this.a.g.enable&&(2*this.a.j<r&&(this.a.d.fillStyle="rgba(100,100,100,0.15)",this.a.Y?this.a.d.fillRect(0,r,this.a.r,this.a.G):this.a.d.fillRect(0,(r-.5*this.a.G>>0)-.5,this.a.r,this.a.j+.5)),this.a.Jd=r+this.a.G)},hk:function(n,t,i,r){this.a.g.enable&&n==this.a.g.b&&t==this.a.g.c&&this.a.g.a===i&&2*this.a.j<r?(this.a.d.fillStyle="rgba(100,100,100,0.15)",this.a.Y?this.a.d.fillRect(0,r,this.a.r,this.a.G):this.a.d.fillRect(0,(r-.5*this.a.G>>0)-.5,this.a.r,this.a.j+.5)):this.a.Ka.ua.g.enable&&this.a.Ka.ua.g.anchor.b===n&&this.a.Ka.ua.g.anchor.c===t&&void 0===this.a.Ka.ua.g.anchor.a&&-1===i&&2*this.a.j<r?(this.a.d.fillStyle="rgba(100,100,100,0.15)",this.a.Y?this.a.d.fillRect(0,r,this.a.r,this.a.G):this.a.d.fillRect(0,(r-.5*this.a.G>>0)-.5,this.a.r,this.a.j+.5)):(this.a.v.l&&this.a.v.b===n&&this.a.v.c===t&&!this.a.v.Pd&&2*this.a.j<r&&!this.a.g.enable&&(this.a.d.fillStyle="rgba(100,100,100,0.15)",this.a.Y?this.a.d.fillRect(0,r,this.a.r,this.a.G):this.a.d.fillRect(0,(r-.5*this.a.G>>0)-.5,this.a.r,this.a.j+.5)),this.a.la===i&&this.a.xa===t&&this.a.ta===n&&!this.a.g.enable&&!this.a.sh&&2*this.a.j<r&&!this.a.g.enable&&(this.a.d.fillStyle="rgba(100,100,100,0.15)",this.a.Y?this.a.d.fillRect(0,r,this.a.r,this.a.G):this.a.d.fillRect(0,(r-.5*this.a.G>>0)-.5,this.a.r,this.a.j+.5)))}};yi.prototype={Ta:function(t,i,r,u){this.bk||(this.bound=t,this.direction=i,this.gc=r,this.wc="",this.sc={x:0,y:0},0<this.gc?(u&&(this.wc="+"),this.wc+=this.gc+" "+n.Gantt.Localize_strings.dayShort,this.sc.x=18*(0<this.wc.length),this.sc.y=10*(0<this.wc.length)):0>this.gc&&(u?this.wc="-":this.gc=Math.abs(this.gc),this.wc=this.gc+" "+n.Gantt.Localize_strings.dayShort,this.sc.x=18*(0<this.wc.length),this.sc.y=10*(0<this.wc.length)),this.W=i?{x:this.bound.x-12,y:this.bound.y-11-this.sc.y,u:24,C:25+this.sc.y}:{x:this.bound.x+11,y:this.bound.y-12,u:25+this.sc.x,C:24})},qb:function(n){this.link=n;this.a.$=!0},Uf:function(){this.a.t.mc(!0);this.direction?(this.a.t.oe(this.W.x-24,this.W.y-24,this.W.u+24,this.W.C+24,5),this.a.s.fillStyle="#83888D",this.a.s.lineWidth=1,this.a.s.beginPath(),this.a.s.moveTo(this.W.x>>0,this.W.y+12+this.sc.y>>0),this.a.s.lineTo(this.W.x+.5*this.W.u>>0,this.W.y+this.W.C>>0),this.a.s.lineTo(this.W.x+this.W.u+2>>0,this.W.y+12+this.sc.y>>0),this.a.s.lineTo(this.W.x+this.W.u+2>>0,this.W.y-12>>0),this.a.s.lineTo(this.W.x>>0,this.W.y-12>>0),this.a.s.closePath(),this.a.s.fill(),this.a.s.fillStyle="#FFFFFF",this.a.s.fillRect(this.bound.x-7>>0,(this.W.y+12>>0)-20,16,16),this.a.s.fillStyle="#83888D",this.a.s.beginPath(),this.a.t.ri(this.a.s,this.bound.x-7>>0,(this.W.y+12>>0)-20,16,16),this.a.s.closePath(),this.a.s.fill(),this.wc.length&&9999>=this.gc&&-9999<=this.gc&&(this.a.s.fillStyle="#FFFFFF",this.a.s.font=100>l(this.gc)?"7pt "+e:100<=l(this.gc)&&1e3>l(this.gc)?"6pt "+e:"5pt "+e,this.a.s.fillText(this.wc,this.W.x+.5*(this.W.u-this.a.s.measureText(this.wc).width),this.W.y+20.8))):(this.a.t.oe(this.W.x-24,this.W.y,this.W.u+24,this.W.C,5),this.a.s.fillStyle="#83888D",this.a.s.lineWidth=1,this.a.s.beginPath(),this.a.s.moveTo(this.W.x>>0,this.W.y>>0),this.a.s.lineTo(this.W.x-12>>0,this.W.y+.5*this.W.C>>0),this.a.s.lineTo(this.W.x>>0,this.W.y+this.W.C>>0),this.a.s.lineTo(this.W.x+36-11+this.sc.x>>0,this.W.y+this.W.C>>0),this.a.s.lineTo(this.W.x+36-11+this.sc.x>>0,this.W.y>>0),this.a.s.closePath(),this.a.s.fill(),this.a.s.fillStyle="#FFFFFF",this.a.s.fillRect(this.bound.x+14+this.sc.x>>0,this.W.y+4>>0,16,16),this.a.s.fillStyle="#83888D",this.a.s.beginPath(),this.a.t.ri(this.a.s,this.bound.x+14-.5+this.sc.x,this.W.y+4,16,16),this.a.s.closePath(),this.a.s.fill(),this.wc.length&&9999>=this.gc&&-9999<=this.gc&&(this.a.s.fillStyle="#FFFFFF",this.a.s.font=100>l(this.gc)?"7pt "+e:100<=l(this.gc)&&1e3>l(this.gc)?"6pt "+e:"5pt "+e,this.a.s.fillText(this.wc,this.W.x+.5*(this.W.C-this.a.s.measureText(this.wc).width)-5,this.W.y+15.2)))},reset:function(){this.bound={x:0,y:0,u:0,C:0};this.link=null},ge:function(){return 0<this.bound.u+this.bound.C},Pd:function(){this.bound={x:0,y:0,u:0,C:0};this.W={x:0,y:0,u:0,C:0};this.link=null;this.a.$=!0},re:function(n,t){if(this.direction){if(this.W.x>=n||n>=this.W.x+this.W.u||this.W.y-10>=t||t>=this.W.y+this.W.C)return!1}else if(this.W.x-20>n||n>this.W.x+this.W.u+7||this.W.y-2>t||t>this.W.y+this.W.C)return!1;return!0},onmousedown:function(n,t){if(this.Kc&&this.ge())if(this.direction){if(n>=this.bound.x-16&&n<=this.bound.x+16&&t<=this.W.y+16&&t>=this.W.y-16)return this.Kc(),!0}else if(n>=this.bound.x+14+this.sc.x&&n<=this.bound.x+14+16+this.sc.x&&t>=this.W.y+4&&t<=this.W.y+4+16)return this.Kc(),!0;return!1},onmousemove:function(n,t){if(this.ge()){if(this.direction){if(n>=this.W.x&&n<=this.W.x+this.W.u&&t>=this.W.y-15&&t<=this.W.y+this.W.C+7)return this.a.sa.style.cursor="pointer",!0}else if(n>=this.W.x-20&&n<=this.W.x+this.W.u&&t>=this.W.y&&t<=this.W.y+this.W.C)return this.a.sa.style.cursor="pointer",!0;this.Pd()}return!1}};pi.prototype={set:function(n,t,i,r){if(this.l){if(this.l.a.q==i.q){this.l.x=n;this.l.y=t;this.l.fill=r;return}this.l.a.vb=!1}this.l={x:n,y:t,a:i,fill:r}},tb:function(n){if(this.l){if(n&&this.l.a.q==n.q)return this.l.a.vb=!1,this.l=null,!1;this.l.a.vb=!1;n||(this.l=null)}return!0},Se:function(n,t){return this.bound.x>n||n>this.bound.x+this.bound.u||this.bound.y>t||t>this.bound.y+this.bound.C},Xg:function(n,t){return this.Ad.x<n&&n<this.Ad.x+this.Ad.u&&this.Ad.y<t&&t<this.Ad.y+this.Ad.C},gg:function(n){this.l&&n&&this.l.a.q==n.q&&(this.l.a.vb=!1,this.l=null)},Bh:V("href"),ge:function(){return null!==this.l}};bt.prototype={Pk:function(n,t){var i=this;n&&(this.canvas=n,this.d=n.getContext("2d"),this.r=this.d.canvas.width,this.U=this.d.canvas.height,this.Xc=this.d.canvas.getBoundingClientRect(),t&&(this.sa=t,this.s=this.sa.getContext("2d"),this.Ih=!1,this.sa.onmouseout=function(){i.Bb().Mg();i.Bb().fi();i.w.focus(!1);i.ta=-1;i.xa=-1;i.la=-1;i.ya();i.t.mc(!0);i.$=!0}),ti.src="../projects/app_themes/default/images/small-icons.png",this.oj=new ht(this),this.f=new li,this.L=new lt(this),this.Gd=new wt(this),this.Za=new pt(this),this.t=new k(this.d,this.s),this.ja=new ai(this),this.ec=new vi(this),(this.Ka=new ct(this,this.f,document.getElementById("ganttCanvasContainer")))&&this.Ka.zc(),this.Ha=null,this.Cc=!0)},Qk:function(){this.Ie=11;this.Ui=3;this.Rd=4;this.Wl=24;this.Ti=1;this.If=4;this.Si=20;this.nd=3;this.Zk=26},Sk:function(){var n=this;this.H={ze:0,Ae:0,b:-1,c:-1,a:-1,l:null,o:o,bound:{x:0,y:0,u:0,C:0},Df:{x:0,y:0,u:0,C:0},J:[],t:new k(n.s,null),ni:!1,set:function(n,t,i,r){this.l&&r&&this.l.q===r.q?this.bound=this.Df:(-1!==n&&-1!==i&&-1===t?(this.b=n,this.c=t,this.a=i):(-1!==n&&(this.b=n),-1!==t&&(this.c=t),-1!==i&&(this.a=i)),r&&(this.l=r,this.o=this.l.o,this.bound=this.Df))},Ta:function(n,t,i,r){this.Df={x:n,y:t,u:i,C:r}},tb:function(t,i){return this.bound.x>t||t>this.bound.x+this.bound.u||this.bound.y>i||i>this.bound.y+this.bound.C+n.G?(this.bound.u=0,this.bound.C=0,!1):!0},re:function(n,t){var i,r=this.bound.x+.5*this.bound.u;return i=o==this.o?48:18,r-i>n||n>r+i||this.bound.y>t||t>this.bound.y+this.bound.C?!1:!0},reset:function(){this.bound.u=0;this.bound.C=0;this.Df.u=0;this.Df.C=0;this.a=this.c=this.b=-1;this.l=null},Gc:function(n){this.J.push(n)},value:function(n,t,i,r){return i-this.bound.y<=(n.If+16)*n.zoom&&0<this.bound.u?(t-this.bound.x)/(this.bound.u/r>>0)>>0:-1},te:function(){var t,e,r;if(0<this.bound.u&&0<this.bound.C){t=96*n.zoom;this.o==i&&(t=36*n.zoom);e=this.bound.x+.5*this.bound.u-.5*t;n.s.fillStyle="#888d92";n.s.fillRect(e-7,this.bound.y+1,t+14,30);n.s.beginPath();n.s.moveTo(e+.5*t,this.bound.y+30+n.Rd*n.zoom+1);n.s.lineTo(e+.5*t-n.Rd*n.zoom,this.bound.y+30+1);n.s.lineTo(e+.5*t+n.Rd*n.zoom,this.bound.y+30+1);n.s.closePath();n.s.fill();for(var t=16*n.zoom,u=this.bound.y+7*n.zoom+1,o=this.o==i?2:5,f=0;f<o;++f)r=e-1+(n.Ti+f*n.Si)*n.zoom,n.s.fillStyle="#fafafa",n.s.fillRect(r,u,t,t),4===f?(n.s.fillStyle="#888d92",n.s.strokeStyle="#888d92",this.t.tk(r,u,t,t)):(n.s.fillStyle="#888d92",n.s.beginPath(),0===f?this.o==i?this.t.vi(r,u,t,t):this.t.ui(r,u,t,t):1===f&&(this.o==i?this.t.lg(r,u,t,t):this.t.si(r,u,t,t)),2===f&&this.t.lg(r,u,t,t),3===f&&this.t.qi(r,u,t,t),n.s.closePath(),n.s.fill());return!0}return!1},onmousemove:function(t,i){return 0===this.bound.u&&0===this.bound.C?!1:this.tb(t,i)?(n.sa.style.cursor="pointer",n.$=!0):!1},onmousedown:function(t,r){if((n.If+16)*n.zoom>=r-this.bound.y&&n.If*n.zoom<=r-this.bound.y&&0<this.bound.u){var u=(t-this.bound.x)/(this.bound.u/(this.o==i?2:5)>>0)>>0;return u<this.J.length&&0<=u&&this.J[u](this.b,this.c,-1),!0}return!1}};this.H.Gc(function(){if(i===n.H.l.o)n.Za.Hc("240",n.H.b,-1==n.H.c?void 0:n.H.c,n.H.a),n.H.reset();else{var t=n.f.A(n.H.b,-1==n.H.c?void 0:n.H.c,n.H.a);t&&n.Aa.gg(t);n.bj(n.H.b,-1===n.H.c?void 0:n.H.c,n.H.a)||n.mg(n.H.b,n.H.c,n.H.a);n.Cb();n.$=!0}});this.H.Gc(function(){i===n.H.l.o?n.Za.Hc("200",n.H.b,-1===n.H.c?void 0:n.H.c,n.H.a):n.cj(n.H.b,-1===n.H.c?void 0:n.H.c,n.H.a,n.H.bound.x+.5*n.H.bound.u);n.H.reset();n.Xa=!1});this.H.Gc(function(){n.Za.Hc("200",n.H.b,-1===n.H.c?void 0:n.H.c,n.H.a);n.H.reset();n.Xa=!1});this.H.Gc(function(){n.Za.Hc("240",n.H.b,-1==n.H.c?void 0:n.H.c,n.H.a);n.H.reset()});this.H.Gc(function(){i!==n.H.l.o&&n.J["350"]&&(n.J["350"](n.f.A(n.H.b,-1==n.H.c?void 0:n.H.c,n.H.a)),n.Cb(),n.$=!0)});this.v={ze:0,Ae:0,b:-1,c:-1,l:null,o:o,bound:{x:0,y:0,u:0,C:0},Pd:!0,J:[],t:new k(n.s,null),disable:!1,set:function(n,t,i){-1!==n&&(this.b=n);-1!==t&&(this.c=t);i&&(this.l=i,this.o=this.l.o)},tb:function(n,t){return this.bound.x>n||n>this.bound.x+this.bound.u||this.bound.y>t||t>this.bound.y+this.bound.C+10?(this.bound.u=0,this.bound.C=0,this.Pd=!0,!1):!0},reset:function(){this.bound.u=0;this.bound.C=0;this.a=this.c=this.b=-1;this.Pd=!0;this.l=null;this.o=o-1;this.disable=!1},Gc:function(n){this.J.push(n)},Ta:function(n,t,i,r){this.bound={x:n,y:t,u:i,C:r}},re:function(n,t){if(this.disable)return!1;var i,r=this.bound.x+.5*this.bound.u;return i=o-1==this.o?58:28,r-i>n||n>r+i||this.bound.y>t||t>this.bound.y+this.bound.C?!1:!0},te:function(){var t,e,r,u;if(0<this.bound.u&&0<this.bound.C&&!this.Pd&&!this.disable){t=116*n.zoom;this.o==i-1&&(t=56*n.zoom);e=this.bound.x+.5*this.bound.u-.5*t;r=30;n.s.fillStyle="#888d92";n.s.fillRect(e-7,this.bound.y+1,t+14,r);r+=7;n.s.beginPath();n.s.moveTo(e+.5*t,this.bound.y+r+1-n.Rd*n.zoom);n.s.lineTo(e+.5*t-n.Rd*n.zoom,this.bound.y+r+1-2*n.Rd*n.zoom);n.s.lineTo(e+.5*t+n.Rd*n.zoom,this.bound.y+r+1-2*n.Rd*n.zoom);n.s.closePath();n.s.fill();for(var t=16*n.zoom,r=this.bound.y+7*n.zoom+1,o=this.o==i-1?3:6,f=0;f<o;++f)u=e-1+(n.Ti+f*n.Si)*n.zoom,n.s.fillStyle="#fafafa",n.s.fillRect(u,r,t,t),n.s.fillStyle="#888d92",n.s.beginPath(),0===f?this.o==i-1?this.t.vi(u,r,t,t):this.t.ui(u,r,t,t):1===f&&(this.o==i-1?this.t.lg(u,r,t,t):this.t.si(u,r,t,t)),2===f&&(this.o==i-1?this.t.ih(u,r,t,t):this.t.lg(u,r,t,t)),3===f&&(this.o==i-1?this.t.ih(u,r,t,t):this.t.ek(u,r,t,t)),4===f&&this.t.ih(u,r,t,t),5==f&&this.t.qi(u,r,t,t),n.s.closePath(),n.s.fill();return!0}return!1},onmousemove:function(t,i){return this.disable?(n.sa.style.cursor="pointer",!1):0===this.bound.u&&0===this.bound.C?!1:this.tb(t,i)?(n.sa.style.cursor="pointer",n.$=!0):!1},onmousedown:function(t,r){if(this.disable)return!1;if((n.If+16)*n.zoom>=r-this.bound.y&&n.If*n.zoom<=r-this.bound.y&&0<this.bound.u){if(r<this.bound.y+6*n.zoom)return n.v.reset(),!1;var u=(t-this.bound.x)/((this.o==i-1?56:116)/(this.o==i-1?3:6)>>0)>>0;return u<this.J.length&&0<=u&&this.J[u](this.b,this.c,-1),!0}return!1}};this.v.Gc(function(){n.v.l.status()==o-1?(n.bj(n.v.b,-1===n.v.c?void 0:n.v.c,-1)||n.mg(n.v.b,n.v.c,-1),n.Cb()):n.Za.ae("260",n.v.b,n.v.c);n.Xa=!1;n.v.reset()});this.v.Gc(function(){n.v.l.status()==o-1?n.cj(n.v.b,n.v.c,n.v.a,n.v.bound.x+.5*n.v.bound.u):n.Za.ae("220",n.v.b,n.v.c,n.v.a);n.Xa=!1;n.v.reset()});this.v.Gc(function(){n.v.l.status()==o-1?n.Za.ae("220",n.v.b,n.v.c,n.v.a):n.Gd.Ng(n.v.b,n.v.c);n.Xa=!1;n.v.reset()});this.v.Gc(function(){n.v.l.status()==i-1?n.Gd.Ng(n.v.b,n.v.c):(n.Th(n.v.b,n.v.c),n.Cb());n.Xa=!1;n.v.reset()});this.v.Gc(function(){n.v.l.status()!=i-1&&(n.Gd.Ng(n.v.b,n.v.c),n.v.reset())});this.v.Gc(function(){n.Za.ae("260",n.v.b,n.v.c);n.Xa=!1;n.v.reset()});this.g=new fi(this);this.Aa=new pi(this);this.Tb={l:null,bound:{x:0,y:0,u:0,C:0},set:function(n,t,i,r){if(this.l){if(this.l.a.q==i.q){this.l.x=n;this.l.y=t;this.l.fill=r;return}this.l.a.vb=!1}this.l={x:n,y:t,a:i,fill:r}},tb:function(n){if(this.l){if(n&&this.l.a.q==n.q)return this.l.a.vb=!1,this.l=null,!1;this.l.a.vb=!1;n||(this.l=null)}return!0},Se:function(n,t){return this.bound.x>n||n>this.bound.x+this.bound.u||this.bound.y>t||t>this.bound.y+this.bound.C},gg:function(n){this.l&&n&&this.l.a.q==n.q&&(this.l.a.vb=!1,this.l=null)},ge:function(){return null!==this.l}};this.Va={enable:!0,b:-1,c:-1,ag:function(n,t){(n!=this.b||t!=this.c)&&(this.b=n,this.c=t,this.update=!0)},update:!1};this.Z=new yi(this);this.Z.Kc=function(){n.Za.Hc("280",this.link);this.Pd()};this.am=null},Rk:function(){this.w=new ei(this.d,this);this.wd=new oi(this.d,this);this.i=new ci(this,1);this.ia=null},focus:function(n,t){n||(this.wd.onmouseup(t),this.w.onmouseup(t),this.ia.releaseCapture(),this.onmouseup(t,!0),this.$=!0)},lc:W("Gd"),Cd:W("Za"),Gl:W("L"),Ll:W("oj"),Bb:W("Ka"),Dh:function(n){if(this.zoom=Math.max(.1,n),this.zoom=Math.min(8,this.zoom),this.G=18*this.zoom,this.j=30*this.zoom,this.Pi=0,this.Md=8*this.zoom,this.Kg=this.Md+"pt "+e,this.Ra=1.5*this.Md,this.i&&this.i.Dh(this.zoom),this.f){var t,r,i=this.f.b,u=i.length;for(n=0;n<u;++n){for(i[n].Mb=-1,t=i[n].c.length-1;0<=t;--t)for(i[n].c[t].update(),r=i[n].c[t].a.length-1;0<=r;--r)i[n].c[t].a[r].update();for(t=i[n].a.length-1;0<=t;--t)i[n].a[t].update()}this.Zd()}},wl:V("Ea"),update:function(){this.d&&(this.r=this.d.canvas.width,this.U=this.d.canvas.height,this.Xc=this.d.canvas.getBoundingClientRect(),this.Ka&&this.Ka.ua.ul(this.U),this.Y?(this.uc=.5*this.r,this.da=0):(this.da=this.Ka.ua.width,this.uc=.5*(this.r+this.da)));this.$=this.Jb=!0;this.i.update()},bg:function(){this.i&&this.i.Db(this.offsetX);this.update()},Zd:function(n){this.w.position=0;this.w.Gb=0;this.Ee=[];this.pd=[];n&&(this.vc=this.Ei(),this.Y||(this.vc+=this.j),n=this.U-this.i.height(),this.w.zc(this.i.height(),n,this.vc+!this.Y*this.j,this.r),this.w.di(),this.ia&&this.wd.Jh(this.ia.Qa),this.Xb=!this.Y*this.i.height(),this.Jb=!1);this.Jb=!0;this.update()},kj:function(){if(this.f)for(var t,i=this.f.b,r=i.length,n=0;n<r;++n)for(i[n].Mb=-1,t=0;t<i[n].c.length;++t)i[n].c[t].rb();this.Jb=!0;this.update()},yb:function(){this.$=!0;this.Ka&&this.Ka.Bc()},reset:function(){this.f.reset();this.L.reset()},ya:function(){this.H.reset();this.v.reset();this.Z.Ta({x:0,y:0,u:0,C:0})},Cb:function(){this.Tb.tb(null);this.Aa.tb(null)},Uf:function(){if(this.ia&&this.ia.Uf(),this.ja.update(),this.Kd(),this.ok(),this.ba&&200===this.Wa){if(this.ba.y<=this.Xb&&0<this.w.value()){if(.0001>=this.w.value())this.w.yl();else{var n=Math.max(w(this.w.value()/this.j)*this.j-this.j,.0001);this.ja.Ib(n)}this.t.mc(!0)}this.U-this.j<this.ba.y&&(n=(this.w.md()/this.j>>0)*this.j,n=Math.min(w((this.w.value()+this.j)/this.j)*this.j+this.j,n),this.ja.Ib(n),this.t.mc(!0))}},onmousemove:function(n,t){var r,h,f;if(this.td)if(f=!1,r=this.Fd(n.clientX,n.clientY),r.altKey=n.altKey,this.Bb().ua.width>=r.x)this.ya(),this.ba=r,this.ba.Sg=n;else if(!this.Bb().ua.g.enable&&(this.ba||(this.ba=r),this.ba.x!=r.x||this.ba.y!=r.y||t))if(this.ba=r,this.ba.Sg=n,this.ba.y<=this.Xb)this.Z.onmousemove(r.x,r.y),this.H.onmousemove(r.x,r.y),this.v.onmousemove(r.x,r.y),this.H.re(r.x,r.y)||this.Z.re(r.x,r.y)||(this.sa.style.cursor="",-1!==this.la&&(this.xa=this.la=-1,this.$=!0));else{if(this.Xa&&(this.bc.Id=!(r.x==this.bc.x&&r.y==this.bc.y)),!this.Xa){if(this.wd.onmousemove(r)||this.w.onmousemove(r))return;if(this.w.Ff(r)){this.la=this.xa=-1;this.ya();return}}if(300===this.Wa){if(!this.Ea&&!this.g.enable&&this.n){this.sa.style.cursor="pointer";this.n.update=!0;this.S=this.ba;this.M&&(this.M.I.links.pop(),this.M=void 0);var f=this.ta,r=this.xa,e=this.la,u=null,o;this.ee(n,!0,n.ctrlKey||n.metaKey);"w-resize"===this.sa.style.cursor&&(this.sa.style.cursor="pointer");this.n.parent=null;-1!=this.ta&&-1!=this.la&&-1===this.xa?(u=this.f.A(this.ta,void 0,this.la),u.o!==i&&this.xa===this.n.c?(this.n.parent=u,this.n.pb=this.Ba(this.n.parent.k)+.5*Math.abs(this.Ba(this.n.parent.m)-this.Ba(this.n.parent.k))>this.ba.x?-10:10,u.P&&(this.n.pb=-10),o=10===this.n.pb&&10===this.n.nb?1:-10===this.n.pb&&-10===this.n.nb?0:s,this.M={I:u},this.M.pa={},this.M.pa.dependenceTaskId=u.id(),this.M.pa.linkType=o,this.M.pa.parentTaskId=this.n.I.id(),this.M.pa.type="link",10===this.n.pb&&-10===this.n.nb?(this.M.pa.dependenceTaskId=this.n.I.id(),this.M.pa.parentTaskId=u.id(),this.M.I=this.n.I,this.n.I.links.push(this.M.pa)):-10===this.n.pb&&10===this.n.nb?u.links.push(this.M.pa):(this.M.pa.dependenceTaskId=this.n.I.id(),this.M.pa.parentTaskId=u.id(),this.M.I=this.n.I,this.n.I.links.push(this.M.pa)),this.Ha&&(this.Ha.I=u,this.Ha.bf=u.id(),this.Ha.vg=this.n.pb),this.n.gf=this.ta,this.n.ff=this.xa,this.n.Rf=this.la,this.Oi()?(o=10===this.n.pb&&10===this.n.nb?1:-10===this.n.pb&&-10===this.n.nb?0:s,this.M={I:u},this.M.pa={},this.M.pa.dependenceTaskId=u.id(),this.M.pa.linkType=o,this.M.pa.parentTaskId=this.n.I.id(),this.M.pa.type="link",10===this.n.pb&&-10===this.n.nb?(this.M.pa.dependenceTaskId=this.n.I.id(),this.M.pa.parentTaskId=u.id(),this.M.I=this.n.I,this.n.I.links.push(this.M.pa)):-10===this.n.pb&&10===this.n.nb?u.links.push(this.M.pa):(this.M.pa.dependenceTaskId=this.n.I.id(),this.M.pa.parentTaskId=u.id(),this.M.I=this.n.I,this.n.I.links.push(this.M.pa))):(this.n.gf=-1,this.n.ff=-1,this.n.Rf=-1,this.Ha&&(this.Ha.I=void 0,this.Ha.bf=void 0,this.Ha.vg=void 0),this.sa.style.cursor="")):this.sa.style.cursor=""):-1!=this.ta&&-1!=this.la&&-1!=this.xa?(u=this.f.A(this.ta,this.xa,this.la),u.o!==i&&this.xa===this.n.c?(this.n.parent=u,this.n.pb=this.Ba(this.n.parent.k)+.5*Math.abs(this.Ba(this.n.parent.m)-this.Ba(this.n.parent.k))>this.ba.x?-10:10,this.n.gf=this.ta,this.n.ff=this.xa,this.n.Rf=this.la,u.P&&(this.n.pb=-10),o=10===this.n.pb&&10===this.n.nb?1:-10===this.n.pb&&-10===this.n.nb?0:s,this.M={I:u},this.M.pa={},this.M.pa.dependenceTaskId=u.id(),this.M.pa.linkType=o,this.M.pa.parentTaskId=this.n.I.id(),this.M.pa.type="link",10===this.n.pb&&-10===this.n.nb?(this.M.pa.dependenceTaskId=this.n.I.id(),this.M.pa.parentTaskId=u.id(),this.M.I=this.n.I,this.n.I.links.push(this.M.pa)):-10===this.n.pb&&10===this.n.nb?u.links.push(this.M.pa):(this.M.pa.dependenceTaskId=this.n.I.id(),this.M.pa.parentTaskId=u.id(),this.M.I=this.n.I,this.n.I.links.push(this.M.pa)),this.Ha&&(this.Ha.I=u,this.Ha.bf=u.id(),this.Ha.vg=this.n.pb),this.Oi()?(this.M={I:u},this.M.pa={},this.M.pa.dependenceTaskId=u.id(),this.M.pa.linkType=o,this.M.pa.parentTaskId=this.n.I.id(),this.M.pa.type="link",10===this.n.pb&&-10===this.n.nb?(this.M.pa.dependenceTaskId=this.n.I.id(),this.M.pa.parentTaskId=u.id(),this.M.I=this.n.I,this.n.I.links.push(this.M.pa)):-10===this.n.pb&&10===this.n.nb?u.links.push(this.M.pa):(this.M.pa.dependenceTaskId=this.n.I.id(),this.M.pa.parentTaskId=u.id(),this.M.I=this.n.I,this.n.I.links.push(this.M.pa))):(this.n.gf=-1,this.n.ff=-1,this.n.Rf=-1,this.Ha&&(this.Ha.I=void 0,this.Ha.bf=void 0,this.Ha.vg=void 0),this.sa.style.cursor="")):this.sa.style.cursor=""):(this.n.gf=-1,this.n.ff=-1,this.n.Rf=-1,this.Ha&&(this.Ha.I=void 0,this.Ha.bf=void 0,this.Ha.vg=void 0),this.sa.style.cursor="");this.ta=f;this.xa=r;this.la=e;this.$=!0;return}}else if(200===this.Wa&&!this.Ea){this.S=r;this.ka.y=(r.y/this.j>>0)*this.j+.5*(this.j-this.G);this.Ii(n);this.Ih=!0;this.Bb().gd();return}if(this.Aa.l){if(this.Aa.Xg(r.x,r.y)){this.sa.style.cursor="pointer";return}if(this.sa.style.cursor="",!this.Ea&&!this.Aa.Se(r.x,r.y)){this.ya();this.sa.style.cursor="";return}}if(!this.Tb.l||this.Ea||this.Tb.Se(r.x,r.y))if(this.H.re(r.x,r.y))this.S=this.ba,this.$=!0,this.H.ni=!0,this.ta=this.H.b,this.xa=this.H.c,this.la=this.H.a,this.H.ni=!1,this.v.reset(),this.Z.reset(),this.H.onmousemove(r.x,r.y);else if(this.v.re(r.x,r.y))this.S=this.ba,this.$=!0,this.ee(n,!0,n.ctrlKey||n.metaKey),this.ta=this.H.b,this.xa=this.H.c,this.la=this.H.a,this.H.reset(),this.Z.reset(),this.v.onmousemove(r.x,r.y);else if(this.Z.re(r.x,r.y))this.S=this.ba,this.$=!0,this.v.reset(),this.H.reset(),this.Z.onmousemove(r.x,r.y);else if(this.g.enable&&!this.bd)this.g.onmousemove(r),this.sa.style.cursor=this.g.$b&&this.g.Yb&&5>Math.abs(r.x-(this.g.bound.x+this.g.bound.u))&&r.y>this.g.bound.y+this.g.bound.C&&r.y<this.g.bound.y+this.g.bound.C+this.j?"w-resize":(5>Math.abs(this.g.bound.x-r.x)||5>Math.abs(this.g.bound.x+this.g.bound.u-r.x))&&this.g.bound.y<=r.y&&r.y<=this.g.bound.y+this.g.bound.C?"w-resize":this.g.Ze(r.x,r.y)&&r.x>this.da||this.g.qe?"text":"";else if(f=this.i.fb,this.Xa){if(f=24,u=(r.x-this.i.R*this.offsetX)/(this.i.R*f)*f*this.i.B+this.Pc.x,e=this.Zf?(u/f>>0)*f:u,this.Yb)this.X=this.Yb.b,this.qa=this.Yb.c,this.oa=this.Yb.a,this.sb=10;else if(1===n.which&&!this.g.enable&&this.g.qe)return;if(o=.75*this.r,f=!1,-1!==this.X&&(f=0!==this.f.lb(this.X).status()),-1===this.X||-1===this.oa||-1!==this.qa||this.Ea||f){if(-1==this.X||-1==this.oa||-1===this.qa||this.Ea||f)-1==this.X||-1!==this.oa||-1===this.qa||this.Ea||f?(this.bd=!1,this.bd=n.buttons?2==n.buttons:2===n.button,this.offsetX+=(r.x-this.S.x)/this.i.R,this.offsetX=Math.max(this.offsetX,this.ia.cf()),this.offsetX=Math.min(this.offsetX,this.ia.df()),this.i&&this.i.Db(this.offsetX),this.zi&&this.w.nh(((r.y-this.S.y)/this.j>>0)*this.j-.0001),this.ia&&this.wd.Jh(this.ia.Qa)):(o=this.f.ma(this.X,this.qa))&&!o.Ac&&(0<=u&&(e+=24),o.Tc(e));else if(f=this.f.A(this.X,this.qa,this.oa),void 0!==f&&i!=f.o&&(!this.g.enable||this.g.Yb)){if(0!=this.S.y-r.y&&!this.Le&&!this.g.enable&&0===this.sb){u=this.i.R/this.i.B;r=f.duration*u;e=this.Pc.x*u;o=f.duration;h=this.S.x;f.P&&(o=-e/u,u=this.Ba(f.k),r=this.r-45,u>this.da-1?r=this.r-45-u:(r=.75*this.r-this.da,e=0,h=this.da));this.ka={x:h,y:this.S.y,width:r,height:this.G,Ld:0,Ic:e,time:o,ng:f.P};this.K={a:this.oa,c:this.qa,b:this.X};this.Ab=this.ta=this.xa=this.la=this.sb=this.X=this.qa=this.oa=-1;this.Xa=!1;this.$=!0;this.Wa=200;return}this.Le=!0;o=this.f.ma(this.X,this.qa);-10===this.sb?(0>=u&&(e-=24),f.Yd(e,o.m)):10===this.sb?(0<=u&&(e+=24),f.Tc(e),f.P=!1):(f.P&&f.Tc(o.m),f.Db(e),f.P=!1,this.Da&&this.Da&&(this.Da.right&&this.Da.right.ud(f,function(n,t){n&&t&&n.q!==t.q&&n.m>t.k&&(t.Db(n.m),t.change=!0)}),this.Da.left&&this.Da.left.ud(f,function(n,t){n&&t&&n.q!==t.q&&n.k<t.m&&(t.Db(n.k-(t.m-t.k)),t.change=!0)})));this.f.ma(this.X,this.qa).rb();this.bc.Id&&this.Aa.gg(f)}}else if(f=this.f.b[this.X].a[this.oa],void 0!==f&&i!=f.o&&(!this.g.enable||this.g.Yb)){if(0!=this.S.y-r.y&&!this.Le&&!this.g.enable&&0===this.sb){u=this.i.R/this.i.B;r=f.duration*u;e=this.Pc.x*u;o=f.duration;h=this.S.x;f.P&&(o=-e/u,u=this.Ba(f.k),r=this.r-45,u>this.da-1?r=this.r-45-u:(r=.75*this.r-this.da,e=0,h=this.da));this.ka={x:h,y:this.S.y,width:r,height:this.G,Ld:0,Ic:e,time:o,ng:f.P};this.K={a:this.oa,c:this.qa,b:this.X};this.Ab=this.ta=this.xa=this.la=this.sb=this.X=this.qa=this.oa=-1;this.Xa=!1;this.$=!0;this.Wa=200;return}this.Le=!0;-10===this.sb?(0>=u&&(e-=24),f.Yd(e)):(10===this.sb?(0<=u&&(e+=24),f.Tc(e)):(f.P&&(u=this.Ba(f.k),o=this.r-45,u<=this.da-1&&(o=.75*this.r),u=24*Math.floor(this.Nh(o)/24),f.Tc(u)),f.Db(e)),f.P=!1);this.Da&&this.Da&&(this.Da.right&&this.Da.right.ud(f,function(n,t){n&&t&&n.q!==t.q&&n.m>t.k&&(t.Db(n.m),t.change=!0)}),this.Da.left&&this.Da.left.ud(f,function(n,t){n&&t&&n.q!==t.q&&n.k<t.m&&(t.Db(n.k-(t.m-t.k)),t.change=!0)}));this.f.b[this.X].Ec();this.bc.Id&&this.Aa.gg(f)}this.S=r;this.$=!0;this.xa=this.la=-1;this.Tb.tb(null);this.Aa.tb(null);this.ya();this.ia&&(this.ia.Cc=!0)}else if(e=this.la,u=this.ta,this.ee(n,!0,n.ctrlKey||n.metaKey),this.S=this.ba,f=!1,-1!==this.ta&&(f=0!==this.f.lb(this.ta).status()),this.Ea)(e!=this.la||u!=this.ta||this.Va.update)&&(this.$=!0,this.Va.update=!1);else{if(0===this.Ab?(this.H.set(this.ta,this.xa,this.la,this.f.Ok(this.ta,this.xa,this.la),r.x,r.y),-1==this.ta&&this.H.reset(),-1!==this.Va.c&&this.v.set(this.Va.b,this.Va.c,this.f.ma(this.Va.b,this.Va.c)),-1===this.Va.b&&this.v.reset()):(-10===this.Ab||10===this.Ab)&&(this.H.reset(),this.v.reset(),i===this.H.o||f||(this.sa.style.cursor="w-resize")),-1===e&&-1===this.la)this.Z.onmousemove(r.x,r.y);this.H.onmousemove(r.x,r.y)&&this.Z.reset();this.v.onmousemove(r.x,r.y)&&this.Z.reset();e!=this.la||u!=this.ta||this.Va.update?(this.Va.update?this.sh||(this.Ka.Mg(this.Va.b,this.Va.c,void 0),-1!==this.Va.c&&this.v.set(this.Va.b,this.Va.c,this.f.ma(this.Va.b,this.Va.c))):this.g.enable?this.Ka.Mg(this.g.b,-1==this.g.c?void 0:this.g.c,-1==this.g.a?void 0:this.g.a):this.Ka.Mg(this.ta,-1==this.xa?void 0:this.xa,-1==this.la?void 0:this.la),this.$=!0,this.Va.update=!1):this.Bb().fi()}else this.ya(),this.sa.style.cursor=""}},onmousedown:function(n){var t,u;if(this.td)if(this.Le=!1,this.ja.stop(),this.ia&&this.ia.releaseCapture(),t=null,this.oa=-1,this.sb=0,this.V=this.Fd(n.clientX,n.clientY),this.bc={x:this.V.x,y:this.V.y,Id:!1},this.Ka.ua.g.enable)this.Ka.ua.g.Ze(n)||this.Ka.gd();else if(!this.wd.onmousedown(this.V)&&!this.w.onmousedown(this.V)){if(this.rh=0,this.S={x:this.V.x,y:this.V.y},this.Aa.l){if(!this.Aa.Se(this.bc.x,this.bc.y)){this.Aa.Xg(this.bc.x,this.bc.y)&&this.Aa.Bh("tasks.aspx?prjID="+this.Aa.l.a.Vc+"&id="+this.Aa.l.a.q);this.ya();this.sa.style.cursor="";return}this.$=!0}if(this.Tb.l&&!this.Tb.Se(this.bc.x,this.bc.y))this.ya(),this.sa.style.cursor="";else if(this.Xa=!0,n.buttons?this.bd=2==n.buttons:(this.bd=2===n.button,this.bd||(this.il=1===n.button)),!(this.Z.onmousedown(this.S.x,this.S.y)||this.H.onmousedown(this.S.x,this.S.y)||this.v.onmousedown(this.S.x,this.S.y)||this.ba.y<=this.Xb)){if(this.ee(n,!this.g.enable,n.ctrlKey||n.metaKey),this.g.enable){if(this.g.b===this.ta&&this.g.c===this.xa&&this.g.a===this.la){this.oa=this.la;this.qa=this.xa;this.X=this.ta;this.sb=this.Ab;this.g.onmousedown(this.S);return}if(-1!==this.g.b&&-1!==this.g.c&&-1===this.g.a&&(this.g.onmousedown(this.S),this.g.Ze(this.S.x,this.S.y)))return;this.g.onmousedown(this.S);if(this.g.qe){this.X=this.qa=this.oa=this.la=this.xa=this.ta=-1;return}}if(this.oa=this.la,this.qa=this.xa,this.X=this.ta,this.sb=this.Ab,this.Oa&&(this.T=this.Oa),this.Ha)this.qj()&&(this.Wa=300),this.$=!0;else if(-1===this.v.b&&-1===this.v.c&&this.bd&&-1===this.X&&-1===this.oa&&-1===this.qa)this.Pc={x:0,y:0},this.jb&&this.T||this.Oa?this.Za.Hc("280",this.Oa?this.Oa:this.T):this.g.enable||(this.Qe(n)?-1!==this.ca.b&&0===this.f.lb(this.ca.b).status()&&(t=this.ca.a+1,-1!==this.ca.c&&this.f.ma(this.ca.b,this.ca.c).Mc(!1),this.f.b[this.ca.b].Rb&&this.f.b[this.ca.b].Wf(!1),n.ctrlKey||n.metaKey?(this.yb(),this.Jb=!0,this.Kd(),this.Yj(this.ca.b,this.ca.Xh?this.ca.Xh:this.ca.c)):(this.f.b[this.ca.b].collapse&&-1===this.ca.c&&(this.f.b[this.ca.b].Mc(!1),this.yb(),this.Jb=!0,this.Kd()),this.ig(this.ca.b,this.ca.c,t),this.Yb={b:this.ca.b,c:this.ca.c,a:t})):this.V.y>this.Xb&&this.f.b.length&&0===this.f.lb(0).status()&&(this.f.b[0].Mc(!1),t=this.f.b[0].a.length,this.ig(0,-1,t),this.Yb={b:0,c:-1,a:t})),this.ya(),this.Cb();else if(n.ctrlKey||n.metaKey){if(-1!=this.X&&-1!=this.oa&&-1===this.qa&&(t=this.f.A(this.X,void 0,this.oa)),-1!=this.X&&-1!=this.oa&&-1!=this.qa&&(t=this.f.A(this.X,this.qa,this.oa)),t&&i!=t.o&&(n.ctrlKey||n.metaKey)){u=this.i.R/this.i.B;n=t.duration*u;var f=this.Pc.x*u,r=t.duration,o=this.S.x;t.P&&(r=-f/u,u=this.Ba(t.k),n=this.r-45,u>this.da-1?n=this.r-45-u:(n=.75*this.r-this.da,f=0,o=this.da));this.ka={x:o,y:this.S.y,width:n,height:this.G,Ld:0,Ic:f,time:r,ng:t.P};this.K={a:this.oa,c:this.qa,b:this.X};this.Ab=this.ta=this.xa=this.la=this.sb=this.X=this.qa=this.oa=-1;this.Xa=!1;this.$=!0;this.Wa=200}}else if(!this.g.enable){this.$=!0;var t=null,r=f=n=-1,e=[];-1===this.X||-1===this.oa||-1!==this.qa||this.Ea?-1==this.X||-1==this.oa||-1===this.qa||this.Ea?-1==this.X||-1!==this.oa||-1===this.qa||this.Ea?this.T&&(this.$=!0):(t=this.f.$c(this.X,this.qa),this.L.add(200,{b:this.X,c:this.qa,a:this.f.ma(this.X,this.qa),index:this.qa,ha:void 0,fa:t.c,ga:t.b,Nc:!0}),this.L.add(999,null)):(t=this.f.A(this.X,this.qa,this.oa),i!==t.o)&&(n=this.f.b[this.X].q,f=this.f.b[this.X].c[this.qa].q,r=this.f.b[this.X].c[this.qa].a[this.oa].q,(this.Da=this.Za.$g(this.X,this.qa,r))&&(this.Da.right&&this.Da.right.ud(t,function(n,t,i){i&&e.push(i)}),this.Da.left&&this.Da.left.ud(t,function(n,t,i){i&&e.push(i)})),this.L.Uh(100,{b:this.X,c:this.qa,a:t,index:this.oa,ha:r,fa:f,ga:n,Nc:!0,Da:e})):(t=this.f.b[this.X].a[this.oa],i!==t.o)&&(n=this.f.b[this.X].q,r=this.f.b[this.X].a[this.oa].q,(this.Da=this.Za.$g(this.X,void 0,r))&&(this.Da.right&&this.Da.right.ud(t,function(n,t,i){i&&e.push(i)}),this.Da.left&&this.Da.left.ud(t,function(n,t,i){i&&e.push(i)})),this.L.Uh(100,{b:this.X,c:void 0,a:t,index:this.oa,ha:r,fa:void 0,ga:n,Nc:!0,Da:e}))}}}},onmouseup:function(t,i){var u,r,f,e;if(this.td)if(this.Le=!1,u=!1,f=!1,e=this.bc.Id,this.Yb=null,this.Jf=!0,this.Xa=!1,this.V=this.Fd(t.clientX,t.clientY),this.rh)this.rh--,this.ya(),this.$=!0;else if(!(i||(this.Aa.l&&this.Aa.href&&!this.Aa.Se(this.V.x,this.V.y)&&this.Aa.Xg(this.V.x,this.V.y)&&(n.open(this.Aa.href),this.Aa.Bh(null)),this.Aa.Bh(null),this.bc.y<=this.Xb)))if(300===this.Wa)this.Vh(),this.v.b=-1,this.X=this.v.c=-1,this.Da=null,this.sb=this.X=this.qa=this.oa=-1;else if(200===this.Wa)this.t.mc(!0),this.Xi(t),this.yb();else if(this.g.enable)this.g.onmouseup(this.Fd(t.clientX,t.clientY));else if(this.v.reset(),this.H.reset(),this.g.qe&&3!==t.which)this.g.onmouseup(this.V);else{if(this.bc={x:this.V.x,y:this.V.y,Id:this.bc.Id},this.ee(t,!0),-1!==this.Va.b&&-1!==this.Va.c&&-1===this.la&&(this.ta=this.Va.b,this.xa=this.Va.c),this.xd&&(this.ja.Lc(this.f.A(this.xd.b,this.xd.c,this.xd.a).k),this.xd=null,this.ya(),this.sa.style.cursor=""),-1!==this.X&&-1!==this.oa&&-1!==this.qa){if(u=0!==this.f.lb(this.X).status(),r=this.f.A(this.X,this.qa,this.oa),this.bd&&!i&&!u){-1!==this.la&&this.J["502"]&&!this.Ea&&(this.Za.O={b:this.X,c:this.qa,a:this.oa,na:this.f.jc(this.X,this.qa,this.oa),fc:!0,I:r,l:r},u={left:t.clientX-this.d.canvas.offsetLeft,top:this.Jd+this.d.canvas.offsetTop},this.Cb(),this.J["502"](u,r,!0,this.f.lb(this.X).id()));this.v.b=-1;this.v.c=-1;this.Da=null;this.sb=this.X=this.qa=this.oa=-1;this.ya();this.Bb().gd();return}e?(this.L.Wh(),this.L.kc(!0,r,this.Da)):(this.Aa.tb(r)&&(r.vb=!r.vb,r.vb&&this.Tb.tb(null),f=!0),this.L.li());this.v.b=-1;this.v.c=-1;this.Da=null;this.Bb().kf(this.w.value())}if(-1!==this.X&&-1!==this.oa&&-1===this.qa){if(u=0!==this.f.lb(this.X).status(),r=this.f.A(this.X,void 0,this.oa),this.bd&&!i&&!u){-1!==this.la&&this.J["502"]&&!this.Ea&&(this.Za.O={b:this.X,c:void 0,a:this.oa,na:this.f.jc(this.X,void 0,this.oa),fc:!0,I:r,l:r},u={left:t.clientX-this.d.canvas.offsetLeft,top:this.Jd+this.d.canvas.offsetTop},this.Cb(),this.J["502"](u,r,!0,this.f.lb(this.X).id()));this.v.b=-1;this.v.c=-1;this.Da=null;this.sb=this.X=this.qa=this.oa=-1;this.ya();this.Bb().gd();return}e?(this.L.Wh(),this.L.kc(!0,r,this.Da)):(this.Aa.tb(r)&&(r.vb=!r.vb,r.vb&&this.Tb.tb(null),f=!0),this.L.li());this.v.b=-1;this.X=this.v.c=-1;this.Da=null;this.Bb().kf(this.w.value())}if(-1!==this.v.b&&-1!==this.v.c){if(u=0!==this.f.lb(this.v.b).status(),r=this.f.ma(this.v.b,this.v.c),this.bd&&!i&&!u){this.J["502"]&&!this.Ea&&(this.Za.O={b:this.v.b,c:this.v.c,a:void 0,na:this.f.$c(this.v.b,this.v.c),fc:!1,gb:r,l:r},u={left:t.clientX-this.d.canvas.offsetLeft,top:this.jd(this.v.b,this.v.c,-1)+this.d.canvas.offsetTop-this.w.value()},this.Cb(),this.J["502"](u,r,!1,this.f.lb(this.v.b).id()));this.v.b=-1;this.v.c=-1;this.Da=null;this.sb=this.X=this.qa=this.oa=-1;this.ya();this.Bb().gd();return}e||(r.vb=!r.vb,r.vb?this.Aa.tb(null):this.Tb.tb(null),f=!0);this.v.b=-1;this.v.c=-1;this.Bb().kf(this.w.value())}-1!==this.X&&-1===this.oa&&-1!==this.qa&&(e?this.L.Bi()&&this.L.kc(!0,this.f.ma(this.X,this.qa)):this.L.Bi()&&this.L.Qb(0),this.v.b=-1,this.v.c=-1,this.Bb().kf(this.w.value()));this.bc.Id&&(f=!0);this.oa=-1;this.sb=0;this.qa=-1;this.bc.Id=!0;this.Da=null;this.wd.onmouseup(t)||this.w.onmouseup(t)||(f||(this.Tb.tb(null),this.Aa.tb(null)),this.Jf=this.$=!0)}},ondblclick:function(n){if(this.td&&(this.Xa=!1,!n.ctrlKey&&!n.metaKey))if(this.g.enable)this.g.ondblclick(this.Fd(n.clientX,n.clientY));else this.ee(n),this.V=this.Fd(n.clientX,n.clientY),this.wd.onmousedown(this.V)||this.w.onmousedown(this.V)||-1!==this.xa&&-1!==this.la||this.H.tb(this.V.x,this.V.y)||this.v.tb(this.V.x,this.V.y)},onmousewheel:function(t){var r,u;if(this.td)if(r=0,300==this.Wa&&(r=this.w.value()),this.Cb(),t.altKey)200!==this.Wa&&(t=t||n.event,r=t.deltaY||t.detail||t.wheelDelta,t.deltaY&&(r*=-1),t.detail&&(r*=-1),this.dm(this.zoom-(r/Math.abs(r)>>0)),this.ee(t,!0),this.ia&&(this.ia.Cc=!0));else{if(u=!0,void 0!==t.wheelDeltaX){var i=0,f=this.ia.cf(),i=this.ia.df();0<t.wheelDeltaX&&(i-=this.offsetX,0<i&&(this.Cb(),this.ya(),this.t.mc(!0),this.sa.style.cursor="",i=Math.min(Math.abs(i),.1*(this.r/this.i.R)),this.ja.uf(-i)),u=!1);0>t.wheelDeltaX&&(i=f-this.offsetX,0>i&&(this.Cb(),this.ya(),this.t.mc(!0),this.sa.style.cursor="",i=Math.min(Math.abs(i),.1*(this.r/this.i.R)),this.ja.uf(i)),u=!1)}if(u)this.w.onmousewheel(t);300==this.Wa&&(this.n.Ce+=r-this.w.value());this.ee(t,!0);this.Z.qb(this.Oa);t=this.Fd(t.clientX,t.clientY);this.H.set(this.ta,this.xa,this.la);0<this.H.bound.u&&0<this.H.bound.C&&this.H.tb(t.x,t.y);0<this.v.bound.u&&0<this.v.bound.C&&this.v.tb(t.x,t.y)}},onkeypress:function(t){if(this.td)if(this.g.enable)this.g.onkeypress(t);else if(!this.Ka.ua.g.enable){t=n.event||t;var i=t.keyCode?t.keyCode:t.which?t.which:t.charCode;(t.ctrlKey||t.metaKey)&&26==i&&this.L.ij();(t.ctrlKey||t.metaKey)&&25==i&&this.L.$i()}},onkeydown:function(t){var f;if(this.td)if(this.g.enable)this.g.onkeydown(t);else if(!this.Ka.ua.g.enable){t=n.event||t;f=t.keyCode?t.keyCode:t.which?t.which:t.charCode;this.dh=0;var r=!1,i=0,u=(this.w.md()/this.j>>0)*this.j,i=0,i=this.ia.cf(),e=this.ia.df();switch(f){case 191:(t.ctrlKey||t.metaKey)&&t.shiftKey&&(this.zh=!this.zh,this.$=!0);break;case 40:r=!0;i=this.Y?this.w.value()+40:((this.w.value()+this.j)/this.j+.5>>0)*this.j-.0001;this.ja.Ib(Math.min(i,u-.0001),void 0,!this.Y);break;case 38:r=!0;i=this.Y?this.w.value()-40:((this.w.value()-this.j)/this.j+.5>>0)*this.j-.0001;this.ja.Ib(Math.max(i,.0001),void 0,!this.Y);break;case 33:r=!0;this.Y?this.ja.Ib(Math.max(this.w.Wg(1)*this.w.step,.0001)):(u=this.w.value(),t=(this.U-this.i.height())/this.j+.5,i=((u-(t>>0)*this.j)/this.j>>0)*this.j-.0001,this.ja.Ib(Math.max(i,.0001)));break;case 34:r=!0;this.Y?this.ja.Ib(Math.min(this.w.Wg(-1)*this.w.step,this.w.md()-.0001)):(t=this.w.value(),f=(this.U-this.i.height())/this.j+.5,i=((t+(f>>0)*this.j)/this.j>>0)*this.j-.0001,this.ja.Ib(Math.min(i,u-.0001)));break;case 36:r=!0;this.w.Zi(1,"end");break;case 35:r=!0;this.Y?this.w.Zi(-1,"home"):this.ja.Ib(u-.0001,void 0,!0);break;case 37:if(i=e-this.offsetX,0<i){if(200===this.Wa)return;this.Cb();this.ya();this.t.mc(!0);this.sa.style.cursor="";i=Math.min(Math.abs(i),.1*(this.r/this.i.R));this.ja.uf(-i)}break;case 39:if(i-=this.offsetX,0>i){if(200===this.Wa)return;this.Cb();this.ya();this.t.mc(!0);this.sa.style.cursor="";i=Math.min(Math.abs(i),.1*(this.r/this.i.R));this.ja.uf(i)}}r&&(this.ya(),this.Cb(),this.Te=!0)}},onkeyup:function(n){this.td&&(this.Ea||n.ctrlKey||n.metaKey||this.Vh())},onpaste:function(n){if(this.td&&this.g.enable)this.g.onpaste(n)},oncopy:function(n){if(this.td&&this.g.enable)this.g.oncopy(n)},Kd:function(n){if(this.$&&(this.$=!1,this.d)){if(this.r=this.d.canvas.width,this.U=this.d.canvas.height,this.Xc=this.d.canvas.getBoundingClientRect(),this.Y?(this.uc=.5*this.r,this.da=0):(this.da=this.Ka.ua.width,this.uc=.5*(this.r+this.da)),this.Dc=this.i.R/this.i.B,this.ye=this.i.R*this.offsetX,this.Jb){this.vc=this.Ei();this.Y||(this.vc+=this.j);var t=this.U-this.i.height();this.w.zc(this.i.height(),t,this.vc+!this.Y*this.j,this.r);this.w.di();this.Xb=!this.Y*this.i.height();this.Jb=!1;this.Ka&&this.Ka.kf(this.w.value())}this.ia&&this.wd.Jh(this.ia.Qa,this.r,this.U);this.i.refresh();this.d.clearRect(0,0,this.r,this.U);this.Dc=this.i.R/this.i.B;this.ye=this.i.R*this.offsetX;this.scrollY=this.w.value()>>0;this.Ek();this.i.vk();this.i.te();this.pk();this.lk();this.Fk();this.Y&&(this.d.save(),this.d.rect(0,this.i.height()+2*this.Pi,this.r,this.U),this.d.clip());this.Bk();this.Y&&this.d.restore();this.Ak();void 0===n&&(this.w.refresh(),this.wd.refresh());1<this.d.canvas.width-this.r&&(this.d.fillStyle="#ffffff",this.d.fillRect(this.r,0,this.d.canvas.width-this.r,this.U));this.Jl();this.Rh&&(this.d.fillStyle="rgba(255,255,255,0.7)",this.d.fillRect(0,0,this.r,this.U));this.zh&&(this.d.font="Bold 10pt "+e,this.d.fillStyle="#000000",this.d.fillText("v1.0.1.205",this.r-70,this.U-15))}},Bk:function(){var n,t,r,i,u,f;for(t=this.i.height()>>0,r=this.w.value()>>0,this.d.font=this.Kg,this.ec.hl(),this.g.Tg=!1,this.Ee=[],i=this.f.b,u=i.length,n=0;n<u;++n)if(f=i[n].a.length,this.Ee.push(t-r+.5*this.j),t+=this.j,!i[n].Rb){if(this.d.strokeStyle="#CCCCCC",this.d.lineWidth=1,t+=.5*(this.j-this.G),t=n===this.X?this.wi(i[n],t,this.oa,r,n):this.wi(i[n],t,-1,r,n),t-r>this.U)break;t-=.5*(this.j-this.G);0===f&&(t+=this.j)}this.g.Tg||this.g.Ta(0,0,0,0,!0)},wi:function(n,t,i,r,u){var f,o,s=!1,c=!1,e=n.c,h,l=e.length;for(i=0;i<l;++i)if(o=e[i].a.length,!e[i].filter){for(h=o,f=o-1;0<=f;--f)e[i].a[f].filter&&--h;if(this.ec.hk(u,i,-1,t-r+3),this.ec.xk(e[i],t,u,i,h),t-r>this.U){c=!0;break}if(t+=this.j,0<t-r+o*this.j&&t-r<this.U&&(!this.Y&&!e[i].collapse||this.Y)&&this.ec.ti(e[i].a,this.ye,t,r),0===o&&this.Y&&(t+=this.j),this.Y||!e[i].collapse)for(f=0;f<o;++f)e[i].a[f].filter||(this.ec.ik(u,i,f,t-r+3),this.ec.yi(e[i].a[f],t,s,u,i,f,e[i].a),t+=this.j)}if(c)return t;if(o=n.a.length){if(i=-1,this.Y&&(t+=this.G),s=!0,!this.Y&&(t+=this.j,n.collapse))return t;for(t-r<this.U&&(!this.Y&&!n.collapse||this.Y)&&this.ec.ti(n.a,this.ye,t,r),f=0;f<o;++f)n.a[f].filter||(this.ec.gk(u,i,f,t-r+3),this.ec.yi(n.a[f],t,s,u,i,f,n.a),t+=this.j)}return t},Ak:function(){function f(n,i,r){var u,o,e;if(!n||0===n.length)return{Bd:[],width:0};if(i||(i=n),u=[],o=0,i=Math.max(t.d.measureText(n).width,t.d.measureText(i).width)/t.zoom,i>b){i=i>2*st?st:b;var s=[],f="",c=n.length,h=0;for(e=0;e<c;++e)"\n"===n[e]&&(s.push(n.slice(h,e)),s.push("\n"),++e,h=e)," "===n[e]&&h!==e&&(s.push(n.slice(h,e)),h=e),e==c-1&&h!==e&&s.push(n.slice(h,e+1));for(c=s.length,n=0;n<c;++n){if(e=f+s[n],h=t.d.measureText(e).width/t.zoom,t.d.measureText(s[n]).width/t.zoom>i){f=s[n].slice(0,25).replace(/^\s+/,"")+"...";u.push(f);o=Math.max(t.d.measureText(f).width/t.zoom,o);break}if("\n"===s[n])f=f.replace(/^\s+/,""),u.push(f),o=Math.max(t.d.measureText(f).width/t.zoom,o),f="";else if(h>i?(f=f.replace(/^\s+/,""),u.push(f),o=Math.max(t.d.measureText(f).width/t.zoom,o),f=s[n]):f=e,n==c-1&&(f=f.replace(/^\s+/,""),u.push(f),o=Math.max(t.d.measureText(f).width/t.zoom,o)),u.length>r-1&&-1!==r){2<u[u.length-1].length&&" "==u[u.length-1][u[u.length-1].length-2]&&(u[u.length-1]=u[u.length-1].slice(0,-2));u.push("...");break}}}else u.push(n),o=b;return o+=2*t.Ie,{Bd:u,width:o*t.zoom}}function e(){var f=wi==i.fill,h=kt==i.fill;i.x=Math.max(t.da+(0<t.da?5:0),i.x);var o=i.x+t.Ie*t.zoom,r=Math.max(i.a.Xd.width,i.a.nc.width),e=i.a.Xd.Bd.length*t.Ra,e=e+i.a.nc.Bd.length*t.Ra,e=e+.5*t.Ra,s=i.a.gj();f&&(e+=t.Ra);i.a.Of&&i.a.Of.length&&(e+=1.5*t.Ra);s&&(e+=1.5*t.Ra);var e=e+1.5*t.Ra,e=e+1.5*t.Ra,e=e+2.2*t.Ra,e=e/t.zoom,c=i.a.mh()+" - "+i.a.pg();for(0<i.a.m&&!h&&(c+=" ("+n.Gantt.Localize_strings.statusOpenTask+")"),h&&(c+=" ("+n.Gantt.Localize_strings.statusClosedTask+")"),r=Math.max((t.d.measureText(c).width+2*t.Ie)*t.zoom,r),h="",f&&(h=n.Gantt.Localize_strings.taskOverdueText.format(i.a.ki()),r=Math.max((t.d.measureText(h).width+2*t.Ie)*t.zoom,r)),t.Aa.bound.x=Math.max(1,i.x),t.Aa.bound.y=i.y,t.Aa.bound.u=r,t.Aa.bound.C=e,t.d.fillStyle=ot,t.d.fillRect(i.x,i.y,r,e*t.zoom),t.d.strokeStyle=i.fill,t.d.lineWidth=1,t.d.strokeRect(Math.floor(i.x)+.5,Math.floor(i.y)+.5,Math.floor(r),Math.floor(e*t.zoom+1)),t.d.fillStyle="#000000",t.d.strokeStyle="#000000",r=i.y+t.Ra+1,u=0;u<i.a.Xd.Bd.length;++u)t.d.fillText(i.a.Xd.Bd[u],i.x+t.Ie*t.zoom,r),r+=t.Ra;for(r+=.5*t.Ra,t.d.fillStyle=f?i.fill:"#000000",t.d.fillText(c,o,r),f&&(r+=t.Ra,t.d.fillText(h,o,r)),t.d.fillStyle=ii,s&&(r+=1.5*t.Ra,t.d.fillText(s+" "+(1==s?n.Gantt.Localize_strings.taskDescSubtask:n.Gantt.Localize_strings.taskDescSubtasks),o,r)),r+=1.5*t.Ra,f=i.a.$a.length,0<f?(s=i.a.Of,s=1<f?n.Gantt.Localize_strings.responsibles.format(f):n.Encoder.htmlDecode(i.a.$a[0].displayName),t.d.fillText(s,o,r)):t.d.fillText(n.Gantt.Localize_strings.noResponsible,o,r),r+=1.5*t.Ra,u=0;u<i.a.nc.Bd.length;++u)t.d.fillText(i.a.nc.Bd[u],o,r),r+=t.Ra;r+=.5*t.Ra;f=n.Gantt.Localize_strings.details;t.d.fillText(f,o,r);t.d.beginPath();t.d.strokeStyle=ri;t.d.lineWidth=Math.floor(t.zoom);t.d.moveTo(Math.floor(o)+.5,Math.floor(r+.15*t.Ra)+.5);t.d.lineTo(Math.floor(o+t.d.measureText(f).width)+.5,Math.floor(r+.15*t.Ra)+.5);t.d.stroke();t.Aa.Ad.x=o;t.Aa.Ad.y=r-14;t.Aa.Ad.u=t.d.measureText(f).width;t.Aa.Ad.C=14}function o(){var o=dt===r.fill,s=ut===r.fill,i=Math.max(r.a.nc.width,b*t.zoom);r.x=Math.min(r.x,t.r-5);var e=r.x+t.Ie*t.zoom-i,f=r.a.nc.Bd.length*t.Ra,f=f+.5*t.Ra;for(r.a.a.length&&(f+=1.25*t.Ra),r.a.$a&&(f+=1.5*t.Ra),f+=2*t.Ra,t.Tb.bound.x=r.x-i,t.Tb.bound.y=r.y,t.Tb.bound.u=i,t.Tb.bound.C=f,t.d.fillStyle=ot,t.d.fillRect(r.x,r.y,-i,f),t.d.strokeStyle=r.fill,t.d.lineWidth=1,t.d.strokeRect(Math.floor(r.x)+.5,Math.floor(r.y)+.5,-Math.floor(i),Math.floor(f+1)),i=r.y+1.25*t.Ra,f=r.a.pg(),0<r.a.m&&!s&&(f+=" ("+n.Gantt.Localize_strings.statusOpenMilestone+")"),s&&(f+=" ("+n.Gantt.Localize_strings.statusClosedMilestone+")"),t.d.fillStyle=o?r.fill:"#000000",o&&(f+=" ("+n.Gantt.Localize_strings.overdue+")"),t.d.fillText(f,e,i),r.a.a.length&&(i+=1.25*t.Ra,t.d.fillStyle=t.Ml,t.d.fillText(r.a.a.length+" "+n.Gantt.Localize_strings.tasks,e,i)),t.d.fillStyle=t.Ml,r.a.$a&&(i+=1.5*t.Ra,t.d.fillText(n.Encoder.htmlDecode(r.a.$a.displayName),e,i)),i+=1.5*t.Ra,u=0;u<r.a.nc.Bd.length;++u)t.d.fillText(r.a.nc.Bd[u],e,i),i+=t.Ra}var t=this,u=0,i=this.Aa.l,r;i&&(null==i.a.Xd&&(i.a.Xd=f(i.a.Q,i.a.dc,10)),null==i.a.nc&&(i.a.nc=f(i.a.dc,i.a.Q,10)),e());r=this.Tb.l;r&&(null==r.a.nc&&(r.a.nc=f(r.a.dc,-1)),o())},lk:function(){if(3===this.i.Kb){var n=(this.Ba(0)>>0)+.5;this.t.uk(n,0,n,this.U,"#97b8fa",1)}},pk:function(){var r,u;if(!this.Y){var n=this.w.value()%this.j,t=this.i.height()-n,i=this.vc-this.w.value();if(i<t)this.d.beginPath(),this.d.strokeStyle="#CCCCCC",this.d.lineWidth=1,this.d.moveTo(0,this.j+.5),this.d.lineTo(this.r,this.j+.5),this.d.moveTo(0,2*this.j+.5),this.d.lineTo(this.r,2*this.j+.5),this.d.stroke();else{for(this.Ee.length!==this.f.b.length&&(this.$=!0),r=n=0,this.pd=[],this.d.beginPath(),this.d.strokeStyle="#CCCCCC",this.d.lineWidth=1;t<=this.U;t+=this.j)if(n=(t>>0)+.5,n<this.Xb)r=n;else{for(this.d.moveTo(.5,n),this.d.lineTo(this.r+.5,n),u=this.Ee.length-1;0<=u;--u)if(this.Ee[u]>r&&this.Ee[u]<n){this.pd.push(r);break}if(r=n,i<t)break}if(this.d.stroke(),this.d.beginPath(),this.d.strokeStyle="#CCCCCC",this.d.lineWidth=1,this.d.moveTo(0,this.j+.5),this.d.lineTo(this.r,this.j+.5),this.d.moveTo(0,2*this.j+.5),this.d.lineTo(this.r,2*this.j+.5),this.d.stroke(),1!==this.i.Kb)for(this.d.fillStyle="#ffffff",t=this.j,i=this.pd.length-1;0<=i;--i)n=this.pd[i]+1,this.pd[i]>2*t?this.d.fillRect(0,n,this.r,t-2):this.pd[i]>=t&&this.d.fillRect(0,2*t+1,this.r,n-t-2)}}},Ek:function(){var t=this.i.lj(),n;if(t){if(n=-1,n=this.i.R*this.offsetX,1===this.i.xb&&3!==this.i.Kb){var i=this.j,r=this.U-i,u=this.r/t.hc+2,f=(n/t.hc-(n/t.hc>>0))*t.hc+t.x;for(this.d.fillStyle="#FFF5EB",n=-1;n<u;++n)this.d.fillRect(f+n*t.hc,i,t.width,r)}n=(this.Ba(0)>>0)+.5;this.d.fillStyle="#EFF5FF";this.d.fillRect(n,this.j,t.width/2,this.U-this.j)}},Fk:function(){var n=this.i.lj(),t,f;if(n&&(t=-1,t=this.i.R*this.offsetX,1===this.i.xb&&3!==this.i.Kb)){var i=this.U,r=this.r/n.hc+2,u=(t/n.hc-(t/n.hc>>0))*n.hc+n.x;for(this.d.lineWidth=1,this.d.strokeStyle="#CCCCCC",this.d.beginPath(),t=-1;t<r;++t)this.d.moveTo((u+t*n.hc>>0)+.5,this.j>>0),this.d.lineTo((u+t*n.hc>>0)+.5,i>>0),this.d.moveTo((u+t*n.hc+n.width>>0)+.5,(this.j>>0)+.5),this.d.lineTo((u+t*n.hc+n.width>>0)+.5,(i>>0)+.5);for(this.d.stroke(),this.d.lineWidth=1,this.d.strokeStyle="#CCCCCC",this.d.beginPath(),t=-1;t<r;++t)for(f=3;7>f;++f)5!==f&&(this.d.moveTo((u+t*n.hc+.5*n.width*f>>0)+.5,this.j>>0),this.d.lineTo((u+t*n.hc+.5*n.width*f>>0)+.5,i>>0),this.d.moveTo((u+t*n.hc+n.width+.5*n.width*f>>0)+.5,(this.j>>0)+.5),this.d.lineTo((u+t*n.hc+n.width+.5*n.width*f>>0)+.5,(i>>0)+.5));for(this.d.stroke(),this.d.fillStyle="#ffffff",n=this.j,i=0,r=this.pd.length-1;0<=r;--r)i=this.pd[r]+1,this.pd[r]>2*n?this.d.fillRect(0,i,this.r,n-2):this.pd[r]>=n&&this.d.fillRect(0,2*n+1,this.r,i-n-2)}},ok:function(){if(this.Te){if(this.ba)this.onmousemove(this.ba.Sg,!0);this.Te=!1}this.g.enable?(this.t.mc(!0),this.g.te(),this.t.pj(this.g.bound,10*this.zoom)):300===this.Wa?this.wk():200===this.Wa?this.nk():this.zk()},nk:function(){function t(){if(n.ka.ng){n.s.fillStyle=ki;n.s.strokeStyle=n.va.b===n.K.b?di:gi;n.s.lineWidth=1;n.ka.x+n.ka.Ic<=n.da&&(n.ka.width=n.ka.width+n.ka.x+n.ka.Ic-n.da,n.ka.x=n.da,n.ka.Ic=0);var t=(n.ka.x+n.ka.Ic>>0)+.5,i=(n.ka.y+n.ka.Ld>>0)+.5;n.s.beginPath();n.s.moveTo(t,i);n.s.lineTo(t+n.ka.width,i);n.s.lineTo(t+n.ka.width,i+.5*n.ka.height);n.s.lineTo(t+n.ka.width,i+n.ka.height);n.s.lineTo(t,i+n.ka.height);n.s.closePath();n.s.fill();n.s.stroke();n.s.drawImage(n.ec.ph,t+n.ka.width+4,i+2)}else n.ka.x+n.ka.Ic<=n.da&&(n.ka.width=n.ka.width+n.ka.x+n.ka.Ic-n.da,n.ka.x=n.da,n.ka.Ic=0),n.s.fillStyle=ki,n.s.fillRect(n.ka.x+n.ka.Ic,n.ka.y+n.ka.Ld,n.ka.width,n.ka.height),n.s.strokeStyle=n.va.b===n.K.b?di:gi,n.s.lineWidth=1,n.s.strokeRect((n.ka.x+n.ka.Ic>>0)+.5,(n.ka.y+n.ka.Ld>>0)+.5,n.ka.width>>0,n.ka.height>>0);n.t.oe(n.ka.x+n.ka.Ic,n.ka.y+n.ka.Ld,n.ka.width,n.ka.height,20)}function i(){var u;if(!n.ja.Vk())for(var e,o,h,f=n.j,i=Math.floor(n.i.height()),c=Math.floor(n.da),l=Math.floor(n.i.height()+2*n.Pi),r=n.f.b,s=r.length,t=0;t<s;++t)if(r[t].Rb)i+=f;else if(r[t].kd())i+=2*f;else{for(i+=f,e=r[t].c.length,u=0;u<e;++u)if(!r[t].c[u].filter){for(h=o=r[t].c[u].a.length,o-=1;0<=o;--o)r[t].c[u].a[o].filter&&--h;if(t===n.va.b&&u===n.va.c){if(1===r[t].c[u].o||n.va.b!==n.K.b)return;e=n.ye+r[t].c[u].k*n.Dc;s=r[t].c[u].duration*n.Dc;i=Math.floor(i-n.scrollY+n.G-n.nd*n.zoom);o=0!==r[t].c[u].a.length?(h+.5)*f:.5*f;o=r[t].c[u].collapse?.5*f:0!==h?(h+.5)*f:.5*f;n.Va.enable||(n.s.fillStyle=bi,n.s.fillRect(e,i+n.G,s,o));e<c&&(s-=c-e,e=c);e+s>c&&(n.s.strokeStyle=rr,n.s.lineWidth=1,n.s.beginPath(),n.s.moveTo(Math.floor(e)+.5,Math.max(l,i-n.nd*n.zoom+.5)),n.s.lineTo(Math.floor(e)+.5,i+Math.floor(o)+.5),n.s.lineTo(Math.floor(e+s)+.5,i+Math.floor(o)+.5),n.s.lineTo(Math.floor(e+s)+.5,Math.max(l,i-n.nd*n.zoom+.5)),n.s.stroke(),n.t.oe(e,i,s,o,f));return}i+=f;r[t].c[u].collapse||(i+=f*h)}if(r[t].collapse)i+=f;else{if(r[t].a.length)for(i+=f,u=r[t].a.length-1;0<=u;--u)r[t].a[u].filter||(i+=f);else i+=f;if(i-n.scrollY>n.U)break}}}var n=this;this.Ih&&(this.t.mc(!0),i(),t(),this.Ih=!1)},zk:function(){if(this.t.mc(!0),!this.Ea){if(-1!==this.la&&0===this.Ab&&this.H.Ta(Math.floor(this.H.ze-48*this.zoom),Math.floor(this.H.Ae)-35*this.zoom,96*this.zoom,35*this.zoom),-1!==this.v.c&&-1!==this.v.b){var n=this.v.l.o==i-1?56:116;this.v.Ta(this.v.ze-.5*n*this.zoom>>0,(this.v.Ae>>0)-(37+2*this.Ui)*this.zoom,n*this.zoom,(30+2*this.Ui)*this.zoom)}this.Z.ge()?this.Z.Uf():(this.t.mc(!0),this.H.te()&&this.t.oe(this.H.bound.x,this.H.bound.y,this.H.bound.u,this.H.bound.C,10*this.zoom),this.v.te()&&this.t.oe(this.v.bound.x,this.v.bound.y,this.v.bound.u,this.v.bound.C,10*this.zoom))}},wk:function(){if(this.n&&this.n.update){if(this.t.mc(!0),!this.M){var t,i,o=.5*this.G,r=this.G,u=this.S.x,f=this.S.y,e=this.n.Sa,n=this.n.Ce+1;this.s.lineWidth=2;this.s.strokeStyle="#24547E";-10===this.n.nb&&(u<e?(this.t.Qc(this.s,u-.5>>0,n>>0,e+.5>>0,n>>0,[6,2]),this.t.Yc(this.s,u>>0,w(Math.min(n,f)-.5),u>>0,w(Math.max(n,f)+.5),[6,2])):(f<this.n.Ce?(t=e-o-.5>>0,i=u+.5>>0,t<i&&(this.t.Qc(this.s,t,n-r>>0,i,n-r>>0,[6,2]),this.t.Qc(this.s,t,n>>0,t+o>>0,n>>0,[6,2]),this.t.Yc(this.s,t,n-r>>0,t,n>>0,[6,2])),t=Math.min(n,f)>>0,i=Math.max(n-r,f-r)>>0):(t=e-o>>0,i=u>>0,t<i&&(this.t.Qc(this.s,t,n+r>>0,i,n+r>>0,[6,2]),this.t.Qc(this.s,t,n>>0,t+o>>0,n>>0,[6,2]),this.t.Yc(this.s,t,n>>0,t,n+r>>0,[6,2])),t=Math.min(n+r,f+r)>>0,i=Math.max(n+r,f+r)>>0),t<i&&this.t.Yc(this.s,u>>0,t,u>>0,i,[6,2])));10===this.n.nb&&(u>e?(this.t.Qc(this.s,e-.5>>0,n>>0,u+.5>>0,n>>0,[6,2]),this.t.Yc(this.s,u>>0,w(Math.min(n,f)-.5),u>>0,w(Math.max(n,f)+.5),[6,2])):f<this.n.Ce?(t=u-.5>>0,i=e+o+.5>>0,t<i&&(this.t.Yc(this.s,t,Math.min(f>>0,n-r>>0),t,Math.max(f>>0,n-r>>0),[6,2]),this.t.Qc(this.s,t,n-r>>0,i,n-r>>0,[6,2]),this.t.Qc(this.s,i-o>>0,n>>0,i,n>>0,[6,2]),this.t.Yc(this.s,i,n-r>>0,i,n>>0,[6,2]))):(t=u-.5>>0,i=e+o+.5>>0,t<i&&(this.t.Yc(this.s,t,Math.min(f>>0,n+r>>0),t,Math.max(f>>0,n+r>>0),[6,2]),this.t.Qc(this.s,t,n+r>>0,i,n+r>>0,[6,2]),this.t.Qc(this.s,i-o>>0,n>>0,i,n>>0,[6,2]),this.t.Yc(this.s,i,n>>0,i,n+r>>0,[6,2]))));this.t.oe(Math.min(e,u),Math.min(n,f),Math.max(e,u)-Math.min(e,u),Math.max(n,f)-Math.min(n,f),30)}this.n.update=!1}},ee:function(n,t,r){var f,w,nt;this.xd=null;this.V=this.Fd(n.clientX,n.clientY);this.S={x:this.V.x,y:this.V.y};n=this.i.R/this.i.B;this.V.x-=this.i.R*this.offsetX;var c=this.i.height()-this.w.value()+.5*this.G,b=this.i.fb,ot=this.i.R*this.offsetX,tt;tt=this.w.value()>>0;this.la=this.xa=this.ta=-1;this.Ab=0;this.sh=this.T=this.Oa=void 0;for(var h=0,k=0,e=this.j,g=this.Nh(this.S.x),st=.5*this.j,rt=0,ut=0,s=0,d=0,it=.75*this.r,ht=this.jf(15),o,p,v,s=0,w=!1,a=this.f.b,lt=a.length,u=0;u<lt;++u)if(f=a[u].a,w=a[u].o,a[u].Rb)c+=e;else if(a[u].kd())c+=2*e;else{for(c+=e,o=0;o<a[u].c.length;++o)if(!a[u].c[o].filter)if(nt=a[u].c[o],v=a[u].c[o].a.length,!this.Y&&nt.collapse)c+=e;else{for(p=v,h=v-1;0<=h;--h)nt.a[h].filter&&--p;var rt=c+tt,ut=this.V.y+tt-this.i.height()+st,ft=c,at=c+.25*e,et=c+p*e+1.5*this.G,ct=ft-.3*this.G-2+.5*e-.3*e;for(this.Y&&(et+=this.G,0===v&&(et+=e)),k=c+.5*(e-this.G)+.5*this.G,c+=e,c+=e*p,h=k+e-this.G,k+=e,p=0;p<v;++p)if(f=nt.a[p],!f.filter){if(this.V.y>=h&&this.V.y<=k&&(this.S.x>this.da&&this.S.x<this.da+16||this.S.x>this.r-32&&this.S.x<this.r-16)){if(s=this.Ba(f.k),d=this.Ba(f.m),s<this.da||s<this.da&&d>this.da){t&&(this.sa.style.cursor="pointer");this.xd={b:u,c:o,a:p};this.ya();return}if(s>this.r&&this.S.x>this.r-32&&this.S.x<this.r-16){t&&(this.sa.style.cursor="pointer");this.xd={b:u,c:o,a:p};this.ya();return}}if(s=ht,f.o===i&&(s=0),g>=f.k-s&&g<=f.m+s&&this.V.y>=h&&this.V.y<=k){this.la=p;this.xa=o;this.ta=u;this.Ab=0;this.Va.ag(-1,-1);this.Pc.x=f.k-this.V.x/(this.i.R*b)*b*this.i.B;this.Pc.y=h-this.V.y;t&&(this.sa.style.cursor="pointer");this.H.ze=this.S.x;this.H.Ae=h;(this.Ea||0!==w)&&this.H.reset();f.o!==i&&(5>l(this.V.x-f.k*n)&&(!t||this.Ea||0!==w||this.f.A(u,o,p).o==i||r||(this.sa.style.cursor="w-resize"),this.Ab=-10),5>l(this.V.x-f.m*n)&&(!t||this.Ea||0!==w||this.f.A(u,o,p).o==i||r||(this.sa.style.cursor="w-resize"),this.Ab=10,this.Pc.x=f.m-this.V.x/(this.i.R*b)*b*this.i.B),300!==this.Wa&&(s=this.Ba(f.k),d=this.Ba(f.m),2<s-this.S.x&&15>s-this.S.x?(this.Ha||(this.Ha={nb:-10},this.$=!0),this.Ab=0,t&&(this.sa.style.cursor="pointer"),this.ya()):2<this.S.x-d&&15>this.S.x-d&&!f.P?(this.Ha||(this.Ha={nb:10},this.$=!0),this.Ab=0,t&&(this.sa.style.cursor="pointer"),this.ya()):this.Ha&&(this.Ha=null,this.$=!0)));return}h+=e;k+=e}if(5>Math.abs(this.V.x-nt.m*n)&&this.V.y>=at&&et>=this.V.y){if(a[u].c[o].o==i-1||this.g.enable&&this.g.Lb)return;t&&!this.Ea&&0===w&&(this.sa.style.cursor="w-resize");this.sh=!0;this.xa=o;this.ta=u;this.Pc.x=nt.m-this.V.x/(this.i.R*b)*b*this.i.B;this.H.ze=this.S.x;this.H.Ae=ft;this.v.Pd=!0;this.v.reset();this.Va.ag(u,o);(this.Ea||0!==w)&&this.H.reset();return}if(y===this.Wa&&g>=nt.k&&g<=nt.m&&this.V.y>=ct&&this.V.y<=ct+.5*e){this.Va.ag(u,o);this.v.set(u,o,this.f.ma(u,o));this.v.ze=this.S.x;this.v.Ae=ft+this.G-(this.nd+this.Rd)*this.zoom;this.v.Pd=!1;this.v.disable=w;return}if(!w&&this.Zh(a[u].c[o].a,ot,rt,tt,1,g,ut,0)){t&&(this.sa.style.cursor="pointer");return}0===v&&this.Y&&(c+=e)}if(a[u].collapse)c+=e;else if(a[u].a.length){if(this.Y&&(c+=this.G),this.Y||(c+=e),this.Y||!a[u].collapse){for(rt=c+tt,ut=this.V.y+tt-this.i.height()+e+st,p=v=a[u].a.length,h=v-1;0<=h;--h)a[u].a[h].filter&&--p;for(h=k=c+.5*e-this.G,k+=this.G,o=0;o<a[u].a.length;++o)if(f=a[u].a[o],!f.filter){if(v=f.m,f.P&&(v+=1e7),f.P){if(s=this.Ba(f.k),it=this.r-45,s<=this.da-1&&(it=.75*this.r),37<this.S.x-it){t&&(this.sa.style.cursor="");h+=e;k+=e;continue}v=this.Nh(it)}if(this.V.y>=h&&this.V.y<=k&&(this.S.x>this.da&&this.S.x<this.da+16||this.S.x>this.r-32&&this.S.x<this.r-16)){if(s=this.Ba(f.k),d=this.Ba(v),s<this.da||s<this.da&&d>this.da){t&&(this.sa.style.cursor="pointer");this.xd={b:u,c:void 0,a:o};this.ya();return}if(s>this.r&&this.S.x>this.r-32&&this.S.x<this.r-16){t&&(this.sa.style.cursor="pointer");this.xd={b:u,c:void 0,a:o};this.ya();return}}if(s=ht,f.o===i&&(s=0),g>=f.k-s&&g<=v+s&&this.V.y>=h&&this.V.y<=k){this.la=o;this.xa=-1;this.ta=u;this.Ab=0;this.Va.ag(-1,-1);this.Pc.x=f.k-this.V.x/(this.i.R*b)*b*this.i.B;this.Pc.y=h-this.V.y;this.sa.style.cursor="pointer";this.H.ze=this.S.x;this.H.Ae=h;(this.Ea||0!==w)&&this.H.reset();f.o!==i&&(5>l(this.V.x-f.k*n)&&(!t||this.Ea||0!==w||this.f.A(u,void 0,o).o==i||r||(this.sa.style.cursor="w-resize"),this.Ab=-10),f.P?5>l(this.S.x-it)&&(!t||this.Ea||0!==w||this.f.A(u,void 0,o).o==i||r||(this.sa.style.cursor="w-resize"),this.Ab=10,this.Pc.x=v-this.V.x/(this.i.R*b)*b*this.i.B):5>l(this.V.x-v*n)&&(!t||this.Ea||0!==w||this.f.A(u,void 0,o).o==i||r||(this.sa.style.cursor="w-resize"),this.Ab=10,this.Pc.x=v-this.V.x/(this.i.R*b)*b*this.i.B),300!==this.Wa&&(s=this.Ba(f.k),d=this.Ba(v),2<s-this.S.x&&15>s-this.S.x?(this.Ha||(this.Ha={nb:-10},this.$=!0),this.Ab=0,t&&(this.sa.style.cursor="pointer"),this.ya()):2<this.S.x-d&&15>this.S.x-d&&!f.P?(this.Ha||(this.Ha={nb:10},this.$=!0),this.Ab=0,t&&(this.sa.style.cursor="pointer"),this.ya()):this.Ha&&(this.Ha=null,this.$=!0)));return}h+=e;k+=e}if(!w&&this.Zh(a[u].a,ot,rt,tt,1,g,ut,e)){t&&(this.sa.style.cursor="pointer");return}c+=e*p}}else c+=e}this.Va.ag(-1,-1);300!==this.Wa&&(this.Ha=null);t&&(this.sa.style.cursor="");this.Ea&&(this.H.reset(),this.v.reset())},Qe:function(n,t,i){this.V=void 0!=n?this.Fd(n.clientX,n.clientY):{x:t,y:i};this.S={x:this.V.x,y:this.V.y};this.V.x-=this.i.R*this.offsetX;var e=this.j,r=-this.w.value(),u=this.V.y-2*e,f=this.f.b,o=f.length;for(t=0;t<o;++t){if(r<=u&&u<=r+e)return this.ca={b:t,c:f[t].c.length?0:-1,a:-1},!0;if(f[t].Rb)r+=e;else if(f[t].kd()){if(r<=u&&u<=r+2*e)return this.ca={b:t,c:-1,a:-1},!0;r+=2*this.j}else{for(r+=this.j,i=0;i<f[t].c.length;++i)if(!f[t].c[i].filter){if(r<=u&&u<=r+e)return this.ca={b:t,c:i,a:-1},!0;if(r+=this.j,!f[t].c[i].collapse)for(n=0;n<f[t].c[i].a.length;++n)if(!f[t].c[i].a[n].filter){if(r<=u&&u<=r+e)return this.ca={b:t,c:i,a:n-1},!0;r+=e}}if(f[t].collapse){if(r<=u&&u<=r+e)return this.ca={b:t,c:-1,a:-1},!0;r+=e}else if(f[t].a.length){if(r<=u&&u<=r+e)return this.ca={b:t,c:-1,a:-1},!0;for(r+=this.j,n=0;n<f[t].a.length;++n)if(!f[t].a[n].filter){if(r<=u&&u<=r+e)return this.ca={b:t,c:-1,a:n-1},!0;r+=e}}else{if(r<=u&&u<=r+e)return this.ca={b:t,c:-1,a:-1},!0;r+=this.j}}}return r<u&&0<o?(this.ca=f.Zc().a.length?{b:t-1,c:-1,a:f.Zc().a.length-1,Xh:f[t-1].c.length?-1:0}:{b:t-1,c:-1,a:-1},!0):!1},Qj:function(n,t){this.V={x:n,y:t};this.S={x:this.V.x,y:this.V.y};this.V.x-=this.i.R*this.offsetX;for(var r=this.i.height()-this.w.value()+.5*this.G,u,f=this.j,e=this.f.b,o=e.length,i=0;i<o;++i)if(e[i].Rb)r+=f;else if(e[i].kd())r+=2*f;else{for(r+=f,u=0;u<e[i].c.length;++u)if(0===e[i].c[u].a.length&&(r+=f),this.Y?r+=f+e[i].c[u].a.length*f:e[i].c[u].collapse||(r+=f+e[i].c[u].a.length*f),r>=t)return{b:i,c:u+1};if(e[i].collapse)r+=f;else if(e[i].a.length){for(r+=f,u=e[i].a.length-1;0<=u;--u)e[i].a[u].filter||(r+=f);if(r>=t)return{b:i,c:void 0}}else r+=f}return{b:void 0,c:void 0}},Zh:function(n,t,i,r,u,e,o,h){var k,rt,c,v;if(this.jb=!1,this.Vl=0,this.Ea)return this.jb;if(!n.length)return!1;var a,y,p,w,tt,b,it=0,nt=0,d=this.j,g=.5*this.G,l=this.jf(5);for(i-=this.i.wg,k=0;k<n.length;++k)for(p=n[k],p.filter&&it++,rt=0;rt<p.links.length;++rt)if(c=p.links[rt],w=c.za||c.parentTaskId,n[k].q!==w)for(tt=c.Sc||c.linkType,b=c.Ca||c.dependenceTaskId,v=nt=0;v<n.length;++v)if(n[v].filter&&nt++,!(n[v].filter&&n[k].filter||n[v].q!==w))if(s===tt)if(a=n[v].k+n[v].duration,y=n[k].k,t=i+d*(v-nt),u=i+d*(k-it),t<u)if(a<y){if(f(e,o,a+l,t,a+l,u)){if(this.T&&this.T.Ca===b&&this.T.za==w){this.jb=!0;continue}return this.Z.Ta({x:this.Ba(a+2*l),y:this.V.y,u:100,C:100},0,Math.floor((p.k-n[v].m)/24),!0),this.Z.qb(c),this.Oa=c,!0}if(f(e,o,a+l,u,y,u))if(this.T&&this.T.Ca===b&&this.T.za==w)this.jb=!0;else return this.Z.Ta({x:this.S.x,y:u-r+this.j-h,u:100,C:100},1,Math.floor((p.k-n[v].m)/24),!0),this.Z.qb(c),this.Oa=c,!0}else{if(f(e,o,a+l,t,a+l,u)){if(this.T&&this.T.Ca===b&&this.T.za==w){this.jb=!0;continue}return this.Z.Ta({x:this.Ba(a+l),y:this.V.y,u:100,C:100},0,Math.floor((p.k-n[v].m)/24),!0),this.Z.qb(c),this.Oa=c,!0}if(f(e,o,y,u-2*g,a,u-2*g))if(this.T&&this.T.Ca===b&&this.T.za==w)this.jb=!0;else return this.Z.Ta({x:this.S.x,y:u-2*g-r+this.j-h,u:100,C:100},1,Math.floor((p.k-n[v].m)/24),!0),this.Z.qb(c),this.Oa=c,!0}else if(a<y){if(f(e,o,a+l,u,a+l,t)){if(this.T&&this.T.Ca===b&&this.T.za==w){this.jb=!0;continue}return this.Z.Ta({x:this.Ba(a+l/2),y:this.V.y,u:100,C:100},0,Math.floor((p.k-n[v].m)/24),!0),this.Z.qb(c),this.Oa=c,!0}if(f(e,o,a+l,u,y,u))if(this.T&&this.T.Ca===b&&this.T.za==w)this.jb=!0;else return this.Z.Ta({x:this.S.x,y:u-r+this.j-h,u:100,C:100},1,Math.floor((p.k-n[v].m)/24),!0),this.Z.qb(c),this.Oa=c,!0}else{if(f(e,o,y-l,u,y-l,t)){if(this.T&&this.T.Ca===b&&this.T.za==w){this.jb=!0;continue}return this.Z.Ta({x:this.Ba(y),y:this.S.y,u:100,C:100},0,Math.floor((p.k-n[v].m)/24),!0),this.Z.qb(c),this.Oa=c,!0}if(f(e,o,y-l,t-2*g,a+l,t-2*g))if(this.T&&this.T.Ca===b&&this.T.za==w)this.jb=!0;else return this.Z.Ta({x:this.S.x,y:t-2*g-r+this.j-h,u:100,C:100},1,Math.floor((p.k-n[v].m)/24),!0),this.Z.qb(c),this.Oa=c,!0}else if(0===tt)if(a=n[v].k,y=n[k].k,t=i+d*(v-nt),u=i+d*(k-it),t<u)if(a<y){if(f(e,o,a-l,t,a-l,u)){if(this.T&&this.T.Ca===b&&this.T.za==w){this.jb=!0;continue}return this.Z.Ta({x:this.Ba(a),y:this.S.y,u:100,C:100},0,Math.floor((p.k-n[v].k)/24)),this.Z.qb(c),this.Oa=c,!0}if(f(e,o,a-l,u,y,u))if(this.T&&this.T.Ca===b&&this.T.za==w)this.jb=!0;else return this.Z.Ta({x:this.S.x,y:u-r+this.j-h,u:100,C:100},1,Math.floor((p.k-n[v].k)/24)),this.Z.qb(c),this.Oa=c,!0}else{if(f(e,o,y-l,t,a,t)){if(this.T&&this.T.Ca===b&&this.T.za==w){this.jb=!0;continue}return this.Z.Ta({x:this.S.x,y:t-r+this.j-h,u:100,C:100},1,Math.floor((p.k-n[v].k)/24)),this.Z.qb(c),this.Oa=c,!0}if(f(e,o,y-l,t,y-l,u))if(this.T&&this.T.Ca===b&&this.T.za==w)this.jb=!0;else return this.Z.Ta({x:this.Ba(y),y:this.V.y,u:100,C:100},0,Math.floor((p.k-n[v].k)/24)),this.Z.qb(c),this.Oa=c,!0}else if(a<y){if(f(e,o,a-l,u,a-l,t)){if(this.T&&this.T.Ca===b&&this.T.za==w){this.jb=!0;continue}return this.Z.Ta({x:this.Ba(a-l),y:this.V.y,u:100,C:100},0,Math.floor((p.k-n[v].k)/24)),this.Z.qb(c),this.Oa=c,!0}if(f(e,o,a-l,u,y,u))if(this.T&&this.T.Ca===b&&this.T.za==w)this.jb=!0;else return this.Z.Ta({x:this.S.x,y:u-r+this.j-h,u:100,C:100},1,Math.floor((p.k-n[v].k)/24)),this.Z.qb(c),this.Oa=c,!0}else{if(f(e,o,y-l,u,y-l,t)){if(this.T&&this.T.Ca===b&&this.T.za==w){this.jb=!0;continue}return this.Z.Ta({x:this.Ba(y),y:this.V.y,u:100,C:100},0,Math.floor((p.k-n[v].k)/24)),this.Z.qb(c),this.Oa=c,!0}if(f(e,o,y+l,t,a,t))if(this.T&&this.T.Ca===b&&this.T.za==w)this.jb=!0;else return this.Z.Ta({x:this.S.x,y:t-r+this.j-h,u:100,C:100},1,Math.floor((p.k-n[v].k)/24)),this.Z.qb(c),this.Oa=c,!0}else if(1===tt)if(a=n[v].k+n[v].duration,y=n[k].k+n[k].duration,t=i+d*(v-nt),u=i+d*(k-it),t<u)if(a<y){if(f(e,o,a+l,t,y+l,t)){if(this.T&&this.T.Ca===b&&this.T.za==w){this.jb=!0;continue}return this.Z.Ta({x:this.S.x,y:t-r+this.j-h,u:100,C:100},1,Math.floor((p.m-n[v].m)/24)),this.Z.qb(c),this.Oa=c,!0}if(f(e,o,y+l,t,y+l,u))if(this.T&&this.T.Ca===b&&this.T.za==w)this.jb=!0;else return this.Z.Ta({x:this.Ba(y+2*l),y:this.V.y,u:100,C:100},0,Math.floor((p.m-n[v].m)/24)),this.Z.qb(c),this.Oa=c,!0}else{if(f(e,o,a+l,t,a+l,u)){if(this.T&&this.T.Ca===b&&this.T.za==w){this.jb=!0;continue}return this.Z.Ta({x:this.Ba(a+2*l),y:this.V.y,u:100,C:100},0,Math.floor((p.m-n[v].m)/24)),this.Z.qb(c),this.Oa=c,!0}if(f(e,o,y,u,a+l,u))if(this.T&&this.T.Ca===b&&this.T.za==w)this.jb=!0;else return this.Z.Ta({x:this.S.x,y:u-r+this.j-h,u:100,C:100},1,Math.floor((p.m-n[v].m)/24)),this.Z.qb(c),this.Oa=c,!0}else if(a<y){if(f(e,o,a,t,y+l,t)){if(this.T&&this.T.Ca===b&&this.T.za==w){this.jb=!0;continue}return this.Z.Ta({x:this.S.x,y:t-r+this.j-h,u:100,C:100},1,Math.floor((p.m-n[v].m)/24)),this.Z.qb(c),this.Oa=c,!0}if(f(e,o,y+l,u,y+l,t))if(this.T&&this.T.Ca===b&&this.T.za==w)this.jb=!0;else return this.Z.Ta({x:this.Ba(y+2*l),y:this.V.y,u:100,C:100},0,Math.floor((p.m-n[v].m)/24)),this.Z.qb(c),this.Oa=c,!0}else{if(f(e,o,a+l,u,a+l,t)){if(this.T&&this.T.Ca===b&&this.T.za==w){this.jb=!0;continue}return this.Z.Ta({x:this.Ba(a+2*l),y:this.V.y,u:100,C:100},0,Math.floor((p.m-n[v].m)/24)),this.Z.qb(c),this.Oa=c,!0}if(f(e,o,y,u,a+l,u))if(this.T&&this.T.Ca===b&&this.T.za==w)this.jb=!0;else return this.Z.Ta({x:this.S.x,y:u-r+this.j-h,u:100,C:100},1,Math.floor((p.m-n[v].m)/24)),this.Z.qb(c),this.Oa=c,!0}return this.jb},Ii:function(){var o,s;this.va={a:-1,c:-1,b:-1};var n=this.i.height()-this.w.value(),h=0,c=0;this.va.c=-1;this.va.b=-1;for(var h=this.ka.y+this.ka.Ld,c=this.ka.y+this.ka.height,f=.5*(h+c),r,e,l,i=this.j,u=this.f.b,a=u.length,t=0;t<a;++t){if(n<f&&f<n+i)return this.va.b=t,!0;if(u[t].Rb)n+=i;else if(u[t].kd()){if(n<f&&f<n+2*i)return this.va.b=t,!0;n+=2*i}else{for(n+=i,r=0;r<u[t].c.length;++r)if(!u[t].c[r].filter){for(l=e=u[t].c[r].a.length,e-=1;0<=e;--e)u[t].c[r].a[e].filter&&--l;if(o=n+this.G,s=o+i*(l+.5),e=l,this.Y?s=o+i*(e+.5):u[t].c[r].collapse?(s=o+.5*i,e=0):s=o+i*(e+.5),0===e&&this.Y&&(n+=i,s+=i),o<=h&&h<=s||o<=c&&c<=s||o<=h&&c<=s)return this.va.c=r,this.va.b=t,!0;n=u[t].c[r].collapse?n+i:n+i*(e+1)}if(u[t].collapse){if(n<f&&f<n+i)return this.va.b=t,!0;n+=i}else if(u[t].a.length){if(n<f&&f<n+i)return this.va.b=t,!0;for(n+=i,r=u[t].a.length-1;0<=r;--r)if(!u[t].a[r].filter){if(n<f&&f<n+i)return this.va.b=t,!0;n+=i}}else{if(n<f&&f<n+i)return this.va.b=t,!0;n+=i}}}return n<h&&0<a?(this.va.b=1===a?0:a-1,!0):!1},Ei:function(){for(var r=0,i,f,u=this.j,t=this.f.b,e=t.length,n=0;n<e;++n)if(t[n].Rb)r+=u;else if(t[n].kd())r+=2*u;else{for(r+=u,i=0;i<t[n].c.length;++i)if(!t[n].c[i].filter&&(r+=u,!t[n].c[i].collapse))for(f=t[n].c[i].a.length-1;0<=f;--f)t[n].c[i].a[f].filter||(r+=u);if(!t[n].collapse&&t[n].a.length)for(i=t[n].a.length-1;0<=i;--i)t[n].a[i].filter||(r+=u);r+=u}return r},jd:function(n,t,i){for(var o=this.j,r,s,h,e=2*o,f=this.f.b,c=f.length,u=0;u<c;++u)if(f[u].Rb)e+=o;else if(f[u].kd())e+=2*o;else{for(e+=o,r=0;r<f[u].c.length;++r)if(!f[u].c[r].filter){for(s=h=f[u].c[r].a.length,h-=1;0<=h;--h)f[u].c[r].a[h].filter&&--s;if(n===u&&r===t&&-1===i)return e+.5*o+2;if(f[u].c[r].collapse)e+=o;else for(e+=o,s=0;s<f[u].c[r].a.length;++s)if(!f[u].c[r].a[s].filter){if(s===i&&n===u&&r===t)return e;e+=o}}if(f[u].collapse)e+=o;else if(e+=o,-1===t){for(r=0;r<f[u].a.length;++r)if(!f[u].a[r].filter){if(r===i&&u===n)return e;e+=o}}else for(r=0;r<f[u].a.length;++r)f[u].a[r].filter||(e+=o)}return e},Nk:function(){for(var r,i,u={height:null,x:null},f=0,t=this.f.b,e=t.length,n=0;n<e;++n)if(f+=this.j,!t[n].kd()){for(0!==n||this.Y||(f+=this.j),f+=this.j,r=0;r<t[n].c.length;++r)if(!t[n].c[r].filter){for(f+=this.j,i=0;i<t[n].c[r].a.length;++i)t[n].c[r].a[i].filter||((!u.x||t[n].c[r].a[i].k<u.x)&&(u.x=t[n].c[r].a[i].k),f+=this.j);0===t[n].c[r].a.length&&((!u.x||t[n].c[r].k<u.x)&&(u.x=t[n].c[r].k),f+=this.j)}for(i=0;i<t[n].a.length;++i)t[n].a[i].filter||((!u.x||t[n].a[i].k<u.x)&&(u.x=t[n].a[i].k),f+=this.j);f+=this.G}return u.height=f+.0001,u},Ji:function(){for(var u=(this.ia.ic.getTime()-this.ia.Sb.getTime())/36e5,f=(this.ia.Qa.eb-this.ia.Nd)*u,u=(this.ia.Qa.end-this.ia.Nd)*u,r,e,t,o=0,s=this.j,i=this.f.b,h=i.length,n=0;n<h;++n)if(i[n].Rb)o+=s;else if(i[n].kd())o+=2*s;else{for(o+=s,r=0;r<i[n].c.length;++r)if(!i[n].c[r].filter){for(o+=s,e=0;e<i[n].c[r].a.length;++e)if(t=i[n].c[r].a[e],!t.filter){if(t.k>=f&&t.k<=u||t.m>=f&&t.m<=u||t.k>=f&&t.m<=u||t.k<=f&&t.m>=u)return 0===e&&0===r&&0===n?{height:.0001,empty:!1}:0===e?{height:o-s,empty:!1}:{height:o,empty:!1};o+=s}if(0===i[n].c[r].a.length){if(i[n].c[r].k>=f&&i[n].c[r].k<=u||i[n].c[r].m>=f&&i[n].c[r].m<=u||i[n].c[r].k>=f&&i[n].c[r].m<=u||i[n].c[r].k<=f&&i[n].c[r].m>=u)return 0===e&&0===r&&0===n?{height:.0001,empty:!1}:0===e?{height:o-s,empty:!1}:{height:o,empty:!1};o+=s}}for(e=0;e<i[n].a.length;++e)if(t=i[n].a[e],!t.filter){if(t.P&&(t.k<=f||t.k>=f&&t.k<=u)||t.k>=f&&t.k<=u||t.m>=f&&t.m<=u||t.k>=f&&t.m<=u||t.k<=f&&t.m>=u)return 0===e&&0===i[n].c.length&&0===n?{height:.0001,empty:!1}:{height:o,empty:!1};o+=s}o+=this.G}return{height:.0001,empty:!0}},Xi:function(n,t){var s;if(!this.Ea){this.Ii(n);t&&(this.va=t);var r=null,e=null,u,f,o,l=!1,h=-1,c=-1;if(f=-1,s=null,this.K.b===this.va.b)if(-1!==this.va.c&&-1!==this.va.b){if(-1!==this.K.a&&-1!==this.K.b&&(this.Qe(n),-1===this.K.c&&(u=this.f.A(this.K.b,void 0,this.K.a),f=this.f.ma(this.va.b,this.va.c),r=this.f.jc(this.K.b,void 0,this.K.a),e=this.f.$c(this.va.b,this.va.c),s=this.Cd().Ue(this.K.b,void 0,r.a),i-1!==f.status()&&(s.length?this.Cd().Hc("300",{b:this.K.b,c:void 0,a:u,index:this.K.a,ad:this.ca.a+1,Ja:this.K.b,Ua:this.va.b,Na:void 0,ib:this.va.c,ha:r.a,fa:void 0,ga:r.b,De:e.b,od:e.c,Eb:s,type:"FtoM"}):(u.P&&u.k>=f.m&&u.Yd(f.m-24),this.f.b[this.va.b].c[this.va.c].Nb(u,this.ca.a+1),this.f.b[this.K.b].Fb(this.K.a),f.rb(),this.ya(),this.L.add(900,{b:this.K.b,c:void 0,a:u,index:this.K.a,ad:this.ca.a+1,Ja:this.K.b,Ua:this.va.b,Na:void 0,ib:this.va.c,ha:r.a,fa:void 0,ga:r.b,De:e.b,od:e.c}),u.P&&u.k>=f.m&&u.Yd(f.m-24),this.L.Nf(),f.collapse&&f.Mc(!1)))),-1!==this.K.c&&-1!==this.va.c&&i-1!==this.f.ma(this.va.b,this.va.c).status())){if(o=this.K.a,c=h=this.ca.a+1,this.ca.a+1===o&&this.va.c===this.K.c){this.va={a:-1,c:-1,b:-1};this.$=!0;this.Wa=y;return}this.va.c===this.K.c&&(l=!0,h<o?++o:c++);u=this.f.A(this.K.b,this.K.c,this.K.a);f=this.f.ma(this.va.b,this.va.c);r=this.f.jc(this.K.b,this.K.c,this.K.a);e=this.f.$c(this.va.b,this.va.c);s=this.Cd().Ue(this.K.b,this.K.c,r.a);s.length&&!l?(this.ya(),this.Cd().Hc("300",{b:this.K.b,c:void 0,a:u,index:this.K.a,ad:this.ca+1,Ja:this.K.b,Ua:this.va.b,Na:this.K.c,ib:this.va.c,ha:r.a,fa:r.c,ga:r.b,De:e.b,od:e.c,Eb:s,type:"MtoM"})):(f.Nb(u,c),this.f.b[this.K.b].c[this.K.c].Fb(o),this.f.b[this.K.b].c[this.K.c].rb(),f.rb(),this.ya(),this.L.add(900,{b:this.K.b,c:void 0,a:u,index:this.K.a,ad:h,Ja:this.K.b,Ua:this.va.b,Na:this.K.c,ib:this.va.c,ha:r.a,fa:r.c,ga:r.b,De:e.b,od:e.c}),this.L.Nf(),f.collapse&&f.Mc(!1))}}else{if(this.Qe(n),u=this.f.A(this.K.b,-1===this.K.c?void 0:this.K.c,this.K.a),r=this.f.jc(this.K.b,-1===this.K.c?void 0:this.K.c,this.K.a),e=this.f.b[this.K.b],s=this.Cd().Ue(this.K.b,-1===this.K.c?void 0:this.K.c,r.a),o=this.K.a,c=h=this.ca.a+1,this.va.c===this.K.c){if(this.ca.a+1===o&&this.va.c===this.K.c){this.va={a:-1,c:-1,b:-1};this.$=!0;this.Wa=y;return}c=h=this.ca.a+1;f=o;l=!0;h<o?++f:++h}s.length&&!l?(this.ya(),this.Cd().Hc("300",{b:this.K.b,c:this.K.c,a:u,index:this.K.a,Ja:this.K.b,Ua:this.K.b,Na:this.K.c,ib:void 0,ha:r.a,fa:r.c,ga:r.b,De:e.q,od:void 0,Eb:s,type:"MtoF"})):(l?(this.f.b[this.K.b].Nb(u,h),this.f.b[this.K.b].Fb(f),this.ya(),this.L.add(900,{b:this.K.b,c:this.K.c,a:u,index:o,ad:c,Ja:this.K.b,Ua:this.K.b,Na:void 0,ib:void 0,ha:r.a,fa:r.c,ga:r.b,De:e.q,od:void 0})):(u=this.f.A(this.K.b,this.K.c,this.K.a),this.f.b[this.K.b].Nb(u,c),this.f.b[this.K.b].c[this.K.c].Fb(this.K.a),this.ya(),this.L.add(900,{b:this.K.b,c:this.K.c,a:u,index:this.K.a,ad:c,Ja:this.K.b,Ua:this.K.b,Na:this.K.c,ib:void 0,ha:r.a,fa:r.c,ga:r.b,De:e.q,od:void 0})),this.L.Nf())}this.va={a:-1,c:-1,b:-1};this.$=!0;this.Wa=y}},mg:function(n,t,r){if(!this.Ea){var f=-1,e=-1,o=-1,u=null;if(-1!==n&&-1===t&&-1!==r&&(f=this.f.b[n].q,o=this.f.b[n].a[r].q,u=this.f.A(n,void 0,r))){if(i==u.o)return;u.Ac=!0;this.g.reset();this.g.Lb=u;this.g.b=n;this.g.c=-1;this.g.a=r;this.g.text=u.Q;this.g.qd=u.Q;this.g.je();this.offsetX*this.i.B+u.k<this.jf(this.da)?this.ja.Lc(u.k):this.hf(u.k)+u.Mb>this.r&&this.ja.Lc(u.k);this.L.add(700,{b:n,c:void 0,a:u,index:r,ha:o,fa:void 0,ga:f,Nc:!0})}if(-1!==n&&-1!==t&&-1!==r&&(f=this.f.b[n].q,e=this.f.b[n].c[t].q,o=this.f.b[n].c[t].a[r].q,u=this.f.A(n,t,r))){if(i==u.o)return;u.Ac=!0;this.g.reset();this.g.Lb=u;this.g.b=n;this.g.c=t;this.g.a=r;this.g.text=u.Q;this.g.qd=u.Q;this.g.je();this.offsetX*this.i.B+u.k<this.jf(this.da)?this.ja.Lc(u.k):this.hf(u.k)+u.Mb>this.r&&this.ja.Lc(u.k);this.L.add(700,{b:n,c:t,a:u,index:r,ha:o,fa:e,ga:f,Nc:!0})}-1!==n&&-1!==t&&-1===r&&(f=this.f.b[n].q,e=this.f.b[n].c[t].q,r=this.f.ma(n,t))&&(r.Ac=!0,this.g.reset(),this.g.$b=r,this.g.b=n,this.g.c=t,this.g.a=-1,this.g.text=r.Q,this.g.qd=r.Q,this.g.je(),this.L.add(800,{b:n,c:t,a:r,index:void 0,ha:void 0,fa:e,ga:f,Nc:!0}),(this.hf(r.m)-r.Mb<this.jf(this.da)||this.hf(r.m)>this.r)&&this.ja.Lc(r.m))}},Jl:function(){var n;if(this.Jf){n=this;n.Jf=!1;var i=0,t=n.U-n.i.height()+2,r=Math.max(n.vc-t,.0001),u=Math.min(n.vc,n.w.value()+t);if(n.Aa.ge()&&(i=n.Mh+n.Aa.bound.C),n.Tb.ge()&&(i=n.Mh+n.Tb.bound.C),!(t>n.vc&&t>i&&0===n.w.Kf))if(n.ya(),i>u){var f=i-u,u=u+f,r=Math.max(u-t,.0001);if(n.w.Kf===f&&0===f){n.Jf=!1;return}i>n.vc?(n.w.Ch(f),n.w.zc(n.i.height()+2,t,u,n.r),n.ya()):r=(r/n.j>>0)*n.j-.0001;n.ja.Ib(r,G())}else n.w.Kf&&(n.w.value()<r?(n.w.save(),n.w.Ch(0),n.w.zc(n.i.height()+2,t,n.vc,n.r)):n.ja.Ib(r,function(){n.w.save();n.w.Ch(0);n.w.zc(n.i.height()+2,t,n.vc,n.r)}));n.Aa.ge()&&n.Lh+n.Aa.bound.u>n.r&&n.ja.uf(-(n.r-(n.Lh+n.Aa.bound.u)-35)/n.i.R)}},ig:function(n,t,r,u){var c;if(!this.g.enable&&!this.Ea){var o=-1,l=-1,h=-1,e,f,s;-1===t&&(this.Da=null,o=this.f.b[n].q,h=this.f.Ef(),this.f.Nb(vt(o,void 0,h),r),e=this.f.A(n,void 0,r),f=this.S.x,s=this.i.fb,f=(f-this.i.R*this.offsetX)/(this.i.R*s)*s*this.i.B,0>f&&(f-=s),this.Zf&&(f=(f/s>>0)*s),e.rd(f,f+120),e&&(e.Ac=!0,this.g.reset(),this.g.Lb=e,this.g.b=n,this.g.c=t,this.g.a=r,this.g.Yb=!0,u&&(this.g.Sd=u),this.g.je(),this.L.add(300,{b:n,c:void 0,a:e,index:r,ha:h,fa:void 0,ga:o,Nc:!0}),o=this.jd(n,-1,1===this.f.lb(n).a.length?r:r+1),this.w.value()+this.w.Ya<o&&this.ja.Ib(Math.min(Math.max(0,o-.5*this.U),this.w.cb-this.w.Ya)+2*this.j)));-1!==t&&(this.Da=null,this.f.b[n].c[t].o!=i-1)&&(o=this.f.b[n].q,l=this.f.b[n].c[t].q,h=this.f.Ef(),this.f.Nb(vt(o,l,h),r),e=this.f.A(n,t,r),c=this.f.ma(n,t),f=this.S.x,s=this.i.fb,f=(f-this.i.R*this.offsetX)/(this.i.R*s)*s*this.i.B,0>f&&(f-=s),this.Zf&&(f=(f/s>>0)*s),e.rd(f,f+120),f<c.m&&e.rd(f,c.m),e&&(e.Ac=!0,this.g.reset(),this.g.Lb=e,this.g.b=n,this.g.c=t,this.g.a=r,this.g.Yb=!0,this.g.xg=c,u&&(this.g.Sd=u,this.g.Oe=!0),this.g.je(),c.rb(),this.L.add(300,{b:n,c:t,a:e,index:r,ha:h,fa:l,ga:o,Nc:!0}),o=this.jd(n,t,r),this.w.value()+this.w.Ya<o&&this.ja.Ib(Math.max(0,o+2*this.j-this.w.Ya))))}},Yj:function(t,i){var r,l;if(!this.g.enable&&0!==this.f.b.length&&!this.Ea&&(r=i,0<=t)){var s=this.f.b[t].q,h=this.f.Ef(),f=null;if((void 0===r||-1===i)&&(r=this.f.b[t].c.length),this.f.b[t].ne(new g(h,s,"","","",new Date,o-1),r),f=this.f.ma(t,r)){var c=n.Gantt.Localize_strings.newMilestone,u=this.S.x,e=this.i.fb,u=this.S.x,e=this.i.fb,u=(u-this.i.R*this.offsetX)/(this.i.R*e)*e*this.i.B;0>u&&(u-=e);this.Zf&&(u=(u/e>>0)*e);f.Tc(u);this.g.reset();this.g.$b=f;this.g.b=t;this.g.c=r;this.g.a=-1;this.g.Oe=!0;this.g.Yb=!0;c&&(this.g.Sd=c);this.g.je();this.L.add(400,{b:t,c:r,a:f,index:r,ha:void 0,fa:h,ga:s,Nc:!0});l=this;this.lc().fg(f.id(),!0,function(){l.Zd()},!0)}}},tj:function(){var t,u;if(!this.g.enable&&0!==this.f.b.length&&!this.Ea&&(t=this.Qj(this.uc,.5*this.U),void 0===t.b&&(t.b=this.f.b.length-1),0<=t.b)){var r=this.f.b[t.b].q,f=this.f.Ef(),i=null;void 0===t.c&&(t.c=this.f.b[t.b].c.length);this.f.b[t.b].ne(new g(f,r,"","","",new Date,o-1),t.c);(i=this.f.ma(t.b,t.c))&&(u=n.Gantt.Localize_strings.newMilestone,i.Tc(nr),this.g.reset(),this.g.$b=i,this.g.b=t.b,this.g.c=t.c,this.g.a=-1,this.g.Oe=!0,this.g.Yb=!0,u&&(this.g.Sd=u),this.g.je(),this.L.add(400,{b:t.b,c:t.c,a:i,index:t.c,ha:void 0,fa:f,ga:r,Nc:!0}),this.Zd(),(this.hf(i.m)-i.Mb<this.jf(this.da)||this.hf(i.m)>this.r)&&this.ja.Lc(0),t=this.jd(t.b,t.c,-1)-.5*this.U,r=(this.w.md()/this.j>>0)*this.j,t=(t/this.j>>0)*this.j,this.ja.Ib(Math.min(Math.max(0,t),r)+(2*this.j-.0001)*this.Y))}},uj:function(t){if(!this.g.enable&&0!==this.f.b.length&&!this.Ea){var i=null;this.ca={b:-1,c:-1,a:-1};this.Qe(void 0,this.uc,.5*this.U);this.ca.c=-1;-1===this.ca.b?(i=this.f.Ai())&&(this.ca.a=i.a.length-1,this.ig(this.f.b.length-1,-1,i.a.length,t?t:n.Gantt.Localize_strings.newTask),i.Ec()):(this.ca.a=this.f.b[this.ca.b].a.length-1,i=this.f.Ai(),i.collapse&&(i.Mc(!1),this.Zd(!0)),this.ig(this.ca.b,this.ca.c,this.ca.a+1,n.Gantt.Localize_strings.newTask));t=this.jd(0,-1,this.ca.a+1)-.5*this.U;i=this.w.md();this.Y||(i=(this.w.md()/this.j>>0)*this.j,t=(t/this.j>>0)*this.j);this.ja.Ib(Math.min(Math.max(0,t),i)+(2*this.j-.0001)*this.Y)}},Th:function(t,i){if(!this.Ea){var e=-1,o=-1,s=-1;if(-1!==i){e=this.f.b[t].q;o=this.f.b[t].c[i].q;s=this.f.Ef();this.f.Nb(vt(e,o,s),0);var r=this.f.A(t,i,0),c=this.f.ma(t,i),h=n.Gantt.Localize_strings.newTask,u=this.i.fb,f=(this.v.bound.x+.5*this.v.bound.u-this.i.R*this.offsetX)/(this.i.R*u)*u*this.i.B;0>f&&(f-=Math.max(24,u));this.Zf&&(f=(f/u>>0)*u);r.rd(f,c.m);r&&(r.Ac=!0,this.g.reset(),this.g.Lb=r,this.g.b=t,this.g.c=i,this.g.a=0,this.g.Yb=!0,h&&(this.g.Sd=h),this.g.je(),this.L.add(300,{b:t,c:i,a:r,index:0,ha:s,fa:o,ga:e,Nc:!0}))}}},cj:function(n,t,i,r){var u;this.J["503"]&&(void 0===i||-1===i?(u=this.f.ma(n,t),this.Za.O={b:n,c:t,a:void 0,l:u,na:this.f.$c(n,t),fc:!1,gb:u},n={left:r,top:this.jd(n,t,-1)+this.d.canvas.offsetTop-this.w.value()}):(u=this.f.A(n,t,i),this.Za.O={b:n,c:t,a:i,l:u,na:this.f.jc(n,t,i),fc:!0,I:u},n={left:r,top:this.Jd+this.d.canvas.offsetTop}),this.J["503"](u,n),this.v.b=-1,this.v.c=-1,this.Da=null,this.sb=this.X=this.qa=this.oa=-1,this.ya())},bj:function(n,t,i){var r;this.J["504"]&&(void 0===i||-1===i?(r=this.f.ma(n,t),this.Za.O={b:n,c:t,a:void 0,l:r,na:this.f.$c(n,t),fc:!1,gb:r}):(r=this.f.A(n,t,i),this.Za.O={b:n,c:t,a:i,l:r,na:this.f.jc(n,t,i),fc:!0,I:r}),this.J["504"](r),this.v.b=-1,this.v.c=-1,this.Da=null,this.sb=this.X=this.qa=this.oa=-1,this.ya())},qj:function(){var n=null,t=this.ta,u=this.xa,r=this.la;if(-1===u&&-1===r||-1!=t&&0!==this.f.lb(t).status())return!1;var f=this.Ab,o=this.i.height(),e=0,s=(this.w.value()>>0)+.5*this.j+!this.Y*this.j;return-1!=t&&-1!=r&&-1===u&&(n=this.f.A(t,void 0,r),o+=this.jd(t,u,r)-s,this.Ba(n.k)+.5*Math.abs(this.Ba(n.m)-this.Ba(n.k))>this.S.x?(f=-10,e=this.Ba(n.k)):(f=10,e=this.Ba(n.m))),-1!=this.ta&&-1!=r&&-1!=u&&(n=this.f.A(t,u,r),o+=this.jd(t,u,r)-s,this.Ba(n.k)+.5*Math.abs(this.Ba(n.m)-this.Ba(n.k))>this.S.x?(f=-10,e=this.Ba(n.k)):(f=10,e=this.Ba(n.m))),n&&i!==n.o?(n.P&&(f=-10),this.n={nb:f,I:n,Sa:e,Ce:o},this.Wa=300,this.n.b=t,this.n.c=u,this.n.a=r,!0):!1},Vh:function(){if(300===this.Wa&&this.n){if(this.n.parent&&this.n.parent.q!==this.n.I.q&&0!==this.n.nb&&0!==this.n.pb&&this.n.gf===this.n.b&&this.n.ff===this.n.c&&i!==this.n.parent.o){var n,t,r,u=!1,f=this.n.parent.id(),e=this.n.I.id();if(this.M){for(t=this.M.I.links,r=t.Zc(),n=0;n<t.length-1;++n)r.dependenceTaskId===t[n].dependenceTaskId&&r.linkType===t[n].linkType&&r.parentTaskId===t[n].parentTaskId&&r.type===t[n].type&&(u=!0);if(this.M.I.links.pop(),!u&&(1===r.linkType||0===r.linkType))for(t=this.n.parent.links,n=0;n<t.length;++n)r.parentTaskId===t[n].dependenceTaskId&&r.linkType===t[n].linkType&&r.dependenceTaskId===t[n].parentTaskId&&r.type===t[n].type&&(u=!0);this.M=void 0}if(!u){for(r=!1,t=this.n.parent.links,n=0;n<t.length;++n)if(e==t[n].parentTaskId){r=!0;break}if(!r)for(t=this.n.I.links,n=0;n<t.length;++n)if(f==t[n].parentTaskId){r=!0;break}r||(n={},-10===this.n.nb&&10===this.n.pb?(n.parentSide=this.n.nb,n.parent=this.n.I,n.task=this.n.parent,n.side=this.n.pb):(n.side=this.n.nb,n.task=this.n.I,n.parent=this.n.parent,n.parentSide=this.n.pb),this.Za.Hc("270",n),this.ya(),this.$=!0)}}this.M&&(this.M.I.links.pop(),this.M=void 0);this.n=void 0;this.Wa=y;this.Ha=null}},Oi:function(){var n,t,i,r=!1,u=this.n.parent.id(),f=this.n.I.id();if(this.n.parent.P&&this.n.I.P?(this.n.nb=-10,this.n.pb=-10):this.n.parent.P?this.n.pb=-10:this.n.I.P&&(this.n.nb=-10),this.M){if(s!==this.M.I.links.Zc().linkType)return this.M.I.links.pop(),this.M=void 0,!1;for(t=this.M.I.links,i=t.Zc(),n=0;n<t.length-1;++n)i.dependenceTaskId===t[n].dependenceTaskId&&i.linkType===t[n].linkType&&i.parentTaskId===t[n].parentTaskId&&i.type===t[n].type&&(r=!0);if(this.M.I.links.pop(),!r&&(1===i.linkType||0===i.linkType))for(t=this.n.parent.links,n=0;n<t.length;++n)i.parentTaskId===t[n].dependenceTaskId&&i.linkType===t[n].linkType&&i.dependenceTaskId===t[n].parentTaskId&&i.type===t[n].type&&(r=!0);this.M=void 0}if(!r){for(i=!1,t=this.n.parent.links,n=0;n<t.length;++n)if(f==t[n].parentTaskId){i=!0;break}if(!i)for(t=this.n.I.links,n=0;n<t.length;++n)if(u==t[n].parentTaskId){i=!0;break}if(!i)return!0}return this.M&&(this.M.I.links.pop(),this.M=void 0),!1},hf:function(n){return this.i.R*this.offsetX+n*this.i.R/this.i.B},Nh:function(n){return(n-this.offsetX*this.i.R)/this.i.R*this.i.B},jf:function(n){return n*this.i.B/this.i.R},Ba:function(n){return this.i.R*this.offsetX+n*(this.i.R/this.i.B)},Fd:function(n,t){return{x:n-this.Xc.left*(this.r/this.Xc.width),y:t-this.Xc.top*(this.U/this.Xc.height)}},Gc:function(n,t){this.J[n]=t},Tk:aa("1.0.1.205"),Uk:function(){return this.Ka.ua.g.enable||this.g.enable},rl:V("zi"),nf:function(){this.Kg=this.Md+"pt "+e;this.i.nf();this.g.nf()},dl:function(n){this.Rh=n;this.$=!0},print:function(){function ft(n,i){i>=2*u&&(n?(t.fillStyle="#818181",vt.oi(230,i,13,13)):(t.fillStyle="#818181",vt.fk(230,i,13,13)))}var u=this.j,kt=n.Gantt.Localize_strings.taskWithoutMilestones||"Task Without Milestones",dt=n.Gantt.Localize_strings.highPriority||"high",lt=n.Gantt.Localize_strings.openStatus||"open",at=n.Gantt.Localize_strings.closeStatus||"close",ot=n.Gantt.Localize_strings.addDate||"add",st=n.Gantt.Localize_strings.noResponsible,ut=void 0!==Teamlab&&void 0!==Teamlab.getDisplayDate,t=this.d,c=null,h=null,vt=new k(t),y=this.Bb().ua,c=y.wa,f=2*u,g="12px"+e,yt="bold 12px "+e,ei="bold 16px "+e;if(c){c=c.getBoundingClientRect();this.Kd(!0);t.fillStyle="#F3F3F3";t.fillRect(0,0,c.width,this.U);t.fillStyle="#CCCCCC";t.fillRect(c.width,0,1,this.r);t.fillStyle="#CCCCCC";t.fillRect(c.width,0,1,this.r);for(var l,p,b,w=!1,r=-this.w.value(),s=this.f.b,oi=s.length,ht=y.rows[1].Sa,ii=y.rows[2].Sa,pt=y.rows[3].Sa,nt=y.rows[4].Sa,ri=y.rows[5].Sa,ct=!y.rows[1].mb,ui=!y.rows[2].mb,wt=!y.rows[3].mb,bt=!y.rows[4].mb,fi=!y.rows[5].mb,o=0;o<oi;++o){if(w=s[o].$e()||s[o].Ni(),0<=r&&(b=v(s[o].Q,19),t.fillStyle=w?"#83888d":"#000000",t.font=ei,t.fillText(b,18,r+.75*u+f),ct&&(t.font=g,t.fillText(v(it(s[o],st),20),ht,r+.7*u+f)),t.fillStyle="#D3D3D3",t.fillRect(0,r+f,c.width-15,1),t.fillRect(0,r+u+f,c.width-15,1),s[o].Qh&&t.drawImage(ti,0,36,16,16,0,r+f+.35*u,16,16),ft(s[o].Rb,r+.35*u+f)),s[o].Rb)r+=u;else if(s[o].kd())r+=this.j,0<=r&&(t.fillStyle=w?"#83888d":"#000000",t.font=yt,t.fillText(kt,27,r+.75*u+f),t.font=g,t.fillText(d(s[o].a),195,r+.7*u+f),t.fillStyle="#D3D3D3",t.fillRect(0,r+f,c.width-15,1),t.fillRect(0,r+u+f,c.width-15,1)),r+=this.j;else{if(r+=this.j,r>this.U)break;for(p=0;p<s[o].c.length;++p)if(!s[o].c[p].filter){if(0<=r&&(b=v(s[o].c[p].Q,24),t.fillStyle=w?"#83888d":1===s[o].c[p].o?gt:0>=s[o].c[p].m?ni:et,t.font=yt,t.fillText(b,27,r+.7*u+f),t.font=g,t.fillText(d(s[o].c[p].a),195,r+.7*u+f),ct&&t.fillText(v(it(s[o].c[p],st),20),ht,r+.7*u+f),wt&&t.fillText(a(s[o].c[p].bb,ut),pt,r+.7*u+f),bt&&(t.fillStyle=w?"#83888d":"#000000",i-1===s[o].c[p].o?t.fillText(at,nt,r+.7*u+f):t.fillText(lt,nt,r+.7*u+f)),t.fillStyle="#D3D3D3",t.fillRect(0,r+f,c.width-15,1),t.fillRect(0,r+u+f,c.width-15,1),s[o].c[p].a.length&&ft(s[o].c[p].collapse,r+.35*u+f)),r+=this.j,r>this.U)break;if(!s[o].c[p].collapse)for(l=0;l<s[o].c[p].a.length&&(s[o].c[p].a[l].filter||(0<=r&&(h=s[o].c[p].a[l],b=v(h.Q,28),t.fillStyle=w?"#83888d":rt(h),t.font=g,t.fillText(b,36,r+.65*u+f),ct&&t.fillText(v(tt(h,st),20),ht,r+.7*u+f),ui&&t.fillText(h.ab?ot:a(h.vd(),ut),ii,r+.7*u+f),wt&&t.fillText(h.P?ot:a(h.hd(),ut),pt,r+.7*u+f),h.tf&&fi&&t.fillText(dt,ri,r+.7*u+f),bt&&(t.fillStyle=w?"#83888d":"#000000",i===h.o?t.fillText(at,nt,r+.7*u+f):t.fillText(lt,nt,r+.7*u+f)),t.fillStyle="#D3D3D3",t.fillRect(0,r+f,c.width-15,1),t.fillRect(0,r+u+f,c.width-15,1)),r+=u,!(r>this.U)));++l);}if(0<=r&&(t.fillStyle=w?"#83888d":"#000000",t.font=yt,t.fillText(kt,27,r+.75*u+f),t.font=g,t.fillText(d(s[o].a),195,r+.7*u+f),t.fillStyle="#D3D3D3",t.fillRect(0,r+f,c.width-15,1),t.fillRect(0,r+u+f,c.width-15,1)),s[o].collapse){if(ft(s[o].collapse,r+.35*u+f),r+=u,r>this.U)break;continue}if(s[o].a.length)for(ft(s[o].collapse,r+.35*u+f),r+=this.j,l=0;l<s[o].a.length&&(s[o].a[l].filter||(0<=r&&(h=s[o].a[l],b=v(h.Q,28),t.fillStyle=w?"#83888d":rt(h),t.font=g,t.fillText(b,36,r+.65*u+f),ct&&t.fillText(v(tt(h,st),20),ht,r+.7*u+f),ui&&t.fillText(h.ab?ot:a(h.vd(),ut),ii,r+.7*u+f),wt&&t.fillText(h.P?ot:a(h.hd(),ut),pt,r+.7*u+f),h.tf&&fi&&t.fillText(dt,ri,r+.7*u+f),bt&&(t.fillStyle=w?"#83888d":"#000000",i===h.o?t.fillText(at,nt,r+.7*u+f):t.fillText(lt,nt,r+.7*u+f)),t.fillStyle="#D3D3D3",t.fillRect(0,r+f,c.width-15,1),t.fillRect(0,r+u+f,c.width-15,1)),r+=u,!(r>this.U)));++l);else r+=this.j}if(r>this.U)break}for(t.fillStyle="#D3D3D3",t.fillRect(0,0,c.width,1.5*u),l=1;l<y.rows.length;++l)y.rows[l].mb||(t.fillStyle="#F3F3F3",vt.Fe(t,y.rows[l].Sa-5,26,y.rows[l].minWidth,u,4),t.fill(),t.fillStyle="#666666",t.font=g,t.fillText(y.rows[l].translate,y.rows[l].Sa+1,1.3*u))}}};(n.Gantt?n.Gantt:n.Gantt={}).TimeLine=bt;t=bt.prototype;t.render=t.Uf;t.addHandler=t.Gc;t.update=t.update;t.viewController=t.lc;t.modelController=t.Cd;t.undoManager=t.Gl;t.userDefaults=t.Ll;t.leftPanelController=t.Bb;t.addNewTask=t.uj;t.addNewMilestone=t.tj;t.setReadMode=t.wl;t.print=t.print;t.onkeypress=t.onkeypress;t.onkeydown=t.onkeydown;t.onkeyup=t.onkeyup;t.ondblclick=t.ondblclick;t.onmousewheel=t.onmousewheel;t.onpaste=t.onpaste;t.oncopy=t.oncopy;t.focus=t.focus;t.internalVersion=t.Tk;t.isEditTitleMode=t.Uk;t.setEnableTouch=t.rl;t.needDrawFlashBackground=t.dl;t=pt.prototype;t.addTask=t.be;t.addMilestone=t.Ne;t.addProject=t.Pg;t.finalize=t.Ik;t.clear=t.clear;t.applyNewAddTaskId=t.Gj;t.applyNewAddMilestoneId=t.Fj;t.addLinkWithIds=t.sj;t.finalizeStatus=t.Kk;t.finalizeOperation=t.Jk;t.collectBeginEndItems=t.$g;t.throughIdsIndexes=t.Gh;t.buildWithThroughIndexer=t.Ug;t.setFilter=t.sl;t.clearFilter=t.ei;t=wt.prototype;t.scaleTo=t.Ud;t.strafeToDay=t.fj;t.strafe=t.Db;t.toVisibleElementMove=t.Hh;t.buildZoomBar=t.Mj;t.enableSlipAnimation=t.Hk;t.fullscreen=t.Y;t.disableUserEvents=t.ck;t.scaleValue=t.nl;t.saveViewState=t.ml;t.loadViewState=t.Yk;t.centeringElement=t.fg;t=at.prototype;t.canvas=t.canvas;t.dom=t.dk;t.needRepaint=t.uh;t=ct.prototype;t.addRowsAvailable=t.vj;t.showHiddenRows=t.lf;t=lt.prototype;t.undo=t.ij;t.redo=t.$i;t=r.prototype;t.id=t.id;t.title=t.title;t.description=t.description;t.owner=t.xh;t.beginDate=t.vd;t.endDate=t.hd;t.isMilestone=t.af;t.status=t.status;t.subtasks=t.gj;t.responsibles=t.Dg;t.isUndefinedEndTime=t.Xk;t.isUndefinedBeginTime=t.Wk;t=g.prototype;t.id=t.id;t.title=t.title;t.description=t.description;t.owner=t.xh;t.tasks=t.Cl;t.beginDate=t.vd;t.endDate=t.hd;t.isMilestone=t.af;t.status=t.status;t.responsibles=t.Dg;t=yt.prototype;t.id=t.id;t.title=t.title;t.description=t.description;t=ht.prototype;t.setFontFamily=t.tl};ASC.Projects.GantChartPage=function(){var kt=null,hf=null,cf=!1,tt=!1,fi=!1,ei=0,sr=!1,oi=!0,at=!0,uu=!0,dt=!1,hr=null,r={},cr=!1,lr=!1,ar=!1,si=[],hi=[],vr=[],e=[],a=[],lf={},fu={},t={},af=0,eu={open:0,closed:1},it=!0,ci={},ou=-1,li=!1,ot=!1,vt="ASC.Projects.GantChartPage.enableChartEvents();",ft=0,o=1,n=null,c=null,u=[],ai=[],vf=28,yf=49,pf=200,vi,yi,st,pi,f,ht,yt,wi,yr,rt,gt,w,ct,v,b,s,ut,ni,pt,bi,et,ki,di,pr,h=null,su=ASC.Projects.Resources,i=su.ProjectsJSResource,wt=su.ProjectsFilterResource,k=ASC.Projects.Common,wf=function(){r.statusOpenTask=wt.StatusOpenTask;r.statusOpenMilestone=wt.StatusOpenMilestone;r.statusClosedMilestone=wt.StatusClosedMilestone;r.statusClosedTask=wt.StatusClosedTask;r.newTask=i.GanttNewTask;r.newMilestone=i.GanttNewMilestone;r.taskWithoutMilestones=i.GanttTaskWithoutMilestones;r.responsibles=i.GanttResponsibles;r.responsibles.format=jq.format;r.noResponsible=wt.NoResponsible;r.taskOverdueText=i.GanttTaskOverdue;r.overdue=wt.Overdue;r.taskDescSubtask=i.GanttSubtaskTaskDesc;r.taskDescSubtasks=i.GanttSubtasksTaskDesc;r.details=i.GanttTaskDetails;r.milestones=i.GanttMilestonesPrjDesc;r.activeTasks=i.GanttActiveTasksPrjDesc;r.tasks=i.GanttTasksMilDesc;r.week=i.GanttWeekShort;r.year=i.GanttYear;r.toTasksList=i.ToTaskList;r.day=i.DelayDay;r.days=i.DelayDays;r.dayShort=i.GanttDayShort;r.expand=i.GanttExpand;r.collapse=i.GanttCollapse;r.responsibles2=i.GanttLeftPanelResponsibles;r.beginDate=i.GanttLeftPanelBeginDate;r.endDate=i.GanttLeftPanelEndDate;r.status=i.GanttLeftPanelStatus;r.priotity=i.GanttLeftPanelPriority;r.highPriority=i.GanttLeftPanelHighPriority;r.openStatus=i.GanttLeftPanelOpenStatus;r.closeStatus=i.GanttLeftPanelCloseStatus;r.addDate=i.GanttLeftPanelAddDate},bf=function(){var n={menuItems:[{id:"Responsibility",title:i.GanttLeftPanelResponsibles},{id:"BeginDate",title:i.GanttLeftPanelBeginDate},{id:"EndDate",title:i.GanttLeftPanelEndDate},{id:"Status",title:i.GanttLeftPanelStatus},{id:"Priority",title:i.GanttLeftPanelPriority}]};jq("#ganttCanvasContainer").append(jq.tmpl("projects_panelFrame",{panelId:"ganttCellChecker"}));f=jq("#ganttCellChecker");f.addClass("gantt-context-menu");f.find(".panel-content").empty().append(jq.tmpl("projects_linedListWithCheckbox",n));f.append("<span id='showChoosedFields' class='button small'>"+i.ApplyBtn+"<\/span>");f.css("padding","4px 4px 0");f.find(".dropdown-item").each(function(){jq(this).css("border","none")});f.find(".dropdown-content").each(function(){jq(this).css("margin-top","0px")});f.on("click",".dropdown-item",function(n){n.stopPropagation()})},kf=function(){if(null===hr){if(hr=jq("#gantt-filter-projects"),hr){jq("#gantt-filter-projects").projectadvancedSelector({itemsChoose:vr,inPopup:!0});jq("#gantt-filter-projects").on("showList",ne)}}else jq("#gantt-filter-projects").projectadvancedSelector("reset");gf()},df=function(){localStorageManager.setItem("ganttProjects",e.join(","))},gf=function(){var u=kt,f=0,r,n,i,o;for(localStorageManager.getItem("ganttProjects")&&null===kt&&(e=localStorageManager.getItem("ganttProjects").split(","),a=localStorageManager.getItem("ganttProjects").split(",")),u&&jq.inArray(u,e)==-1&&(e.push(u),a.push(u)),localStorageManager.setItem("ganttProjects",e.join(",")),r=e.length-1;r>=0;--r)e[r]=parseInt(e[r]);for(n=e.length-1;n>=0;--n)i=t[e[n]],undefined===i&&e.splice(n,1);for(n=a.length-1;n>=0;--n)i=t[a[n]],undefined===i&&a.splice(n,1);if(uu){for(o=k.currentUserIsModuleAdmin(),n=e.length-1;n>=0;--n)i=t[e[n]],undefined!==i&&(o||(1===i.status||2===i.status)&&e.splice(n,1));for(n=a.length-1;n>=0;--n)i=t[a[n]],undefined!==i&&(o||(1===i.status||2===i.status)&&a.splice(n,1))}f=e.length;pu(0===f);0===f&&h&&h.css({display:"none"});f>0?(jq("#gantt-filter-projects").projectadvancedSelector("select",e),wu(a.shift()),dt&&nr(!1)):vu()},ne=function(t,i){for(var r=0,o=i.length,f=[],u;r<o;++r)u=i[r].id,f.push(u),a.push(u);dt=!1;at=!0;h.css({display:""});nr(!0);e=f.slice(0);df();n.modelController().clear();pu(0===a.length);ti();hu();0===a.length&&h.css({display:"none"})},hu=function(){for(var i=a.length,n=0;n<i;++n)if(prjId=a.shift(),t[prjId].dataLoaded&&!ot)du(prjId),n==i-1&&(br(),h.css({display:"none"}));else{wu(prjId);break}gi()},cu=function(n,t){var r=0,u=k.removeBlockedUsersFromTeam(k.excludeVisitors(n)),e=u?u.length:0,f=s.find(".dropdown-content"),i;for(f.empty(),r=0;r<e;++r)i=u[r],f.append(jq("<li class='check-value'><input type='"+t+"' id='"+i.id+"' name='responsibles'/><label for='"+i.id+"' title='"+i.displayName+"'>"+i.displayName+" <\/label><\/li>"))},te=function(){vi=jq(".full-screen");yi=jq(".left-panel");st=jq("#zoomScale");pi=jq("#teamMemberFilter");ht=jq("#openTaskOnly");ht.prop("checked",!1);yt=jq(".fake-background");gt=jq("#parentTaskName");w=jq("#dependentTaskSelect");ct=jq("#linkTypeSelector");wi=jq("#addNewLinkPopup .save");yr=jq("#addNewLinkPopup .task-select");rt=jq("#statusListContainer");v=jq("#taskContextMenu");b=jq("#milestoneContextMenu");ut=jq("#taskStatus");ni=jq("#milestoneStatus");pt=jq("#emptyScreenForGanttLayout");s=jq("#responsiblesContainer");bi=jq("#ganttHelpPanel");et=jq("#ganttActions");ki=jq("#undoButton");di=jq("#reduButton");pr=jq("#createNewButton");et.append('<div id="btnCloseHelpActionsPanel" class="cancelButton" style="top:-1px" onclick="">×<\/div>');document.onselectstart=function(){return n.isEditTitleMode()};var r=jq("#createNewButton");jq("#showGanttHelp").click(function(n){var t=jq(n.target?n.target:n.srcElement);bi.is(":visible")?bi.hide():(it=!0,n.stopPropagation(),bi.show())});window.onbeforeunload=function(n){if(jq("#mainActionButtons").hasClass("disable")){var t=i.GanttOnBeforeUnloadMessage;if(typeof n=="undefined"&&(n=window.event),dt)return n&&(n.returnValue=t),t}};jq("#createNewMilestone").click(function(){e.length&&(p(),ASC.Projects.MilestoneAction.showNewMilestonePopup(),ASC.Projects.MilestoneAction.filterProjectsByIdInCombobox(e),r.hide())});jq("#createNewTask").click(function(){e.length&&(p(),ASC.Projects.TaskAction.showCreateNewTaskForm(),ASC.Projects.TaskAction.filterProjectsByIdInCombobox(e),r.hide())});ki.click(function(){jq(this).hasClass("disable")||jq("#mainActionButtons").hasClass("disable")||n.undoManager().undo()});di.click(function(){jq(this).hasClass("disable")||jq("#mainActionButtons").hasClass("disable")||n.undoManager().redo()});jq(".print").click(function(){if(!jq(this).parent().hasClass("disable")){var t=go(),n=window.open();n.document.open();n.document.write(t);n.document.close();n.focus()}});jq(".refresh").click(function(){wr()});jq(".scale-conteiner").on("click",".tl-combobox-container",function(){fi=!1});st.change(function(){if(fi)return fi=!1,!1;yu();localStorageManager.setItem("ganttZoomScale",jq(this).val())});jq("#todayPreset").click(function(){n&&(n.viewController().strafeToDay(),ti())});jq(".popupContainerClass .cancel").on("click",function(){return y(),jq.unblockUI(),!1});jq("#questionWindowDeleteMilestone .remove, #questionWindowTaskWithSubtasks .end").click(function(){return y(),n.modelController().finalize(),jq.unblockUI(),!1});jq("#questionWindowTaskRemove .remove").click(function(){y();tt=!0;of({},jq(this).data("taskid"));n.modelController().finalize();jq.unblockUI()});jq("#moveTaskOutMilestone .move-all").click(function(){return y(),n.modelController().finalize("SaveConnections"),jq.unblockUI(),!1});jq("#moveTaskOutMilestone .one-move").click(function(){return y(),n.modelController().finalize(),jq.unblockUI(),!1});jq("#addFirstTask").click(function(){return n.addNewTask(),pt.addClass("display-none"),!1});jq("#addFirstMilestone").click(function(){return n.addNewMilestone(),pt.addClass("display-none"),!1});jq("#hideEmptyScreen").click(function(){return pt.addClass("display-none"),!1});vi.click(function(){jq(this).hasClass("active")||ie()});yi.click(function(){jq(this).hasClass("active")||re()});jq("#hideActionsButton").click(function(){et.addClass("display-none");localStorageManager.setItem("hideActionHelpPlag",!0)});jq("#btnCloseHelpActionsPanel").click(function(){et.addClass("display-none");localStorageManager.setItem("hideActionHelpPlag",!0)});jq(document).keydown(function(t){var i=t.keyCode?t.keyCode:t.which?t.which:t.charCode;if(80===i&&(t.ctrlKey||t.metaKey)){t.preventDefault();jq(".print").click();return}if(!n.isEditTitleMode()&&!jq("#milestoneActionPanel").is(":visible")&&!jq("#addTaskPanel").is(":visible")){if(i==27)return pt.addClass("display-none"),!0;i!=72||at||(et.hasClass("display-none")?(localStorageManager.setItem("hideActionHelpPlag",!1),et.removeClass("display-none").addClass("display-block")):(localStorageManager.setItem("hideActionHelpPlag",!0),et.removeClass("display-block").addClass("display-none")))}return!0});jq(".addition").on("click",".filter-container .combobox-title",function(){p()});pi.change(function(){});ht.change(function(){br();ht.is(":checked")?localStorageManager.setItem("openTaskOnlyFilter",!0):localStorageManager.setItem("openTaskOnlyFilter",!1)});rt.on("click",".open",function(){y();rt.hide();jq(this).hasClass("underline")||n.modelController().finalizeStatus(eu.open)});rt.on("click",".closed",function(){y();rt.hide();jq(this).hasClass("underline")||n.modelController().finalizeStatus(eu.closed)});jq(".gantt-context-menu").mouseenter(function(){p()});jq(".gantt-context-menu").mouseleave(function(){y()});jq(".gantt-context-menu .dropdown-item").click(function(t){var i=jq(this).closest(".gantt-context-menu").attr("id"),r;if(i=="statusList")return!0;r=jq(this).attr("class").split(" ")[0];r=="responsible"?(s.data("prjid",jq("#"+i).data("prjid")),i=="milestoneContextMenu"?ur("milestone",b.data("id"),ou):ur("task",v.data("id")),t.stopPropagation()):(n.modelController().finalizeOperation(r),jq(".gantt-context-menu").hide())});jq("body").click(function(n){var i=jq(n.target?n.target:n.srcElement),t=!0;return jq(".blockPage").length?!0:i.closest(".check-value").length?!0:(i.closest(".addition").length&&!i.hasClass("HelpCenterSwitcher")&&(i.closest(".tl-combobox").length?p():y(),t=!0),t&&i.parents().each(function(){jq(this).hasClass("gantt-context-menu")&&(t=!0)}),it&&!jq(".gantt-context-menu:visible").length?(it=!1,t=!1):(it=!0,t=!0),t&&(y(),li||jq(".gantt-context-menu").hide(),li=!1,it=!0),!0)});jq(document).on("change","#dependentTaskSelect",function(){if(jq(this).val()=="-1")return ct.text(""),!1;rf();dr()});ct.change(function(){dr()});wi.click(function(){if(!jq(this).hasClass("disable")){var t={};t.linkType=parseInt(ct.data("value"));t.linkType==2?(t.parentTaskId=parseInt(w.val(),10),t.dependenceTaskId=parseInt(gt.data("taskid"),10)):(t.parentTaskId=parseInt(gt.data("taskid"),10),t.dependenceTaskId=parseInt(w.val(),10));t.linkType==3&&(t.linkType=2);d();Teamlab.addPrjTaskLink({link:t,prjId:w.data("prjid")},t.parentTaskId,t,{success:function(t){g();jq.unblockUI();t.link.projectId=t.prjId;uf(t.link);n.modelController().addLinkWithIds(t.link)},error:iu})}});s.on("change","input",function(){s.data("changed","true")});jq("#setResponsible").click(function(n){if(s.data("changed")!="true")return s.data("id",""),s.hide(),!0;s.data("changed","");var i={},f,r=s.data("prjid"),e=s.data("type"),u=s.data("id");e=="task"?(i=t[r].allTaskHash[u],f=i.status,delete i.status,i.responsibles=lu(),i.updRespFlag=!0,ri(i)):(i=t[r].milestonesHash[u],i.responsible=lu()[0],delete i.status,i.updRespFlag=!0,ui(i));jq(".gantt-context-menu").hide();n.stopPropagation()})},gi=function(){var t,i,r;if(localStorageManager.getItem("checkedCells")){for(t=localStorageManager.getItem("checkedCells").split(","),i=0;i<t.length;i++)f.find("input[id="+t[i]+"]").prop("checked",!0);n.leftPanelController().addRowsAvailable(t);localStorageManager.getItem("visibleCells")?(r=localStorageManager.getItem("visibleCells").split(","),n.leftPanelController().showHiddenRows(r)):n.leftPanelController().showHiddenRows([])}},wr=function(){ot||(n.modelController().clear(),ot=!0,au(!0))},y=function(){n.viewController().disableUserEvents(!1)},p=function(){n.viewController().disableUserEvents(!0)},d=function(){sr=!0;setTimeout(function(){sr&&LoadingBanner.displayLoading()},2e3);jq(".mode-button-container").addClass("disable");jq("#mainActionButtons").addClass("disable");pr.css({visibility:"hidden"});n.viewController().disableUserEvents(!0)},g=function(){jq(".mode-button-container").removeClass("disable");jq("#mainActionButtons").removeClass("disable");pr.css({visibility:"visible"});n.viewController().disableUserEvents(!1);sr=!1;LoadingBanner.hideLoading()},nr=function(n){n?(jq("#mainActionButtons").addClass("disable"),jq("#menuCreateNewButton").addClass("disable"),jq("#createNewButton").css({visibility:"hidden"})):(jq("#mainActionButtons").removeClass("disable"),jq("#menuCreateNewButton").removeClass("disable"),jq("#createNewButton").css({visibility:"visible"}))},ie=function(){vi.addClass("active");yi.removeClass("active");localStorageManager.setItem("ganttFullScreen",!0);n.viewController().fullscreen(!0);yt.removeClass("gray")},re=function(){yi.addClass("active");vi.removeClass("active");localStorageManager.setItem("ganttFullScreen",!1);n.viewController().fullscreen(!1);yt.addClass("gray")},lu=function(){var t=s.find("input:checked"),n=[];return t.each(function(){n.push(jq(this).attr("id"))}),n},au=function(n){ASC.Projects.GantChart(window);ot=!0;si=[];hi=[];vr=[];e=[];a=[];lf={};fu={};t={};kt=jq.getURLParam("PrjID");n||(te(),fe(),bf(),jq(document).find(".mainPageContent").append('<div id="block-panel" class="blocked-panel"/>'),h=jq("#block-panel"),h&&(h.mousemove(function(n){n.preventDefault();n.stopImmediatePropagation()}),h.mousedown(function(n){n.preventDefault();n.stopImmediatePropagation()}),h.mouseup(function(n){n.preventDefault();n.stopImmediatePropagation()}),h.bind("contextmenu",function(){return!1})));h.css({display:""});nr(!0);Teamlab.bind(Teamlab.events.addPrjMilestone,function(n,t){nf(t,!0,!0)});Teamlab.getPrjProjects({reload:n},{filter:{sortBy:"",sortOrder:"",status:"",fields:"id,title,security,isPrivate,status,responsible"},success:function(n,t){ASC.Projects.Master.Projects=t;ue(n.reload)}})},ue=function(i){for(var u=ASC.Projects.Master.Projects,o=u.length,f=[],e=[],r=0;r<o;r++)if(t[u[r].id]=u[r],uu){if(1===u[r].status||2===u[r].status)continue;0===u[r].status&&(u[r].isInTeam?f.push(u[r]):e.push(u[r]))}f.length>0&&(f[f.length-1].classname="separator");vr=f.concat(e);kf();gi();i||(jq(document).bind("loadTasks",function(n,t){cr=!0;jq(document).trigger("loadData",[{prjId:t.prjId}])}),jq(document).bind("loadMilestones",function(n,t){lr=!0;jq(document).trigger("loadData",{prjId:t.prjId})}),jq(document).bind("loadGanttIndex",function(n,t){ar=!0;jq(document).trigger("loadData",{prjId:t.prjId})}),jq(document).bind("loadData",function(i,r){if(lr&&cr&&ar){if(!r)return;t[r.prjId].dataLoaded=!0;du(r.prjId);oi&&vu();a.length==0?(br(),n.viewController().loadViewState(!0),ot=!1,gi(),h.css({display:"none"})):hu()}}))},fe=function(){(wf(),window.Gantt.Teamlab_shortmonths=Teamlab.constants.nameCollections.shortmonths,window.Gantt.Teamlab_months=Teamlab.constants.nameCollections.months,window.Gantt.Localize_strings=r,u.push(document.getElementById("layer0")),u.push(document.getElementById("layer1")),u[ft]&&u[o])&&(ai.push(u[ft].getContext("2d")),ai.push(u[o].getContext("2d")),ai[ft]&&ai[o])&&(u[o].onselectstart=function(){return!1},u[o].onmousedown=function(){return!1},u[o].oncontextmenu=function(){return!1},n=new Gantt.TimeLine(u[ft],u[o]),localStorageManager.getItem("ganttZoomScale")&&st.val(localStorageManager.getItem("ganttZoomScale")),st.tlcombobox(),yu(),tr(),n.viewController().strafeToDay(),kr())},vu=function(){localStorageManager.getItem("hideActionHelpPlag")||at||et.removeClass("display-none").addClass("display-block");ee();n.userDefaults().setFontFamily(jq("body").css("fontFamily"));n.update();n.viewController().enableSlipAnimation(!0);se();ao();localStorageManager.getItem("openTaskOnlyFilter")?ht.prop("checked",!0):ht.prop("checked",!1);gi();oi=!1},yu=function(){var t=parseInt(st.val());t===1?n.viewController().scaleTo(vf,undefined,!0):t===7?n.viewController().scaleTo(yf,undefined,!0):t===4&&n.viewController().scaleTo(pf,undefined,!0)},ee=function(){dt&&(jq("#menuCreateNewButton").removeClass("disable"),at=!1)},pu=function(t){pt.css({display:t?"block":"none"});n.needDrawFlashBackground(t)},ts=function(){if(oi)return!1;var n="projects.aspx",t=jq.getURLParam("prjID");t&&Teamlab.getPrjTeam({},t,{success:function(t,i){ASC.Projects.Master.TeamWithBlockedUsers=i;ASC.Projects.Master.Team=k.removeBlockedUsersFromTeam(ASC.Projects.Master.TeamWithBlockedUsers);var r=k.userInProjectTeam(Teamlab.profile.id);hf.isPrivate&&!r&&(document.location=n);!r||r.canReadTasks&&r.canReadMilestones||(document.location=n)}})},wu=function(n){LoadingBanner.displayLoading();cr=!1;lr=!1;ar=!1;var i=k.filterParamsForListTasks;delete i.status;i.projectId=n;Teamlab.getPrjTasksSimpleFilter({prjId:n},{filter:i,success:function(n,i){t[n.prjId].tasks=i;jq(document).trigger("loadTasks",[{prjId:n.prjId}])}});Teamlab.getPrjMilestones({prjId:n},{filter:i,success:function(n,i){t[n.prjId].milestones=i;jq(document).trigger("loadMilestones",[{prjId:n.prjId}])}});Teamlab.getPrjGanttIndex({prjId:n},n,{success:function(n,i){t[n.prjId].ganttIndex=typeof i=="string"?jq.parseJSON(i):{};jq(document).trigger("loadGanttIndex",[{prjId:n.prjId}])},error:function(n){t[n.prjId].ganttIndex={};jq(document).trigger("loadGanttIndex",[{prjId:n.prjId}])}});kt&&kt==n?t[n].team=ASC.Projects.Master.Team:Teamlab.getPrjTeam({prjId:n},n,{success:function(n,i){t[n.prjId].team=i}})},br=function(){y();var i={};i.status=ht.prop("checked")?!0:undefined;i.participant=pi.val()!="-1"?pi.val():undefined;cf=!0;n.modelController().setFilter(function(n){var r=n.owner();n.isMilestone()?n.filter=i.status&&n.status()==1?!0:!1:oe(i,n)?(n.filter=!1,t[r].allTaskHash[n.id()].visible=!0):(n.filter=!0,t[r].allTaskHash[n.id()].visible=!1)})},oe=function(n,i){var e=!1,r=!1,u,f;if((!n.status||n.status&&i.status()==1)&&(e=!0),!n.participant)return r=!0,e&&r;if(u=t[i.owner()].allTaskHash[i.id()].responsibles,n.participant&&u.length)for(f=0;f<u.length;f++)if(n.participant==u[f].id){r=!0;break}return n.participant=="00000000-0000-0000-0000-000000000000"&&u.length==0&&(r=!0),e&&r},se=function(){document.onmousemove=function(t){n.onmousemove(t)};document.onkeypress=function(t){if(h&&"none"===h.css("display"))n.onkeypress(t)};document.onkeydown=function(t){if(h&&"none"===h.css("display"))n.onkeydown(t)};document.onkeyup=function(t){return h&&"none"===h.css("display")?n.onkeyup(t):!1};document.onmouseup=function(t){n.focus(!1,t)};document.onpaste=function(t){n.onpaste(t)};document.oncopy=function(t){n.oncopy(t)};window.onresize=function(){tr();ti();n.render()};u[o].onmousemove=function(t){n.onmousemove(t)};u[o].onmousedown=function(t){n.onmousedown(t)};u[o].onmouseup=function(t){n.onmouseup(t)};u[o].ondblclick=function(t){n.ondblclick(t)};ko();u[o].addEventListener?"onwheel"in u[o]?(u[o].addEventListener("wheel",er,!1),u[o].addEventListener("wheel",function(n){return n.preventDefault(),!1},!1)):"onmousewheel"in u[o]?(u[o].addEventListener("mousewheel",er,!1),u[o].addEventListener("mousewheel",function(n){return n.preventDefault(),!1},!1)):u[o].addEventListener("MozMousePixelScroll",er,!1):(u[o].attachEvent("onmousewheel",er),u[o].addEventListener("onmousewheel",function(){return!1},!1));jq(".left-panel").bind("mousewheel DOMMouseScroll",function(){jq(".advanced-selector-container ").first().css({display:"none"});v.is(":visible")&&v.hide()});c=n.viewController().buildZoomBar(document.getElementById("ganttChartZoom"));tr();kr();n.update();n.viewController().toVisibleElementMove();ti();tr();window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(n){window.setTimeout(n,1e3/15)}}();bu()},bu=function(){requestAnimFrame(bu);kr()},kr=function(){n.render()},ku=!0,tr=function(){var t=window.innerWidth-48,f=yt.position().top,i=window.innerHeight-f,r=parseInt(jq(".mainPageLayout").first().css("min-width"),10);t=t>r?t:r;(u[ft].width!=t||u[ft].height!=i)&&(u[ft].width=t,u[ft].height=i,u[o].width=t,u[o].height=i,n.update());c&&c.canvas()&&(c.canvas().width!=c.dom().clientWidth||c.canvas().height!=c.dom().clientHeight)&&(c.canvas().width=c.dom().clientWidth,c.canvas().height=c.dom().clientHeight,c.needRepaint());ku&&(ti(),ku=!1)},ti=function(){var n=window.innerWidth-48,u=yt.position().top,f=window.innerHeight-u,r=parseInt(jq(".mainPageLayout").first().css("min-width"),10),i,t;n=n>r?n:r;yt.height(f);i=169;t=n-jq("#mainActionButtons").width()-jq(".zoom-presets").outerWidth()-i;jq("#ganttChartZoom").width(t);oi&&(jq("#ganttChartZoom").css("border","1px solid #ccc"),jq("#ganttChartZoom").css("backgroundColor","#fff"));i=192;t=jq(".filter-container").width()-jq(".mode-button-container").width()-jq(".task-filter-container:first").outerWidth()-jq(".task-filter-container:last").outerWidth();jq(".task-filter-container .tl-combobox").css({maxWidth:t});jq("#ZoomBarId").is("canvas")&&(jq("#ZoomBarId").width(jq("#ganttChartZoom").width()),c&&(c.canvas().width=c.dom().clientWidth,c.canvas().height=c.dom().clientHeight,c.needRepaint()))},du=function(i){var r=t[i];he(r);ae(r);le(r);n.modelController().buildWithThroughIndexer();LoadingBanner.hideLoading()},he=function(t){var c=t.title,o=t.id,r="",l=t.created?new Date(t.created):new Date,a=t.ganttIndex,s=window.UserManager.getUser(t.responsibleId),i,h,u,f;s?(t.responsible=s,r=t.responsible):undefined!==t.responsible&&undefined!==t.responsible.displayName&&(r=t.responsible);i=!1;(k.currentUserIsModuleAdmin()||t.responsible.id==Teamlab.profile.id)&&(i=!0);Teamlab.profile.isVisitor&&(i=!1);h=1e3;u=t.status;i||(u=h);i?(dt=!0,at=!1,nr(!1)):(f=e.indexOf(o),-1!==f&&e.splice(f,1));n.modelController().addProject(o,c,"",r,l,a,t.isPrivate,u)},bt=function(n){return n.setHours(0),n.setMilliseconds(0),n.setMinutes(0),n.setSeconds(0),n},gu=function(n){for(var r=n.length,i=[],t=0;t<r;++t)i.push(window.UserManager.getUser(n[t]));return i},ce=function(i,r,u){var c=[],it=i.title,rt=i.description,p=i.deadline,s=bt(i.crtdate),w=i.startDate,ut=i.priority,b=i.status,l=i.projectOwner,ft=i.subtasksCount?i.subtasksCount:0,k,e,f,a=[],d=-1,g=!1,v=i.id,y,h,tt,o;if(i.responsibles.length){if("string"==typeof i.responsibles[0])a=gu(i.responsibles);else{for(y=[],h=0;h<i.responsibles.length;++h)y.push(i.responsibles[h].id);a=gu(y)}k=Encoder.htmlDecode(i.responsibles[0].displayName)}if(i.milestoneId&&(d=i.milestoneId),f=undefined,p?f=new Date(p):b==2&&i.uptdate&&(f=new Date(i.uptdate)),f&&(f=bt(f)),e=undefined,w?e=bt(w):(f&&s<=f&&(e=bt(s)),f&&s>f&&(e=f),g=!0),e||(e=bt(s)),tt=2,c=[],i.links)for(o=0;o<i.links.length;++o)i.links[o].parentTaskId!==v&&tt===i.links[o].linkType&&c.push(i.links[o]);"number"==typeof i.projectOwner?l=i.projectOwner:"object"!=typeof i.projectOwner||isNaN(i.projectOwner.id)||(l=i.projectOwner.id);n.modelController().addTask(v,l,it,k,rt,e,f,b,d,ut,ft,a,c,u,g);r&&(t[i.projectId].allTaskHash[i.id]=i,t[i.projectId].allTaskHash[i.id].visible=!0,t[i.projectId].taskCount++,nt(i.projectId),n.update(),n.viewController().disableUserEvents(!1),n.viewController().centeringElement(v))},nf=function(i,r,u){if(i){var f=i.id,e=i.title,o=i.description,s=bt(i.deadline),h="";i.responsible&&(h=Encoder.htmlDecode(i.responsible.displayName));var c=i.projectId,l=i.isKey,a=i.status;n.modelController().addMilestone(f,c,e,o,i.responsible,new Date(s),a,l,u)}r&&(t[i.projectId].milestonesHash[i.id]=i,t[i.projectId].milestoneCount++,nt(i.projectId),n.update(),n.viewController().disableUserEvents(!1),n.viewController().centeringElement(f,!0))},le=function(n){if(0===n.status){var t;for(si=n.tasks.slice(0),n.taskCount=si.length,n.allTaskHash={};t=si.pop();)n.allTaskHash[t.id]=t,n.allTaskHash[t.id].visible=!0,ce(t)}},ae=function(n){if(0===n.status){var t;for(n.milestonesHash={},hi=n.milestones.slice(0),n.milestoneCount=hi.length;t=hi.pop();)n.milestonesHash[t.id]=t,nf(t)}},lt=function(n,i){var r={title:n.title()?n.title():""},f,u;if(r.description=n.description()?n.description():"",i){for(r.id=n.id(),r.responsibles=[],f=n.responsibles(),u=0;u<f.length;u++)r.responsibles.push(f[u].id);r.priority=t[n.owner()].allTaskHash[r.id].priority}return n.beginDate()&&(r.startDate=Teamlab.serializeTimestamp(n.beginDate())),n.isUndefinedBeginTime()&&(r.startDate=undefined),n.isUndefinedEndTime()?r.deadline=undefined:n.endDate()&&(r.deadline=Teamlab.serializeTimestamp(n.endDate())),n.owner()&&(r.projectId=n.owner()),r.milestoneId=n.milestone,r},ir=function(n,i){var r={title:n.title()?n.title():""};return r.description=n.description()?n.description():"",i?(r.id=n.id(),r.isKey=t[n.owner()].milestonesHash[r.id].isKey,r.responsible=n.responsibles()):r.responsible=t[n.owner()].responsibleId,r.deadline=Teamlab.serializeTimestamp(n.endDate()),n.owner&&(r.projectId=n.owner()),r},ve=function(n){p();n.links.length?jq("#noteAboutLinks").removeClass("display-none"):jq("#noteAboutLinks").addClass("display-none");PopupKeyUpActionProvider.CloseDialogAction=vt;StudioBlockUIManager.blockUI(jq("#questionWindowTaskRemove"),400,200,0);PopupKeyUpActionProvider.EnterAction="jq('#questionWindowTaskRemove .remove').click();";jq("#questionWindowTaskRemove .remove").data("taskid",n.id())},ye=function(n){p();PopupKeyUpActionProvider.CloseDialogAction=vt;StudioBlockUIManager.blockUI(jq("#questionWindowDeleteMilestone"),400,200,0);PopupKeyUpActionProvider.EnterAction="jq('#questionWindowDeleteMilestone .remove').click();";jq("#questionWindowDeleteMilestone").attr("milestoneId",n)},pe=function(n){p();PopupKeyUpActionProvider.CloseDialogAction=vt;StudioBlockUIManager.blockUI(jq("#questionWindowTaskWithSubtasks"),"auto",200,0);PopupKeyUpActionProvider.EnterAction="jq('#questionWindowTaskWithSubtasks .end').click();";jq("#questionWindowTaskWithSubtasks .end").data("taskid",n)},tf=function(){p();PopupKeyUpActionProvider.CloseDialogAction=vt;StudioBlockUIManager.blockUI(jq("#questionWindowMilestoneTasks"),400,200,0);PopupKeyUpActionProvider.EnterAction="jq('#questionWindowMilestoneTasks .cancel').click();"},we=function(){p();PopupKeyUpActionProvider.CloseDialogAction=vt;StudioBlockUIManager.blockUI(jq("#moveTaskOutMilestone"),"auto",200,0);PopupKeyUpActionProvider.EnterAction="jq('#moveTaskOutMilestone .cancel').click();"},be=function(n){ke(n)?(p(),PopupKeyUpActionProvider.CloseDialogAction=vt,StudioBlockUIManager.blockUI(jq("#addNewLinkPopup"),400,200,0)):k.displayInfoPanel(i.GanttNotAvailableTaskLink,!0)},ke=function(n){var o,s=!1,u=-1,f=t[n.owner()],e=f.allTaskHash[n.id()],i,r;gt.text(e.title).data("taskid",e.id);r=w.find("option:first");w.remove();yr.find(".tl-combobox-container").remove();yr.append("<select id='dependentTaskSelect'><\/select>");w=jq("#dependentTaskSelect");for(o in f.allTaskHash)i=f.allTaskHash[o],i.visible&&de(e,i)&&(r=document.createElement("option"),r.setAttribute("value",i.id),r.appendChild(document.createTextNode(i.title)),w.append(r),-1===u&&(u=i.id,s=!0));return-1!==u&&(w.data("prjid",f.id),w.val(u+"").tlcombobox(),ct.text(""),rf(),dr()),s},de=function(n,t){var r=0,i;if(t.id==n.id||t.status==2||t.milestoneId!=n.milestoneId||!t.deadline&&!n.deadline)return!1;if(n.links&&(r=n.links.length),r>0)for(i=0;i<r;i++)if(n.links[i].parentTaskId==t.id||n.links[i].dependenceTaskId==t.id)return!1;return!0},rf=function(){var u=w.data("prjid"),n=t[u].allTaskHash[gt.data("taskid")],r=t[u].allTaskHash[w.val()],f=n.startDate?n.startDate:n.crtdate,e=r.startDate?r.startDate:r.crtdate,o=n.deadline?n.deadline:undefined,s=r.deadline?r.deadline:undefined,h=k.getPossibleTypeLink(f,o,e,s,{});h[2]==k.linkTypeEnum.start_end?ct.text(i.RelatedLinkTypeSE).data("value",k.linkTypeEnum.start_end):ct.text(i.RelatedLinkTypeES).data("value",k.linkTypeEnum.end_start)},dr=function(){w.val()!="-1"?wi.removeClass("disable"):wi.addClass("disable")},uf=function(n){var i=t[n.projectId];i.allTaskHash[n.parentTaskId].links?i.allTaskHash[n.parentTaskId].links.push(n):i.allTaskHash[n.parentTaskId].links=[n];i.allTaskHash[n.dependenceTaskId].links?i.allTaskHash[n.dependenceTaskId].links.push(n):i.allTaskHash[n.dependenceTaskId].links=[n]},ff=function(n,t){return n.parentTaskId==t.parentTaskId&&n.dependenceTaskId==t.dependenceTaskId?!0:n.parentTaskId==t.dependenceTaskId&&n.dependenceTaskId==t.parentTaskId},ge=function(n){d();Teamlab.addPrjTask({},n.projectId,n,{success:no,error:rr})},no=function(i,r){t[r.projectId].allTaskHash[r.id]=r;t[r.projectId].allTaskHash[r.id].visible=!0;n.modelController().applyNewAddTaskId(r.id);t[r.projectId].taskCount++;nt(r.projectId)},ii=function(n,i,r){var u,e,f;for(d(),u=0,e=i.length;u<e;u++)f={},f.newMilestoneID=n,Teamlab.updatePrjTask({links:r},i[u],f,{success:function(n,i){if(t[i.projectId].allTaskHash[i.id]=i,nt(i.projectId),n.links)for(var r=0;r<n.links.length;++r)nu(n.links[r].link)},error:rr})},rr=function(){g()},ri=function(n){d();var t={};n.updRespFlag&&(t.updRespFlag=!0);Teamlab.updatePrjTask(t,n.id,n,{success:to,error:rr})},ef=function(n){var t,i=n.length;if(i)for(d(),ei=i,t=0;t<i;t++)Teamlab.updatePrjTask({},n[t].id,n[t],{success:io,error:rr})},to=function(i,r){var u=t[r.projectId].allTaskHash[r.id].visible;t[r.projectId].allTaskHash[r.id]=r;t[r.projectId].allTaskHash[r.id].visible=u;i.updRespFlag&&n.modelController().finalizeOperation("responsible",r.responsibles);nt(r.projectId)},io=function(n,i){ei=ei-1;t[i.projectId].allTaskHash[i.id]=i;ei==0&&nt(i.projectId)},of=function(n,t){d();Teamlab.removePrjTask(n,t,{success:ro,error:uo})},ro=function(n,i){delete t[i.projectId].allTaskHash[i.id];t[i.projectId].taskCount--;nt(i.projectId)},uo=function(){},fo=function(n,t){d();var i=n.projectId;Teamlab.addPrjMilestone({tasksIds:t},i,n,{success:oo,error:gr})},ui=function(n,t){d();var i={},r={tasks:t,milestoneId:n.id};t||typeof n.status=="undefined"?(i=n,n.updRespFlag&&(r.updRespFlag=!0)):i.status=n.status;Teamlab.updatePrjMilestone(r,n.id,i,{success:eo,error:gr})},eo=function(i,r){var f,s,e=t[r.projectId],h=e.milestonesHash[r.id],u=i.tasks,o=[];if(h.deadline>r.deadline&&u){for(s=u.length,f=0;f<s;++f)e.allTaskHash[u[f].id()].deadline>r.deadline&&e.allTaskHash[u[f].id()].status==1&&(u[f].milestone=i.milestoneId,o.push(lt(u[f],!0)));ef(o)}u&&u.length&&o.length||g();e.milestonesHash[r.id]=r;i.updRespFlag&&n.modelController().finalizeOperation("responsible",r.responsible)},oo=function(i,r){t[r.projectId].milestonesHash[r.id]=r;i.tasksIds&&ii(r.id,i.tasksIds);n.modelController().applyNewAddMilestoneId(r.id,r.responsible);t[r.projectId].milestoneCount++;nt(r.projectId)},gr=function(){ot=!0;wr();tf();g()},so=function(n){d();Teamlab.removePrjMilestone({},n,{success:ho,error:gr})},ho=function(n,t){delete fu[t.id];af--;nt(t.projectId)},nu=function(n){d();Teamlab.addPrjTaskLink({link:n},n.parentTaskId,n,{success:co,error:iu})},tu=function(n){d();var t={dependenceTaskId:n.dependenceTaskId,parentTaskId:n.parentTaskId};Teamlab.removePrjTaskLink({link:n},n.dependenceTaskId,t,{success:lo,error:iu})},co=function(n){uf(n.link);g()},iu=function(n,t){t[0]!="link already exist"&&(ot=!0,wr(),ASC.Projects.Base.showCommonPopup("createNewLinkError",y,y),g())},lo=function(n){var i,u,r=n.link,f,e=t[r.projectId].allTaskHash[r.parentTaskId],o=t[r.projectId].allTaskHash[r.dependenceTaskId];if(e.links&&o.links){for(f=e.links.length,i=0,u=f;i<u;++i)if(ff(e.links[i],r)){e.links.splice(i,1);break}for(f=o.links.length,i=0,u=f;i<u;++i)if(ff(o.links[i],r)){o.links.splice(i,1);break}g()}},nt=function(i){if(!tt){g();return}t[i].ganttIndex=n.modelController().throughIdsIndexes(i);var r={};r.id=i;r.order=JSON.stringify(t[i].ganttIndex);Teamlab.setPrjGanttIndex({},i,r,{success:function(){g()},error:function(){g()}});tt=!1},ao=function(){var e=-10,o=10,v=0,y=1,c=2,w=40,l=100,h=-1,b=10,k=20;n.addHandler("101",function(n,t,i,r){tt=!0;r.milestone=t;var u=lt(r);u.projectId||(u.projectId=n);ge(u)});n.addHandler("111",function(n,t,i){tt=!0;of({},i)});n.addHandler("270",function(t){var i={};i.parentTaskId=t.task.id();i.dependenceTaskId=t.parent.id();i.linkType=c;i.projectId=t.task.owner();e===t.parentSide&&o===t.side?i.linkType=c:e===t.parentSide&&e===t.side?i.linkType=v:o===t.parentSide&&o===t.side&&(i.linkType=y);nu(i);n.modelController().finalize()});n.addHandler("280",function(t,i){t.projectId=i.owner();tu(t);n.modelController().finalize()});n.addHandler("140",function(t,i){t.projectId=i.owner();nu(t);n.modelController().finalize()});n.addHandler("145",function(t,i){t.projectId=i.owner();tu(t);n.modelController().finalize()});n.addHandler("350",function(n){be(n)});n.addHandler("112",function(n,t,i){tt=!0;so(i.id())});n.addHandler("102",function(n,t,i){var f,e,r,u;for(tt=!0,f=i.tasks(),e=[],r=0;r<f.length;++r)e.push(f[r].id());u=ir(i);u.projectId||(u.projectId=n);fo(u,e)});n.addHandler("121",function(n,t,i,r){r.milestone=t;ri(lt(r,!0))});n.addHandler("122",function(n,t,i){ui(ir(i,!0))});n.addHandler("123",function(n,t,i,r,u){var e,f;if(r.isMilestone())ui(ir(r,!0),r.tasks());else if(e=[],r.milestone=t,u){for(e.push(lt(r,!0)),f=0;f<u.length;++f)u[f].change&&(u[f].milestone=t,e.push(lt(u[f],!0)));ef(e)}else ri(lt(r,!0))});n.addHandler("124",function(n,t,i,r){r.milestone=t;var u=lt(r,!0);u.status=r.status();ri(u)});n.addHandler("125",function(n,t,i){var r={};r.id=t;r.status=i.status();ui(r)});n.addHandler("130",function(n,t,i,r,u,f,e,o){if(tt=!0,!t&&!u){nt(n);return}if(o)ii(t,[i],e);else{if(e)for(var s=0;s<e.length;++s)tu(e[s].link);ii(u,[i])}});n.addHandler("150",function(n,t){tt=!0;n?ii(n,t):ii(0,t)});n.addHandler("300",function(){we()});n.addHandler("UndoRedoUI",function(n,t){n?ki.removeClass("disable"):ki.addClass("disable");t?di.removeClass("disable"):di.addClass("disable")});n.addHandler("200",function(n,t,i,r){ve(r)});n.addHandler("220",function(n,t){ye(t)});n.addHandler("240",function(t,i,r,u){if(u.subtasks().length&&u.status()!=2)for(var f=0;f<u.subtasks().length;f++)if(u.subtasks()[f].status==1){pe(u);return}n.modelController().finalize()});n.addHandler("260",function(t,i,r){var f=r.tasks(),u;if(f.length&&r.status()!=1)for(u=0;u<f.length;u++)if(f[u].status()==1){tf();return}n.modelController().finalize()});n.addHandler("500",function(n,t){var n=n||{};yo(n,t)});n.addHandler("502",function(n,t,i,r){at||(ci=n,ou=r,i?po(t,n):wo(t,n))});n.addHandler("503",function(n,t,i){ci=t;i||s.data("id","");s.data("prjid",n.owner());n.isMilestone()?ur("milestone",n.id()):ur("task",n.id());li=undefined===i?!0:!1});n.addHandler("160",function(n){var i,u,r;if(n.isMilestone())ui(ir(n,!0));else{for(i=t[n.owner()].allTaskHash[n.id()],u=n.responsibles(),r=0;r<u.length;r++)i.responsibles.push(u[r].id);delete i.status;ri(i)}});n.viewController().onchangetimescale=function(n){var t=-1;t=w<n&&n<=l?7:n>l?4:1;t!==h&&(h=t,vo(h))};n.viewController().onshowhint=function(n,t,i){t?b===n?sf("collapse",i):k===n&&sf("expand",i):jq(".gantt-hint").hide()};var g=f.height(),r=!1,u=function(t){var e,o,i,u,h,s;if(r){for(e=t.toElement,t.currentTarget&&(e=t.currentTarget),o=e.id,i=localStorageManager.getItem("checkedCells").split(","),i.splice(i.indexOf(o),1),e.checked?i.splice(0,0,o):i.push(o),localStorageManager.setItem("checkedCells",i.join(",")),u=[],h=f.find("input:checked"),s=0;s<h.length;s++)u.push(jq(h[s]).attr("id"));localStorageManager.getItem("visibleCells")&&0!==localStorageManager.getItem("visibleCells").length&&u.push.apply(u,localStorageManager.getItem("visibleCells").split(","));n.leftPanelController().addRowsAvailable(i);n.leftPanelController().showHiddenRows(u);localStorageManager.setItem("visibleCells",u.join(",")+","+localStorageManager.getItem("visibleCells"));f.hide()}},d=function(){var o;if(!r){var t=0,e=[],i=[],u=[];for(localStorageManager.getItem("checkedCells")&&0!==localStorageManager.getItem("visibleCells").length&&(i=localStorageManager.getItem("checkedCells").split(",")),localStorageManager.getItem("visibleCells")&&0!==localStorageManager.getItem("visibleCells").length&&(u=localStorageManager.getItem("visibleCells").split(",")),o=f.find("input:checked"),t=0;t<o.length;t++)e.push(jq(o[t]).attr("id"));for(t=i.length-1;t>=0;--t)-1==e.indexOf(i[t])&&i.splice(t,1);for(t=u.length-1;t>=0;--t)-1==i.indexOf(u[t])&&u.splice(t,1);if(0===o.length)u=[],i=[];else{for(t=e.length-1;t>=0;--t)-1!==i.indexOf(e[t])&&e.splice(t,1);i=e.concat(i);u=e.concat(u)}n.leftPanelController().addRowsAvailable(i);n.leftPanelController().showHiddenRows(u);localStorageManager.setItem("checkedCells",i.join(","));localStorageManager.setItem("visibleCells",u.join(","));f.hide()}},a=function(n){var r={menuItems:[{id:"Responsibility",title:i.GanttLeftPanelResponsibles},{id:"BeginDate",title:i.GanttLeftPanelBeginDate},{id:"EndDate",title:i.GanttLeftPanelEndDate},{id:"Status",title:i.GanttLeftPanelStatus},{id:"Priority",title:i.GanttLeftPanelPriority}]},e,t,o;if(f=jq("#ganttCellChecker"),n)for(e=!1,t=0;t<r.menuItems.length;++t){for(e=!1,o=0;o<n.length;++o)if(n[o]===r.menuItems[t].id){e=!0;break}e||(r.menuItems.splice(t,1),--t)}f.find(".panel-content").empty().append(jq.tmpl("projects_linedListWithCheckbox",r));f.find("input").css("display",n?"none":"");f.find(".dropdown-item").each(function(){jq(this).css("border","none")});f.find(".dropdown-content").each(function(){jq(this).css("margin-top","0px")});f.addClass("gantt-context-menu").css("width","auto");jq("#Responsibility").click(function(n){u(n)});jq("#BeginDate").click(function(n){u(n)});jq("#EndDate").click(function(n){u(n)});jq("#Status").click(function(n){u(n)});jq("#Priority").click(function(n){u(n)})};jq("#showChoosedFields").click(function(n){d(n)});n.leftPanelController().onfieldsfilter=function(n,t,i,u,e){var o,s,h;if(localStorageManager.setItem("checkedCells",e.join(",")),t){if(o=[],localStorageManager.getItem("visibleCells")&&0!==localStorageManager.getItem("visibleCells").length&&(o=localStorageManager.getItem("visibleCells").split(",")),o.length){for(s=o.length-1;s>=0;--s)-1===e.indexOf(o[s])&&o.splice(s,1);localStorageManager.setItem("visibleCells",o.join(","))}return}if(f.is(":visible")&&!r){f.hide();return}for(it=!0,p(),n.preventDefault?n.preventDefault():n.returnValue&&(n.returnValue=!1),n.stopPropagation&&n.stopPropagation(),a(undefined),jq(".gantt-context-menu").hide(),f.css({overflow:"hidden",left:i-20,top:u,height:"auto"}),f.find("input").prop("checked",!1),h=0;h<e.length;h++)f.find("input[id="+e[h]+"]").prop("checked",!0);jq("#showChoosedFields").css({display:""});r=!1;f.show()};n.leftPanelController().onhiddenfieldsfilter=function(n,t,i,u,e,o){if(localStorageManager.setItem("visibleCells",o.join(",")),!t){if(f.is(":visible")&&r){f.hide();return}it=!0;p();n.preventDefault?n.preventDefault():n.returnValue&&(n.returnValue=!1);n.stopPropagation&&n.stopPropagation();a(e);jq(".gantt-context-menu").hide();f.css({overflow:"hidden",left:i-20,top:u,height:"auto"});jq("#showChoosedFields").css({display:"none"});f.find("input").prop("checked",!1);for(var s=0;s<e.length;s++)f.find("input[id="+e[s]+"]").prop("checked",!1);r=!0;f.show()}};n.leftPanelController().onchangetimes=function(n,t,i){ns(!0,n,t,i)}},vo=function(n){var i=jq(".zoom-presets .combobox-title-inner-text"),t=st.val();t!=n&&(fi=!0,st.val(n).change(),localStorageManager.setItem("ganttZoomScale",n))},sf=function(n,t){var i=jq(".gantt-hint");i.length||(jq("body").append("<div class='gantt-hint'><\/div>"),i=jq(".gantt-hint"));n=="expand"?i.text(r.expand):i.text(r.collapse);i.css({left:t.left-10,top:t.top+10});i.show()},yo=function(n,t){if(rt.data("id")==n.id())return rt.data("id",""),!0;rt.data("id",n.id());fr(rt,t.left-10,t.top-1)},po=function(n,i){if(v.is(":visible")&&v.data("id")==n.id())return v.hide(),!0;var r=t[n.owner()].allTaskHash[n.id()];v.data("id",r.id);v.data("prjid",n.owner());r.status==2?(v.find(".edit").hide(),v.find(".addlink").hide(),jq("#taskResponsible").hide(),ut.removeAttr("class").addClass("open dropdown-item"),ut.text(ut.data("opentext"))):(v.find(".edit").show(),v.find(".addlink").show(),jq("#taskResponsible").show(),ut.removeAttr("class").addClass("closed dropdown-item"),ut.text(ut.data("closetext")));fr(v,i.left,i.top)},wo=function(n,i){if(b.is(":visible")&&b.data("id")==n.id())return b.hide(),!0;var r=t[n.owner()].milestonesHash[n.id()];b.data("id",r.id);b.data("prjid",n.owner());r.status==1?(b.find(".edit").hide(),b.find(".addMilestoneTask").hide(),jq("#milestoneResponsible").hide(),ni.removeAttr("class").addClass("open dropdown-item"),ni.text(ut.data("opentext"))):(b.find(".edit").show(),b.find(".addMilestoneTask").show(),jq("#milestoneResponsible").show(),ni.removeAttr("class").addClass("closed dropdown-item"),ni.text(ut.data("closetext")));fr(b,i.left,i.top)},ur=function(n,i){var r,f,u;if(s.data("id")==i)return s.data("id",""),!0;for(r={},f=s.data("prjid"),s.data("id",i),s.data("type",n),n=="task"?(cu(t[f].team,"checkbox"),r=t[f].allTaskHash[i].responsibles):(cu(t[f].team,"radio"),r=[t[f].milestonesHash[i].responsible]),u=0;u<r.length;u++)r[u].id?jq("#"+r[u].id).prop("checked",!0):jq("#"+r[u]).prop("checked",!0);fr(s,ci.left,ci.top)},fr=function(n,t,i){jq(".gantt-context-menu").hide();bo(n,t,i);it=!0;document.getElementById(n.attr("id")).oncontextmenu=function(){return!1};n.show()},bo=function(n,t,i){var r=window.innerWidth,e=window.innerHeight,u=n.outerWidth(),f=n.outerHeight();r-t<u&&(t=r-u-14);e-i<f&&(i=i-f-16);n.css({left:t,top:i})},er=function(t){jq(".gantt-context-menu").hide();it=!0;n.onmousewheel(t);n.update();jq(".advanced-selector-container ").first().css({display:"none"})},or=function(t){var f=t.changedTouches,i=f[0],r="",u;switch(t.type){case"touchstart":r="mousedown";break;case"touchmove":r="mousemove";break;case"touchend":r="mouseup";break;default:return}n.setEnableTouch(!0);u=document.createEvent("MouseEvent");u&&(u.initMouseEvent(r,!0,!0,window,1,i.screenX,i.screenY,i.clientX,i.clientY,!1,!1,!1,!1,0,null),i.target.dispatchEvent(u));t.preventDefault()},ko=function(){document.addEventListener("touchstart",or,!0);document.addEventListener("touchmove",or,!0);document.addEventListener("touchend",or,!0);document.addEventListener("touchcancel",or,!0)},go=function(){var r,i,t;return n.print(),r=u[0].toDataURL(),i="javascript:window.print();",jq.browser.opera||(i+=" window.close();"),t="<!DOCTYPE html>",t+="<html>",t+="<head>",t+="<title>"+document.title+"<\/title>",t+="<style>@media print{img{height:90%;} @page { size: landscape; }}<\/style>",t+="<\/head>",t+='<body style="margin:0;padding:0;" onload="'+i+'">',t+='<img src="'+r+'">',t+="<\/body>",t+"<\/html>"},l=null,ru,ns=function(t,i,r,u){ru=u;null===l&&(l=document.createElement("input"),l&&(l.id="datepicker-chart",l.style.color="transparent",l.style.border="none",l.style.position="absolute",l.style.zIndex=100,l.style.width="0px",l.style.height="30px",l.style.background="transparent",l.onfocus="this.blur()",document.body.appendChild(l),jq("#datepicker-chart").mask("dd.MM.yyyy"),jq("#datepicker-chart").datepicker({onSelect:function(){n.modelController().finalizeOperation("timechanage",{time:jq("#datepicker-chart").datepicker("getDate"),direction:ru})}})));l&&(l.style.left=i.left+10+"px",l.style.top=i.top-26+"px",l.style.display=t?"":"none",r.isMilestone()?jq("#datepicker-chart").datepicker("setDate",r.endDate()):jq("#datepicker-chart").datepicker("setDate",!ru||r.isUndefinedEndTime()?r.beginDate():r.endDate()),jq("#datepicker-chart").datepicker(t?"show":"hide"),jq("#ui-datepicker-div").focus())};return{init:au,enableChartEvents:y,disableChartEvents:p}}(jQuery);ASC.Projects.Settings=function(){function t(){Teamlab.getPrjSettings({success:function(t,i){var r=ASC.Projects.Resources.StartModules,u=r.find(function(n){return n.StartModuleType===ASC.Projects.Master.StartModuleType})||r[0];i.startModuleTitle=u.Title;jq("#settings").html(jq.tmpl("projects_settings",i));var f=jq("#cbxEnableSettings"),e=jq("#cbxHideSettings"),o=jq("#startModule");f.on("change",function(){n({everebodyCanCreate:f.is(":checked")})});e.on("change",function(){n({hideEntitiesInPausedProjects:e.is(":checked")})});o.advancedSelector({height:104,itemsSelectedIds:[u.StartModuleType],onechosen:!0,showSearch:!1,itemsChoose:r.map(function(n){return{id:n.StartModuleType,title:n.Title}}),sortMethod:function(){return 0}}).on("showList",function(t,i){o.html(i.title).attr("title",i.title);n({startModule:i.id})})}})}function n(n){Teamlab.updatePrjSettings(n,{success:function(){ASC.Projects.Common.displayInfoPanel(ASC.Resources.Master.Resource.ChangesSuccessfullyAppliedMsg)},error:function(){ASC.Projects.Common.displayInfoPanel(ASC.Resources.Master.Resource.CommonJSErrorMsg,!0)}})}return{init:t}}();jq(document).ready(function(){ASC.Projects.Settings.init()})